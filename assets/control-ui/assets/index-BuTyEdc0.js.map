{"version":3,"file":"index-BuTyEdc0.js","sources":["../../../ui/src/ui/controllers/channels.ts","../../../ui/src/ui/controllers/config/form-utils.ts","../../../ui/src/ui/controllers/config.ts","../../../ui/src/ui/views/channels.nostr-profile-form.ts","../../../ui/src/ui/app-channels.ts","../../../src/sessions/session-key-utils.ts","../../../ui/src/ui/app-scroll.ts","../../../ui/src/ui/controllers/debug.ts","../../../ui/src/ui/controllers/logs.ts","../../../ui/src/ui/controllers/nodes.ts","../../../ui/src/ui/app-polling.ts","../../../ui/src/ui/controllers/agent-identity.ts","../../../ui/src/ui/controllers/agent-skills.ts","../../../ui/src/ui/controllers/agents.ts","../../../src/shared/text/reasoning-tags.ts","../../../ui/src/ui/format.ts","../../../ui/src/ui/controllers/cron.ts","../../../ui/src/ui/device-auth.ts","../../../node_modules/.pnpm/@noble+ed25519@3.0.0/node_modules/@noble/ed25519/index.js","../../../ui/src/ui/device-identity.ts","../../../ui/src/ui/controllers/devices.ts","../../../ui/src/ui/controllers/exec-approvals.ts","../../../ui/src/ui/controllers/presence.ts","../../../ui/src/ui/controllers/sessions.ts","../../../ui/src/ui/controllers/skills.ts","../../../ui/src/ui/navigation.ts","../../../ui/src/ui/storage.ts","../../../ui/src/ui/theme.ts","../../../ui/src/ui/theme-transition.ts","../../../ui/src/ui/app-settings.ts","../../../ui/src/ui/app-tool-stream.ts","../../../ui/src/ui/chat/message-extract.ts","../../../ui/src/ui/uuid.ts","../../../ui/src/ui/controllers/chat.ts","../../../ui/src/ui/app-chat.ts","../../../ui/src/ui/app-defaults.ts","../../../ui/src/ui/assistant-identity.ts","../../../ui/src/ui/controllers/assistant-identity.ts","../../../ui/src/ui/controllers/exec-approval.ts","../../../src/gateway/device-auth.ts","../../../src/gateway/protocol/client-info.ts","../../../ui/src/ui/gateway.ts","../../../ui/src/ui/app-gateway.ts","../../../ui/src/ui/app-lifecycle.ts","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/async-directive.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directives/ref.js","../../../ui/src/ui/icons.ts","../../../ui/src/ui/app-render.helpers.ts","../../../ui/src/ui/controllers/agent-files.ts","../../../src/agents/tool-policy.ts","../../../ui/src/ui/presenter.ts","../../../ui/src/ui/views/agents.ts","../../../ui/src/ui/views/config-form.shared.ts","../../../ui/src/ui/views/config-form.node.ts","../../../ui/src/ui/views/config-form.render.ts","../../../ui/src/ui/views/config-form.analyze.ts","../../../ui/src/ui/views/channels.config.ts","../../../ui/src/ui/views/channels.discord.ts","../../../ui/src/ui/views/channels.googlechat.ts","../../../ui/src/ui/views/channels.imessage.ts","../../../ui/src/ui/views/channels.nostr.ts","../../../ui/src/ui/views/channels.shared.ts","../../../ui/src/ui/views/channels.signal.ts","../../../ui/src/ui/views/channels.slack.ts","../../../ui/src/ui/views/channels.telegram.ts","../../../ui/src/ui/views/channels.whatsapp.ts","../../../ui/src/ui/views/channels.ts","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directives/unsafe-html.js","../../../ui/src/ui/markdown.ts","../../../ui/src/ui/chat/copy-as-markdown.ts","../../../ui/src/ui/chat/copy-code-block.ts","../../../ui/src/ui/chat/message-normalizer.ts","../../../ui/src/ui/tool-display.ts","../../../ui/src/ui/chat/constants.ts","../../../ui/src/ui/chat/tool-helpers.ts","../../../ui/src/ui/chat/tool-cards.ts","../../../ui/src/ui/chat/grouped-render.ts","../../../ui/src/ui/views/markdown-sidebar.ts","../../../ui/src/ui/components/resizable-divider.ts","../../../ui/src/ui/views/chat.ts","../../../ui/src/ui/views/config.ts","../../../ui/src/ui/views/cron.ts","../../../ui/src/ui/views/debug.ts","../../../ui/src/ui/views/exec-approval.ts","../../../ui/src/ui/views/gateway-url-confirmation.ts","../../../ui/src/ui/views/instances.ts","../../../ui/src/ui/views/logs.ts","../../../ui/src/ui/views/nodes.ts","../../../ui/src/ui/views/overview.ts","../../../ui/src/ui/views/sessions.ts","../../../ui/src/ui/views/skills.ts","../../../ui/src/ui/app-render.ts","../../../ui/src/ui/app.ts"],"sourcesContent":["import type { ChannelsState } from \"./channels.types\";\n\nexport type { ChannelsState };\n\nexport async function loadChannels(state: ChannelsState, probe: boolean) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.channelsLoading) {\n    return;\n  }\n  state.channelsLoading = true;\n  state.channelsError = null;\n  try {\n    const res = await state.client.request(\"channels.status\", {\n      probe,\n      timeoutMs: 8000,\n    });\n    state.channelsSnapshot = res;\n    state.channelsLastSuccess = Date.now();\n  } catch (err) {\n    state.channelsError = String(err);\n  } finally {\n    state.channelsLoading = false;\n  }\n}\n\nexport async function startWhatsAppLogin(state: ChannelsState, force: boolean) {\n  if (!state.client || !state.connected || state.whatsappBusy) {\n    return;\n  }\n  state.whatsappBusy = true;\n  try {\n    const res = await state.client.request(\"web.login.start\", {\n      force,\n      timeoutMs: 30000,\n    });\n    state.whatsappLoginMessage = res.message ?? null;\n    state.whatsappLoginQrDataUrl = res.qrDataUrl ?? null;\n    state.whatsappLoginConnected = null;\n  } catch (err) {\n    state.whatsappLoginMessage = String(err);\n    state.whatsappLoginQrDataUrl = null;\n    state.whatsappLoginConnected = null;\n  } finally {\n    state.whatsappBusy = false;\n  }\n}\n\nexport async function waitWhatsAppLogin(state: ChannelsState) {\n  if (!state.client || !state.connected || state.whatsappBusy) {\n    return;\n  }\n  state.whatsappBusy = true;\n  try {\n    const res = await state.client.request(\"web.login.wait\", {\n      timeoutMs: 120000,\n    });\n    state.whatsappLoginMessage = res.message ?? null;\n    state.whatsappLoginConnected = res.connected ?? null;\n    if (res.connected) {\n      state.whatsappLoginQrDataUrl = null;\n    }\n  } catch (err) {\n    state.whatsappLoginMessage = String(err);\n    state.whatsappLoginConnected = null;\n  } finally {\n    state.whatsappBusy = false;\n  }\n}\n\nexport async function logoutWhatsApp(state: ChannelsState) {\n  if (!state.client || !state.connected || state.whatsappBusy) {\n    return;\n  }\n  state.whatsappBusy = true;\n  try {\n    await state.client.request(\"channels.logout\", { channel: \"whatsapp\" });\n    state.whatsappLoginMessage = \"Logged out.\";\n    state.whatsappLoginQrDataUrl = null;\n    state.whatsappLoginConnected = null;\n  } catch (err) {\n    state.whatsappLoginMessage = String(err);\n  } finally {\n    state.whatsappBusy = false;\n  }\n}\n","export function cloneConfigObject<T>(value: T): T {\n  if (typeof structuredClone === \"function\") {\n    return structuredClone(value);\n  }\n  return JSON.parse(JSON.stringify(value)) as T;\n}\n\nexport function serializeConfigForm(form: Record<string, unknown>): string {\n  return `${JSON.stringify(form, null, 2).trimEnd()}\\n`;\n}\n\nexport function setPathValue(\n  obj: Record<string, unknown> | unknown[],\n  path: Array<string | number>,\n  value: unknown,\n) {\n  if (path.length === 0) {\n    return;\n  }\n  let current: Record<string, unknown> | unknown[] = obj;\n  for (let i = 0; i < path.length - 1; i += 1) {\n    const key = path[i];\n    const nextKey = path[i + 1];\n    if (typeof key === \"number\") {\n      if (!Array.isArray(current)) {\n        return;\n      }\n      if (current[key] == null) {\n        current[key] = typeof nextKey === \"number\" ? [] : ({} as Record<string, unknown>);\n      }\n      current = current[key] as Record<string, unknown> | unknown[];\n    } else {\n      if (typeof current !== \"object\" || current == null) {\n        return;\n      }\n      const record = current as Record<string, unknown>;\n      if (record[key] == null) {\n        record[key] = typeof nextKey === \"number\" ? [] : ({} as Record<string, unknown>);\n      }\n      current = record[key] as Record<string, unknown> | unknown[];\n    }\n  }\n  const lastKey = path[path.length - 1];\n  if (typeof lastKey === \"number\") {\n    if (Array.isArray(current)) {\n      current[lastKey] = value;\n    }\n    return;\n  }\n  if (typeof current === \"object\" && current != null) {\n    (current as Record<string, unknown>)[lastKey] = value;\n  }\n}\n\nexport function removePathValue(\n  obj: Record<string, unknown> | unknown[],\n  path: Array<string | number>,\n) {\n  if (path.length === 0) {\n    return;\n  }\n  let current: Record<string, unknown> | unknown[] = obj;\n  for (let i = 0; i < path.length - 1; i += 1) {\n    const key = path[i];\n    if (typeof key === \"number\") {\n      if (!Array.isArray(current)) {\n        return;\n      }\n      current = current[key] as Record<string, unknown> | unknown[];\n    } else {\n      if (typeof current !== \"object\" || current == null) {\n        return;\n      }\n      current = (current as Record<string, unknown>)[key] as Record<string, unknown> | unknown[];\n    }\n    if (current == null) {\n      return;\n    }\n  }\n  const lastKey = path[path.length - 1];\n  if (typeof lastKey === \"number\") {\n    if (Array.isArray(current)) {\n      current.splice(lastKey, 1);\n    }\n    return;\n  }\n  if (typeof current === \"object\" && current != null) {\n    delete (current as Record<string, unknown>)[lastKey];\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { ConfigSchemaResponse, ConfigSnapshot, ConfigUiHints } from \"../types\";\nimport {\n  cloneConfigObject,\n  removePathValue,\n  serializeConfigForm,\n  setPathValue,\n} from \"./config/form-utils\";\n\nexport type ConfigState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  applySessionKey: string;\n  configLoading: boolean;\n  configRaw: string;\n  configRawOriginal: string;\n  configValid: boolean | null;\n  configIssues: unknown[];\n  configSaving: boolean;\n  configApplying: boolean;\n  updateRunning: boolean;\n  configSnapshot: ConfigSnapshot | null;\n  configSchema: unknown;\n  configSchemaVersion: string | null;\n  configSchemaLoading: boolean;\n  configUiHints: ConfigUiHints;\n  configForm: Record<string, unknown> | null;\n  configFormOriginal: Record<string, unknown> | null;\n  configFormDirty: boolean;\n  configFormMode: \"form\" | \"raw\";\n  configSearchQuery: string;\n  configActiveSection: string | null;\n  configActiveSubsection: string | null;\n  lastError: string | null;\n  showToast?: (type: \"success\" | \"error\" | \"info\" | \"loading\", message: string) => void;\n};\n\nexport async function loadConfig(state: ConfigState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.configLoading = true;\n  state.lastError = null;\n  try {\n    const res = await state.client.request(\"config.get\", {});\n    applyConfigSnapshot(state, res);\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.configLoading = false;\n  }\n}\n\nexport async function loadConfigSchema(state: ConfigState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.configSchemaLoading) {\n    return;\n  }\n  state.configSchemaLoading = true;\n  try {\n    const res = await state.client.request(\"config.schema\", {});\n    applyConfigSchema(state, res);\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.configSchemaLoading = false;\n  }\n}\n\nexport function applyConfigSchema(state: ConfigState, res: ConfigSchemaResponse) {\n  state.configSchema = res.schema ?? null;\n  state.configUiHints = res.uiHints ?? {};\n  state.configSchemaVersion = res.version ?? null;\n}\n\nexport function applyConfigSnapshot(state: ConfigState, snapshot: ConfigSnapshot) {\n  state.configSnapshot = snapshot;\n  const rawFromSnapshot =\n    typeof snapshot.raw === \"string\"\n      ? snapshot.raw\n      : snapshot.config && typeof snapshot.config === \"object\"\n        ? serializeConfigForm(snapshot.config)\n        : state.configRaw;\n  if (!state.configFormDirty || state.configFormMode === \"raw\") {\n    state.configRaw = rawFromSnapshot;\n  } else if (state.configForm) {\n    state.configRaw = serializeConfigForm(state.configForm);\n  } else {\n    state.configRaw = rawFromSnapshot;\n  }\n  state.configValid = typeof snapshot.valid === \"boolean\" ? snapshot.valid : null;\n  state.configIssues = Array.isArray(snapshot.issues) ? snapshot.issues : [];\n\n  if (!state.configFormDirty) {\n    state.configForm = cloneConfigObject(snapshot.config ?? {});\n    state.configFormOriginal = cloneConfigObject(snapshot.config ?? {});\n    state.configRawOriginal = rawFromSnapshot;\n  }\n}\n\nexport async function saveConfig(state: ConfigState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.configSaving = true;\n  state.lastError = null;\n  try {\n    const raw =\n      state.configFormMode === \"form\" && state.configForm\n        ? serializeConfigForm(state.configForm)\n        : state.configRaw;\n    const baseHash = state.configSnapshot?.hash;\n    if (!baseHash) {\n      state.lastError = \"Config hash missing; reload and retry.\";\n      return;\n    }\n    await state.client.request(\"config.set\", { raw, baseHash });\n    state.configFormDirty = false;\n    await loadConfig(state);\n    state.showToast?.(\"success\", \"Config saved\");\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.configSaving = false;\n  }\n}\n\nexport async function applyConfig(state: ConfigState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.configApplying = true;\n  state.lastError = null;\n  try {\n    const raw =\n      state.configFormMode === \"form\" && state.configForm\n        ? serializeConfigForm(state.configForm)\n        : state.configRaw;\n    const baseHash = state.configSnapshot?.hash;\n    if (!baseHash) {\n      state.lastError = \"Config hash missing; reload and retry.\";\n      return;\n    }\n    await state.client.request(\"config.apply\", {\n      raw,\n      baseHash,\n      sessionKey: state.applySessionKey,\n    });\n    state.configFormDirty = false;\n    await loadConfig(state);\n    state.showToast?.(\"success\", \"Config applied\");\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.configApplying = false;\n  }\n}\n\nexport async function runUpdate(state: ConfigState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.updateRunning = true;\n  state.lastError = null;\n  try {\n    await state.client.request(\"update.run\", {\n      sessionKey: state.applySessionKey,\n    });\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.updateRunning = false;\n  }\n}\n\nexport function updateConfigFormValue(\n  state: ConfigState,\n  path: Array<string | number>,\n  value: unknown,\n) {\n  const base = cloneConfigObject(state.configForm ?? state.configSnapshot?.config ?? {});\n  setPathValue(base, path, value);\n  state.configForm = base;\n  state.configFormDirty = true;\n  if (state.configFormMode === \"form\") {\n    state.configRaw = serializeConfigForm(base);\n  }\n}\n\nexport function removeConfigFormValue(state: ConfigState, path: Array<string | number>) {\n  const base = cloneConfigObject(state.configForm ?? state.configSnapshot?.config ?? {});\n  removePathValue(base, path);\n  state.configForm = base;\n  state.configFormDirty = true;\n  if (state.configFormMode === \"form\") {\n    state.configRaw = serializeConfigForm(base);\n  }\n}\n","/**\n * Nostr Profile Edit Form\n *\n * Provides UI for editing and publishing Nostr profile (kind:0).\n */\n\nimport { html, nothing, type TemplateResult } from \"lit\";\nimport type { NostrProfile as NostrProfileType } from \"../types\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface NostrProfileFormState {\n  /** Current form values */\n  values: NostrProfileType;\n  /** Original values for dirty detection */\n  original: NostrProfileType;\n  /** Whether the form is currently submitting */\n  saving: boolean;\n  /** Whether import is in progress */\n  importing: boolean;\n  /** Last error message */\n  error: string | null;\n  /** Last success message */\n  success: string | null;\n  /** Validation errors per field */\n  fieldErrors: Record<string, string>;\n  /** Whether to show advanced fields */\n  showAdvanced: boolean;\n}\n\nexport interface NostrProfileFormCallbacks {\n  /** Called when a field value changes */\n  onFieldChange: (field: keyof NostrProfileType, value: string) => void;\n  /** Called when save is clicked */\n  onSave: () => void;\n  /** Called when import is clicked */\n  onImport: () => void;\n  /** Called when cancel is clicked */\n  onCancel: () => void;\n  /** Called when toggle advanced is clicked */\n  onToggleAdvanced: () => void;\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction isFormDirty(state: NostrProfileFormState): boolean {\n  const { values, original } = state;\n  return (\n    values.name !== original.name ||\n    values.displayName !== original.displayName ||\n    values.about !== original.about ||\n    values.picture !== original.picture ||\n    values.banner !== original.banner ||\n    values.website !== original.website ||\n    values.nip05 !== original.nip05 ||\n    values.lud16 !== original.lud16\n  );\n}\n\n// ============================================================================\n// Form Rendering\n// ============================================================================\n\nexport function renderNostrProfileForm(params: {\n  state: NostrProfileFormState;\n  callbacks: NostrProfileFormCallbacks;\n  accountId: string;\n}): TemplateResult {\n  const { state, callbacks, accountId } = params;\n  const isDirty = isFormDirty(state);\n\n  const renderField = (\n    field: keyof NostrProfileType,\n    label: string,\n    opts: {\n      type?: \"text\" | \"url\" | \"textarea\";\n      placeholder?: string;\n      maxLength?: number;\n      help?: string;\n    } = {},\n  ) => {\n    const { type = \"text\", placeholder, maxLength, help } = opts;\n    const value = state.values[field] ?? \"\";\n    const error = state.fieldErrors[field];\n\n    const inputId = `nostr-profile-${field}`;\n\n    if (type === \"textarea\") {\n      return html`\n        <div class=\"form-field\" style=\"margin-bottom: 12px;\">\n          <label for=\"${inputId}\" style=\"display: block; margin-bottom: 4px; font-weight: 500;\">\n            ${label}\n          </label>\n          <textarea\n            id=\"${inputId}\"\n            .value=${value}\n            placeholder=${placeholder ?? \"\"}\n            maxlength=${maxLength ?? 2000}\n            rows=\"3\"\n            style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; font-family: inherit;\"\n            @input=${(e: InputEvent) => {\n              const target = e.target as HTMLTextAreaElement;\n              callbacks.onFieldChange(field, target.value);\n            }}\n            ?disabled=${state.saving}\n          ></textarea>\n          ${help ? html`<div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px;\">${help}</div>` : nothing}\n          ${error ? html`<div style=\"font-size: 12px; color: var(--danger-color); margin-top: 2px;\">${error}</div>` : nothing}\n        </div>\n      `;\n    }\n\n    return html`\n      <div class=\"form-field\" style=\"margin-bottom: 12px;\">\n        <label for=\"${inputId}\" style=\"display: block; margin-bottom: 4px; font-weight: 500;\">\n          ${label}\n        </label>\n        <input\n          id=\"${inputId}\"\n          type=${type}\n          .value=${value}\n          placeholder=${placeholder ?? \"\"}\n          maxlength=${maxLength ?? 256}\n          style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;\"\n          @input=${(e: InputEvent) => {\n            const target = e.target as HTMLInputElement;\n            callbacks.onFieldChange(field, target.value);\n          }}\n          ?disabled=${state.saving}\n        />\n        ${help ? html`<div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px;\">${help}</div>` : nothing}\n        ${error ? html`<div style=\"font-size: 12px; color: var(--danger-color); margin-top: 2px;\">${error}</div>` : nothing}\n      </div>\n    `;\n  };\n\n  const renderPicturePreview = () => {\n    const picture = state.values.picture;\n    if (!picture) {\n      return nothing;\n    }\n\n    return html`\n      <div style=\"margin-bottom: 12px;\">\n        <img\n          src=${picture}\n          alt=\"Profile picture preview\"\n          style=\"max-width: 80px; max-height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color);\"\n          @error=${(e: Event) => {\n            const img = e.target as HTMLImageElement;\n            img.style.display = \"none\";\n          }}\n          @load=${(e: Event) => {\n            const img = e.target as HTMLImageElement;\n            img.style.display = \"block\";\n          }}\n        />\n      </div>\n    `;\n  };\n\n  return html`\n    <div class=\"nostr-profile-form\" style=\"padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-top: 12px;\">\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n        <div style=\"font-weight: 600; font-size: 16px;\">Edit Profile</div>\n        <div style=\"font-size: 12px; color: var(--text-muted);\">Account: ${accountId}</div>\n      </div>\n\n      ${\n        state.error\n          ? html`<div class=\"callout danger\" style=\"margin-bottom: 12px;\">${state.error}</div>`\n          : nothing\n      }\n\n      ${\n        state.success\n          ? html`<div class=\"callout success\" style=\"margin-bottom: 12px;\">${state.success}</div>`\n          : nothing\n      }\n\n      ${renderPicturePreview()}\n\n      ${renderField(\"name\", \"Username\", {\n        placeholder: \"satoshi\",\n        maxLength: 256,\n        help: \"Short username (e.g., satoshi)\",\n      })}\n\n      ${renderField(\"displayName\", \"Display Name\", {\n        placeholder: \"Satoshi Nakamoto\",\n        maxLength: 256,\n        help: \"Your full display name\",\n      })}\n\n      ${renderField(\"about\", \"Bio\", {\n        type: \"textarea\",\n        placeholder: \"Tell people about yourself...\",\n        maxLength: 2000,\n        help: \"A brief bio or description\",\n      })}\n\n      ${renderField(\"picture\", \"Avatar URL\", {\n        type: \"url\",\n        placeholder: \"https://example.com/avatar.jpg\",\n        help: \"HTTPS URL to your profile picture\",\n      })}\n\n      ${\n        state.showAdvanced\n          ? html`\n            <div style=\"border-top: 1px solid var(--border-color); padding-top: 12px; margin-top: 12px;\">\n              <div style=\"font-weight: 500; margin-bottom: 12px; color: var(--text-muted);\">Advanced</div>\n\n              ${renderField(\"banner\", \"Banner URL\", {\n                type: \"url\",\n                placeholder: \"https://example.com/banner.jpg\",\n                help: \"HTTPS URL to a banner image\",\n              })}\n\n              ${renderField(\"website\", \"Website\", {\n                type: \"url\",\n                placeholder: \"https://example.com\",\n                help: \"Your personal website\",\n              })}\n\n              ${renderField(\"nip05\", \"NIP-05 Identifier\", {\n                placeholder: \"you@example.com\",\n                help: \"Verifiable identifier (e.g., you@domain.com)\",\n              })}\n\n              ${renderField(\"lud16\", \"Lightning Address\", {\n                placeholder: \"you@getalby.com\",\n                help: \"Lightning address for tips (LUD-16)\",\n              })}\n            </div>\n          `\n          : nothing\n      }\n\n      <div style=\"display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;\">\n        <button\n          class=\"btn primary\"\n          @click=${callbacks.onSave}\n          ?disabled=${state.saving || !isDirty}\n        >\n          ${state.saving ? \"Saving...\" : \"Save & Publish\"}\n        </button>\n\n        <button\n          class=\"btn\"\n          @click=${callbacks.onImport}\n          ?disabled=${state.importing || state.saving}\n        >\n          ${state.importing ? \"Importing...\" : \"Import from Relays\"}\n        </button>\n\n        <button\n          class=\"btn\"\n          @click=${callbacks.onToggleAdvanced}\n        >\n          ${state.showAdvanced ? \"Hide Advanced\" : \"Show Advanced\"}\n        </button>\n\n        <button\n          class=\"btn\"\n          @click=${callbacks.onCancel}\n          ?disabled=${state.saving}\n        >\n          Cancel\n        </button>\n      </div>\n\n      ${\n        isDirty\n          ? html`\n              <div style=\"font-size: 12px; color: var(--warning-color); margin-top: 8px\">\n                You have unsaved changes\n              </div>\n            `\n          : nothing\n      }\n    </div>\n  `;\n}\n\n// ============================================================================\n// Factory\n// ============================================================================\n\n/**\n * Create initial form state from existing profile\n */\nexport function createNostrProfileFormState(\n  profile: NostrProfileType | undefined,\n): NostrProfileFormState {\n  const values: NostrProfileType = {\n    name: profile?.name ?? \"\",\n    displayName: profile?.displayName ?? \"\",\n    about: profile?.about ?? \"\",\n    picture: profile?.picture ?? \"\",\n    banner: profile?.banner ?? \"\",\n    website: profile?.website ?? \"\",\n    nip05: profile?.nip05 ?? \"\",\n    lud16: profile?.lud16 ?? \"\",\n  };\n\n  return {\n    values,\n    original: { ...values },\n    saving: false,\n    importing: false,\n    error: null,\n    success: null,\n    fieldErrors: {},\n    showAdvanced: Boolean(profile?.banner || profile?.website || profile?.nip05 || profile?.lud16),\n  };\n}\n","import type { OpenClawApp } from \"./app\";\nimport type { NostrProfile } from \"./types\";\nimport {\n  loadChannels,\n  logoutWhatsApp,\n  startWhatsAppLogin,\n  waitWhatsAppLogin,\n} from \"./controllers/channels\";\nimport { loadConfig, saveConfig } from \"./controllers/config\";\nimport { createNostrProfileFormState } from \"./views/channels.nostr-profile-form\";\n\nexport async function handleWhatsAppStart(host: OpenClawApp, force: boolean) {\n  await startWhatsAppLogin(host, force);\n  await loadChannels(host, true);\n}\n\nexport async function handleWhatsAppWait(host: OpenClawApp) {\n  await waitWhatsAppLogin(host);\n  await loadChannels(host, true);\n}\n\nexport async function handleWhatsAppLogout(host: OpenClawApp) {\n  await logoutWhatsApp(host);\n  await loadChannels(host, true);\n}\n\nexport async function handleChannelConfigSave(host: OpenClawApp) {\n  await saveConfig(host);\n  await loadConfig(host);\n  await loadChannels(host, true);\n}\n\nexport async function handleChannelConfigReload(host: OpenClawApp) {\n  await loadConfig(host);\n  await loadChannels(host, true);\n}\n\nfunction parseValidationErrors(details: unknown): Record<string, string> {\n  if (!Array.isArray(details)) {\n    return {};\n  }\n  const errors: Record<string, string> = {};\n  for (const entry of details) {\n    if (typeof entry !== \"string\") {\n      continue;\n    }\n    const [rawField, ...rest] = entry.split(\":\");\n    if (!rawField || rest.length === 0) {\n      continue;\n    }\n    const field = rawField.trim();\n    const message = rest.join(\":\").trim();\n    if (field && message) {\n      errors[field] = message;\n    }\n  }\n  return errors;\n}\n\nfunction resolveNostrAccountId(host: OpenClawApp): string {\n  const accounts = host.channelsSnapshot?.channelAccounts?.nostr ?? [];\n  return accounts[0]?.accountId ?? host.nostrProfileAccountId ?? \"default\";\n}\n\nfunction buildNostrProfileUrl(accountId: string, suffix = \"\"): string {\n  return `/api/channels/nostr/${encodeURIComponent(accountId)}/profile${suffix}`;\n}\n\nexport function handleNostrProfileEdit(\n  host: OpenClawApp,\n  accountId: string,\n  profile: NostrProfile | null,\n) {\n  host.nostrProfileAccountId = accountId;\n  host.nostrProfileFormState = createNostrProfileFormState(profile ?? undefined);\n}\n\nexport function handleNostrProfileCancel(host: OpenClawApp) {\n  host.nostrProfileFormState = null;\n  host.nostrProfileAccountId = null;\n}\n\nexport function handleNostrProfileFieldChange(\n  host: OpenClawApp,\n  field: keyof NostrProfile,\n  value: string,\n) {\n  const state = host.nostrProfileFormState;\n  if (!state) {\n    return;\n  }\n  host.nostrProfileFormState = {\n    ...state,\n    values: {\n      ...state.values,\n      [field]: value,\n    },\n    fieldErrors: {\n      ...state.fieldErrors,\n      [field]: \"\",\n    },\n  };\n}\n\nexport function handleNostrProfileToggleAdvanced(host: OpenClawApp) {\n  const state = host.nostrProfileFormState;\n  if (!state) {\n    return;\n  }\n  host.nostrProfileFormState = {\n    ...state,\n    showAdvanced: !state.showAdvanced,\n  };\n}\n\nexport async function handleNostrProfileSave(host: OpenClawApp) {\n  const state = host.nostrProfileFormState;\n  if (!state || state.saving) {\n    return;\n  }\n  const accountId = resolveNostrAccountId(host);\n\n  host.nostrProfileFormState = {\n    ...state,\n    saving: true,\n    error: null,\n    success: null,\n    fieldErrors: {},\n  };\n\n  try {\n    const response = await fetch(buildNostrProfileUrl(accountId), {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(state.values),\n    });\n    const data = (await response.json().catch(() => null)) as {\n      ok?: boolean;\n      error?: string;\n      details?: unknown;\n      persisted?: boolean;\n    } | null;\n\n    if (!response.ok || data?.ok === false || !data) {\n      const errorMessage = data?.error ?? `Profile update failed (${response.status})`;\n      host.nostrProfileFormState = {\n        ...state,\n        saving: false,\n        error: errorMessage,\n        success: null,\n        fieldErrors: parseValidationErrors(data?.details),\n      };\n      return;\n    }\n\n    if (!data.persisted) {\n      host.nostrProfileFormState = {\n        ...state,\n        saving: false,\n        error: \"Profile publish failed on all relays.\",\n        success: null,\n      };\n      return;\n    }\n\n    host.nostrProfileFormState = {\n      ...state,\n      saving: false,\n      error: null,\n      success: \"Profile published to relays.\",\n      fieldErrors: {},\n      original: { ...state.values },\n    };\n    await loadChannels(host, true);\n  } catch (err) {\n    host.nostrProfileFormState = {\n      ...state,\n      saving: false,\n      error: `Profile update failed: ${String(err)}`,\n      success: null,\n    };\n  }\n}\n\nexport async function handleNostrProfileImport(host: OpenClawApp) {\n  const state = host.nostrProfileFormState;\n  if (!state || state.importing) {\n    return;\n  }\n  const accountId = resolveNostrAccountId(host);\n\n  host.nostrProfileFormState = {\n    ...state,\n    importing: true,\n    error: null,\n    success: null,\n  };\n\n  try {\n    const response = await fetch(buildNostrProfileUrl(accountId, \"/import\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ autoMerge: true }),\n    });\n    const data = (await response.json().catch(() => null)) as {\n      ok?: boolean;\n      error?: string;\n      imported?: NostrProfile;\n      merged?: NostrProfile;\n      saved?: boolean;\n    } | null;\n\n    if (!response.ok || data?.ok === false || !data) {\n      const errorMessage = data?.error ?? `Profile import failed (${response.status})`;\n      host.nostrProfileFormState = {\n        ...state,\n        importing: false,\n        error: errorMessage,\n        success: null,\n      };\n      return;\n    }\n\n    const merged = data.merged ?? data.imported ?? null;\n    const nextValues = merged ? { ...state.values, ...merged } : state.values;\n    const showAdvanced = Boolean(\n      nextValues.banner || nextValues.website || nextValues.nip05 || nextValues.lud16,\n    );\n\n    host.nostrProfileFormState = {\n      ...state,\n      importing: false,\n      values: nextValues,\n      error: null,\n      success: data.saved\n        ? \"Profile imported from relays. Review and publish.\"\n        : \"Profile imported. Review and publish.\",\n      showAdvanced,\n    };\n\n    if (data.saved) {\n      await loadChannels(host, true);\n    }\n  } catch (err) {\n    host.nostrProfileFormState = {\n      ...state,\n      importing: false,\n      error: `Profile import failed: ${String(err)}`,\n      success: null,\n    };\n  }\n}\n","export type ParsedAgentSessionKey = {\n  agentId: string;\n  rest: string;\n};\n\nexport function parseAgentSessionKey(\n  sessionKey: string | undefined | null,\n): ParsedAgentSessionKey | null {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return null;\n  }\n  const parts = raw.split(\":\").filter(Boolean);\n  if (parts.length < 3) {\n    return null;\n  }\n  if (parts[0] !== \"agent\") {\n    return null;\n  }\n  const agentId = parts[1]?.trim();\n  const rest = parts.slice(2).join(\":\");\n  if (!agentId || !rest) {\n    return null;\n  }\n  return { agentId, rest };\n}\n\nexport function isSubagentSessionKey(sessionKey: string | undefined | null): boolean {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return false;\n  }\n  if (raw.toLowerCase().startsWith(\"subagent:\")) {\n    return true;\n  }\n  const parsed = parseAgentSessionKey(raw);\n  return Boolean((parsed?.rest ?? \"\").toLowerCase().startsWith(\"subagent:\"));\n}\n\nexport function isAcpSessionKey(sessionKey: string | undefined | null): boolean {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return false;\n  }\n  const normalized = raw.toLowerCase();\n  if (normalized.startsWith(\"acp:\")) {\n    return true;\n  }\n  const parsed = parseAgentSessionKey(raw);\n  return Boolean((parsed?.rest ?? \"\").toLowerCase().startsWith(\"acp:\"));\n}\n\nconst THREAD_SESSION_MARKERS = [\":thread:\", \":topic:\"];\n\nexport function resolveThreadParentSessionKey(\n  sessionKey: string | undefined | null,\n): string | null {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return null;\n  }\n  const normalized = raw.toLowerCase();\n  let idx = -1;\n  for (const marker of THREAD_SESSION_MARKERS) {\n    const candidate = normalized.lastIndexOf(marker);\n    if (candidate > idx) {\n      idx = candidate;\n    }\n  }\n  if (idx <= 0) {\n    return null;\n  }\n  const parent = raw.slice(0, idx).trim();\n  return parent ? parent : null;\n}\n","/** Distance (px) from the bottom within which we consider the user \"near bottom\". */\nconst NEAR_BOTTOM_THRESHOLD = 450;\n\ntype ScrollHost = {\n  updateComplete: Promise<unknown>;\n  querySelector: (selectors: string) => Element | null;\n  style: CSSStyleDeclaration;\n  chatScrollFrame: number | null;\n  chatScrollTimeout: number | null;\n  chatHasAutoScrolled: boolean;\n  chatUserNearBottom: boolean;\n  chatNewMessagesBelow: boolean;\n  logsScrollFrame: number | null;\n  logsAtBottom: boolean;\n  topbarObserver: ResizeObserver | null;\n};\n\nexport function scheduleChatScroll(host: ScrollHost, force = false) {\n  if (host.chatScrollFrame) {\n    cancelAnimationFrame(host.chatScrollFrame);\n  }\n  if (host.chatScrollTimeout != null) {\n    clearTimeout(host.chatScrollTimeout);\n    host.chatScrollTimeout = null;\n  }\n  const pickScrollTarget = () => {\n    const container = host.querySelector(\".chat-thread\") as HTMLElement | null;\n    if (container) {\n      const overflowY = getComputedStyle(container).overflowY;\n      const canScroll =\n        overflowY === \"auto\" ||\n        overflowY === \"scroll\" ||\n        container.scrollHeight - container.clientHeight > 1;\n      if (canScroll) {\n        return container;\n      }\n    }\n    return (document.scrollingElement ?? document.documentElement) as HTMLElement | null;\n  };\n  // Wait for Lit render to complete, then scroll\n  void host.updateComplete.then(() => {\n    host.chatScrollFrame = requestAnimationFrame(() => {\n      host.chatScrollFrame = null;\n      const target = pickScrollTarget();\n      if (!target) {\n        return;\n      }\n      const distanceFromBottom = target.scrollHeight - target.scrollTop - target.clientHeight;\n\n      // force=true only overrides when we haven't auto-scrolled yet (initial load).\n      // After initial load, respect the user's scroll position.\n      const effectiveForce = force && !host.chatHasAutoScrolled;\n      const shouldStick =\n        effectiveForce || host.chatUserNearBottom || distanceFromBottom < NEAR_BOTTOM_THRESHOLD;\n\n      if (!shouldStick) {\n        // User is scrolled up â€” flag that new content arrived below.\n        host.chatNewMessagesBelow = true;\n        return;\n      }\n      if (effectiveForce) {\n        host.chatHasAutoScrolled = true;\n      }\n      target.scrollTop = target.scrollHeight;\n      host.chatUserNearBottom = true;\n      host.chatNewMessagesBelow = false;\n      const retryDelay = effectiveForce ? 150 : 120;\n      host.chatScrollTimeout = window.setTimeout(() => {\n        host.chatScrollTimeout = null;\n        const latest = pickScrollTarget();\n        if (!latest) {\n          return;\n        }\n        const latestDistanceFromBottom =\n          latest.scrollHeight - latest.scrollTop - latest.clientHeight;\n        const shouldStickRetry =\n          effectiveForce ||\n          host.chatUserNearBottom ||\n          latestDistanceFromBottom < NEAR_BOTTOM_THRESHOLD;\n        if (!shouldStickRetry) {\n          return;\n        }\n        latest.scrollTop = latest.scrollHeight;\n        host.chatUserNearBottom = true;\n      }, retryDelay);\n    });\n  });\n}\n\nexport function scheduleLogsScroll(host: ScrollHost, force = false) {\n  if (host.logsScrollFrame) {\n    cancelAnimationFrame(host.logsScrollFrame);\n  }\n  void host.updateComplete.then(() => {\n    host.logsScrollFrame = requestAnimationFrame(() => {\n      host.logsScrollFrame = null;\n      const container = host.querySelector(\".log-stream\") as HTMLElement | null;\n      if (!container) {\n        return;\n      }\n      const distanceFromBottom =\n        container.scrollHeight - container.scrollTop - container.clientHeight;\n      const shouldStick = force || distanceFromBottom < 80;\n      if (!shouldStick) {\n        return;\n      }\n      container.scrollTop = container.scrollHeight;\n    });\n  });\n}\n\nexport function handleChatScroll(host: ScrollHost, event: Event) {\n  const container = event.currentTarget as HTMLElement | null;\n  if (!container) {\n    return;\n  }\n  const distanceFromBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n  host.chatUserNearBottom = distanceFromBottom < NEAR_BOTTOM_THRESHOLD;\n  // Clear the \"new messages below\" indicator when user scrolls back to bottom.\n  if (host.chatUserNearBottom) {\n    host.chatNewMessagesBelow = false;\n  }\n}\n\nexport function handleLogsScroll(host: ScrollHost, event: Event) {\n  const container = event.currentTarget as HTMLElement | null;\n  if (!container) {\n    return;\n  }\n  const distanceFromBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n  host.logsAtBottom = distanceFromBottom < 80;\n}\n\nexport function resetChatScroll(host: ScrollHost) {\n  host.chatHasAutoScrolled = false;\n  host.chatUserNearBottom = true;\n  host.chatNewMessagesBelow = false;\n}\n\nexport function exportLogs(lines: string[], label: string) {\n  if (lines.length === 0) {\n    return;\n  }\n  const blob = new Blob([`${lines.join(\"\\n\")}\\n`], { type: \"text/plain\" });\n  const url = URL.createObjectURL(blob);\n  const anchor = document.createElement(\"a\");\n  const stamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, \"-\");\n  anchor.href = url;\n  anchor.download = `openclaw-logs-${label}-${stamp}.log`;\n  anchor.click();\n  URL.revokeObjectURL(url);\n}\n\nexport function observeTopbar(host: ScrollHost) {\n  if (typeof ResizeObserver === \"undefined\") {\n    return;\n  }\n  const topbar = host.querySelector(\".topbar\");\n  if (!topbar) {\n    return;\n  }\n  const update = () => {\n    const { height } = topbar.getBoundingClientRect();\n    host.style.setProperty(\"--topbar-height\", `${height}px`);\n  };\n  update();\n  host.topbarObserver = new ResizeObserver(() => update());\n  host.topbarObserver.observe(topbar);\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { HealthSnapshot, StatusSummary } from \"../types\";\n\nexport type DebugState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  debugLoading: boolean;\n  debugStatus: StatusSummary | null;\n  debugHealth: HealthSnapshot | null;\n  debugModels: unknown[];\n  debugHeartbeat: unknown;\n  debugCallMethod: string;\n  debugCallParams: string;\n  debugCallResult: string | null;\n  debugCallError: string | null;\n};\n\nexport async function loadDebug(state: DebugState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.debugLoading) {\n    return;\n  }\n  state.debugLoading = true;\n  try {\n    const [status, health, models, heartbeat] = await Promise.all([\n      state.client.request(\"status\", {}),\n      state.client.request(\"health\", {}),\n      state.client.request(\"models.list\", {}),\n      state.client.request(\"last-heartbeat\", {}),\n    ]);\n    state.debugStatus = status as StatusSummary;\n    state.debugHealth = health as HealthSnapshot;\n    const modelPayload = models as { models?: unknown[] } | undefined;\n    state.debugModels = Array.isArray(modelPayload?.models) ? modelPayload?.models : [];\n    state.debugHeartbeat = heartbeat;\n  } catch (err) {\n    state.debugCallError = String(err);\n  } finally {\n    state.debugLoading = false;\n  }\n}\n\nexport async function callDebugMethod(state: DebugState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.debugCallError = null;\n  state.debugCallResult = null;\n  try {\n    const params = state.debugCallParams.trim()\n      ? (JSON.parse(state.debugCallParams) as unknown)\n      : {};\n    const res = await state.client.request(state.debugCallMethod.trim(), params);\n    state.debugCallResult = JSON.stringify(res, null, 2);\n  } catch (err) {\n    state.debugCallError = String(err);\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { LogEntry, LogLevel } from \"../types\";\n\nexport type LogsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  logsLoading: boolean;\n  logsError: string | null;\n  logsCursor: number | null;\n  logsFile: string | null;\n  logsEntries: LogEntry[];\n  logsTruncated: boolean;\n  logsLastFetchAt: number | null;\n  logsLimit: number;\n  logsMaxBytes: number;\n};\n\nconst LOG_BUFFER_LIMIT = 2000;\nconst LEVELS = new Set<LogLevel>([\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"fatal\"]);\n\nfunction parseMaybeJsonString(value: unknown) {\n  if (typeof value !== \"string\") {\n    return null;\n  }\n  const trimmed = value.trim();\n  if (!trimmed.startsWith(\"{\") || !trimmed.endsWith(\"}\")) {\n    return null;\n  }\n  try {\n    const parsed = JSON.parse(trimmed) as unknown;\n    if (!parsed || typeof parsed !== \"object\") {\n      return null;\n    }\n    return parsed as Record<string, unknown>;\n  } catch {\n    return null;\n  }\n}\n\nfunction normalizeLevel(value: unknown): LogLevel | null {\n  if (typeof value !== \"string\") {\n    return null;\n  }\n  const lowered = value.toLowerCase() as LogLevel;\n  return LEVELS.has(lowered) ? lowered : null;\n}\n\nexport function parseLogLine(line: string): LogEntry {\n  if (!line.trim()) {\n    return { raw: line, message: line };\n  }\n  try {\n    const obj = JSON.parse(line) as Record<string, unknown>;\n    const meta =\n      obj && typeof obj._meta === \"object\" && obj._meta !== null\n        ? (obj._meta as Record<string, unknown>)\n        : null;\n    const time =\n      typeof obj.time === \"string\" ? obj.time : typeof meta?.date === \"string\" ? meta?.date : null;\n    const level = normalizeLevel(meta?.logLevelName ?? meta?.level);\n\n    const contextCandidate =\n      typeof obj[\"0\"] === \"string\" ? obj[\"0\"] : typeof meta?.name === \"string\" ? meta?.name : null;\n    const contextObj = parseMaybeJsonString(contextCandidate);\n    let subsystem: string | null = null;\n    if (contextObj) {\n      if (typeof contextObj.subsystem === \"string\") {\n        subsystem = contextObj.subsystem;\n      } else if (typeof contextObj.module === \"string\") {\n        subsystem = contextObj.module;\n      }\n    }\n    if (!subsystem && contextCandidate && contextCandidate.length < 120) {\n      subsystem = contextCandidate;\n    }\n\n    let message: string | null = null;\n    if (typeof obj[\"1\"] === \"string\") {\n      message = obj[\"1\"];\n    } else if (!contextObj && typeof obj[\"0\"] === \"string\") {\n      message = obj[\"0\"];\n    } else if (typeof obj.message === \"string\") {\n      message = obj.message;\n    }\n\n    return {\n      raw: line,\n      time,\n      level,\n      subsystem,\n      message: message ?? line,\n      meta: meta ?? undefined,\n    };\n  } catch {\n    return { raw: line, message: line };\n  }\n}\n\nexport async function loadLogs(state: LogsState, opts?: { reset?: boolean; quiet?: boolean }) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.logsLoading && !opts?.quiet) {\n    return;\n  }\n  if (!opts?.quiet) {\n    state.logsLoading = true;\n  }\n  state.logsError = null;\n  try {\n    const res = await state.client.request(\"logs.tail\", {\n      cursor: opts?.reset ? undefined : (state.logsCursor ?? undefined),\n      limit: state.logsLimit,\n      maxBytes: state.logsMaxBytes,\n    });\n    const payload = res as {\n      file?: string;\n      cursor?: number;\n      size?: number;\n      lines?: unknown;\n      truncated?: boolean;\n      reset?: boolean;\n    };\n    const lines = Array.isArray(payload.lines)\n      ? payload.lines.filter((line) => typeof line === \"string\")\n      : [];\n    const entries = lines.map(parseLogLine);\n    const shouldReset = Boolean(opts?.reset || payload.reset || state.logsCursor == null);\n    state.logsEntries = shouldReset\n      ? entries\n      : [...state.logsEntries, ...entries].slice(-LOG_BUFFER_LIMIT);\n    if (typeof payload.cursor === \"number\") {\n      state.logsCursor = payload.cursor;\n    }\n    if (typeof payload.file === \"string\") {\n      state.logsFile = payload.file;\n    }\n    state.logsTruncated = Boolean(payload.truncated);\n    state.logsLastFetchAt = Date.now();\n  } catch (err) {\n    state.logsError = String(err);\n  } finally {\n    if (!opts?.quiet) {\n      state.logsLoading = false;\n    }\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\n\nexport type NodesState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  nodesLoading: boolean;\n  nodes: Array<Record<string, unknown>>;\n  lastError: string | null;\n};\n\nexport async function loadNodes(state: NodesState, opts?: { quiet?: boolean }) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.nodesLoading) {\n    return;\n  }\n  state.nodesLoading = true;\n  if (!opts?.quiet) {\n    state.lastError = null;\n  }\n  try {\n    const res = await state.client.request(\"node.list\", {});\n    state.nodes = Array.isArray(res.nodes) ? res.nodes : [];\n  } catch (err) {\n    if (!opts?.quiet) {\n      state.lastError = String(err);\n    }\n  } finally {\n    state.nodesLoading = false;\n  }\n}\n","import type { OpenClawApp } from \"./app\";\nimport { loadDebug } from \"./controllers/debug\";\nimport { loadLogs } from \"./controllers/logs\";\nimport { loadNodes } from \"./controllers/nodes\";\n\ntype PollingHost = {\n  nodesPollInterval: number | null;\n  logsPollInterval: number | null;\n  debugPollInterval: number | null;\n  tab: string;\n};\n\nexport function startNodesPolling(host: PollingHost) {\n  if (host.nodesPollInterval != null) {\n    return;\n  }\n  host.nodesPollInterval = window.setInterval(\n    () => void loadNodes(host as unknown as OpenClawApp, { quiet: true }),\n    5000,\n  );\n}\n\nexport function stopNodesPolling(host: PollingHost) {\n  if (host.nodesPollInterval == null) {\n    return;\n  }\n  clearInterval(host.nodesPollInterval);\n  host.nodesPollInterval = null;\n}\n\nexport function startLogsPolling(host: PollingHost) {\n  if (host.logsPollInterval != null) {\n    return;\n  }\n  host.logsPollInterval = window.setInterval(() => {\n    if (host.tab !== \"logs\") {\n      return;\n    }\n    void loadLogs(host as unknown as OpenClawApp, { quiet: true });\n  }, 2000);\n}\n\nexport function stopLogsPolling(host: PollingHost) {\n  if (host.logsPollInterval == null) {\n    return;\n  }\n  clearInterval(host.logsPollInterval);\n  host.logsPollInterval = null;\n}\n\nexport function startDebugPolling(host: PollingHost) {\n  if (host.debugPollInterval != null) {\n    return;\n  }\n  host.debugPollInterval = window.setInterval(() => {\n    if (host.tab !== \"debug\") {\n      return;\n    }\n    void loadDebug(host as unknown as OpenClawApp);\n  }, 3000);\n}\n\nexport function stopDebugPolling(host: PollingHost) {\n  if (host.debugPollInterval == null) {\n    return;\n  }\n  clearInterval(host.debugPollInterval);\n  host.debugPollInterval = null;\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { AgentIdentityResult } from \"../types\";\n\nexport type AgentIdentityState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  agentIdentityLoading: boolean;\n  agentIdentityError: string | null;\n  agentIdentityById: Record<string, AgentIdentityResult>;\n};\n\nexport async function loadAgentIdentity(state: AgentIdentityState, agentId: string) {\n  if (!state.client || !state.connected || state.agentIdentityLoading) {\n    return;\n  }\n  if (state.agentIdentityById[agentId]) {\n    return;\n  }\n  state.agentIdentityLoading = true;\n  state.agentIdentityError = null;\n  try {\n    const res = await state.client.request<AgentIdentityResult | null>(\"agent.identity.get\", {\n      agentId,\n    });\n    if (res) {\n      state.agentIdentityById = { ...state.agentIdentityById, [agentId]: res };\n    }\n  } catch (err) {\n    state.agentIdentityError = String(err);\n  } finally {\n    state.agentIdentityLoading = false;\n  }\n}\n\nexport async function loadAgentIdentities(state: AgentIdentityState, agentIds: string[]) {\n  if (!state.client || !state.connected || state.agentIdentityLoading) {\n    return;\n  }\n  const missing = agentIds.filter((id) => !state.agentIdentityById[id]);\n  if (missing.length === 0) {\n    return;\n  }\n  state.agentIdentityLoading = true;\n  state.agentIdentityError = null;\n  try {\n    for (const agentId of missing) {\n      const res = await state.client.request<AgentIdentityResult | null>(\"agent.identity.get\", {\n        agentId,\n      });\n      if (res) {\n        state.agentIdentityById = { ...state.agentIdentityById, [agentId]: res };\n      }\n    }\n  } catch (err) {\n    state.agentIdentityError = String(err);\n  } finally {\n    state.agentIdentityLoading = false;\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { SkillStatusReport } from \"../types\";\n\nexport type AgentSkillsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  agentSkillsLoading: boolean;\n  agentSkillsError: string | null;\n  agentSkillsReport: SkillStatusReport | null;\n  agentSkillsAgentId: string | null;\n};\n\nexport async function loadAgentSkills(state: AgentSkillsState, agentId: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.agentSkillsLoading) {\n    return;\n  }\n  state.agentSkillsLoading = true;\n  state.agentSkillsError = null;\n  try {\n    const res = await state.client.request(\"skills.status\", { agentId });\n    if (res) {\n      state.agentSkillsReport = res as SkillStatusReport;\n      state.agentSkillsAgentId = agentId;\n    }\n  } catch (err) {\n    state.agentSkillsError = String(err);\n  } finally {\n    state.agentSkillsLoading = false;\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { AgentsListResult } from \"../types\";\n\nexport type AgentsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  agentsLoading: boolean;\n  agentsError: string | null;\n  agentsList: AgentsListResult | null;\n  agentsSelectedId: string | null;\n};\n\nexport async function loadAgents(state: AgentsState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.agentsLoading) {\n    return;\n  }\n  state.agentsLoading = true;\n  state.agentsError = null;\n  try {\n    const res = await state.client.request(\"agents.list\", {});\n    if (res) {\n      state.agentsList = res;\n      const selected = state.agentsSelectedId;\n      const known = res.agents.some((entry) => entry.id === selected);\n      if (!selected || !known) {\n        state.agentsSelectedId = res.defaultId ?? res.agents[0]?.id ?? null;\n      }\n    }\n  } catch (err) {\n    state.agentsError = String(err);\n  } finally {\n    state.agentsLoading = false;\n  }\n}\n","export type ReasoningTagMode = \"strict\" | \"preserve\";\nexport type ReasoningTagTrim = \"none\" | \"start\" | \"both\";\n\nconst QUICK_TAG_RE = /<\\s*\\/?\\s*(?:think(?:ing)?|thought|antthinking|final)\\b/i;\nconst FINAL_TAG_RE = /<\\s*\\/?\\s*final\\b[^<>]*>/gi;\nconst THINKING_TAG_RE = /<\\s*(\\/?)\\s*(?:think(?:ing)?|thought|antthinking)\\b[^<>]*>/gi;\n\ninterface CodeRegion {\n  start: number;\n  end: number;\n}\n\nfunction findCodeRegions(text: string): CodeRegion[] {\n  const regions: CodeRegion[] = [];\n\n  const fencedRe = /(^|\\n)(```|~~~)[^\\n]*\\n[\\s\\S]*?(?:\\n\\2(?:\\n|$)|$)/g;\n  for (const match of text.matchAll(fencedRe)) {\n    const start = (match.index ?? 0) + match[1].length;\n    regions.push({ start, end: start + match[0].length - match[1].length });\n  }\n\n  const inlineRe = /`+[^`]+`+/g;\n  for (const match of text.matchAll(inlineRe)) {\n    const start = match.index ?? 0;\n    const end = start + match[0].length;\n    const insideFenced = regions.some((r) => start >= r.start && end <= r.end);\n    if (!insideFenced) {\n      regions.push({ start, end });\n    }\n  }\n\n  regions.sort((a, b) => a.start - b.start);\n  return regions;\n}\n\nfunction isInsideCode(pos: number, regions: CodeRegion[]): boolean {\n  return regions.some((r) => pos >= r.start && pos < r.end);\n}\n\nfunction applyTrim(value: string, mode: ReasoningTagTrim): string {\n  if (mode === \"none\") {\n    return value;\n  }\n  if (mode === \"start\") {\n    return value.trimStart();\n  }\n  return value.trim();\n}\n\nexport function stripReasoningTagsFromText(\n  text: string,\n  options?: {\n    mode?: ReasoningTagMode;\n    trim?: ReasoningTagTrim;\n  },\n): string {\n  if (!text) {\n    return text;\n  }\n  if (!QUICK_TAG_RE.test(text)) {\n    return text;\n  }\n\n  const mode = options?.mode ?? \"strict\";\n  const trimMode = options?.trim ?? \"both\";\n\n  let cleaned = text;\n  if (FINAL_TAG_RE.test(cleaned)) {\n    FINAL_TAG_RE.lastIndex = 0;\n    const finalMatches: Array<{ start: number; length: number; inCode: boolean }> = [];\n    const preCodeRegions = findCodeRegions(cleaned);\n    for (const match of cleaned.matchAll(FINAL_TAG_RE)) {\n      const start = match.index ?? 0;\n      finalMatches.push({\n        start,\n        length: match[0].length,\n        inCode: isInsideCode(start, preCodeRegions),\n      });\n    }\n\n    for (let i = finalMatches.length - 1; i >= 0; i--) {\n      const m = finalMatches[i];\n      if (!m.inCode) {\n        cleaned = cleaned.slice(0, m.start) + cleaned.slice(m.start + m.length);\n      }\n    }\n  } else {\n    FINAL_TAG_RE.lastIndex = 0;\n  }\n\n  const codeRegions = findCodeRegions(cleaned);\n\n  THINKING_TAG_RE.lastIndex = 0;\n  let result = \"\";\n  let lastIndex = 0;\n  let inThinking = false;\n\n  for (const match of cleaned.matchAll(THINKING_TAG_RE)) {\n    const idx = match.index ?? 0;\n    const isClose = match[1] === \"/\";\n\n    if (isInsideCode(idx, codeRegions)) {\n      continue;\n    }\n\n    if (!inThinking) {\n      result += cleaned.slice(lastIndex, idx);\n      if (!isClose) {\n        inThinking = true;\n      }\n    } else if (isClose) {\n      inThinking = false;\n    }\n\n    lastIndex = idx + match[0].length;\n  }\n\n  if (!inThinking || mode === \"preserve\") {\n    result += cleaned.slice(lastIndex);\n  }\n\n  return applyTrim(result, trimMode);\n}\n","import { stripReasoningTagsFromText } from \"../../../src/shared/text/reasoning-tags.js\";\n\nexport function formatMs(ms?: number | null): string {\n  if (!ms && ms !== 0) {\n    return \"n/a\";\n  }\n  return new Date(ms).toLocaleString();\n}\n\nexport function formatAgo(ms?: number | null): string {\n  if (!ms && ms !== 0) {\n    return \"n/a\";\n  }\n  const diff = Date.now() - ms;\n  if (diff < 0) {\n    return \"just now\";\n  }\n  const sec = Math.round(diff / 1000);\n  if (sec < 60) {\n    return `${sec}s ago`;\n  }\n  const min = Math.round(sec / 60);\n  if (min < 60) {\n    return `${min}m ago`;\n  }\n  const hr = Math.round(min / 60);\n  if (hr < 48) {\n    return `${hr}h ago`;\n  }\n  const day = Math.round(hr / 24);\n  return `${day}d ago`;\n}\n\nexport function formatDurationMs(ms?: number | null): string {\n  if (!ms && ms !== 0) {\n    return \"n/a\";\n  }\n  if (ms < 1000) {\n    return `${ms}ms`;\n  }\n  const sec = Math.round(ms / 1000);\n  if (sec < 60) {\n    return `${sec}s`;\n  }\n  const min = Math.round(sec / 60);\n  if (min < 60) {\n    return `${min}m`;\n  }\n  const hr = Math.round(min / 60);\n  if (hr < 48) {\n    return `${hr}h`;\n  }\n  const day = Math.round(hr / 24);\n  return `${day}d`;\n}\n\nexport function formatList(values?: Array<string | null | undefined>): string {\n  if (!values || values.length === 0) {\n    return \"none\";\n  }\n  return values.filter((v): v is string => Boolean(v && v.trim())).join(\", \");\n}\n\nexport function clampText(value: string, max = 120): string {\n  if (value.length <= max) {\n    return value;\n  }\n  return `${value.slice(0, Math.max(0, max - 1))}â€¦`;\n}\n\nexport function truncateText(\n  value: string,\n  max: number,\n): {\n  text: string;\n  truncated: boolean;\n  total: number;\n} {\n  if (value.length <= max) {\n    return { text: value, truncated: false, total: value.length };\n  }\n  return {\n    text: value.slice(0, Math.max(0, max)),\n    truncated: true,\n    total: value.length,\n  };\n}\n\nexport function toNumber(value: string, fallback: number): number {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nexport function parseList(input: string): string[] {\n  return input\n    .split(/[,\\n]/)\n    .map((v) => v.trim())\n    .filter((v) => v.length > 0);\n}\n\nexport function stripThinkingTags(value: string): string {\n  return stripReasoningTagsFromText(value, { mode: \"preserve\", trim: \"start\" });\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { CronJob, CronRunLogEntry, CronStatus } from \"../types\";\nimport type { CronFormState } from \"../ui-types\";\nimport { toNumber } from \"../format\";\n\nexport type CronState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  cronLoading: boolean;\n  cronJobs: CronJob[];\n  cronStatus: CronStatus | null;\n  cronError: string | null;\n  cronForm: CronFormState;\n  cronRunsJobId: string | null;\n  cronRuns: CronRunLogEntry[];\n  cronBusy: boolean;\n};\n\nexport async function loadCronStatus(state: CronState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  try {\n    const res = await state.client.request(\"cron.status\", {});\n    state.cronStatus = res;\n  } catch (err) {\n    state.cronError = String(err);\n  }\n}\n\nexport async function loadCronJobs(state: CronState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.cronLoading) {\n    return;\n  }\n  state.cronLoading = true;\n  state.cronError = null;\n  try {\n    const res = await state.client.request(\"cron.list\", {\n      includeDisabled: true,\n    });\n    state.cronJobs = Array.isArray(res.jobs) ? res.jobs : [];\n  } catch (err) {\n    state.cronError = String(err);\n  } finally {\n    state.cronLoading = false;\n  }\n}\n\nexport function buildCronSchedule(form: CronFormState) {\n  if (form.scheduleKind === \"at\") {\n    const ms = Date.parse(form.scheduleAt);\n    if (!Number.isFinite(ms)) {\n      throw new Error(\"Invalid run time.\");\n    }\n    return { kind: \"at\" as const, atMs: ms };\n  }\n  if (form.scheduleKind === \"every\") {\n    const amount = toNumber(form.everyAmount, 0);\n    if (amount <= 0) {\n      throw new Error(\"Invalid interval amount.\");\n    }\n    const unit = form.everyUnit;\n    const mult = unit === \"minutes\" ? 60_000 : unit === \"hours\" ? 3_600_000 : 86_400_000;\n    return { kind: \"every\" as const, everyMs: amount * mult };\n  }\n  const expr = form.cronExpr.trim();\n  if (!expr) {\n    throw new Error(\"Cron expression required.\");\n  }\n  return { kind: \"cron\" as const, expr, tz: form.cronTz.trim() || undefined };\n}\n\nexport function buildCronPayload(form: CronFormState) {\n  if (form.payloadKind === \"systemEvent\") {\n    const text = form.payloadText.trim();\n    if (!text) {\n      throw new Error(\"System event text required.\");\n    }\n    return { kind: \"systemEvent\" as const, text };\n  }\n  const message = form.payloadText.trim();\n  if (!message) {\n    throw new Error(\"Agent message required.\");\n  }\n  const payload: {\n    kind: \"agentTurn\";\n    message: string;\n    deliver?: boolean;\n    channel?: string;\n    to?: string;\n    timeoutSeconds?: number;\n  } = { kind: \"agentTurn\", message };\n  if (form.deliver) {\n    payload.deliver = true;\n  }\n  if (form.channel) {\n    payload.channel = form.channel;\n  }\n  if (form.to.trim()) {\n    payload.to = form.to.trim();\n  }\n  const timeoutSeconds = toNumber(form.timeoutSeconds, 0);\n  if (timeoutSeconds > 0) {\n    payload.timeoutSeconds = timeoutSeconds;\n  }\n  return payload;\n}\n\nexport async function addCronJob(state: CronState) {\n  if (!state.client || !state.connected || state.cronBusy) {\n    return;\n  }\n  state.cronBusy = true;\n  state.cronError = null;\n  try {\n    const schedule = buildCronSchedule(state.cronForm);\n    const payload = buildCronPayload(state.cronForm);\n    const agentId = state.cronForm.agentId.trim();\n    const job = {\n      name: state.cronForm.name.trim(),\n      description: state.cronForm.description.trim() || undefined,\n      agentId: agentId || undefined,\n      enabled: state.cronForm.enabled,\n      schedule,\n      sessionTarget: state.cronForm.sessionTarget,\n      wakeMode: state.cronForm.wakeMode,\n      payload,\n      isolation:\n        state.cronForm.postToMainPrefix.trim() && state.cronForm.sessionTarget === \"isolated\"\n          ? { postToMainPrefix: state.cronForm.postToMainPrefix.trim() }\n          : undefined,\n    };\n    if (!job.name) {\n      throw new Error(\"Name required.\");\n    }\n    await state.client.request(\"cron.add\", job);\n    state.cronForm = {\n      ...state.cronForm,\n      name: \"\",\n      description: \"\",\n      payloadText: \"\",\n    };\n    await loadCronJobs(state);\n    await loadCronStatus(state);\n  } catch (err) {\n    state.cronError = String(err);\n  } finally {\n    state.cronBusy = false;\n  }\n}\n\nexport async function toggleCronJob(state: CronState, job: CronJob, enabled: boolean) {\n  if (!state.client || !state.connected || state.cronBusy) {\n    return;\n  }\n  state.cronBusy = true;\n  state.cronError = null;\n  try {\n    await state.client.request(\"cron.update\", { id: job.id, patch: { enabled } });\n    await loadCronJobs(state);\n    await loadCronStatus(state);\n  } catch (err) {\n    state.cronError = String(err);\n  } finally {\n    state.cronBusy = false;\n  }\n}\n\nexport async function runCronJob(state: CronState, job: CronJob) {\n  if (!state.client || !state.connected || state.cronBusy) {\n    return;\n  }\n  state.cronBusy = true;\n  state.cronError = null;\n  try {\n    await state.client.request(\"cron.run\", { id: job.id, mode: \"force\" });\n    await loadCronRuns(state, job.id);\n  } catch (err) {\n    state.cronError = String(err);\n  } finally {\n    state.cronBusy = false;\n  }\n}\n\nexport async function removeCronJob(state: CronState, job: CronJob) {\n  if (!state.client || !state.connected || state.cronBusy) {\n    return;\n  }\n  state.cronBusy = true;\n  state.cronError = null;\n  try {\n    await state.client.request(\"cron.remove\", { id: job.id });\n    if (state.cronRunsJobId === job.id) {\n      state.cronRunsJobId = null;\n      state.cronRuns = [];\n    }\n    await loadCronJobs(state);\n    await loadCronStatus(state);\n  } catch (err) {\n    state.cronError = String(err);\n  } finally {\n    state.cronBusy = false;\n  }\n}\n\nexport async function loadCronRuns(state: CronState, jobId: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  try {\n    const res = await state.client.request(\"cron.runs\", {\n      id: jobId,\n      limit: 50,\n    });\n    state.cronRunsJobId = jobId;\n    state.cronRuns = Array.isArray(res.entries) ? res.entries : [];\n  } catch (err) {\n    state.cronError = String(err);\n  }\n}\n","export type DeviceAuthEntry = {\n  token: string;\n  role: string;\n  scopes: string[];\n  updatedAtMs: number;\n};\n\ntype DeviceAuthStore = {\n  version: 1;\n  deviceId: string;\n  tokens: Record<string, DeviceAuthEntry>;\n};\n\nconst STORAGE_KEY = \"openclaw.device.auth.v1\";\n\nfunction normalizeRole(role: string): string {\n  return role.trim();\n}\n\nfunction normalizeScopes(scopes: string[] | undefined): string[] {\n  if (!Array.isArray(scopes)) {\n    return [];\n  }\n  const out = new Set<string>();\n  for (const scope of scopes) {\n    const trimmed = scope.trim();\n    if (trimmed) {\n      out.add(trimmed);\n    }\n  }\n  return [...out].toSorted();\n}\n\nfunction readStore(): DeviceAuthStore | null {\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    if (!raw) {\n      return null;\n    }\n    const parsed = JSON.parse(raw) as DeviceAuthStore;\n    if (!parsed || parsed.version !== 1) {\n      return null;\n    }\n    if (!parsed.deviceId || typeof parsed.deviceId !== \"string\") {\n      return null;\n    }\n    if (!parsed.tokens || typeof parsed.tokens !== \"object\") {\n      return null;\n    }\n    return parsed;\n  } catch {\n    return null;\n  }\n}\n\nfunction writeStore(store: DeviceAuthStore) {\n  try {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(store));\n  } catch {\n    // best-effort\n  }\n}\n\nexport function loadDeviceAuthToken(params: {\n  deviceId: string;\n  role: string;\n}): DeviceAuthEntry | null {\n  const store = readStore();\n  if (!store || store.deviceId !== params.deviceId) {\n    return null;\n  }\n  const role = normalizeRole(params.role);\n  const entry = store.tokens[role];\n  if (!entry || typeof entry.token !== \"string\") {\n    return null;\n  }\n  return entry;\n}\n\nexport function storeDeviceAuthToken(params: {\n  deviceId: string;\n  role: string;\n  token: string;\n  scopes?: string[];\n}): DeviceAuthEntry {\n  const role = normalizeRole(params.role);\n  const next: DeviceAuthStore = {\n    version: 1,\n    deviceId: params.deviceId,\n    tokens: {},\n  };\n  const existing = readStore();\n  if (existing && existing.deviceId === params.deviceId) {\n    next.tokens = { ...existing.tokens };\n  }\n  const entry: DeviceAuthEntry = {\n    token: params.token,\n    role,\n    scopes: normalizeScopes(params.scopes),\n    updatedAtMs: Date.now(),\n  };\n  next.tokens[role] = entry;\n  writeStore(next);\n  return entry;\n}\n\nexport function clearDeviceAuthToken(params: { deviceId: string; role: string }) {\n  const store = readStore();\n  if (!store || store.deviceId !== params.deviceId) {\n    return;\n  }\n  const role = normalizeRole(params.role);\n  if (!store.tokens[role]) {\n    return;\n  }\n  const next = { ...store, tokens: { ...store.tokens } };\n  delete next.tokens[role];\n  writeStore(next);\n}\n","/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */\n/**\n * 5KB JS implementation of ed25519 EdDSA signatures.\n * Compliant with RFC8032, FIPS 186-5 & ZIP215.\n * @module\n * @example\n * ```js\nimport * as ed from '@noble/ed25519';\n(async () => {\n  const secretKey = ed.utils.randomSecretKey();\n  const message = Uint8Array.from([0xab, 0xbc, 0xcd, 0xde]);\n  const pubKey = await ed.getPublicKeyAsync(secretKey); // Sync methods are also present\n  const signature = await ed.signAsync(message, secretKey);\n  const isValid = await ed.verifyAsync(signature, message, pubKey);\n})();\n```\n */\n/**\n * Curve params. ed25519 is twisted edwards curve. Equation is âˆ’xÂ² + yÂ² = -a + dxÂ²yÂ².\n * * P = `2n**255n - 19n` // field over which calculations are done\n * * N = `2n**252n + 27742317777372353535851937790883648493n` // group order, amount of curve points\n * * h = 8 // cofactor\n * * a = `Fp.create(BigInt(-1))` // equation param\n * * d = -121665/121666 a.k.a. `Fp.neg(121665 * Fp.inv(121666))` // equation param\n * * Gx, Gy are coordinates of Generator / base point\n */\nconst ed25519_CURVE = {\n    p: 0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,\n    n: 0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,\n    h: 8n,\n    a: 0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,\n    d: 0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,\n    Gx: 0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,\n    Gy: 0x6666666666666666666666666666666666666666666666666666666666666658n,\n};\nconst { p: P, n: N, Gx, Gy, a: _a, d: _d, h } = ed25519_CURVE;\nconst L = 32; // field / group byte length\nconst L2 = 64;\n// Helpers and Precomputes sections are reused between libraries\n// ## Helpers\n// ----------\nconst captureTrace = (...args) => {\n    if ('captureStackTrace' in Error && typeof Error.captureStackTrace === 'function') {\n        Error.captureStackTrace(...args);\n    }\n};\nconst err = (message = '') => {\n    const e = new Error(message);\n    captureTrace(e, err);\n    throw e;\n};\nconst isBig = (n) => typeof n === 'bigint'; // is big integer\nconst isStr = (s) => typeof s === 'string'; // is string\nconst isBytes = (a) => a instanceof Uint8Array || (ArrayBuffer.isView(a) && a.constructor.name === 'Uint8Array');\n/** Asserts something is Uint8Array. */\nconst abytes = (value, length, title = '') => {\n    const bytes = isBytes(value);\n    const len = value?.length;\n    const needsLen = length !== undefined;\n    if (!bytes || (needsLen && len !== length)) {\n        const prefix = title && `\"${title}\" `;\n        const ofLen = needsLen ? ` of length ${length}` : '';\n        const got = bytes ? `length=${len}` : `type=${typeof value}`;\n        err(prefix + 'expected Uint8Array' + ofLen + ', got ' + got);\n    }\n    return value;\n};\n/** create Uint8Array */\nconst u8n = (len) => new Uint8Array(len);\nconst u8fr = (buf) => Uint8Array.from(buf);\nconst padh = (n, pad) => n.toString(16).padStart(pad, '0');\nconst bytesToHex = (b) => Array.from(abytes(b))\n    .map((e) => padh(e, 2))\n    .join('');\nconst C = { _0: 48, _9: 57, A: 65, F: 70, a: 97, f: 102 }; // ASCII characters\nconst _ch = (ch) => {\n    if (ch >= C._0 && ch <= C._9)\n        return ch - C._0; // '2' => 50-48\n    if (ch >= C.A && ch <= C.F)\n        return ch - (C.A - 10); // 'B' => 66-(65-10)\n    if (ch >= C.a && ch <= C.f)\n        return ch - (C.a - 10); // 'b' => 98-(97-10)\n    return;\n};\nconst hexToBytes = (hex) => {\n    const e = 'hex invalid';\n    if (!isStr(hex))\n        return err(e);\n    const hl = hex.length;\n    const al = hl / 2;\n    if (hl % 2)\n        return err(e);\n    const array = u8n(al);\n    for (let ai = 0, hi = 0; ai < al; ai++, hi += 2) {\n        // treat each char as ASCII\n        const n1 = _ch(hex.charCodeAt(hi)); // parse first char, multiply it by 16\n        const n2 = _ch(hex.charCodeAt(hi + 1)); // parse second char\n        if (n1 === undefined || n2 === undefined)\n            return err(e);\n        array[ai] = n1 * 16 + n2; // example: 'A9' => 10*16 + 9\n    }\n    return array;\n};\nconst cr = () => globalThis?.crypto; // WebCrypto is available in all modern environments\nconst subtle = () => cr()?.subtle ?? err('crypto.subtle must be defined, consider polyfill');\n// prettier-ignore\nconst concatBytes = (...arrs) => {\n    const r = u8n(arrs.reduce((sum, a) => sum + abytes(a).length, 0)); // create u8a of summed length\n    let pad = 0; // walk through each array,\n    arrs.forEach(a => { r.set(a, pad); pad += a.length; }); // ensure they have proper type\n    return r;\n};\n/** WebCrypto OS-level CSPRNG (random number generator). Will throw when not available. */\nconst randomBytes = (len = L) => {\n    const c = cr();\n    return c.getRandomValues(u8n(len));\n};\nconst big = BigInt;\nconst assertRange = (n, min, max, msg = 'bad number: out of range') => (isBig(n) && min <= n && n < max ? n : err(msg));\n/** modular division */\nconst M = (a, b = P) => {\n    const r = a % b;\n    return r >= 0n ? r : b + r;\n};\nconst modN = (a) => M(a, N);\n/** Modular inversion using euclidean GCD (non-CT). No negative exponent for now. */\n// prettier-ignore\nconst invert = (num, md) => {\n    if (num === 0n || md <= 0n)\n        err('no inverse n=' + num + ' mod=' + md);\n    let a = M(num, md), b = md, x = 0n, y = 1n, u = 1n, v = 0n;\n    while (a !== 0n) {\n        const q = b / a, r = b % a;\n        const m = x - u * q, n = y - v * q;\n        b = a, a = r, x = u, y = v, u = m, v = n;\n    }\n    return b === 1n ? M(x, md) : err('no inverse'); // b is gcd at this point\n};\nconst callHash = (name) => {\n    // @ts-ignore\n    const fn = hashes[name];\n    if (typeof fn !== 'function')\n        err('hashes.' + name + ' not set');\n    return fn;\n};\nconst hash = (msg) => callHash('sha512')(msg);\nconst apoint = (p) => (p instanceof Point ? p : err('Point expected'));\n// ## End of Helpers\n// -----------------\nconst B256 = 2n ** 256n;\n/** Point in XYZT extended coordinates. */\nclass Point {\n    static BASE;\n    static ZERO;\n    X;\n    Y;\n    Z;\n    T;\n    constructor(X, Y, Z, T) {\n        const max = B256;\n        this.X = assertRange(X, 0n, max);\n        this.Y = assertRange(Y, 0n, max);\n        this.Z = assertRange(Z, 1n, max);\n        this.T = assertRange(T, 0n, max);\n        Object.freeze(this);\n    }\n    static CURVE() {\n        return ed25519_CURVE;\n    }\n    static fromAffine(p) {\n        return new Point(p.x, p.y, 1n, M(p.x * p.y));\n    }\n    /** RFC8032 5.1.3: Uint8Array to Point. */\n    static fromBytes(hex, zip215 = false) {\n        const d = _d;\n        // Copy array to not mess it up.\n        const normed = u8fr(abytes(hex, L));\n        // adjust first LE byte = last BE byte\n        const lastByte = hex[31];\n        normed[31] = lastByte & ~0x80;\n        const y = bytesToNumLE(normed);\n        // zip215=true:           0 <= y < 2^256\n        // zip215=false, RFC8032: 0 <= y < 2^255-19\n        const max = zip215 ? B256 : P;\n        assertRange(y, 0n, max);\n        const y2 = M(y * y); // yÂ²\n        const u = M(y2 - 1n); // u=yÂ²-1\n        const v = M(d * y2 + 1n); // v=dyÂ²+1\n        let { isValid, value: x } = uvRatio(u, v); // (uvÂ³)(uvâ·)^(p-5)/8; square root\n        if (!isValid)\n            err('bad point: y not sqrt'); // not square root: bad point\n        const isXOdd = (x & 1n) === 1n; // adjust sign of x coordinate\n        const isLastByteOdd = (lastByte & 0x80) !== 0; // x_0, last bit\n        if (!zip215 && x === 0n && isLastByteOdd)\n            err('bad point: x==0, isLastByteOdd'); // x=0, x_0=1\n        if (isLastByteOdd !== isXOdd)\n            x = M(-x);\n        return new Point(x, y, 1n, M(x * y)); // Z=1, T=xy\n    }\n    static fromHex(hex, zip215) {\n        return Point.fromBytes(hexToBytes(hex), zip215);\n    }\n    get x() {\n        return this.toAffine().x;\n    }\n    get y() {\n        return this.toAffine().y;\n    }\n    /** Checks if the point is valid and on-curve. */\n    assertValidity() {\n        const a = _a;\n        const d = _d;\n        const p = this;\n        if (p.is0())\n            return err('bad point: ZERO'); // TODO: optimize, with vars below?\n        // Equation in affine coordinates: axÂ² + yÂ² = 1 + dxÂ²yÂ²\n        // Equation in projective coordinates (X/Z, Y/Z, Z):  (aXÂ² + YÂ²)ZÂ² = Zâ´ + dXÂ²YÂ²\n        const { X, Y, Z, T } = p;\n        const X2 = M(X * X); // XÂ²\n        const Y2 = M(Y * Y); // YÂ²\n        const Z2 = M(Z * Z); // ZÂ²\n        const Z4 = M(Z2 * Z2); // Zâ´\n        const aX2 = M(X2 * a); // aXÂ²\n        const left = M(Z2 * M(aX2 + Y2)); // (aXÂ² + YÂ²)ZÂ²\n        const right = M(Z4 + M(d * M(X2 * Y2))); // Zâ´ + dXÂ²YÂ²\n        if (left !== right)\n            return err('bad point: equation left != right (1)');\n        // In Extended coordinates we also have T, which is x*y=T/Z: check X*Y == Z*T\n        const XY = M(X * Y);\n        const ZT = M(Z * T);\n        if (XY !== ZT)\n            return err('bad point: equation left != right (2)');\n        return this;\n    }\n    /** Equality check: compare points P&Q. */\n    equals(other) {\n        const { X: X1, Y: Y1, Z: Z1 } = this;\n        const { X: X2, Y: Y2, Z: Z2 } = apoint(other); // checks class equality\n        const X1Z2 = M(X1 * Z2);\n        const X2Z1 = M(X2 * Z1);\n        const Y1Z2 = M(Y1 * Z2);\n        const Y2Z1 = M(Y2 * Z1);\n        return X1Z2 === X2Z1 && Y1Z2 === Y2Z1;\n    }\n    is0() {\n        return this.equals(I);\n    }\n    /** Flip point over y coordinate. */\n    negate() {\n        return new Point(M(-this.X), this.Y, this.Z, M(-this.T));\n    }\n    /** Point doubling. Complete formula. Cost: `4M + 4S + 1*a + 6add + 1*2`. */\n    double() {\n        const { X: X1, Y: Y1, Z: Z1 } = this;\n        const a = _a;\n        // https://hyperelliptic.org/EFD/g1p/auto-twisted-extended.html#doubling-dbl-2008-hwcd\n        const A = M(X1 * X1);\n        const B = M(Y1 * Y1);\n        const C = M(2n * M(Z1 * Z1));\n        const D = M(a * A);\n        const x1y1 = X1 + Y1;\n        const E = M(M(x1y1 * x1y1) - A - B);\n        const G = D + B;\n        const F = G - C;\n        const H = D - B;\n        const X3 = M(E * F);\n        const Y3 = M(G * H);\n        const T3 = M(E * H);\n        const Z3 = M(F * G);\n        return new Point(X3, Y3, Z3, T3);\n    }\n    /** Point addition. Complete formula. Cost: `8M + 1*k + 8add + 1*2`. */\n    add(other) {\n        const { X: X1, Y: Y1, Z: Z1, T: T1 } = this;\n        const { X: X2, Y: Y2, Z: Z2, T: T2 } = apoint(other); // doesn't check if other on-curve\n        const a = _a;\n        const d = _d;\n        // https://hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html#addition-add-2008-hwcd-3\n        const A = M(X1 * X2);\n        const B = M(Y1 * Y2);\n        const C = M(T1 * d * T2);\n        const D = M(Z1 * Z2);\n        const E = M((X1 + Y1) * (X2 + Y2) - A - B);\n        const F = M(D - C);\n        const G = M(D + C);\n        const H = M(B - a * A);\n        const X3 = M(E * F);\n        const Y3 = M(G * H);\n        const T3 = M(E * H);\n        const Z3 = M(F * G);\n        return new Point(X3, Y3, Z3, T3);\n    }\n    subtract(other) {\n        return this.add(apoint(other).negate());\n    }\n    /**\n     * Point-by-scalar multiplication. Scalar must be in range 1 <= n < CURVE.n.\n     * Uses {@link wNAF} for base point.\n     * Uses fake point to mitigate side-channel leakage.\n     * @param n scalar by which point is multiplied\n     * @param safe safe mode guards against timing attacks; unsafe mode is faster\n     */\n    multiply(n, safe = true) {\n        if (!safe && (n === 0n || this.is0()))\n            return I;\n        assertRange(n, 1n, N);\n        if (n === 1n)\n            return this;\n        if (this.equals(G))\n            return wNAF(n).p;\n        // init result point & fake point\n        let p = I;\n        let f = G;\n        for (let d = this; n > 0n; d = d.double(), n >>= 1n) {\n            // if bit is present, add to point\n            // if not present, add to fake, for timing safety\n            if (n & 1n)\n                p = p.add(d);\n            else if (safe)\n                f = f.add(d);\n        }\n        return p;\n    }\n    multiplyUnsafe(scalar) {\n        return this.multiply(scalar, false);\n    }\n    /** Convert point to 2d xy affine point. (X, Y, Z) âˆ‹ (x=X/Z, y=Y/Z) */\n    toAffine() {\n        const { X, Y, Z } = this;\n        // fast-paths for ZERO point OR Z=1\n        if (this.equals(I))\n            return { x: 0n, y: 1n };\n        const iz = invert(Z, P);\n        // (Z * Z^-1) must be 1, otherwise bad math\n        if (M(Z * iz) !== 1n)\n            err('invalid inverse');\n        // x = X*Z^-1; y = Y*Z^-1\n        const x = M(X * iz);\n        const y = M(Y * iz);\n        return { x, y };\n    }\n    toBytes() {\n        const { x, y } = this.assertValidity().toAffine();\n        const b = numTo32bLE(y);\n        // store sign in first LE byte\n        b[31] |= x & 1n ? 0x80 : 0;\n        return b;\n    }\n    toHex() {\n        return bytesToHex(this.toBytes());\n    }\n    clearCofactor() {\n        return this.multiply(big(h), false);\n    }\n    isSmallOrder() {\n        return this.clearCofactor().is0();\n    }\n    isTorsionFree() {\n        // Multiply by big number N. We can't `mul(N)` because of checks. Instead, we `mul(N/2)*2+1`\n        let p = this.multiply(N / 2n, false).double();\n        if (N % 2n)\n            p = p.add(this);\n        return p.is0();\n    }\n}\n/** Generator / base point */\nconst G = new Point(Gx, Gy, 1n, M(Gx * Gy));\n/** Identity / zero point */\nconst I = new Point(0n, 1n, 1n, 0n);\n// Static aliases\nPoint.BASE = G;\nPoint.ZERO = I;\nconst numTo32bLE = (num) => hexToBytes(padh(assertRange(num, 0n, B256), L2)).reverse();\nconst bytesToNumLE = (b) => big('0x' + bytesToHex(u8fr(abytes(b)).reverse()));\nconst pow2 = (x, power) => {\n    // pow2(x, 4) == x^(2^4)\n    let r = x;\n    while (power-- > 0n) {\n        r *= r;\n        r %= P;\n    }\n    return r;\n};\n// prettier-ignore\nconst pow_2_252_3 = (x) => {\n    const x2 = (x * x) % P; // x^2,       bits 1\n    const b2 = (x2 * x) % P; // x^3,       bits 11\n    const b4 = (pow2(b2, 2n) * b2) % P; // x^(2^4-1), bits 1111\n    const b5 = (pow2(b4, 1n) * x) % P; // x^(2^5-1), bits 11111\n    const b10 = (pow2(b5, 5n) * b5) % P; // x^(2^10)\n    const b20 = (pow2(b10, 10n) * b10) % P; // x^(2^20)\n    const b40 = (pow2(b20, 20n) * b20) % P; // x^(2^40)\n    const b80 = (pow2(b40, 40n) * b40) % P; // x^(2^80)\n    const b160 = (pow2(b80, 80n) * b80) % P; // x^(2^160)\n    const b240 = (pow2(b160, 80n) * b80) % P; // x^(2^240)\n    const b250 = (pow2(b240, 10n) * b10) % P; // x^(2^250)\n    const pow_p_5_8 = (pow2(b250, 2n) * x) % P; // < To pow to (p+3)/8, multiply it by x.\n    return { pow_p_5_8, b2 };\n};\nconst RM1 = 0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n; // âˆš-1\n// for sqrt comp\n// prettier-ignore\nconst uvRatio = (u, v) => {\n    const v3 = M(v * v * v); // vÂ³\n    const v7 = M(v3 * v3 * v); // vâ·\n    const pow = pow_2_252_3(u * v7).pow_p_5_8; // (uvâ·)^(p-5)/8\n    let x = M(u * v3 * pow); // (uvÂ³)(uvâ·)^(p-5)/8\n    const vx2 = M(v * x * x); // vxÂ²\n    const root1 = x; // First root candidate\n    const root2 = M(x * RM1); // Second root candidate; RM1 is âˆš-1\n    const useRoot1 = vx2 === u; // If vxÂ² = u (mod p), x is a square root\n    const useRoot2 = vx2 === M(-u); // If vxÂ² = -u, set x <-- x * 2^((p-1)/4)\n    const noRoot = vx2 === M(-u * RM1); // There is no valid root, vxÂ² = -uâˆš-1\n    if (useRoot1)\n        x = root1;\n    if (useRoot2 || noRoot)\n        x = root2; // We return root2 anyway, for const-time\n    if ((M(x) & 1n) === 1n)\n        x = M(-x); // edIsNegative\n    return { isValid: useRoot1 || useRoot2, value: x };\n};\n// N == L, just weird naming\nconst modL_LE = (hash) => modN(bytesToNumLE(hash)); // modulo L; but little-endian\n/** hashes.sha512 should conform to the interface. */\n// TODO: rename\nconst sha512a = (...m) => hashes.sha512Async(concatBytes(...m)); // Async SHA512\nconst sha512s = (...m) => callHash('sha512')(concatBytes(...m));\n// RFC8032 5.1.5\nconst hash2extK = (hashed) => {\n    // slice creates a copy, unlike subarray\n    const head = hashed.slice(0, L);\n    head[0] &= 248; // Clamp bits: 0b1111_1000\n    head[31] &= 127; // 0b0111_1111\n    head[31] |= 64; // 0b0100_0000\n    const prefix = hashed.slice(L, L2); // secret key \"prefix\"\n    const scalar = modL_LE(head); // modular division over curve order\n    const point = G.multiply(scalar); // public key point\n    const pointBytes = point.toBytes(); // point serialized to Uint8Array\n    return { head, prefix, scalar, point, pointBytes };\n};\n// RFC8032 5.1.5; getPublicKey async, sync. Hash priv key and extract point.\nconst getExtendedPublicKeyAsync = (secretKey) => sha512a(abytes(secretKey, L)).then(hash2extK);\nconst getExtendedPublicKey = (secretKey) => hash2extK(sha512s(abytes(secretKey, L)));\n/** Creates 32-byte ed25519 public key from 32-byte secret key. Async. */\nconst getPublicKeyAsync = (secretKey) => getExtendedPublicKeyAsync(secretKey).then((p) => p.pointBytes);\n/** Creates 32-byte ed25519 public key from 32-byte secret key. To use, set `hashes.sha512` first. */\nconst getPublicKey = (priv) => getExtendedPublicKey(priv).pointBytes;\nconst hashFinishA = (res) => sha512a(res.hashable).then(res.finish);\nconst hashFinishS = (res) => res.finish(sha512s(res.hashable));\n// Code, shared between sync & async sign\nconst _sign = (e, rBytes, msg) => {\n    const { pointBytes: P, scalar: s } = e;\n    const r = modL_LE(rBytes); // r was created outside, reduce it modulo L\n    const R = G.multiply(r).toBytes(); // R = [r]B\n    const hashable = concatBytes(R, P, msg); // dom2(F, C) || R || A || PH(M)\n    const finish = (hashed) => {\n        // k = SHA512(dom2(F, C) || R || A || PH(M))\n        const S = modN(r + modL_LE(hashed) * s); // S = (r + k * s) mod L; 0 <= s < l\n        return abytes(concatBytes(R, numTo32bLE(S)), L2); // 64-byte sig: 32b R.x + 32b LE(S)\n    };\n    return { hashable, finish };\n};\n/**\n * Signs message using secret key. Async.\n * Follows RFC8032 5.1.6.\n */\nconst signAsync = async (message, secretKey) => {\n    const m = abytes(message);\n    const e = await getExtendedPublicKeyAsync(secretKey);\n    const rBytes = await sha512a(e.prefix, m); // r = SHA512(dom2(F, C) || prefix || PH(M))\n    return hashFinishA(_sign(e, rBytes, m)); // gen R, k, S, then 64-byte signature\n};\n/**\n * Signs message using secret key. To use, set `hashes.sha512` first.\n * Follows RFC8032 5.1.6.\n */\nconst sign = (message, secretKey) => {\n    const m = abytes(message);\n    const e = getExtendedPublicKey(secretKey);\n    const rBytes = sha512s(e.prefix, m); // r = SHA512(dom2(F, C) || prefix || PH(M))\n    return hashFinishS(_sign(e, rBytes, m)); // gen R, k, S, then 64-byte signature\n};\nconst defaultVerifyOpts = { zip215: true };\nconst _verify = (sig, msg, pub, opts = defaultVerifyOpts) => {\n    sig = abytes(sig, L2); // Signature hex str/Bytes, must be 64 bytes\n    msg = abytes(msg); // Message hex str/Bytes\n    pub = abytes(pub, L);\n    const { zip215 } = opts; // switch between zip215 and rfc8032 verif\n    let A;\n    let R;\n    let s;\n    let SB;\n    let hashable = Uint8Array.of();\n    try {\n        A = Point.fromBytes(pub, zip215); // public key A decoded\n        R = Point.fromBytes(sig.slice(0, L), zip215); // 0 <= R < 2^256: ZIP215 R can be >= P\n        s = bytesToNumLE(sig.slice(L, L2)); // Decode second half as an integer S\n        SB = G.multiply(s, false); // in the range 0 <= s < L\n        hashable = concatBytes(R.toBytes(), A.toBytes(), msg); // dom2(F, C) || R || A || PH(M)\n    }\n    catch (error) { }\n    const finish = (hashed) => {\n        // k = SHA512(dom2(F, C) || R || A || PH(M))\n        if (SB == null)\n            return false; // false if try-catch catched an error\n        if (!zip215 && A.isSmallOrder())\n            return false; // false for SBS: Strongly Binding Signature\n        const k = modL_LE(hashed); // decode in little-endian, modulo L\n        const RkA = R.add(A.multiply(k, false)); // [8]R + [8][k]A'\n        return RkA.add(SB.negate()).clearCofactor().is0(); // [8][S]B = [8]R + [8][k]A'\n    };\n    return { hashable, finish };\n};\n/** Verifies signature on message and public key. Async. Follows RFC8032 5.1.7. */\nconst verifyAsync = async (signature, message, publicKey, opts = defaultVerifyOpts) => hashFinishA(_verify(signature, message, publicKey, opts));\n/** Verifies signature on message and public key. To use, set `hashes.sha512` first. Follows RFC8032 5.1.7. */\nconst verify = (signature, message, publicKey, opts = defaultVerifyOpts) => hashFinishS(_verify(signature, message, publicKey, opts));\n/** Math, hex, byte helpers. Not in `utils` because utils share API with noble-curves. */\nconst etc = {\n    bytesToHex: bytesToHex,\n    hexToBytes: hexToBytes,\n    concatBytes: concatBytes,\n    mod: M,\n    invert: invert,\n    randomBytes: randomBytes,\n};\nconst hashes = {\n    sha512Async: async (message) => {\n        const s = subtle();\n        const m = concatBytes(message);\n        return u8n(await s.digest('SHA-512', m.buffer));\n    },\n    sha512: undefined,\n};\n// FIPS 186 B.4.1 compliant key generation produces private keys\n// with modulo bias being neglible. takes >N+16 bytes, returns (hash mod n-1)+1\nconst randomSecretKey = (seed = randomBytes(L)) => seed;\nconst keygen = (seed) => {\n    const secretKey = randomSecretKey(seed);\n    const publicKey = getPublicKey(secretKey);\n    return { secretKey, publicKey };\n};\nconst keygenAsync = async (seed) => {\n    const secretKey = randomSecretKey(seed);\n    const publicKey = await getPublicKeyAsync(secretKey);\n    return { secretKey, publicKey };\n};\n/** ed25519-specific key utilities. */\nconst utils = {\n    getExtendedPublicKeyAsync: getExtendedPublicKeyAsync,\n    getExtendedPublicKey: getExtendedPublicKey,\n    randomSecretKey: randomSecretKey,\n};\n// ## Precomputes\n// --------------\nconst W = 8; // W is window size\nconst scalarBits = 256;\nconst pwindows = Math.ceil(scalarBits / W) + 1; // 33 for W=8, NOT 32 - see wNAF loop\nconst pwindowSize = 2 ** (W - 1); // 128 for W=8\nconst precompute = () => {\n    const points = [];\n    let p = G;\n    let b = p;\n    for (let w = 0; w < pwindows; w++) {\n        b = p;\n        points.push(b);\n        for (let i = 1; i < pwindowSize; i++) {\n            b = b.add(p);\n            points.push(b);\n        } // i=1, bc we skip 0\n        p = b.double();\n    }\n    return points;\n};\nlet Gpows = undefined; // precomputes for base point G\n// const-time negate\nconst ctneg = (cnd, p) => {\n    const n = p.negate();\n    return cnd ? n : p;\n};\n/**\n * Precomputes give 12x faster getPublicKey(), 10x sign(), 2x verify() by\n * caching multiples of G (base point). Cache is stored in 32MB of RAM.\n * Any time `G.multiply` is done, precomputes are used.\n * Not used for getSharedSecret, which instead multiplies random pubkey `P.multiply`.\n *\n * w-ary non-adjacent form (wNAF) precomputation method is 10% slower than windowed method,\n * but takes 2x less RAM. RAM reduction is possible by utilizing `.subtract`.\n *\n * !! Precomputes can be disabled by commenting-out call of the wNAF() inside Point#multiply().\n */\nconst wNAF = (n) => {\n    const comp = Gpows || (Gpows = precompute());\n    let p = I;\n    let f = G; // f must be G, or could become I in the end\n    const pow_2_w = 2 ** W; // 256 for W=8\n    const maxNum = pow_2_w; // 256 for W=8\n    const mask = big(pow_2_w - 1); // 255 for W=8 == mask 0b11111111\n    const shiftBy = big(W); // 8 for W=8\n    for (let w = 0; w < pwindows; w++) {\n        let wbits = Number(n & mask); // extract W bits.\n        n >>= shiftBy; // shift number by W bits.\n        // We use negative indexes to reduce size of precomputed table by 2x.\n        // Instead of needing precomputes 0..256, we only calculate them for 0..128.\n        // If an index > 128 is found, we do (256-index) - where 256 is next window.\n        // Naive: index +127 => 127, +224 => 224\n        // Optimized: index +127 => 127, +224 => 256-32\n        if (wbits > pwindowSize) {\n            wbits -= maxNum;\n            n += 1n;\n        }\n        const off = w * pwindowSize;\n        const offF = off; // offsets, evaluate both\n        const offP = off + Math.abs(wbits) - 1;\n        const isEven = w % 2 !== 0; // conditions, evaluate both\n        const isNeg = wbits < 0;\n        if (wbits === 0) {\n            // off == I: can't add it. Adding random offF instead.\n            f = f.add(ctneg(isEven, comp[offF])); // bits are 0: add garbage to fake point\n        }\n        else {\n            p = p.add(ctneg(isNeg, comp[offP])); // bits are 1: add to result point\n        }\n    }\n    if (n !== 0n)\n        err('invalid wnaf');\n    return { p, f }; // return both real and fake points for JIT\n};\n// !! Remove the export to easily use in REPL / browser console\nexport { etc, getPublicKey, getPublicKeyAsync, hash, hashes, keygen, keygenAsync, Point, sign, signAsync, utils, verify, verifyAsync, };\n","import { getPublicKeyAsync, signAsync, utils } from \"@noble/ed25519\";\n\ntype StoredIdentity = {\n  version: 1;\n  deviceId: string;\n  publicKey: string;\n  privateKey: string;\n  createdAtMs: number;\n};\n\nexport type DeviceIdentity = {\n  deviceId: string;\n  publicKey: string;\n  privateKey: string;\n};\n\nconst STORAGE_KEY = \"openclaw-device-identity-v1\";\n\nfunction base64UrlEncode(bytes: Uint8Array): string {\n  let binary = \"\";\n  for (const byte of bytes) {\n    binary += String.fromCharCode(byte);\n  }\n  return btoa(binary).replaceAll(\"+\", \"-\").replaceAll(\"/\", \"_\").replace(/=+$/g, \"\");\n}\n\nfunction base64UrlDecode(input: string): Uint8Array {\n  const normalized = input.replaceAll(\"-\", \"+\").replaceAll(\"_\", \"/\");\n  const padded = normalized + \"=\".repeat((4 - (normalized.length % 4)) % 4);\n  const binary = atob(padded);\n  const out = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i += 1) {\n    out[i] = binary.charCodeAt(i);\n  }\n  return out;\n}\n\nfunction bytesToHex(bytes: Uint8Array): string {\n  return Array.from(bytes)\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n}\n\nasync function fingerprintPublicKey(publicKey: Uint8Array): Promise<string> {\n  const hash = await crypto.subtle.digest(\"SHA-256\", publicKey);\n  return bytesToHex(new Uint8Array(hash));\n}\n\nasync function generateIdentity(): Promise<DeviceIdentity> {\n  const privateKey = utils.randomSecretKey();\n  const publicKey = await getPublicKeyAsync(privateKey);\n  const deviceId = await fingerprintPublicKey(publicKey);\n  return {\n    deviceId,\n    publicKey: base64UrlEncode(publicKey),\n    privateKey: base64UrlEncode(privateKey),\n  };\n}\n\nexport async function loadOrCreateDeviceIdentity(): Promise<DeviceIdentity> {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (raw) {\n      const parsed = JSON.parse(raw) as StoredIdentity;\n      if (\n        parsed?.version === 1 &&\n        typeof parsed.deviceId === \"string\" &&\n        typeof parsed.publicKey === \"string\" &&\n        typeof parsed.privateKey === \"string\"\n      ) {\n        const derivedId = await fingerprintPublicKey(base64UrlDecode(parsed.publicKey));\n        if (derivedId !== parsed.deviceId) {\n          const updated: StoredIdentity = {\n            ...parsed,\n            deviceId: derivedId,\n          };\n          localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));\n          return {\n            deviceId: derivedId,\n            publicKey: parsed.publicKey,\n            privateKey: parsed.privateKey,\n          };\n        }\n        return {\n          deviceId: parsed.deviceId,\n          publicKey: parsed.publicKey,\n          privateKey: parsed.privateKey,\n        };\n      }\n    }\n  } catch {\n    // fall through to regenerate\n  }\n\n  const identity = await generateIdentity();\n  const stored: StoredIdentity = {\n    version: 1,\n    deviceId: identity.deviceId,\n    publicKey: identity.publicKey,\n    privateKey: identity.privateKey,\n    createdAtMs: Date.now(),\n  };\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(stored));\n  return identity;\n}\n\nexport async function signDevicePayload(privateKeyBase64Url: string, payload: string) {\n  const key = base64UrlDecode(privateKeyBase64Url);\n  const data = new TextEncoder().encode(payload);\n  const sig = await signAsync(data, key);\n  return base64UrlEncode(sig);\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport { clearDeviceAuthToken, storeDeviceAuthToken } from \"../device-auth\";\nimport { loadOrCreateDeviceIdentity } from \"../device-identity\";\n\nexport type DeviceTokenSummary = {\n  role: string;\n  scopes?: string[];\n  createdAtMs?: number;\n  rotatedAtMs?: number;\n  revokedAtMs?: number;\n  lastUsedAtMs?: number;\n};\n\nexport type PendingDevice = {\n  requestId: string;\n  deviceId: string;\n  displayName?: string;\n  role?: string;\n  remoteIp?: string;\n  isRepair?: boolean;\n  ts?: number;\n};\n\nexport type PairedDevice = {\n  deviceId: string;\n  displayName?: string;\n  roles?: string[];\n  scopes?: string[];\n  remoteIp?: string;\n  tokens?: DeviceTokenSummary[];\n  createdAtMs?: number;\n  approvedAtMs?: number;\n};\n\nexport type DevicePairingList = {\n  pending: PendingDevice[];\n  paired: PairedDevice[];\n};\n\nexport type DevicesState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  devicesLoading: boolean;\n  devicesError: string | null;\n  devicesList: DevicePairingList | null;\n};\n\nexport async function loadDevices(state: DevicesState, opts?: { quiet?: boolean }) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.devicesLoading) {\n    return;\n  }\n  state.devicesLoading = true;\n  if (!opts?.quiet) {\n    state.devicesError = null;\n  }\n  try {\n    const res = await state.client.request(\"device.pair.list\", {});\n    state.devicesList = {\n      pending: Array.isArray(res?.pending) ? res.pending : [],\n      paired: Array.isArray(res?.paired) ? res.paired : [],\n    };\n  } catch (err) {\n    if (!opts?.quiet) {\n      state.devicesError = String(err);\n    }\n  } finally {\n    state.devicesLoading = false;\n  }\n}\n\nexport async function approveDevicePairing(state: DevicesState, requestId: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  try {\n    await state.client.request(\"device.pair.approve\", { requestId });\n    await loadDevices(state);\n  } catch (err) {\n    state.devicesError = String(err);\n  }\n}\n\nexport async function rejectDevicePairing(state: DevicesState, requestId: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  const confirmed = window.confirm(\"Reject this device pairing request?\");\n  if (!confirmed) {\n    return;\n  }\n  try {\n    await state.client.request(\"device.pair.reject\", { requestId });\n    await loadDevices(state);\n  } catch (err) {\n    state.devicesError = String(err);\n  }\n}\n\nexport async function rotateDeviceToken(\n  state: DevicesState,\n  params: { deviceId: string; role: string; scopes?: string[] },\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  try {\n    const res = await state.client.request(\"device.token.rotate\", params);\n    if (res?.token) {\n      const identity = await loadOrCreateDeviceIdentity();\n      const role = res.role ?? params.role;\n      if (res.deviceId === identity.deviceId || params.deviceId === identity.deviceId) {\n        storeDeviceAuthToken({\n          deviceId: identity.deviceId,\n          role,\n          token: res.token,\n          scopes: res.scopes ?? params.scopes ?? [],\n        });\n      }\n      window.prompt(\"New device token (copy and store securely):\", res.token);\n    }\n    await loadDevices(state);\n  } catch (err) {\n    state.devicesError = String(err);\n  }\n}\n\nexport async function revokeDeviceToken(\n  state: DevicesState,\n  params: { deviceId: string; role: string },\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  const confirmed = window.confirm(`Revoke token for ${params.deviceId} (${params.role})?`);\n  if (!confirmed) {\n    return;\n  }\n  try {\n    await state.client.request(\"device.token.revoke\", params);\n    const identity = await loadOrCreateDeviceIdentity();\n    if (params.deviceId === identity.deviceId) {\n      clearDeviceAuthToken({ deviceId: identity.deviceId, role: params.role });\n    }\n    await loadDevices(state);\n  } catch (err) {\n    state.devicesError = String(err);\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport { cloneConfigObject, removePathValue, setPathValue } from \"./config/form-utils\";\n\nexport type ExecApprovalsDefaults = {\n  security?: string;\n  ask?: string;\n  askFallback?: string;\n  autoAllowSkills?: boolean;\n};\n\nexport type ExecApprovalsAllowlistEntry = {\n  id?: string;\n  pattern: string;\n  lastUsedAt?: number;\n  lastUsedCommand?: string;\n  lastResolvedPath?: string;\n};\n\nexport type ExecApprovalsAgent = ExecApprovalsDefaults & {\n  allowlist?: ExecApprovalsAllowlistEntry[];\n};\n\nexport type ExecApprovalsFile = {\n  version?: number;\n  socket?: { path?: string };\n  defaults?: ExecApprovalsDefaults;\n  agents?: Record<string, ExecApprovalsAgent>;\n};\n\nexport type ExecApprovalsSnapshot = {\n  path: string;\n  exists: boolean;\n  hash: string;\n  file: ExecApprovalsFile;\n};\n\nexport type ExecApprovalsTarget = { kind: \"gateway\" } | { kind: \"node\"; nodeId: string };\n\nexport type ExecApprovalsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  execApprovalsLoading: boolean;\n  execApprovalsSaving: boolean;\n  execApprovalsDirty: boolean;\n  execApprovalsSnapshot: ExecApprovalsSnapshot | null;\n  execApprovalsForm: ExecApprovalsFile | null;\n  execApprovalsSelectedAgent: string | null;\n  lastError: string | null;\n};\n\nfunction resolveExecApprovalsRpc(target?: ExecApprovalsTarget | null): {\n  method: string;\n  params: Record<string, unknown>;\n} | null {\n  if (!target || target.kind === \"gateway\") {\n    return { method: \"exec.approvals.get\", params: {} };\n  }\n  const nodeId = target.nodeId.trim();\n  if (!nodeId) {\n    return null;\n  }\n  return { method: \"exec.approvals.node.get\", params: { nodeId } };\n}\n\nfunction resolveExecApprovalsSaveRpc(\n  target: ExecApprovalsTarget | null | undefined,\n  params: { file: ExecApprovalsFile; baseHash: string },\n): { method: string; params: Record<string, unknown> } | null {\n  if (!target || target.kind === \"gateway\") {\n    return { method: \"exec.approvals.set\", params };\n  }\n  const nodeId = target.nodeId.trim();\n  if (!nodeId) {\n    return null;\n  }\n  return { method: \"exec.approvals.node.set\", params: { ...params, nodeId } };\n}\n\nexport async function loadExecApprovals(\n  state: ExecApprovalsState,\n  target?: ExecApprovalsTarget | null,\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.execApprovalsLoading) {\n    return;\n  }\n  state.execApprovalsLoading = true;\n  state.lastError = null;\n  try {\n    const rpc = resolveExecApprovalsRpc(target);\n    if (!rpc) {\n      state.lastError = \"Select a node before loading exec approvals.\";\n      return;\n    }\n    const res = await state.client.request(rpc.method, rpc.params);\n    applyExecApprovalsSnapshot(state, res);\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.execApprovalsLoading = false;\n  }\n}\n\nexport function applyExecApprovalsSnapshot(\n  state: ExecApprovalsState,\n  snapshot: ExecApprovalsSnapshot,\n) {\n  state.execApprovalsSnapshot = snapshot;\n  if (!state.execApprovalsDirty) {\n    state.execApprovalsForm = cloneConfigObject(snapshot.file ?? {});\n  }\n}\n\nexport async function saveExecApprovals(\n  state: ExecApprovalsState,\n  target?: ExecApprovalsTarget | null,\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.execApprovalsSaving = true;\n  state.lastError = null;\n  try {\n    const baseHash = state.execApprovalsSnapshot?.hash;\n    if (!baseHash) {\n      state.lastError = \"Exec approvals hash missing; reload and retry.\";\n      return;\n    }\n    const file = state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {};\n    const rpc = resolveExecApprovalsSaveRpc(target, { file, baseHash });\n    if (!rpc) {\n      state.lastError = \"Select a node before saving exec approvals.\";\n      return;\n    }\n    await state.client.request(rpc.method, rpc.params);\n    state.execApprovalsDirty = false;\n    await loadExecApprovals(state, target);\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.execApprovalsSaving = false;\n  }\n}\n\nexport function updateExecApprovalsFormValue(\n  state: ExecApprovalsState,\n  path: Array<string | number>,\n  value: unknown,\n) {\n  const base = cloneConfigObject(\n    state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {},\n  );\n  setPathValue(base, path, value);\n  state.execApprovalsForm = base;\n  state.execApprovalsDirty = true;\n}\n\nexport function removeExecApprovalsFormValue(\n  state: ExecApprovalsState,\n  path: Array<string | number>,\n) {\n  const base = cloneConfigObject(\n    state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {},\n  );\n  removePathValue(base, path);\n  state.execApprovalsForm = base;\n  state.execApprovalsDirty = true;\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { PresenceEntry } from \"../types\";\n\nexport type PresenceState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  presenceLoading: boolean;\n  presenceEntries: PresenceEntry[];\n  presenceError: string | null;\n  presenceStatus: string | null;\n};\n\nexport async function loadPresence(state: PresenceState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.presenceLoading) {\n    return;\n  }\n  state.presenceLoading = true;\n  state.presenceError = null;\n  state.presenceStatus = null;\n  try {\n    const res = await state.client.request(\"system-presence\", {});\n    if (Array.isArray(res)) {\n      state.presenceEntries = res;\n      state.presenceStatus = res.length === 0 ? \"No instances yet.\" : null;\n    } else {\n      state.presenceEntries = [];\n      state.presenceStatus = \"No presence payload.\";\n    }\n  } catch (err) {\n    state.presenceError = String(err);\n  } finally {\n    state.presenceLoading = false;\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { SessionsListResult } from \"../types\";\nimport { toNumber } from \"../format\";\n\nexport type SessionsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  sessionsLoading: boolean;\n  sessionsResult: SessionsListResult | null;\n  sessionsError: string | null;\n  sessionsFilterActive: string;\n  sessionsFilterLimit: string;\n  sessionsIncludeGlobal: boolean;\n  sessionsIncludeUnknown: boolean;\n};\n\nexport async function loadSessions(\n  state: SessionsState,\n  overrides?: {\n    activeMinutes?: number;\n    limit?: number;\n    includeGlobal?: boolean;\n    includeUnknown?: boolean;\n  },\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.sessionsLoading) {\n    return;\n  }\n  state.sessionsLoading = true;\n  state.sessionsError = null;\n  try {\n    const includeGlobal = overrides?.includeGlobal ?? state.sessionsIncludeGlobal;\n    const includeUnknown = overrides?.includeUnknown ?? state.sessionsIncludeUnknown;\n    const activeMinutes = overrides?.activeMinutes ?? toNumber(state.sessionsFilterActive, 0);\n    const limit = overrides?.limit ?? toNumber(state.sessionsFilterLimit, 0);\n    const params: Record<string, unknown> = {\n      includeGlobal,\n      includeUnknown,\n    };\n    if (activeMinutes > 0) {\n      params.activeMinutes = activeMinutes;\n    }\n    if (limit > 0) {\n      params.limit = limit;\n    }\n    const res = await state.client.request(\"sessions.list\", params);\n    if (res) {\n      state.sessionsResult = res;\n    }\n  } catch (err) {\n    state.sessionsError = String(err);\n  } finally {\n    state.sessionsLoading = false;\n  }\n}\n\nexport async function patchSession(\n  state: SessionsState,\n  key: string,\n  patch: {\n    label?: string | null;\n    thinkingLevel?: string | null;\n    verboseLevel?: string | null;\n    reasoningLevel?: string | null;\n  },\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  const params: Record<string, unknown> = { key };\n  if (\"label\" in patch) {\n    params.label = patch.label;\n  }\n  if (\"thinkingLevel\" in patch) {\n    params.thinkingLevel = patch.thinkingLevel;\n  }\n  if (\"verboseLevel\" in patch) {\n    params.verboseLevel = patch.verboseLevel;\n  }\n  if (\"reasoningLevel\" in patch) {\n    params.reasoningLevel = patch.reasoningLevel;\n  }\n  try {\n    await state.client.request(\"sessions.patch\", params);\n    await loadSessions(state);\n  } catch (err) {\n    state.sessionsError = String(err);\n  }\n}\n\nexport async function deleteSession(state: SessionsState, key: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.sessionsLoading) {\n    return;\n  }\n  const confirmed = window.confirm(\n    `Delete session \"${key}\"?\\n\\nDeletes the session entry and archives its transcript.`,\n  );\n  if (!confirmed) {\n    return;\n  }\n  state.sessionsLoading = true;\n  state.sessionsError = null;\n  try {\n    await state.client.request(\"sessions.delete\", { key, deleteTranscript: true });\n    await loadSessions(state);\n  } catch (err) {\n    state.sessionsError = String(err);\n  } finally {\n    state.sessionsLoading = false;\n  }\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { SkillStatusReport } from \"../types\";\n\nexport type SkillsState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  skillsLoading: boolean;\n  skillsReport: SkillStatusReport | null;\n  skillsError: string | null;\n  skillsBusyKey: string | null;\n  skillEdits: Record<string, string>;\n  skillMessages: SkillMessageMap;\n  showToast?: (type: \"success\" | \"error\" | \"info\" | \"loading\", message: string) => void;\n};\n\nexport type SkillMessage = {\n  kind: \"success\" | \"error\";\n  message: string;\n};\n\nexport type SkillMessageMap = Record<string, SkillMessage>;\n\ntype LoadSkillsOptions = {\n  clearMessages?: boolean;\n};\n\nfunction setSkillMessage(state: SkillsState, key: string, message?: SkillMessage) {\n  if (!key.trim()) {\n    return;\n  }\n  const next = { ...state.skillMessages };\n  if (message) {\n    next[key] = message;\n  } else {\n    delete next[key];\n  }\n  state.skillMessages = next;\n}\n\nfunction getErrorMessage(err: unknown) {\n  if (err instanceof Error) {\n    return err.message;\n  }\n  return String(err);\n}\n\nexport async function loadSkills(state: SkillsState, options?: LoadSkillsOptions) {\n  if (options?.clearMessages && Object.keys(state.skillMessages).length > 0) {\n    state.skillMessages = {};\n  }\n  if (!state.client || !state.connected) {\n    return;\n  }\n  if (state.skillsLoading) {\n    return;\n  }\n  state.skillsLoading = true;\n  state.skillsError = null;\n  try {\n    const res = await state.client.request(\"skills.status\", {});\n    if (res) {\n      state.skillsReport = res;\n    }\n  } catch (err) {\n    state.skillsError = getErrorMessage(err);\n  } finally {\n    state.skillsLoading = false;\n  }\n}\n\nexport function updateSkillEdit(state: SkillsState, skillKey: string, value: string) {\n  state.skillEdits = { ...state.skillEdits, [skillKey]: value };\n}\n\nexport async function updateSkillEnabled(state: SkillsState, skillKey: string, enabled: boolean) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.skillsBusyKey = skillKey;\n  state.skillsError = null;\n  try {\n    await state.client.request(\"skills.update\", { skillKey, enabled });\n    await loadSkills(state);\n    setSkillMessage(state, skillKey, {\n      kind: \"success\",\n      message: enabled ? \"Skill enabled\" : \"Skill disabled\",\n    });\n  } catch (err) {\n    const message = getErrorMessage(err);\n    state.skillsError = message;\n    setSkillMessage(state, skillKey, {\n      kind: \"error\",\n      message,\n    });\n  } finally {\n    state.skillsBusyKey = null;\n  }\n}\n\nexport async function saveSkillApiKey(state: SkillsState, skillKey: string) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.skillsBusyKey = skillKey;\n  state.skillsError = null;\n  try {\n    const apiKey = state.skillEdits[skillKey] ?? \"\";\n    await state.client.request(\"skills.update\", { skillKey, apiKey });\n    await loadSkills(state);\n    setSkillMessage(state, skillKey, {\n      kind: \"success\",\n      message: \"API key saved\",\n    });\n  } catch (err) {\n    const message = getErrorMessage(err);\n    state.skillsError = message;\n    setSkillMessage(state, skillKey, {\n      kind: \"error\",\n      message,\n    });\n  } finally {\n    state.skillsBusyKey = null;\n  }\n}\n\nexport async function installSkill(\n  state: SkillsState,\n  skillKey: string,\n  name: string,\n  installId: string,\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.skillsBusyKey = skillKey;\n  state.skillsError = null;\n  try {\n    const result = await state.client.request(\"skills.install\", {\n      name,\n      installId,\n      timeoutMs: 120000,\n    });\n    await loadSkills(state);\n    const successMsg = result?.message ?? \"Skill installed\";\n    setSkillMessage(state, skillKey, {\n      kind: \"success\",\n      message: successMsg,\n    });\n    state.showToast?.(\"success\", successMsg);\n  } catch (err) {\n    const message = getErrorMessage(err);\n    state.skillsError = message;\n    setSkillMessage(state, skillKey, {\n      kind: \"error\",\n      message,\n    });\n    state.showToast?.(\"error\", `Failed to install skill: ${message}`);\n  } finally {\n    state.skillsBusyKey = null;\n  }\n}\n","import type { IconName } from \"./icons.js\";\n\nexport const TAB_GROUPS = [\n  { label: \"Chat\", tabs: [\"chat\"] },\n  {\n    label: \"Control\",\n    tabs: [\"overview\", \"channels\", \"instances\", \"sessions\", \"cron\"],\n  },\n  { label: \"Agent\", tabs: [\"agents\", \"skills\", \"nodes\"] },\n  { label: \"Settings\", tabs: [\"config\", \"debug\", \"logs\"] },\n] as const;\n\nexport type Tab =\n  | \"agents\"\n  | \"overview\"\n  | \"channels\"\n  | \"instances\"\n  | \"sessions\"\n  | \"cron\"\n  | \"skills\"\n  | \"nodes\"\n  | \"chat\"\n  | \"config\"\n  | \"debug\"\n  | \"logs\";\n\nconst TAB_PATHS: Record<Tab, string> = {\n  agents: \"/agents\",\n  overview: \"/overview\",\n  channels: \"/channels\",\n  instances: \"/instances\",\n  sessions: \"/sessions\",\n  cron: \"/cron\",\n  skills: \"/skills\",\n  nodes: \"/nodes\",\n  chat: \"/chat\",\n  config: \"/config\",\n  debug: \"/debug\",\n  logs: \"/logs\",\n};\n\nconst PATH_TO_TAB = new Map(Object.entries(TAB_PATHS).map(([tab, path]) => [path, tab as Tab]));\n\nexport function normalizeBasePath(basePath: string): string {\n  if (!basePath) {\n    return \"\";\n  }\n  let base = basePath.trim();\n  if (!base.startsWith(\"/\")) {\n    base = `/${base}`;\n  }\n  if (base === \"/\") {\n    return \"\";\n  }\n  if (base.endsWith(\"/\")) {\n    base = base.slice(0, -1);\n  }\n  return base;\n}\n\nexport function normalizePath(path: string): string {\n  if (!path) {\n    return \"/\";\n  }\n  let normalized = path.trim();\n  if (!normalized.startsWith(\"/\")) {\n    normalized = `/${normalized}`;\n  }\n  if (normalized.length > 1 && normalized.endsWith(\"/\")) {\n    normalized = normalized.slice(0, -1);\n  }\n  return normalized;\n}\n\nexport function pathForTab(tab: Tab, basePath = \"\"): string {\n  const base = normalizeBasePath(basePath);\n  const path = TAB_PATHS[tab];\n  return base ? `${base}${path}` : path;\n}\n\nexport function tabFromPath(pathname: string, basePath = \"\"): Tab | null {\n  const base = normalizeBasePath(basePath);\n  let path = pathname || \"/\";\n  if (base) {\n    if (path === base) {\n      path = \"/\";\n    } else if (path.startsWith(`${base}/`)) {\n      path = path.slice(base.length);\n    }\n  }\n  let normalized = normalizePath(path).toLowerCase();\n  if (normalized.endsWith(\"/index.html\")) {\n    normalized = \"/\";\n  }\n  if (normalized === \"/\") {\n    return \"chat\";\n  }\n  return PATH_TO_TAB.get(normalized) ?? null;\n}\n\nexport function inferBasePathFromPathname(pathname: string): string {\n  let normalized = normalizePath(pathname);\n  if (normalized.endsWith(\"/index.html\")) {\n    normalized = normalizePath(normalized.slice(0, -\"/index.html\".length));\n  }\n  if (normalized === \"/\") {\n    return \"\";\n  }\n  const segments = normalized.split(\"/\").filter(Boolean);\n  if (segments.length === 0) {\n    return \"\";\n  }\n  for (let i = 0; i < segments.length; i++) {\n    const candidate = `/${segments.slice(i).join(\"/\")}`.toLowerCase();\n    if (PATH_TO_TAB.has(candidate)) {\n      const prefix = segments.slice(0, i);\n      return prefix.length ? `/${prefix.join(\"/\")}` : \"\";\n    }\n  }\n  return `/${segments.join(\"/\")}`;\n}\n\nexport function iconForTab(tab: Tab): IconName {\n  switch (tab) {\n    case \"agents\":\n      return \"folder\";\n    case \"chat\":\n      return \"messageSquare\";\n    case \"overview\":\n      return \"barChart\";\n    case \"channels\":\n      return \"link\";\n    case \"instances\":\n      return \"radio\";\n    case \"sessions\":\n      return \"fileText\";\n    case \"cron\":\n      return \"loader\";\n    case \"skills\":\n      return \"zap\";\n    case \"nodes\":\n      return \"monitor\";\n    case \"config\":\n      return \"settings\";\n    case \"debug\":\n      return \"bug\";\n    case \"logs\":\n      return \"scrollText\";\n    default:\n      return \"folder\";\n  }\n}\n\nexport function titleForTab(tab: Tab) {\n  switch (tab) {\n    case \"agents\":\n      return \"Agents\";\n    case \"overview\":\n      return \"Overview\";\n    case \"channels\":\n      return \"Channels\";\n    case \"instances\":\n      return \"Instances\";\n    case \"sessions\":\n      return \"Sessions\";\n    case \"cron\":\n      return \"Cron Jobs\";\n    case \"skills\":\n      return \"Skills\";\n    case \"nodes\":\n      return \"Nodes\";\n    case \"chat\":\n      return \"Chat\";\n    case \"config\":\n      return \"Config\";\n    case \"debug\":\n      return \"Debug\";\n    case \"logs\":\n      return \"Logs\";\n    default:\n      return \"Control\";\n  }\n}\n\nexport function subtitleForTab(tab: Tab) {\n  switch (tab) {\n    case \"agents\":\n      return \"Manage agent workspaces, tools, and identities.\";\n    case \"overview\":\n      return \"Gateway status, entry points, and a fast health read.\";\n    case \"channels\":\n      return \"Manage channels and settings.\";\n    case \"instances\":\n      return \"Presence beacons from connected clients and nodes.\";\n    case \"sessions\":\n      return \"Inspect active sessions and adjust per-session defaults.\";\n    case \"cron\":\n      return \"Schedule wakeups and recurring agent runs.\";\n    case \"skills\":\n      return \"Manage skill availability and API key injection.\";\n    case \"nodes\":\n      return \"Paired devices, capabilities, and command exposure.\";\n    case \"chat\":\n      return \"Direct gateway chat session for quick interventions.\";\n    case \"config\":\n      return \"Edit ~/.openclaw/openclaw.json safely.\";\n    case \"debug\":\n      return \"Gateway snapshots, events, and manual RPC calls.\";\n    case \"logs\":\n      return \"Live tail of the gateway file logs.\";\n    default:\n      return \"\";\n  }\n}\n","const KEY = \"openclaw.control.settings.v1\";\n\nimport type { ThemeMode } from \"./theme\";\n\nexport type UiSettings = {\n  gatewayUrl: string;\n  token: string;\n  sessionKey: string;\n  lastActiveSessionKey: string;\n  theme: ThemeMode;\n  chatFocusMode: boolean;\n  chatShowThinking: boolean;\n  splitRatio: number; // Sidebar split ratio (0.4 to 0.7, default 0.6)\n  navCollapsed: boolean; // Collapsible sidebar state\n  navGroupsCollapsed: Record<string, boolean>; // Which nav groups are collapsed\n};\n\nexport function loadSettings(): UiSettings {\n  const defaultUrl = (() => {\n    const proto = location.protocol === \"https:\" ? \"wss\" : \"ws\";\n    return `${proto}://${location.host}`;\n  })();\n\n  const defaults: UiSettings = {\n    gatewayUrl: defaultUrl,\n    token: \"\",\n    sessionKey: \"main\",\n    lastActiveSessionKey: \"main\",\n    theme: \"system\",\n    chatFocusMode: false,\n    chatShowThinking: true,\n    splitRatio: 0.6,\n    navCollapsed: false,\n    navGroupsCollapsed: {},\n  };\n\n  try {\n    const raw = localStorage.getItem(KEY);\n    if (!raw) {\n      return defaults;\n    }\n    const parsed = JSON.parse(raw) as Partial<UiSettings>;\n    return {\n      gatewayUrl:\n        typeof parsed.gatewayUrl === \"string\" && parsed.gatewayUrl.trim()\n          ? parsed.gatewayUrl.trim()\n          : defaults.gatewayUrl,\n      token: typeof parsed.token === \"string\" ? parsed.token : defaults.token,\n      sessionKey:\n        typeof parsed.sessionKey === \"string\" && parsed.sessionKey.trim()\n          ? parsed.sessionKey.trim()\n          : defaults.sessionKey,\n      lastActiveSessionKey:\n        typeof parsed.lastActiveSessionKey === \"string\" && parsed.lastActiveSessionKey.trim()\n          ? parsed.lastActiveSessionKey.trim()\n          : (typeof parsed.sessionKey === \"string\" && parsed.sessionKey.trim()) ||\n            defaults.lastActiveSessionKey,\n      theme:\n        parsed.theme === \"light\" || parsed.theme === \"dark\" || parsed.theme === \"system\"\n          ? parsed.theme\n          : defaults.theme,\n      chatFocusMode:\n        typeof parsed.chatFocusMode === \"boolean\" ? parsed.chatFocusMode : defaults.chatFocusMode,\n      chatShowThinking:\n        typeof parsed.chatShowThinking === \"boolean\"\n          ? parsed.chatShowThinking\n          : defaults.chatShowThinking,\n      splitRatio:\n        typeof parsed.splitRatio === \"number\" &&\n        parsed.splitRatio >= 0.4 &&\n        parsed.splitRatio <= 0.7\n          ? parsed.splitRatio\n          : defaults.splitRatio,\n      navCollapsed:\n        typeof parsed.navCollapsed === \"boolean\" ? parsed.navCollapsed : defaults.navCollapsed,\n      navGroupsCollapsed:\n        typeof parsed.navGroupsCollapsed === \"object\" && parsed.navGroupsCollapsed !== null\n          ? parsed.navGroupsCollapsed\n          : defaults.navGroupsCollapsed,\n    };\n  } catch {\n    return defaults;\n  }\n}\n\nexport function saveSettings(next: UiSettings) {\n  localStorage.setItem(KEY, JSON.stringify(next));\n}\n","export type ThemeMode = \"system\" | \"light\" | \"dark\";\nexport type ResolvedTheme = \"light\" | \"dark\";\n\nexport function getSystemTheme(): ResolvedTheme {\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\n    return \"dark\";\n  }\n  return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n}\n\nexport function resolveTheme(mode: ThemeMode): ResolvedTheme {\n  if (mode === \"system\") {\n    return getSystemTheme();\n  }\n  return mode;\n}\n","import type { ThemeMode } from \"./theme\";\n\nexport type ThemeTransitionContext = {\n  element?: HTMLElement | null;\n  pointerClientX?: number;\n  pointerClientY?: number;\n};\n\nexport type ThemeTransitionOptions = {\n  nextTheme: ThemeMode;\n  applyTheme: () => void;\n  context?: ThemeTransitionContext;\n  currentTheme?: ThemeMode | null;\n};\n\ntype DocumentWithViewTransition = Document & {\n  startViewTransition?: (callback: () => void) => { finished: Promise<void> };\n};\n\nconst clamp01 = (value: number) => {\n  if (Number.isNaN(value)) {\n    return 0.5;\n  }\n  if (value <= 0) {\n    return 0;\n  }\n  if (value >= 1) {\n    return 1;\n  }\n  return value;\n};\n\nconst hasReducedMotionPreference = () => {\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\n    return false;\n  }\n  return window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches ?? false;\n};\n\nconst cleanupThemeTransition = (root: HTMLElement) => {\n  root.classList.remove(\"theme-transition\");\n  root.style.removeProperty(\"--theme-switch-x\");\n  root.style.removeProperty(\"--theme-switch-y\");\n};\n\nexport const startThemeTransition = ({\n  nextTheme,\n  applyTheme,\n  context,\n  currentTheme,\n}: ThemeTransitionOptions) => {\n  if (currentTheme === nextTheme) {\n    return;\n  }\n\n  const documentReference = globalThis.document ?? null;\n  if (!documentReference) {\n    applyTheme();\n    return;\n  }\n\n  const root = documentReference.documentElement;\n  const document_ = documentReference as DocumentWithViewTransition;\n  const prefersReducedMotion = hasReducedMotionPreference();\n\n  const canUseViewTransition = Boolean(document_.startViewTransition) && !prefersReducedMotion;\n\n  if (canUseViewTransition) {\n    let xPercent = 0.5;\n    let yPercent = 0.5;\n\n    if (\n      context?.pointerClientX !== undefined &&\n      context?.pointerClientY !== undefined &&\n      typeof window !== \"undefined\"\n    ) {\n      xPercent = clamp01(context.pointerClientX / window.innerWidth);\n      yPercent = clamp01(context.pointerClientY / window.innerHeight);\n    } else if (context?.element) {\n      const rect = context.element.getBoundingClientRect();\n      if (rect.width > 0 && rect.height > 0 && typeof window !== \"undefined\") {\n        xPercent = clamp01((rect.left + rect.width / 2) / window.innerWidth);\n        yPercent = clamp01((rect.top + rect.height / 2) / window.innerHeight);\n      }\n    }\n\n    root.style.setProperty(\"--theme-switch-x\", `${xPercent * 100}%`);\n    root.style.setProperty(\"--theme-switch-y\", `${yPercent * 100}%`);\n    root.classList.add(\"theme-transition\");\n\n    try {\n      const transition = document_.startViewTransition?.(() => {\n        applyTheme();\n      });\n      if (transition?.finished) {\n        void transition.finished.finally(() => cleanupThemeTransition(root));\n      } else {\n        cleanupThemeTransition(root);\n      }\n    } catch {\n      cleanupThemeTransition(root);\n      applyTheme();\n    }\n    return;\n  }\n\n  applyTheme();\n  cleanupThemeTransition(root);\n};\n","import type { OpenClawApp } from \"./app\";\nimport { refreshChat } from \"./app-chat\";\nimport {\n  startLogsPolling,\n  stopLogsPolling,\n  startDebugPolling,\n  stopDebugPolling,\n} from \"./app-polling\";\nimport { scheduleChatScroll, scheduleLogsScroll } from \"./app-scroll\";\nimport { loadAgentIdentities, loadAgentIdentity } from \"./controllers/agent-identity\";\nimport { loadAgentSkills } from \"./controllers/agent-skills\";\nimport { loadAgents } from \"./controllers/agents\";\nimport { loadChannels } from \"./controllers/channels\";\nimport { loadConfig, loadConfigSchema } from \"./controllers/config\";\nimport { loadCronJobs, loadCronStatus } from \"./controllers/cron\";\nimport { loadDebug } from \"./controllers/debug\";\nimport { loadDevices } from \"./controllers/devices\";\nimport { loadExecApprovals } from \"./controllers/exec-approvals\";\nimport { loadLogs } from \"./controllers/logs\";\nimport { loadNodes } from \"./controllers/nodes\";\nimport { loadPresence } from \"./controllers/presence\";\nimport { loadSessions } from \"./controllers/sessions\";\nimport { loadSkills } from \"./controllers/skills\";\nimport {\n  inferBasePathFromPathname,\n  normalizeBasePath,\n  normalizePath,\n  pathForTab,\n  tabFromPath,\n  type Tab,\n} from \"./navigation\";\nimport { saveSettings, type UiSettings } from \"./storage\";\nimport { resolveTheme, type ResolvedTheme, type ThemeMode } from \"./theme\";\nimport { startThemeTransition, type ThemeTransitionContext } from \"./theme-transition\";\n\ntype SettingsHost = {\n  settings: UiSettings;\n  theme: ThemeMode;\n  themeResolved: ResolvedTheme;\n  applySessionKey: string;\n  sessionKey: string;\n  tab: Tab;\n  connected: boolean;\n  chatHasAutoScrolled: boolean;\n  logsAtBottom: boolean;\n  eventLog: unknown[];\n  eventLogBuffer: unknown[];\n  basePath: string;\n  themeMedia: MediaQueryList | null;\n  themeMediaHandler: ((event: MediaQueryListEvent) => void) | null;\n  pendingGatewayUrl?: string | null;\n};\n\nexport function applySettings(host: SettingsHost, next: UiSettings) {\n  const normalized = {\n    ...next,\n    lastActiveSessionKey: next.lastActiveSessionKey?.trim() || next.sessionKey.trim() || \"main\",\n  };\n  host.settings = normalized;\n  saveSettings(normalized);\n  if (next.theme !== host.theme) {\n    host.theme = next.theme;\n    applyResolvedTheme(host, resolveTheme(next.theme));\n  }\n  host.applySessionKey = host.settings.lastActiveSessionKey;\n}\n\nexport function setLastActiveSessionKey(host: SettingsHost, next: string) {\n  const trimmed = next.trim();\n  if (!trimmed) {\n    return;\n  }\n  if (host.settings.lastActiveSessionKey === trimmed) {\n    return;\n  }\n  applySettings(host, { ...host.settings, lastActiveSessionKey: trimmed });\n}\n\nexport function applySettingsFromUrl(host: SettingsHost) {\n  if (!window.location.search) {\n    return;\n  }\n  const params = new URLSearchParams(window.location.search);\n  const tokenRaw = params.get(\"token\");\n  const passwordRaw = params.get(\"password\");\n  const sessionRaw = params.get(\"session\");\n  const gatewayUrlRaw = params.get(\"gatewayUrl\");\n  let shouldCleanUrl = false;\n\n  if (tokenRaw != null) {\n    const token = tokenRaw.trim();\n    if (token && token !== host.settings.token) {\n      applySettings(host, { ...host.settings, token });\n    }\n    params.delete(\"token\");\n    shouldCleanUrl = true;\n  }\n\n  if (passwordRaw != null) {\n    const password = passwordRaw.trim();\n    if (password) {\n      (host as { password: string }).password = password;\n    }\n    params.delete(\"password\");\n    shouldCleanUrl = true;\n  }\n\n  if (sessionRaw != null) {\n    const session = sessionRaw.trim();\n    if (session) {\n      host.sessionKey = session;\n      applySettings(host, {\n        ...host.settings,\n        sessionKey: session,\n        lastActiveSessionKey: session,\n      });\n    }\n  }\n\n  if (gatewayUrlRaw != null) {\n    const gatewayUrl = gatewayUrlRaw.trim();\n    if (gatewayUrl && gatewayUrl !== host.settings.gatewayUrl) {\n      host.pendingGatewayUrl = gatewayUrl;\n    }\n    params.delete(\"gatewayUrl\");\n    shouldCleanUrl = true;\n  }\n\n  if (!shouldCleanUrl) {\n    return;\n  }\n  const url = new URL(window.location.href);\n  url.search = params.toString();\n  window.history.replaceState({}, \"\", url.toString());\n}\n\nexport function setTab(host: SettingsHost, next: Tab) {\n  if (host.tab !== next) {\n    host.tab = next;\n  }\n  if (next === \"chat\") {\n    host.chatHasAutoScrolled = false;\n  }\n  if (next === \"logs\") {\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\n  } else {\n    stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\n  }\n  if (next === \"debug\") {\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\n  } else {\n    stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\n  }\n  void refreshActiveTab(host);\n  syncUrlWithTab(host, next, false);\n}\n\nexport function setTheme(host: SettingsHost, next: ThemeMode, context?: ThemeTransitionContext) {\n  const applyTheme = () => {\n    host.theme = next;\n    applySettings(host, { ...host.settings, theme: next });\n    applyResolvedTheme(host, resolveTheme(next));\n  };\n  startThemeTransition({\n    nextTheme: next,\n    applyTheme,\n    context,\n    currentTheme: host.theme,\n  });\n}\n\nexport async function refreshActiveTab(host: SettingsHost) {\n  if (host.tab === \"overview\") {\n    await loadOverview(host);\n  }\n  if (host.tab === \"channels\") {\n    await loadChannelsTab(host);\n  }\n  if (host.tab === \"instances\") {\n    await loadPresence(host as unknown as OpenClawApp);\n  }\n  if (host.tab === \"sessions\") {\n    await loadSessions(host as unknown as OpenClawApp);\n  }\n  if (host.tab === \"cron\") {\n    await loadCron(host);\n  }\n  if (host.tab === \"skills\") {\n    await loadSkills(host as unknown as OpenClawApp);\n  }\n  if (host.tab === \"agents\") {\n    await loadAgents(host as unknown as OpenClawApp);\n    await loadConfig(host as unknown as OpenClawApp);\n    const agentIds = host.agentsList?.agents?.map((entry) => entry.id) ?? [];\n    if (agentIds.length > 0) {\n      void loadAgentIdentities(host as unknown as OpenClawApp, agentIds);\n    }\n    const agentId =\n      host.agentsSelectedId ?? host.agentsList?.defaultId ?? host.agentsList?.agents?.[0]?.id;\n    if (agentId) {\n      void loadAgentIdentity(host as unknown as OpenClawApp, agentId);\n      if (host.agentsPanel === \"skills\") {\n        void loadAgentSkills(host as unknown as OpenClawApp, agentId);\n      }\n      if (host.agentsPanel === \"channels\") {\n        void loadChannels(host as unknown as OpenClawApp, false);\n      }\n      if (host.agentsPanel === \"cron\") {\n        void loadCron(host);\n      }\n    }\n  }\n  if (host.tab === \"nodes\") {\n    await loadNodes(host as unknown as OpenClawApp);\n    await loadDevices(host as unknown as OpenClawApp);\n    await loadConfig(host as unknown as OpenClawApp);\n    await loadExecApprovals(host as unknown as OpenClawApp);\n  }\n  if (host.tab === \"chat\") {\n    await refreshChat(host as unknown as Parameters<typeof refreshChat>[0]);\n    scheduleChatScroll(\n      host as unknown as Parameters<typeof scheduleChatScroll>[0],\n      !host.chatHasAutoScrolled,\n    );\n  }\n  if (host.tab === \"config\") {\n    await loadConfigSchema(host as unknown as OpenClawApp);\n    await loadConfig(host as unknown as OpenClawApp);\n  }\n  if (host.tab === \"debug\") {\n    await loadDebug(host as unknown as OpenClawApp);\n    host.eventLog = host.eventLogBuffer;\n  }\n  if (host.tab === \"logs\") {\n    host.logsAtBottom = true;\n    await loadLogs(host as unknown as OpenClawApp, { reset: true });\n    scheduleLogsScroll(host as unknown as Parameters<typeof scheduleLogsScroll>[0], true);\n  }\n}\n\nexport function inferBasePath() {\n  if (typeof window === \"undefined\") {\n    return \"\";\n  }\n  const configured = window.__OPENCLAW_CONTROL_UI_BASE_PATH__;\n  if (typeof configured === \"string\" && configured.trim()) {\n    return normalizeBasePath(configured);\n  }\n  return inferBasePathFromPathname(window.location.pathname);\n}\n\nexport function syncThemeWithSettings(host: SettingsHost) {\n  host.theme = host.settings.theme ?? \"system\";\n  applyResolvedTheme(host, resolveTheme(host.theme));\n}\n\nexport function applyResolvedTheme(host: SettingsHost, resolved: ResolvedTheme) {\n  host.themeResolved = resolved;\n  if (typeof document === \"undefined\") {\n    return;\n  }\n  const root = document.documentElement;\n  root.dataset.theme = resolved;\n  root.style.colorScheme = resolved;\n}\n\nexport function attachThemeListener(host: SettingsHost) {\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\n    return;\n  }\n  host.themeMedia = window.matchMedia(\"(prefers-color-scheme: dark)\");\n  host.themeMediaHandler = (event) => {\n    if (host.theme !== \"system\") {\n      return;\n    }\n    applyResolvedTheme(host, event.matches ? \"dark\" : \"light\");\n  };\n  if (typeof host.themeMedia.addEventListener === \"function\") {\n    host.themeMedia.addEventListener(\"change\", host.themeMediaHandler);\n    return;\n  }\n  const legacy = host.themeMedia as MediaQueryList & {\n    addListener: (cb: (event: MediaQueryListEvent) => void) => void;\n  };\n  legacy.addListener(host.themeMediaHandler);\n}\n\nexport function detachThemeListener(host: SettingsHost) {\n  if (!host.themeMedia || !host.themeMediaHandler) {\n    return;\n  }\n  if (typeof host.themeMedia.removeEventListener === \"function\") {\n    host.themeMedia.removeEventListener(\"change\", host.themeMediaHandler);\n    return;\n  }\n  const legacy = host.themeMedia as MediaQueryList & {\n    removeListener: (cb: (event: MediaQueryListEvent) => void) => void;\n  };\n  legacy.removeListener(host.themeMediaHandler);\n  host.themeMedia = null;\n  host.themeMediaHandler = null;\n}\n\nexport function syncTabWithLocation(host: SettingsHost, replace: boolean) {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  const resolved = tabFromPath(window.location.pathname, host.basePath) ?? \"chat\";\n  setTabFromRoute(host, resolved);\n  syncUrlWithTab(host, resolved, replace);\n}\n\nexport function onPopState(host: SettingsHost) {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  const resolved = tabFromPath(window.location.pathname, host.basePath);\n  if (!resolved) {\n    return;\n  }\n\n  const url = new URL(window.location.href);\n  const session = url.searchParams.get(\"session\")?.trim();\n  if (session) {\n    host.sessionKey = session;\n    applySettings(host, {\n      ...host.settings,\n      sessionKey: session,\n      lastActiveSessionKey: session,\n    });\n  }\n\n  setTabFromRoute(host, resolved);\n}\n\nexport function setTabFromRoute(host: SettingsHost, next: Tab) {\n  if (host.tab !== next) {\n    host.tab = next;\n  }\n  if (next === \"chat\") {\n    host.chatHasAutoScrolled = false;\n  }\n  if (next === \"logs\") {\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\n  } else {\n    stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\n  }\n  if (next === \"debug\") {\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\n  } else {\n    stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\n  }\n  if (host.connected) {\n    void refreshActiveTab(host);\n  }\n}\n\nexport function syncUrlWithTab(host: SettingsHost, tab: Tab, replace: boolean) {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  const targetPath = normalizePath(pathForTab(tab, host.basePath));\n  const currentPath = normalizePath(window.location.pathname);\n  const url = new URL(window.location.href);\n\n  if (tab === \"chat\" && host.sessionKey) {\n    url.searchParams.set(\"session\", host.sessionKey);\n  } else {\n    url.searchParams.delete(\"session\");\n  }\n\n  if (currentPath !== targetPath) {\n    url.pathname = targetPath;\n  }\n\n  if (replace) {\n    window.history.replaceState({}, \"\", url.toString());\n  } else {\n    window.history.pushState({}, \"\", url.toString());\n  }\n}\n\nexport function syncUrlWithSessionKey(host: SettingsHost, sessionKey: string, replace: boolean) {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  const url = new URL(window.location.href);\n  url.searchParams.set(\"session\", sessionKey);\n  if (replace) {\n    window.history.replaceState({}, \"\", url.toString());\n  } else {\n    window.history.pushState({}, \"\", url.toString());\n  }\n}\n\nexport async function loadOverview(host: SettingsHost) {\n  await Promise.all([\n    loadChannels(host as unknown as OpenClawApp, false),\n    loadPresence(host as unknown as OpenClawApp),\n    loadSessions(host as unknown as OpenClawApp),\n    loadCronStatus(host as unknown as OpenClawApp),\n    loadDebug(host as unknown as OpenClawApp),\n  ]);\n}\n\nexport async function loadChannelsTab(host: SettingsHost) {\n  await Promise.all([\n    loadChannels(host as unknown as OpenClawApp, true),\n    loadConfigSchema(host as unknown as OpenClawApp),\n    loadConfig(host as unknown as OpenClawApp),\n  ]);\n}\n\nexport async function loadCron(host: SettingsHost) {\n  await Promise.all([\n    loadChannels(host as unknown as OpenClawApp, false),\n    loadCronStatus(host as unknown as OpenClawApp),\n    loadCronJobs(host as unknown as OpenClawApp),\n  ]);\n}\n","import { truncateText } from \"./format\";\n\nconst TOOL_STREAM_LIMIT = 50;\nconst TOOL_STREAM_THROTTLE_MS = 80;\nconst TOOL_OUTPUT_CHAR_LIMIT = 120_000;\n\nexport type AgentEventPayload = {\n  runId: string;\n  seq: number;\n  stream: string;\n  ts: number;\n  sessionKey?: string;\n  data: Record<string, unknown>;\n};\n\nexport type ToolStreamEntry = {\n  toolCallId: string;\n  runId: string;\n  sessionKey?: string;\n  name: string;\n  args?: unknown;\n  output?: string;\n  startedAt: number;\n  updatedAt: number;\n  message: Record<string, unknown>;\n};\n\ntype ToolStreamHost = {\n  sessionKey: string;\n  chatRunId: string | null;\n  toolStreamById: Map<string, ToolStreamEntry>;\n  toolStreamOrder: string[];\n  chatToolMessages: Record<string, unknown>[];\n  toolStreamSyncTimer: number | null;\n};\n\nfunction extractToolOutputText(value: unknown): string | null {\n  if (!value || typeof value !== \"object\") {\n    return null;\n  }\n  const record = value as Record<string, unknown>;\n  if (typeof record.text === \"string\") {\n    return record.text;\n  }\n  const content = record.content;\n  if (!Array.isArray(content)) {\n    return null;\n  }\n  const parts = content\n    .map((item) => {\n      if (!item || typeof item !== \"object\") {\n        return null;\n      }\n      const entry = item as Record<string, unknown>;\n      if (entry.type === \"text\" && typeof entry.text === \"string\") {\n        return entry.text;\n      }\n      return null;\n    })\n    .filter((part): part is string => Boolean(part));\n  if (parts.length === 0) {\n    return null;\n  }\n  return parts.join(\"\\n\");\n}\n\nfunction formatToolOutput(value: unknown): string | null {\n  if (value === null || value === undefined) {\n    return null;\n  }\n  if (typeof value === \"number\" || typeof value === \"boolean\") {\n    return String(value);\n  }\n  const contentText = extractToolOutputText(value);\n  let text: string;\n  if (typeof value === \"string\") {\n    text = value;\n  } else if (contentText) {\n    text = contentText;\n  } else {\n    try {\n      text = JSON.stringify(value, null, 2);\n    } catch {\n      // oxlint-disable typescript/no-base-to-string\n      text = String(value);\n    }\n  }\n  const truncated = truncateText(text, TOOL_OUTPUT_CHAR_LIMIT);\n  if (!truncated.truncated) {\n    return truncated.text;\n  }\n  return `${truncated.text}\\n\\nâ€¦ truncated (${truncated.total} chars, showing first ${truncated.text.length}).`;\n}\n\nfunction buildToolStreamMessage(entry: ToolStreamEntry): Record<string, unknown> {\n  const content: Array<Record<string, unknown>> = [];\n  content.push({\n    type: \"toolcall\",\n    name: entry.name,\n    arguments: entry.args ?? {},\n  });\n  if (entry.output) {\n    content.push({\n      type: \"toolresult\",\n      name: entry.name,\n      text: entry.output,\n    });\n  }\n  return {\n    role: \"assistant\",\n    toolCallId: entry.toolCallId,\n    runId: entry.runId,\n    content,\n    timestamp: entry.startedAt,\n  };\n}\n\nfunction trimToolStream(host: ToolStreamHost) {\n  if (host.toolStreamOrder.length <= TOOL_STREAM_LIMIT) {\n    return;\n  }\n  const overflow = host.toolStreamOrder.length - TOOL_STREAM_LIMIT;\n  const removed = host.toolStreamOrder.splice(0, overflow);\n  for (const id of removed) {\n    host.toolStreamById.delete(id);\n  }\n}\n\nfunction syncToolStreamMessages(host: ToolStreamHost) {\n  host.chatToolMessages = host.toolStreamOrder\n    .map((id) => host.toolStreamById.get(id)?.message)\n    .filter((msg): msg is Record<string, unknown> => Boolean(msg));\n}\n\nexport function flushToolStreamSync(host: ToolStreamHost) {\n  if (host.toolStreamSyncTimer != null) {\n    clearTimeout(host.toolStreamSyncTimer);\n    host.toolStreamSyncTimer = null;\n  }\n  syncToolStreamMessages(host);\n}\n\nexport function scheduleToolStreamSync(host: ToolStreamHost, force = false) {\n  if (force) {\n    flushToolStreamSync(host);\n    return;\n  }\n  if (host.toolStreamSyncTimer != null) {\n    return;\n  }\n  host.toolStreamSyncTimer = window.setTimeout(\n    () => flushToolStreamSync(host),\n    TOOL_STREAM_THROTTLE_MS,\n  );\n}\n\nexport function resetToolStream(host: ToolStreamHost) {\n  host.toolStreamById.clear();\n  host.toolStreamOrder = [];\n  host.chatToolMessages = [];\n  flushToolStreamSync(host);\n}\n\nexport type CompactionStatus = {\n  active: boolean;\n  startedAt: number | null;\n  completedAt: number | null;\n};\n\ntype CompactionHost = ToolStreamHost & {\n  compactionStatus?: CompactionStatus | null;\n  compactionClearTimer?: number | null;\n};\n\nconst COMPACTION_TOAST_DURATION_MS = 5000;\n\nexport function handleCompactionEvent(host: CompactionHost, payload: AgentEventPayload) {\n  const data = payload.data ?? {};\n  const phase = typeof data.phase === \"string\" ? data.phase : \"\";\n\n  // Clear any existing timer\n  if (host.compactionClearTimer != null) {\n    window.clearTimeout(host.compactionClearTimer);\n    host.compactionClearTimer = null;\n  }\n\n  if (phase === \"start\") {\n    host.compactionStatus = {\n      active: true,\n      startedAt: Date.now(),\n      completedAt: null,\n    };\n  } else if (phase === \"end\") {\n    host.compactionStatus = {\n      active: false,\n      startedAt: host.compactionStatus?.startedAt ?? null,\n      completedAt: Date.now(),\n    };\n    // Auto-clear the toast after duration\n    host.compactionClearTimer = window.setTimeout(() => {\n      host.compactionStatus = null;\n      host.compactionClearTimer = null;\n    }, COMPACTION_TOAST_DURATION_MS);\n  }\n}\n\nexport function handleAgentEvent(host: ToolStreamHost, payload?: AgentEventPayload) {\n  if (!payload) {\n    return;\n  }\n\n  // Handle compaction events\n  if (payload.stream === \"compaction\") {\n    handleCompactionEvent(host as CompactionHost, payload);\n    return;\n  }\n\n  if (payload.stream !== \"tool\") {\n    return;\n  }\n  const sessionKey = typeof payload.sessionKey === \"string\" ? payload.sessionKey : undefined;\n  if (sessionKey && sessionKey !== host.sessionKey) {\n    return;\n  }\n  // Fallback: only accept session-less events for the active run.\n  if (!sessionKey && host.chatRunId && payload.runId !== host.chatRunId) {\n    return;\n  }\n  if (host.chatRunId && payload.runId !== host.chatRunId) {\n    return;\n  }\n  if (!host.chatRunId) {\n    return;\n  }\n\n  const data = payload.data ?? {};\n  const toolCallId = typeof data.toolCallId === \"string\" ? data.toolCallId : \"\";\n  if (!toolCallId) {\n    return;\n  }\n  const name = typeof data.name === \"string\" ? data.name : \"tool\";\n  const phase = typeof data.phase === \"string\" ? data.phase : \"\";\n  const args = phase === \"start\" ? data.args : undefined;\n  const output =\n    phase === \"update\"\n      ? formatToolOutput(data.partialResult)\n      : phase === \"result\"\n        ? formatToolOutput(data.result)\n        : undefined;\n\n  const now = Date.now();\n  let entry = host.toolStreamById.get(toolCallId);\n  if (!entry) {\n    entry = {\n      toolCallId,\n      runId: payload.runId,\n      sessionKey,\n      name,\n      args,\n      output,\n      startedAt: typeof payload.ts === \"number\" ? payload.ts : now,\n      updatedAt: now,\n      message: {},\n    };\n    host.toolStreamById.set(toolCallId, entry);\n    host.toolStreamOrder.push(toolCallId);\n  } else {\n    entry.name = name;\n    if (args !== undefined) {\n      entry.args = args;\n    }\n    if (output !== undefined) {\n      entry.output = output;\n    }\n    entry.updatedAt = now;\n  }\n\n  entry.message = buildToolStreamMessage(entry);\n  trimToolStream(host);\n  scheduleToolStreamSync(host, phase === \"result\");\n}\n","import { stripThinkingTags } from \"../format\";\n\nconst ENVELOPE_PREFIX = /^\\[([^\\]]+)\\]\\s*/;\nconst ENVELOPE_CHANNELS = [\n  \"WebChat\",\n  \"WhatsApp\",\n  \"Telegram\",\n  \"Signal\",\n  \"Slack\",\n  \"Discord\",\n  \"iMessage\",\n  \"Teams\",\n  \"Matrix\",\n  \"Zalo\",\n  \"Zalo Personal\",\n  \"BlueBubbles\",\n];\n\nconst textCache = new WeakMap<object, string | null>();\nconst thinkingCache = new WeakMap<object, string | null>();\n\nfunction looksLikeEnvelopeHeader(header: string): boolean {\n  if (/\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}Z\\b/.test(header)) {\n    return true;\n  }\n  if (/\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}\\b/.test(header)) {\n    return true;\n  }\n  return ENVELOPE_CHANNELS.some((label) => header.startsWith(`${label} `));\n}\n\nexport function stripEnvelope(text: string): string {\n  const match = text.match(ENVELOPE_PREFIX);\n  if (!match) {\n    return text;\n  }\n  const header = match[1] ?? \"\";\n  if (!looksLikeEnvelopeHeader(header)) {\n    return text;\n  }\n  return text.slice(match[0].length);\n}\n\nexport function extractText(message: unknown): string | null {\n  const m = message as Record<string, unknown>;\n  const role = typeof m.role === \"string\" ? m.role : \"\";\n  const content = m.content;\n  if (typeof content === \"string\") {\n    const processed = role === \"assistant\" ? stripThinkingTags(content) : stripEnvelope(content);\n    return processed;\n  }\n  if (Array.isArray(content)) {\n    const parts = content\n      .map((p) => {\n        const item = p as Record<string, unknown>;\n        if (item.type === \"text\" && typeof item.text === \"string\") {\n          return item.text;\n        }\n        return null;\n      })\n      .filter((v): v is string => typeof v === \"string\");\n    if (parts.length > 0) {\n      const joined = parts.join(\"\\n\");\n      const processed = role === \"assistant\" ? stripThinkingTags(joined) : stripEnvelope(joined);\n      return processed;\n    }\n  }\n  if (typeof m.text === \"string\") {\n    const processed = role === \"assistant\" ? stripThinkingTags(m.text) : stripEnvelope(m.text);\n    return processed;\n  }\n  return null;\n}\n\nexport function extractTextCached(message: unknown): string | null {\n  if (!message || typeof message !== \"object\") {\n    return extractText(message);\n  }\n  const obj = message;\n  if (textCache.has(obj)) {\n    return textCache.get(obj) ?? null;\n  }\n  const value = extractText(message);\n  textCache.set(obj, value);\n  return value;\n}\n\nexport function extractThinking(message: unknown): string | null {\n  const m = message as Record<string, unknown>;\n  const content = m.content;\n  const parts: string[] = [];\n  if (Array.isArray(content)) {\n    for (const p of content) {\n      const item = p as Record<string, unknown>;\n      if (item.type === \"thinking\" && typeof item.thinking === \"string\") {\n        const cleaned = item.thinking.trim();\n        if (cleaned) {\n          parts.push(cleaned);\n        }\n      }\n    }\n  }\n  if (parts.length > 0) {\n    return parts.join(\"\\n\");\n  }\n\n  // Back-compat: older logs may still have <think> tags inside text blocks.\n  const rawText = extractRawText(message);\n  if (!rawText) {\n    return null;\n  }\n  const matches = [\n    ...rawText.matchAll(/<\\s*think(?:ing)?\\s*>([\\s\\S]*?)<\\s*\\/\\s*think(?:ing)?\\s*>/gi),\n  ];\n  const extracted = matches.map((m) => (m[1] ?? \"\").trim()).filter(Boolean);\n  return extracted.length > 0 ? extracted.join(\"\\n\") : null;\n}\n\nexport function extractThinkingCached(message: unknown): string | null {\n  if (!message || typeof message !== \"object\") {\n    return extractThinking(message);\n  }\n  const obj = message;\n  if (thinkingCache.has(obj)) {\n    return thinkingCache.get(obj) ?? null;\n  }\n  const value = extractThinking(message);\n  thinkingCache.set(obj, value);\n  return value;\n}\n\nexport function extractRawText(message: unknown): string | null {\n  const m = message as Record<string, unknown>;\n  const content = m.content;\n  if (typeof content === \"string\") {\n    return content;\n  }\n  if (Array.isArray(content)) {\n    const parts = content\n      .map((p) => {\n        const item = p as Record<string, unknown>;\n        if (item.type === \"text\" && typeof item.text === \"string\") {\n          return item.text;\n        }\n        return null;\n      })\n      .filter((v): v is string => typeof v === \"string\");\n    if (parts.length > 0) {\n      return parts.join(\"\\n\");\n    }\n  }\n  if (typeof m.text === \"string\") {\n    return m.text;\n  }\n  return null;\n}\n\nexport function formatReasoningMarkdown(text: string): string {\n  const trimmed = text.trim();\n  if (!trimmed) {\n    return \"\";\n  }\n  const lines = trimmed\n    .split(/\\r?\\n/)\n    .map((line) => line.trim())\n    .filter(Boolean)\n    .map((line) => `_${line}_`);\n  return lines.length ? [\"_Reasoning:_\", ...lines].join(\"\\n\") : \"\";\n}\n","export type CryptoLike = {\n  randomUUID?: (() => string) | undefined;\n  getRandomValues?: ((array: Uint8Array) => Uint8Array) | undefined;\n};\n\nlet warnedWeakCrypto = false;\n\nfunction uuidFromBytes(bytes: Uint8Array): string {\n  bytes[6] = (bytes[6] & 0x0f) | 0x40; // version 4\n  bytes[8] = (bytes[8] & 0x3f) | 0x80; // variant 1\n\n  let hex = \"\";\n  for (let i = 0; i < bytes.length; i++) {\n    hex += bytes[i].toString(16).padStart(2, \"0\");\n  }\n\n  return `${hex.slice(0, 8)}-${hex.slice(8, 12)}-${hex.slice(12, 16)}-${hex.slice(\n    16,\n    20,\n  )}-${hex.slice(20)}`;\n}\n\nfunction weakRandomBytes(): Uint8Array {\n  const bytes = new Uint8Array(16);\n  const now = Date.now();\n  for (let i = 0; i < bytes.length; i++) {\n    bytes[i] = Math.floor(Math.random() * 256);\n  }\n  bytes[0] ^= now & 0xff;\n  bytes[1] ^= (now >>> 8) & 0xff;\n  bytes[2] ^= (now >>> 16) & 0xff;\n  bytes[3] ^= (now >>> 24) & 0xff;\n  return bytes;\n}\n\nfunction warnWeakCryptoOnce() {\n  if (warnedWeakCrypto) {\n    return;\n  }\n  warnedWeakCrypto = true;\n  console.warn(\"[uuid] crypto API missing; falling back to weak randomness\");\n}\n\nexport function generateUUID(cryptoLike: CryptoLike | null = globalThis.crypto): string {\n  if (cryptoLike && typeof cryptoLike.randomUUID === \"function\") {\n    return cryptoLike.randomUUID();\n  }\n\n  if (cryptoLike && typeof cryptoLike.getRandomValues === \"function\") {\n    const bytes = new Uint8Array(16);\n    cryptoLike.getRandomValues(bytes);\n    return uuidFromBytes(bytes);\n  }\n\n  warnWeakCryptoOnce();\n  return uuidFromBytes(weakRandomBytes());\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type { ChatAttachment } from \"../ui-types\";\nimport { extractText } from \"../chat/message-extract\";\nimport { generateUUID } from \"../uuid\";\n\nexport type ChatState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  sessionKey: string;\n  chatLoading: boolean;\n  chatMessages: unknown[];\n  chatThinkingLevel: string | null;\n  chatSending: boolean;\n  chatMessage: string;\n  chatAttachments: ChatAttachment[];\n  chatRunId: string | null;\n  chatStream: string | null;\n  chatStreamStartedAt: number | null;\n  lastError: string | null;\n};\n\nexport type ChatEventPayload = {\n  runId: string;\n  sessionKey: string;\n  state: \"delta\" | \"final\" | \"aborted\" | \"error\";\n  message?: unknown;\n  errorMessage?: string;\n};\n\nexport async function loadChatHistory(state: ChatState) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  state.chatLoading = true;\n  state.lastError = null;\n  try {\n    const res = await state.client.request(\"chat.history\", {\n      sessionKey: state.sessionKey,\n      limit: 200,\n    });\n    state.chatMessages = Array.isArray(res.messages) ? res.messages : [];\n    state.chatThinkingLevel = res.thinkingLevel ?? null;\n  } catch (err) {\n    state.lastError = String(err);\n  } finally {\n    state.chatLoading = false;\n  }\n}\n\nfunction dataUrlToBase64(dataUrl: string): { content: string; mimeType: string } | null {\n  const match = /^data:([^;]+);base64,(.+)$/.exec(dataUrl);\n  if (!match) {\n    return null;\n  }\n  return { mimeType: match[1], content: match[2] };\n}\n\nexport async function sendChatMessage(\n  state: ChatState,\n  message: string,\n  attachments?: ChatAttachment[],\n): Promise<string | null> {\n  if (!state.client || !state.connected) {\n    return null;\n  }\n  const msg = message.trim();\n  const hasAttachments = attachments && attachments.length > 0;\n  if (!msg && !hasAttachments) {\n    return null;\n  }\n\n  const now = Date.now();\n\n  // Build user message content blocks\n  const contentBlocks: Array<{ type: string; text?: string; source?: unknown }> = [];\n  if (msg) {\n    contentBlocks.push({ type: \"text\", text: msg });\n  }\n  // Add image previews to the message for display\n  if (hasAttachments) {\n    for (const att of attachments) {\n      contentBlocks.push({\n        type: \"image\",\n        source: { type: \"base64\", media_type: att.mimeType, data: att.dataUrl },\n      });\n    }\n  }\n\n  state.chatMessages = [\n    ...state.chatMessages,\n    {\n      role: \"user\",\n      content: contentBlocks,\n      timestamp: now,\n    },\n  ];\n\n  state.chatSending = true;\n  state.lastError = null;\n  const runId = generateUUID();\n  state.chatRunId = runId;\n  state.chatStream = \"\";\n  state.chatStreamStartedAt = now;\n\n  // Convert attachments to API format\n  const apiAttachments = hasAttachments\n    ? attachments\n        .map((att) => {\n          const parsed = dataUrlToBase64(att.dataUrl);\n          if (!parsed) {\n            return null;\n          }\n          return {\n            type: \"image\",\n            mimeType: parsed.mimeType,\n            content: parsed.content,\n          };\n        })\n        .filter((a): a is NonNullable<typeof a> => a !== null)\n    : undefined;\n\n  try {\n    await state.client.request(\"chat.send\", {\n      sessionKey: state.sessionKey,\n      message: msg,\n      deliver: false,\n      idempotencyKey: runId,\n      attachments: apiAttachments,\n    });\n    return runId;\n  } catch (err) {\n    const error = String(err);\n    state.chatRunId = null;\n    state.chatStream = null;\n    state.chatStreamStartedAt = null;\n    state.lastError = error;\n    state.chatMessages = [\n      ...state.chatMessages,\n      {\n        role: \"assistant\",\n        content: [{ type: \"text\", text: \"Error: \" + error }],\n        timestamp: Date.now(),\n      },\n    ];\n    return null;\n  } finally {\n    state.chatSending = false;\n  }\n}\n\nexport async function abortChatRun(state: ChatState): Promise<boolean> {\n  if (!state.client || !state.connected) {\n    return false;\n  }\n  const runId = state.chatRunId;\n  try {\n    await state.client.request(\n      \"chat.abort\",\n      runId ? { sessionKey: state.sessionKey, runId } : { sessionKey: state.sessionKey },\n    );\n    return true;\n  } catch (err) {\n    state.lastError = String(err);\n    return false;\n  }\n}\n\nexport function handleChatEvent(state: ChatState, payload?: ChatEventPayload) {\n  if (!payload) {\n    return null;\n  }\n  if (payload.sessionKey !== state.sessionKey) {\n    return null;\n  }\n\n  // Final from another run (e.g. sub-agent announce): refresh history to show new message.\n  // See https://github.com/openclaw/openclaw/issues/1909\n  if (payload.runId && state.chatRunId && payload.runId !== state.chatRunId) {\n    if (payload.state === \"final\") {\n      return \"final\";\n    }\n    return null;\n  }\n\n  if (payload.state === \"delta\") {\n    const next = extractText(payload.message);\n    if (typeof next === \"string\") {\n      const current = state.chatStream ?? \"\";\n      if (!current || next.length >= current.length) {\n        state.chatStream = next;\n      }\n    }\n  } else if (payload.state === \"final\") {\n    state.chatStream = null;\n    state.chatRunId = null;\n    state.chatStreamStartedAt = null;\n  } else if (payload.state === \"aborted\") {\n    state.chatStream = null;\n    state.chatRunId = null;\n    state.chatStreamStartedAt = null;\n  } else if (payload.state === \"error\") {\n    state.chatStream = null;\n    state.chatRunId = null;\n    state.chatStreamStartedAt = null;\n    state.lastError = payload.errorMessage ?? \"chat error\";\n  }\n  return payload.state;\n}\n","import type { OpenClawApp } from \"./app\";\nimport type { GatewayHelloOk } from \"./gateway\";\nimport type { ChatAttachment, ChatQueueItem } from \"./ui-types\";\nimport { parseAgentSessionKey } from \"../../../src/sessions/session-key-utils.js\";\nimport { scheduleChatScroll } from \"./app-scroll\";\nimport { setLastActiveSessionKey } from \"./app-settings\";\nimport { resetToolStream } from \"./app-tool-stream\";\nimport { abortChatRun, loadChatHistory, sendChatMessage } from \"./controllers/chat\";\nimport { loadSessions } from \"./controllers/sessions\";\nimport { normalizeBasePath } from \"./navigation\";\nimport { generateUUID } from \"./uuid\";\n\ntype ChatHost = {\n  connected: boolean;\n  chatMessage: string;\n  chatAttachments: ChatAttachment[];\n  chatQueue: ChatQueueItem[];\n  chatRunId: string | null;\n  chatSending: boolean;\n  sessionKey: string;\n  basePath: string;\n  hello: GatewayHelloOk | null;\n  chatAvatarUrl: string | null;\n  refreshSessionsAfterChat: Set<string>;\n};\n\nexport const CHAT_SESSIONS_ACTIVE_MINUTES = 120;\n\nexport function isChatBusy(host: ChatHost) {\n  return host.chatSending || Boolean(host.chatRunId);\n}\n\nexport function isChatStopCommand(text: string) {\n  const trimmed = text.trim();\n  if (!trimmed) {\n    return false;\n  }\n  const normalized = trimmed.toLowerCase();\n  if (normalized === \"/stop\") {\n    return true;\n  }\n  return (\n    normalized === \"stop\" ||\n    normalized === \"esc\" ||\n    normalized === \"abort\" ||\n    normalized === \"wait\" ||\n    normalized === \"exit\"\n  );\n}\n\nfunction isChatResetCommand(text: string) {\n  const trimmed = text.trim();\n  if (!trimmed) {\n    return false;\n  }\n  const normalized = trimmed.toLowerCase();\n  if (normalized === \"/new\" || normalized === \"/reset\") {\n    return true;\n  }\n  return normalized.startsWith(\"/new \") || normalized.startsWith(\"/reset \");\n}\n\nexport async function handleAbortChat(host: ChatHost) {\n  if (!host.connected) {\n    return;\n  }\n  host.chatMessage = \"\";\n  await abortChatRun(host as unknown as OpenClawApp);\n}\n\nfunction enqueueChatMessage(\n  host: ChatHost,\n  text: string,\n  attachments?: ChatAttachment[],\n  refreshSessions?: boolean,\n) {\n  const trimmed = text.trim();\n  const hasAttachments = Boolean(attachments && attachments.length > 0);\n  if (!trimmed && !hasAttachments) {\n    return;\n  }\n  host.chatQueue = [\n    ...host.chatQueue,\n    {\n      id: generateUUID(),\n      text: trimmed,\n      createdAt: Date.now(),\n      attachments: hasAttachments ? attachments?.map((att) => ({ ...att })) : undefined,\n      refreshSessions,\n    },\n  ];\n}\n\nasync function sendChatMessageNow(\n  host: ChatHost,\n  message: string,\n  opts?: {\n    previousDraft?: string;\n    restoreDraft?: boolean;\n    attachments?: ChatAttachment[];\n    previousAttachments?: ChatAttachment[];\n    restoreAttachments?: boolean;\n    refreshSessions?: boolean;\n  },\n) {\n  resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\n  const runId = await sendChatMessage(host as unknown as OpenClawApp, message, opts?.attachments);\n  const ok = Boolean(runId);\n  if (!ok && opts?.previousDraft != null) {\n    host.chatMessage = opts.previousDraft;\n  }\n  if (!ok && opts?.previousAttachments) {\n    host.chatAttachments = opts.previousAttachments;\n  }\n  if (ok) {\n    setLastActiveSessionKey(\n      host as unknown as Parameters<typeof setLastActiveSessionKey>[0],\n      host.sessionKey,\n    );\n  }\n  if (ok && opts?.restoreDraft && opts.previousDraft?.trim()) {\n    host.chatMessage = opts.previousDraft;\n  }\n  if (ok && opts?.restoreAttachments && opts.previousAttachments?.length) {\n    host.chatAttachments = opts.previousAttachments;\n  }\n  scheduleChatScroll(host as unknown as Parameters<typeof scheduleChatScroll>[0]);\n  if (ok && !host.chatRunId) {\n    void flushChatQueue(host);\n  }\n  if (ok && opts?.refreshSessions && runId) {\n    host.refreshSessionsAfterChat.add(runId);\n  }\n  return ok;\n}\n\nasync function flushChatQueue(host: ChatHost) {\n  if (!host.connected || isChatBusy(host)) {\n    return;\n  }\n  const [next, ...rest] = host.chatQueue;\n  if (!next) {\n    return;\n  }\n  host.chatQueue = rest;\n  const ok = await sendChatMessageNow(host, next.text, {\n    attachments: next.attachments,\n    refreshSessions: next.refreshSessions,\n  });\n  if (!ok) {\n    host.chatQueue = [next, ...host.chatQueue];\n  }\n}\n\nexport function removeQueuedMessage(host: ChatHost, id: string) {\n  host.chatQueue = host.chatQueue.filter((item) => item.id !== id);\n}\n\nexport async function handleSendChat(\n  host: ChatHost,\n  messageOverride?: string,\n  opts?: { restoreDraft?: boolean },\n) {\n  if (!host.connected) {\n    return;\n  }\n  const previousDraft = host.chatMessage;\n  const message = (messageOverride ?? host.chatMessage).trim();\n  const attachments = host.chatAttachments ?? [];\n  const attachmentsToSend = messageOverride == null ? attachments : [];\n  const hasAttachments = attachmentsToSend.length > 0;\n\n  // Allow sending with just attachments (no message text required)\n  if (!message && !hasAttachments) {\n    return;\n  }\n\n  if (isChatStopCommand(message)) {\n    await handleAbortChat(host);\n    return;\n  }\n\n  const refreshSessions = isChatResetCommand(message);\n  if (messageOverride == null) {\n    host.chatMessage = \"\";\n    // Clear attachments when sending\n    host.chatAttachments = [];\n  }\n\n  if (isChatBusy(host)) {\n    enqueueChatMessage(host, message, attachmentsToSend, refreshSessions);\n    return;\n  }\n\n  await sendChatMessageNow(host, message, {\n    previousDraft: messageOverride == null ? previousDraft : undefined,\n    restoreDraft: Boolean(messageOverride && opts?.restoreDraft),\n    attachments: hasAttachments ? attachmentsToSend : undefined,\n    previousAttachments: messageOverride == null ? attachments : undefined,\n    restoreAttachments: Boolean(messageOverride && opts?.restoreDraft),\n    refreshSessions,\n  });\n}\n\nexport async function refreshChat(host: ChatHost) {\n  await Promise.all([\n    loadChatHistory(host as unknown as OpenClawApp),\n    loadSessions(host as unknown as OpenClawApp, {\n      activeMinutes: CHAT_SESSIONS_ACTIVE_MINUTES,\n    }),\n    refreshChatAvatar(host),\n  ]);\n  scheduleChatScroll(host as unknown as Parameters<typeof scheduleChatScroll>[0]);\n}\n\nexport const flushChatQueueForEvent = flushChatQueue;\n\ntype SessionDefaultsSnapshot = {\n  defaultAgentId?: string;\n};\n\nfunction resolveAgentIdForSession(host: ChatHost): string | null {\n  const parsed = parseAgentSessionKey(host.sessionKey);\n  if (parsed?.agentId) {\n    return parsed.agentId;\n  }\n  const snapshot = host.hello?.snapshot as\n    | { sessionDefaults?: SessionDefaultsSnapshot }\n    | undefined;\n  const fallback = snapshot?.sessionDefaults?.defaultAgentId?.trim();\n  return fallback || \"main\";\n}\n\nfunction buildAvatarMetaUrl(basePath: string, agentId: string): string {\n  const base = normalizeBasePath(basePath);\n  const encoded = encodeURIComponent(agentId);\n  return base ? `${base}/avatar/${encoded}?meta=1` : `/avatar/${encoded}?meta=1`;\n}\n\nexport async function refreshChatAvatar(host: ChatHost) {\n  if (!host.connected) {\n    host.chatAvatarUrl = null;\n    return;\n  }\n  const agentId = resolveAgentIdForSession(host);\n  if (!agentId) {\n    host.chatAvatarUrl = null;\n    return;\n  }\n  host.chatAvatarUrl = null;\n  const url = buildAvatarMetaUrl(host.basePath, agentId);\n  try {\n    const res = await fetch(url, { method: \"GET\" });\n    if (!res.ok) {\n      host.chatAvatarUrl = null;\n      return;\n    }\n    const data = (await res.json()) as { avatarUrl?: unknown };\n    const avatarUrl = typeof data.avatarUrl === \"string\" ? data.avatarUrl.trim() : \"\";\n    host.chatAvatarUrl = avatarUrl || null;\n  } catch {\n    host.chatAvatarUrl = null;\n  }\n}\n","import type { LogLevel } from \"./types\";\nimport type { CronFormState } from \"./ui-types\";\n\nexport const DEFAULT_LOG_LEVEL_FILTERS: Record<LogLevel, boolean> = {\n  trace: true,\n  debug: true,\n  info: true,\n  warn: true,\n  error: true,\n  fatal: true,\n};\n\nexport const DEFAULT_CRON_FORM: CronFormState = {\n  name: \"\",\n  description: \"\",\n  agentId: \"\",\n  enabled: true,\n  scheduleKind: \"every\",\n  scheduleAt: \"\",\n  everyAmount: \"30\",\n  everyUnit: \"minutes\",\n  cronExpr: \"0 7 * * *\",\n  cronTz: \"\",\n  sessionTarget: \"main\",\n  wakeMode: \"next-heartbeat\",\n  payloadKind: \"systemEvent\",\n  payloadText: \"\",\n  deliver: false,\n  channel: \"last\",\n  to: \"\",\n  timeoutSeconds: \"\",\n  postToMainPrefix: \"\",\n};\n","const MAX_ASSISTANT_NAME = 50;\nconst MAX_ASSISTANT_AVATAR = 200;\n\nexport const DEFAULT_ASSISTANT_NAME = \"Assistant\";\nexport const DEFAULT_ASSISTANT_AVATAR = \"A\";\n\nexport type AssistantIdentity = {\n  agentId?: string | null;\n  name: string;\n  avatar: string | null;\n};\n\ndeclare global {\n  interface Window {\n    __OPENCLAW_ASSISTANT_NAME__?: string;\n    __OPENCLAW_ASSISTANT_AVATAR__?: string;\n  }\n}\n\nfunction coerceIdentityValue(value: string | undefined, maxLength: number): string | undefined {\n  if (typeof value !== \"string\") {\n    return undefined;\n  }\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return undefined;\n  }\n  if (trimmed.length <= maxLength) {\n    return trimmed;\n  }\n  return trimmed.slice(0, maxLength);\n}\n\nexport function normalizeAssistantIdentity(\n  input?: Partial<AssistantIdentity> | null,\n): AssistantIdentity {\n  const name = coerceIdentityValue(input?.name, MAX_ASSISTANT_NAME) ?? DEFAULT_ASSISTANT_NAME;\n  const avatar = coerceIdentityValue(input?.avatar ?? undefined, MAX_ASSISTANT_AVATAR) ?? null;\n  const agentId =\n    typeof input?.agentId === \"string\" && input.agentId.trim() ? input.agentId.trim() : null;\n  return { agentId, name, avatar };\n}\n\nexport function resolveInjectedAssistantIdentity(): AssistantIdentity {\n  if (typeof window === \"undefined\") {\n    return normalizeAssistantIdentity({});\n  }\n  return normalizeAssistantIdentity({\n    name: window.__OPENCLAW_ASSISTANT_NAME__,\n    avatar: window.__OPENCLAW_ASSISTANT_AVATAR__,\n  });\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport { normalizeAssistantIdentity } from \"../assistant-identity\";\n\nexport type AssistantIdentityState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  sessionKey: string;\n  assistantName: string;\n  assistantAvatar: string | null;\n  assistantAgentId: string | null;\n};\n\nexport async function loadAssistantIdentity(\n  state: AssistantIdentityState,\n  opts?: { sessionKey?: string },\n) {\n  if (!state.client || !state.connected) {\n    return;\n  }\n  const sessionKey = opts?.sessionKey?.trim() || state.sessionKey.trim();\n  const params = sessionKey ? { sessionKey } : {};\n  try {\n    const res = await state.client.request(\"agent.identity.get\", params);\n    if (!res) {\n      return;\n    }\n    const normalized = normalizeAssistantIdentity(res);\n    state.assistantName = normalized.name;\n    state.assistantAvatar = normalized.avatar;\n    state.assistantAgentId = normalized.agentId ?? null;\n  } catch {\n    // Ignore errors; keep last known identity.\n  }\n}\n","export type ExecApprovalRequestPayload = {\n  command: string;\n  cwd?: string | null;\n  host?: string | null;\n  security?: string | null;\n  ask?: string | null;\n  agentId?: string | null;\n  resolvedPath?: string | null;\n  sessionKey?: string | null;\n};\n\nexport type ExecApprovalRequest = {\n  id: string;\n  request: ExecApprovalRequestPayload;\n  createdAtMs: number;\n  expiresAtMs: number;\n};\n\nexport type ExecApprovalResolved = {\n  id: string;\n  decision?: string | null;\n  resolvedBy?: string | null;\n  ts?: number | null;\n};\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null;\n}\n\nexport function parseExecApprovalRequested(payload: unknown): ExecApprovalRequest | null {\n  if (!isRecord(payload)) {\n    return null;\n  }\n  const id = typeof payload.id === \"string\" ? payload.id.trim() : \"\";\n  const request = payload.request;\n  if (!id || !isRecord(request)) {\n    return null;\n  }\n  const command = typeof request.command === \"string\" ? request.command.trim() : \"\";\n  if (!command) {\n    return null;\n  }\n  const createdAtMs = typeof payload.createdAtMs === \"number\" ? payload.createdAtMs : 0;\n  const expiresAtMs = typeof payload.expiresAtMs === \"number\" ? payload.expiresAtMs : 0;\n  if (!createdAtMs || !expiresAtMs) {\n    return null;\n  }\n  return {\n    id,\n    request: {\n      command,\n      cwd: typeof request.cwd === \"string\" ? request.cwd : null,\n      host: typeof request.host === \"string\" ? request.host : null,\n      security: typeof request.security === \"string\" ? request.security : null,\n      ask: typeof request.ask === \"string\" ? request.ask : null,\n      agentId: typeof request.agentId === \"string\" ? request.agentId : null,\n      resolvedPath: typeof request.resolvedPath === \"string\" ? request.resolvedPath : null,\n      sessionKey: typeof request.sessionKey === \"string\" ? request.sessionKey : null,\n    },\n    createdAtMs,\n    expiresAtMs,\n  };\n}\n\nexport function parseExecApprovalResolved(payload: unknown): ExecApprovalResolved | null {\n  if (!isRecord(payload)) {\n    return null;\n  }\n  const id = typeof payload.id === \"string\" ? payload.id.trim() : \"\";\n  if (!id) {\n    return null;\n  }\n  return {\n    id,\n    decision: typeof payload.decision === \"string\" ? payload.decision : null,\n    resolvedBy: typeof payload.resolvedBy === \"string\" ? payload.resolvedBy : null,\n    ts: typeof payload.ts === \"number\" ? payload.ts : null,\n  };\n}\n\nexport function pruneExecApprovalQueue(queue: ExecApprovalRequest[]): ExecApprovalRequest[] {\n  const now = Date.now();\n  return queue.filter((entry) => entry.expiresAtMs > now);\n}\n\nexport function addExecApproval(\n  queue: ExecApprovalRequest[],\n  entry: ExecApprovalRequest,\n): ExecApprovalRequest[] {\n  const next = pruneExecApprovalQueue(queue).filter((item) => item.id !== entry.id);\n  next.push(entry);\n  return next;\n}\n\nexport function removeExecApproval(\n  queue: ExecApprovalRequest[],\n  id: string,\n): ExecApprovalRequest[] {\n  return pruneExecApprovalQueue(queue).filter((entry) => entry.id !== id);\n}\n","export type DeviceAuthPayloadParams = {\n  deviceId: string;\n  clientId: string;\n  clientMode: string;\n  role: string;\n  scopes: string[];\n  signedAtMs: number;\n  token?: string | null;\n  nonce?: string | null;\n  version?: \"v1\" | \"v2\";\n};\n\nexport function buildDeviceAuthPayload(params: DeviceAuthPayloadParams): string {\n  const version = params.version ?? (params.nonce ? \"v2\" : \"v1\");\n  const scopes = params.scopes.join(\",\");\n  const token = params.token ?? \"\";\n  const base = [\n    version,\n    params.deviceId,\n    params.clientId,\n    params.clientMode,\n    params.role,\n    scopes,\n    String(params.signedAtMs),\n    token,\n  ];\n  if (version === \"v2\") {\n    base.push(params.nonce ?? \"\");\n  }\n  return base.join(\"|\");\n}\n","export const GATEWAY_CLIENT_IDS = {\n  WEBCHAT_UI: \"webchat-ui\",\n  CONTROL_UI: \"openclaw-control-ui\",\n  WEBCHAT: \"webchat\",\n  CLI: \"cli\",\n  GATEWAY_CLIENT: \"gateway-client\",\n  MACOS_APP: \"openclaw-macos\",\n  IOS_APP: \"openclaw-ios\",\n  ANDROID_APP: \"openclaw-android\",\n  NODE_HOST: \"node-host\",\n  TEST: \"test\",\n  FINGERPRINT: \"fingerprint\",\n  PROBE: \"openclaw-probe\",\n} as const;\n\nexport type GatewayClientId = (typeof GATEWAY_CLIENT_IDS)[keyof typeof GATEWAY_CLIENT_IDS];\n\n// Back-compat naming (internal): these values are IDs, not display names.\nexport const GATEWAY_CLIENT_NAMES = GATEWAY_CLIENT_IDS;\nexport type GatewayClientName = GatewayClientId;\n\nexport const GATEWAY_CLIENT_MODES = {\n  WEBCHAT: \"webchat\",\n  CLI: \"cli\",\n  UI: \"ui\",\n  BACKEND: \"backend\",\n  NODE: \"node\",\n  PROBE: \"probe\",\n  TEST: \"test\",\n} as const;\n\nexport type GatewayClientMode = (typeof GATEWAY_CLIENT_MODES)[keyof typeof GATEWAY_CLIENT_MODES];\n\nexport type GatewayClientInfo = {\n  id: GatewayClientId;\n  displayName?: string;\n  version: string;\n  platform: string;\n  deviceFamily?: string;\n  modelIdentifier?: string;\n  mode: GatewayClientMode;\n  instanceId?: string;\n};\n\nconst GATEWAY_CLIENT_ID_SET = new Set<GatewayClientId>(Object.values(GATEWAY_CLIENT_IDS));\nconst GATEWAY_CLIENT_MODE_SET = new Set<GatewayClientMode>(Object.values(GATEWAY_CLIENT_MODES));\n\nexport function normalizeGatewayClientId(raw?: string | null): GatewayClientId | undefined {\n  const normalized = raw?.trim().toLowerCase();\n  if (!normalized) {\n    return undefined;\n  }\n  return GATEWAY_CLIENT_ID_SET.has(normalized as GatewayClientId)\n    ? (normalized as GatewayClientId)\n    : undefined;\n}\n\nexport function normalizeGatewayClientName(raw?: string | null): GatewayClientName | undefined {\n  return normalizeGatewayClientId(raw);\n}\n\nexport function normalizeGatewayClientMode(raw?: string | null): GatewayClientMode | undefined {\n  const normalized = raw?.trim().toLowerCase();\n  if (!normalized) {\n    return undefined;\n  }\n  return GATEWAY_CLIENT_MODE_SET.has(normalized as GatewayClientMode)\n    ? (normalized as GatewayClientMode)\n    : undefined;\n}\n","import { buildDeviceAuthPayload } from \"../../../src/gateway/device-auth.js\";\nimport {\n  GATEWAY_CLIENT_MODES,\n  GATEWAY_CLIENT_NAMES,\n  type GatewayClientMode,\n  type GatewayClientName,\n} from \"../../../src/gateway/protocol/client-info.js\";\nimport { clearDeviceAuthToken, loadDeviceAuthToken, storeDeviceAuthToken } from \"./device-auth\";\nimport { loadOrCreateDeviceIdentity, signDevicePayload } from \"./device-identity\";\nimport { generateUUID } from \"./uuid\";\n\nexport type GatewayEventFrame = {\n  type: \"event\";\n  event: string;\n  payload?: unknown;\n  seq?: number;\n  stateVersion?: { presence: number; health: number };\n};\n\nexport type GatewayResponseFrame = {\n  type: \"res\";\n  id: string;\n  ok: boolean;\n  payload?: unknown;\n  error?: { code: string; message: string; details?: unknown };\n};\n\nexport type GatewayHelloOk = {\n  type: \"hello-ok\";\n  protocol: number;\n  features?: { methods?: string[]; events?: string[] };\n  snapshot?: unknown;\n  auth?: {\n    deviceToken?: string;\n    role?: string;\n    scopes?: string[];\n    issuedAtMs?: number;\n  };\n  policy?: { tickIntervalMs?: number };\n};\n\ntype Pending = {\n  resolve: (value: unknown) => void;\n  reject: (err: unknown) => void;\n};\n\nexport type GatewayBrowserClientOptions = {\n  url: string;\n  token?: string;\n  password?: string;\n  clientName?: GatewayClientName;\n  clientVersion?: string;\n  platform?: string;\n  mode?: GatewayClientMode;\n  instanceId?: string;\n  onHello?: (hello: GatewayHelloOk) => void;\n  onEvent?: (evt: GatewayEventFrame) => void;\n  onClose?: (info: { code: number; reason: string }) => void;\n  onGap?: (info: { expected: number; received: number }) => void;\n};\n\n// 4008 = application-defined code (browser rejects 1008 \"Policy Violation\")\nconst CONNECT_FAILED_CLOSE_CODE = 4008;\n\nexport class GatewayBrowserClient {\n  private ws: WebSocket | null = null;\n  private pending = new Map<string, Pending>();\n  private closed = false;\n  private lastSeq: number | null = null;\n  private connectNonce: string | null = null;\n  private connectSent = false;\n  private connectTimer: number | null = null;\n  private backoffMs = 800;\n\n  constructor(private opts: GatewayBrowserClientOptions) {}\n\n  start() {\n    this.closed = false;\n    this.connect();\n  }\n\n  stop() {\n    this.closed = true;\n    this.ws?.close();\n    this.ws = null;\n    this.flushPending(new Error(\"gateway client stopped\"));\n  }\n\n  get connected() {\n    return this.ws?.readyState === WebSocket.OPEN;\n  }\n\n  private connect() {\n    if (this.closed) {\n      return;\n    }\n    this.ws = new WebSocket(this.opts.url);\n    this.ws.addEventListener(\"open\", () => this.queueConnect());\n    this.ws.addEventListener(\"message\", (ev) => this.handleMessage(String(ev.data ?? \"\")));\n    this.ws.addEventListener(\"close\", (ev) => {\n      const reason = String(ev.reason ?? \"\");\n      this.ws = null;\n      this.flushPending(new Error(`gateway closed (${ev.code}): ${reason}`));\n      this.opts.onClose?.({ code: ev.code, reason });\n      this.scheduleReconnect();\n    });\n    this.ws.addEventListener(\"error\", () => {\n      // ignored; close handler will fire\n    });\n  }\n\n  private scheduleReconnect() {\n    if (this.closed) {\n      return;\n    }\n    const delay = this.backoffMs;\n    this.backoffMs = Math.min(this.backoffMs * 1.7, 15_000);\n    window.setTimeout(() => this.connect(), delay);\n  }\n\n  private flushPending(err: Error) {\n    for (const [, p] of this.pending) {\n      p.reject(err);\n    }\n    this.pending.clear();\n  }\n\n  private async sendConnect() {\n    if (this.connectSent) {\n      return;\n    }\n    this.connectSent = true;\n    if (this.connectTimer !== null) {\n      window.clearTimeout(this.connectTimer);\n      this.connectTimer = null;\n    }\n\n    // crypto.subtle is only available in secure contexts (HTTPS, localhost).\n    // Over plain HTTP, we skip device identity and fall back to token-only auth.\n    // Gateways may reject this unless gateway.controlUi.allowInsecureAuth is enabled.\n    const isSecureContext = typeof crypto !== \"undefined\" && !!crypto.subtle;\n\n    const scopes = [\"operator.admin\", \"operator.approvals\", \"operator.pairing\"];\n    const role = \"operator\";\n    let deviceIdentity: Awaited<ReturnType<typeof loadOrCreateDeviceIdentity>> | null = null;\n    let canFallbackToShared = false;\n    let authToken = this.opts.token;\n\n    if (isSecureContext) {\n      deviceIdentity = await loadOrCreateDeviceIdentity();\n      const storedToken = loadDeviceAuthToken({\n        deviceId: deviceIdentity.deviceId,\n        role,\n      })?.token;\n      authToken = storedToken ?? this.opts.token;\n      canFallbackToShared = Boolean(storedToken && this.opts.token);\n    }\n    const auth =\n      authToken || this.opts.password\n        ? {\n            token: authToken,\n            password: this.opts.password,\n          }\n        : undefined;\n\n    let device:\n      | {\n          id: string;\n          publicKey: string;\n          signature: string;\n          signedAt: number;\n          nonce: string | undefined;\n        }\n      | undefined;\n\n    if (isSecureContext && deviceIdentity) {\n      const signedAtMs = Date.now();\n      const nonce = this.connectNonce ?? undefined;\n      const payload = buildDeviceAuthPayload({\n        deviceId: deviceIdentity.deviceId,\n        clientId: this.opts.clientName ?? GATEWAY_CLIENT_NAMES.CONTROL_UI,\n        clientMode: this.opts.mode ?? GATEWAY_CLIENT_MODES.WEBCHAT,\n        role,\n        scopes,\n        signedAtMs,\n        token: authToken ?? null,\n        nonce,\n      });\n      const signature = await signDevicePayload(deviceIdentity.privateKey, payload);\n      device = {\n        id: deviceIdentity.deviceId,\n        publicKey: deviceIdentity.publicKey,\n        signature,\n        signedAt: signedAtMs,\n        nonce,\n      };\n    }\n    const params = {\n      minProtocol: 3,\n      maxProtocol: 3,\n      client: {\n        id: this.opts.clientName ?? GATEWAY_CLIENT_NAMES.CONTROL_UI,\n        version: this.opts.clientVersion ?? \"dev\",\n        platform: this.opts.platform ?? navigator.platform ?? \"web\",\n        mode: this.opts.mode ?? GATEWAY_CLIENT_MODES.WEBCHAT,\n        instanceId: this.opts.instanceId,\n      },\n      role,\n      scopes,\n      device,\n      caps: [],\n      auth,\n      userAgent: navigator.userAgent,\n      locale: navigator.language,\n    };\n\n    void this.request<GatewayHelloOk>(\"connect\", params)\n      .then((hello) => {\n        if (hello?.auth?.deviceToken && deviceIdentity) {\n          storeDeviceAuthToken({\n            deviceId: deviceIdentity.deviceId,\n            role: hello.auth.role ?? role,\n            token: hello.auth.deviceToken,\n            scopes: hello.auth.scopes ?? [],\n          });\n        }\n        this.backoffMs = 800;\n        this.opts.onHello?.(hello);\n      })\n      .catch(() => {\n        if (canFallbackToShared && deviceIdentity) {\n          clearDeviceAuthToken({ deviceId: deviceIdentity.deviceId, role });\n        }\n        this.ws?.close(CONNECT_FAILED_CLOSE_CODE, \"connect failed\");\n      });\n  }\n\n  private handleMessage(raw: string) {\n    let parsed: unknown;\n    try {\n      parsed = JSON.parse(raw);\n    } catch {\n      return;\n    }\n\n    const frame = parsed as { type?: unknown };\n    if (frame.type === \"event\") {\n      const evt = parsed as GatewayEventFrame;\n      if (evt.event === \"connect.challenge\") {\n        const payload = evt.payload as { nonce?: unknown } | undefined;\n        const nonce = payload && typeof payload.nonce === \"string\" ? payload.nonce : null;\n        if (nonce) {\n          this.connectNonce = nonce;\n          void this.sendConnect();\n        }\n        return;\n      }\n      const seq = typeof evt.seq === \"number\" ? evt.seq : null;\n      if (seq !== null) {\n        if (this.lastSeq !== null && seq > this.lastSeq + 1) {\n          this.opts.onGap?.({ expected: this.lastSeq + 1, received: seq });\n        }\n        this.lastSeq = seq;\n      }\n      try {\n        this.opts.onEvent?.(evt);\n      } catch (err) {\n        console.error(\"[gateway] event handler error:\", err);\n      }\n      return;\n    }\n\n    if (frame.type === \"res\") {\n      const res = parsed as GatewayResponseFrame;\n      const pending = this.pending.get(res.id);\n      if (!pending) {\n        return;\n      }\n      this.pending.delete(res.id);\n      if (res.ok) {\n        pending.resolve(res.payload);\n      } else {\n        pending.reject(new Error(res.error?.message ?? \"request failed\"));\n      }\n      return;\n    }\n  }\n\n  request<T = unknown>(method: string, params?: unknown): Promise<T> {\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n      return Promise.reject(new Error(\"gateway not connected\"));\n    }\n    const id = generateUUID();\n    const frame = { type: \"req\", id, method, params };\n    const p = new Promise<T>((resolve, reject) => {\n      this.pending.set(id, { resolve: (v) => resolve(v as T), reject });\n    });\n    this.ws.send(JSON.stringify(frame));\n    return p;\n  }\n\n  private queueConnect() {\n    this.connectNonce = null;\n    this.connectSent = false;\n    if (this.connectTimer !== null) {\n      window.clearTimeout(this.connectTimer);\n    }\n    this.connectTimer = window.setTimeout(() => {\n      void this.sendConnect();\n    }, 750);\n  }\n}\n","import type { OpenClawApp } from \"./app\";\nimport type { EventLogEntry } from \"./app-events\";\nimport type { ExecApprovalRequest } from \"./controllers/exec-approval\";\nimport type { GatewayEventFrame, GatewayHelloOk } from \"./gateway\";\nimport type { Tab } from \"./navigation\";\nimport type { UiSettings } from \"./storage\";\nimport type { AgentsListResult, HealthSnapshot, PresenceEntry, StatusSummary } from \"./types\";\nimport { CHAT_SESSIONS_ACTIVE_MINUTES, flushChatQueueForEvent } from \"./app-chat\";\nimport { applySettings, loadCron, refreshActiveTab, setLastActiveSessionKey } from \"./app-settings\";\nimport { handleAgentEvent, resetToolStream, type AgentEventPayload } from \"./app-tool-stream\";\nimport { loadAgents } from \"./controllers/agents\";\nimport { loadAssistantIdentity } from \"./controllers/assistant-identity\";\nimport { handleChatEvent, loadChatHistory, type ChatEventPayload } from \"./controllers/chat\";\nimport { loadDevices } from \"./controllers/devices\";\nimport {\n  addExecApproval,\n  parseExecApprovalRequested,\n  parseExecApprovalResolved,\n  removeExecApproval,\n} from \"./controllers/exec-approval\";\nimport { loadNodes } from \"./controllers/nodes\";\nimport { loadSessions } from \"./controllers/sessions\";\nimport { GatewayBrowserClient } from \"./gateway\";\n\ntype GatewayHost = {\n  settings: UiSettings;\n  password: string;\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  hello: GatewayHelloOk | null;\n  lastError: string | null;\n  onboarding?: boolean;\n  eventLogBuffer: EventLogEntry[];\n  eventLog: EventLogEntry[];\n  tab: Tab;\n  presenceEntries: PresenceEntry[];\n  presenceError: string | null;\n  presenceStatus: StatusSummary | null;\n  agentsLoading: boolean;\n  agentsList: AgentsListResult | null;\n  agentsError: string | null;\n  debugHealth: HealthSnapshot | null;\n  assistantName: string;\n  assistantAvatar: string | null;\n  assistantAgentId: string | null;\n  sessionKey: string;\n  chatRunId: string | null;\n  refreshSessionsAfterChat: Set<string>;\n  execApprovalQueue: ExecApprovalRequest[];\n  execApprovalError: string | null;\n};\n\ntype SessionDefaultsSnapshot = {\n  defaultAgentId?: string;\n  mainKey?: string;\n  mainSessionKey?: string;\n  scope?: string;\n};\n\nfunction normalizeSessionKeyForDefaults(\n  value: string | undefined,\n  defaults: SessionDefaultsSnapshot,\n): string {\n  const raw = (value ?? \"\").trim();\n  const mainSessionKey = defaults.mainSessionKey?.trim();\n  if (!mainSessionKey) {\n    return raw;\n  }\n  if (!raw) {\n    return mainSessionKey;\n  }\n  const mainKey = defaults.mainKey?.trim() || \"main\";\n  const defaultAgentId = defaults.defaultAgentId?.trim();\n  const isAlias =\n    raw === \"main\" ||\n    raw === mainKey ||\n    (defaultAgentId &&\n      (raw === `agent:${defaultAgentId}:main` || raw === `agent:${defaultAgentId}:${mainKey}`));\n  return isAlias ? mainSessionKey : raw;\n}\n\nfunction applySessionDefaults(host: GatewayHost, defaults?: SessionDefaultsSnapshot) {\n  if (!defaults?.mainSessionKey) {\n    return;\n  }\n  const resolvedSessionKey = normalizeSessionKeyForDefaults(host.sessionKey, defaults);\n  const resolvedSettingsSessionKey = normalizeSessionKeyForDefaults(\n    host.settings.sessionKey,\n    defaults,\n  );\n  const resolvedLastActiveSessionKey = normalizeSessionKeyForDefaults(\n    host.settings.lastActiveSessionKey,\n    defaults,\n  );\n  const nextSessionKey = resolvedSessionKey || resolvedSettingsSessionKey || host.sessionKey;\n  const nextSettings = {\n    ...host.settings,\n    sessionKey: resolvedSettingsSessionKey || nextSessionKey,\n    lastActiveSessionKey: resolvedLastActiveSessionKey || nextSessionKey,\n  };\n  const shouldUpdateSettings =\n    nextSettings.sessionKey !== host.settings.sessionKey ||\n    nextSettings.lastActiveSessionKey !== host.settings.lastActiveSessionKey;\n  if (nextSessionKey !== host.sessionKey) {\n    host.sessionKey = nextSessionKey;\n  }\n  if (shouldUpdateSettings) {\n    applySettings(host as unknown as Parameters<typeof applySettings>[0], nextSettings);\n  }\n}\n\nexport function connectGateway(host: GatewayHost) {\n  host.lastError = null;\n  host.hello = null;\n  host.connected = false;\n  (\n    host as unknown as { connectionState: \"connected\" | \"reconnecting\" | \"disconnected\" }\n  ).connectionState = \"disconnected\";\n  host.execApprovalQueue = [];\n  host.execApprovalError = null;\n\n  host.client?.stop();\n  host.client = new GatewayBrowserClient({\n    url: host.settings.gatewayUrl,\n    token: host.settings.token.trim() ? host.settings.token : undefined,\n    password: host.password.trim() ? host.password : undefined,\n    clientName: \"openclaw-control-ui\",\n    mode: \"webchat\",\n    onHello: (hello) => {\n      host.connected = true;\n      (\n        host as unknown as { connectionState: \"connected\" | \"reconnecting\" | \"disconnected\" }\n      ).connectionState = \"connected\";\n      host.lastError = null;\n      host.hello = hello;\n      applySnapshot(host, hello);\n      // Reset orphaned chat run state from before disconnect.\n      // Any in-flight run's final event was lost during the disconnect window.\n      host.chatRunId = null;\n      (host as unknown as { chatStream: string | null }).chatStream = null;\n      (host as unknown as { chatStreamStartedAt: number | null }).chatStreamStartedAt = null;\n      resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\n      void loadAssistantIdentity(host as unknown as OpenClawApp);\n      void loadAgents(host as unknown as OpenClawApp);\n      void loadNodes(host as unknown as OpenClawApp, { quiet: true });\n      void loadDevices(host as unknown as OpenClawApp, { quiet: true });\n      void refreshActiveTab(host as unknown as Parameters<typeof refreshActiveTab>[0]);\n    },\n    onClose: ({ code, reason }) => {\n      host.connected = false;\n      const connectionState = host as unknown as {\n        connectionState: \"connected\" | \"reconnecting\" | \"disconnected\";\n      };\n      // Code 1012 = Service Restart (expected during config saves, don't show as error)\n      if (code !== 1012) {\n        connectionState.connectionState = \"reconnecting\";\n        const errorMsg = `disconnected (${code}): ${reason || \"no reason\"}`;\n        host.lastError = errorMsg;\n        // Toast will be shown via lastError watcher in updated()\n      } else {\n        connectionState.connectionState = \"disconnected\";\n      }\n    },\n    onEvent: (evt) => handleGatewayEvent(host, evt),\n    onGap: ({ expected, received }) => {\n      host.lastError = `event gap detected (expected seq ${expected}, got ${received}); refresh recommended`;\n    },\n  });\n  host.client.start();\n}\n\nexport function handleGatewayEvent(host: GatewayHost, evt: GatewayEventFrame) {\n  try {\n    handleGatewayEventUnsafe(host, evt);\n  } catch (err) {\n    console.error(\"[gateway] handleGatewayEvent error:\", evt.event, err);\n  }\n}\n\nfunction handleGatewayEventUnsafe(host: GatewayHost, evt: GatewayEventFrame) {\n  host.eventLogBuffer = [\n    { ts: Date.now(), event: evt.event, payload: evt.payload },\n    ...host.eventLogBuffer,\n  ].slice(0, 250);\n  if (host.tab === \"debug\") {\n    host.eventLog = host.eventLogBuffer;\n  }\n\n  if (evt.event === \"agent\") {\n    if (host.onboarding) {\n      return;\n    }\n    handleAgentEvent(\n      host as unknown as Parameters<typeof handleAgentEvent>[0],\n      evt.payload as AgentEventPayload | undefined,\n    );\n    return;\n  }\n\n  if (evt.event === \"chat\") {\n    const payload = evt.payload as ChatEventPayload | undefined;\n    if (payload?.sessionKey) {\n      setLastActiveSessionKey(\n        host as unknown as Parameters<typeof setLastActiveSessionKey>[0],\n        payload.sessionKey,\n      );\n    }\n    const state = handleChatEvent(host as unknown as OpenClawApp, payload);\n    if (state === \"final\" || state === \"error\" || state === \"aborted\") {\n      resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\n      void flushChatQueueForEvent(host as unknown as Parameters<typeof flushChatQueueForEvent>[0]);\n      const runId = payload?.runId;\n      if (runId && host.refreshSessionsAfterChat.has(runId)) {\n        host.refreshSessionsAfterChat.delete(runId);\n        if (state === \"final\") {\n          void loadSessions(host as unknown as OpenClawApp, {\n            activeMinutes: CHAT_SESSIONS_ACTIVE_MINUTES,\n          });\n        }\n      }\n    }\n    if (state === \"final\") {\n      void loadChatHistory(host as unknown as OpenClawApp);\n    }\n    return;\n  }\n\n  if (evt.event === \"presence\") {\n    const payload = evt.payload as { presence?: PresenceEntry[] } | undefined;\n    if (payload?.presence && Array.isArray(payload.presence)) {\n      host.presenceEntries = payload.presence;\n      host.presenceError = null;\n      host.presenceStatus = null;\n    }\n    return;\n  }\n\n  if (evt.event === \"cron\" && host.tab === \"cron\") {\n    void loadCron(host as unknown as Parameters<typeof loadCron>[0]);\n  }\n\n  if (evt.event === \"device.pair.requested\" || evt.event === \"device.pair.resolved\") {\n    void loadDevices(host as unknown as OpenClawApp, { quiet: true });\n  }\n\n  if (evt.event === \"exec.approval.requested\") {\n    const entry = parseExecApprovalRequested(evt.payload);\n    if (entry) {\n      host.execApprovalQueue = addExecApproval(host.execApprovalQueue, entry);\n      host.execApprovalError = null;\n      const delay = Math.max(0, entry.expiresAtMs - Date.now() + 500);\n      window.setTimeout(() => {\n        host.execApprovalQueue = removeExecApproval(host.execApprovalQueue, entry.id);\n      }, delay);\n    }\n    return;\n  }\n\n  if (evt.event === \"exec.approval.resolved\") {\n    const resolved = parseExecApprovalResolved(evt.payload);\n    if (resolved) {\n      host.execApprovalQueue = removeExecApproval(host.execApprovalQueue, resolved.id);\n    }\n  }\n}\n\nexport function applySnapshot(host: GatewayHost, hello: GatewayHelloOk) {\n  const snapshot = hello.snapshot as\n    | {\n        presence?: PresenceEntry[];\n        health?: HealthSnapshot;\n        sessionDefaults?: SessionDefaultsSnapshot;\n      }\n    | undefined;\n  if (snapshot?.presence && Array.isArray(snapshot.presence)) {\n    host.presenceEntries = snapshot.presence;\n  }\n  if (snapshot?.health) {\n    host.debugHealth = snapshot.health;\n  }\n  if (snapshot?.sessionDefaults) {\n    applySessionDefaults(host, snapshot.sessionDefaults);\n  }\n}\n","import type { Tab } from \"./navigation\";\nimport { connectGateway } from \"./app-gateway\";\nimport {\n  startLogsPolling,\n  startNodesPolling,\n  stopLogsPolling,\n  stopNodesPolling,\n  startDebugPolling,\n  stopDebugPolling,\n} from \"./app-polling\";\nimport { observeTopbar, scheduleChatScroll, scheduleLogsScroll } from \"./app-scroll\";\nimport {\n  applySettingsFromUrl,\n  attachThemeListener,\n  detachThemeListener,\n  inferBasePath,\n  syncTabWithLocation,\n  syncThemeWithSettings,\n} from \"./app-settings\";\n\ntype LifecycleHost = {\n  basePath: string;\n  tab: Tab;\n  chatHasAutoScrolled: boolean;\n  chatLoading: boolean;\n  chatMessages: unknown[];\n  chatToolMessages: unknown[];\n  chatStream: string;\n  logsAutoFollow: boolean;\n  logsAtBottom: boolean;\n  logsEntries: unknown[];\n  popStateHandler: () => void;\n  topbarObserver: ResizeObserver | null;\n};\n\nexport function handleConnected(host: LifecycleHost) {\n  host.basePath = inferBasePath();\n  applySettingsFromUrl(host as unknown as Parameters<typeof applySettingsFromUrl>[0]);\n  syncTabWithLocation(host as unknown as Parameters<typeof syncTabWithLocation>[0], true);\n  syncThemeWithSettings(host as unknown as Parameters<typeof syncThemeWithSettings>[0]);\n  attachThemeListener(host as unknown as Parameters<typeof attachThemeListener>[0]);\n  window.addEventListener(\"popstate\", host.popStateHandler);\n  connectGateway(host as unknown as Parameters<typeof connectGateway>[0]);\n  startNodesPolling(host as unknown as Parameters<typeof startNodesPolling>[0]);\n  if (host.tab === \"logs\") {\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\n  }\n  if (host.tab === \"debug\") {\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\n  }\n}\n\nexport function handleFirstUpdated(host: LifecycleHost) {\n  observeTopbar(host as unknown as Parameters<typeof observeTopbar>[0]);\n}\n\nexport function handleDisconnected(host: LifecycleHost) {\n  window.removeEventListener(\"popstate\", host.popStateHandler);\n  stopNodesPolling(host as unknown as Parameters<typeof stopNodesPolling>[0]);\n  stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\n  stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\n  detachThemeListener(host as unknown as Parameters<typeof detachThemeListener>[0]);\n  host.topbarObserver?.disconnect();\n  host.topbarObserver = null;\n}\n\nexport function handleUpdated(host: LifecycleHost, changed: Map<PropertyKey, unknown>) {\n  if (\n    host.tab === \"chat\" &&\n    (changed.has(\"chatMessages\") ||\n      changed.has(\"chatToolMessages\") ||\n      changed.has(\"chatStream\") ||\n      changed.has(\"chatLoading\") ||\n      changed.has(\"tab\"))\n  ) {\n    const forcedByTab = changed.has(\"tab\");\n    const forcedByLoad =\n      changed.has(\"chatLoading\") && changed.get(\"chatLoading\") === true && !host.chatLoading;\n    scheduleChatScroll(\n      host as unknown as Parameters<typeof scheduleChatScroll>[0],\n      forcedByTab || forcedByLoad || !host.chatHasAutoScrolled,\n    );\n  }\n  if (\n    host.tab === \"logs\" &&\n    (changed.has(\"logsEntries\") || changed.has(\"logsAutoFollow\") || changed.has(\"tab\"))\n  ) {\n    if (host.logsAutoFollow && host.logsAtBottom) {\n      scheduleLogsScroll(\n        host as unknown as Parameters<typeof scheduleLogsScroll>[0],\n        changed.has(\"tab\") || changed.has(\"logsAutoFollow\"),\n      );\n    }\n  }\n}\n","import{isSingleExpression as i}from\"./directive-helpers.js\";import{Directive as t,PartType as e}from\"./directive.js\";export{directive}from\"./directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=(i,t)=>{const e=i._$AN;if(void 0===e)return!1;for(const i of e)i._$AO?.(t,!1),s(i,t);return!0},o=i=>{let t,e;do{if(void 0===(t=i._$AM))break;e=t._$AN,e.delete(i),i=t}while(0===e?.size)},r=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(void 0===e)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),c(t)}};function h(i){void 0!==this._$AN?(o(this),this._$AM=i,r(this)):this._$AM=i}function n(i,t=!1,e=0){const r=this._$AH,h=this._$AN;if(void 0!==h&&0!==h.size)if(t)if(Array.isArray(r))for(let i=e;i<r.length;i++)s(r[i],!1),o(r[i]);else null!=r&&(s(r,!1),o(r));else s(this,i)}const c=i=>{i.type==e.CHILD&&(i._$AP??=n,i._$AQ??=h)};class f extends t{constructor(){super(...arguments),this._$AN=void 0}_$AT(i,t,e){super._$AT(i,t,e),r(this),this.isConnected=i._$AU}_$AO(i,t=!0){i!==this.isConnected&&(this.isConnected=i,i?this.reconnected?.():this.disconnected?.()),t&&(s(this,i),o(this))}setValue(t){if(i(this._$Ct))this._$Ct._$AI(t,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=t,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}export{f as AsyncDirective,t as Directive,e as PartType};\n//# sourceMappingURL=async-directive.js.map\n","import{nothing as t}from\"../lit-html.js\";import{AsyncDirective as i}from\"../async-directive.js\";import{directive as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=()=>new h;class h{}const o=new WeakMap,n=s(class extends i{render(i){return t}update(i,[s]){const e=s!==this.G;return e&&void 0!==this.G&&this.rt(void 0),(e||this.lt!==this.ct)&&(this.G=s,this.ht=i.options?.host,this.rt(this.ct=i.element)),t}rt(t){if(this.isConnected||(t=void 0),\"function\"==typeof this.G){const i=this.ht??globalThis;let s=o.get(i);void 0===s&&(s=new WeakMap,o.set(i,s)),void 0!==s.get(this.G)&&this.G.call(this.ht,void 0),s.set(this.G,t),void 0!==t&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return\"function\"==typeof this.G?o.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});export{e as createRef,n as ref};\n//# sourceMappingURL=ref.js.map\n","import { html, type TemplateResult } from \"lit\";\n\n// Lucide-style SVG icons\n// All icons use currentColor for stroke\n\nexport const icons = {\n  // Navigation icons\n  messageSquare: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n    </svg>\n  `,\n  barChart: html`\n    <svg viewBox=\"0 0 24 24\">\n      <line x1=\"12\" x2=\"12\" y1=\"20\" y2=\"10\" />\n      <line x1=\"18\" x2=\"18\" y1=\"20\" y2=\"4\" />\n      <line x1=\"6\" x2=\"6\" y1=\"20\" y2=\"16\" />\n    </svg>\n  `,\n  link: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\" />\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\" />\n    </svg>\n  `,\n  radio: html`\n    <svg viewBox=\"0 0 24 24\">\n      <circle cx=\"12\" cy=\"12\" r=\"2\" />\n      <path\n        d=\"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14\"\n      />\n    </svg>\n  `,\n  fileText: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14 2 14 8 20 8\" />\n      <line x1=\"16\" x2=\"8\" y1=\"13\" y2=\"13\" />\n      <line x1=\"16\" x2=\"8\" y1=\"17\" y2=\"17\" />\n      <line x1=\"10\" x2=\"8\" y1=\"9\" y2=\"9\" />\n    </svg>\n  `,\n  zap: html`\n    <svg viewBox=\"0 0 24 24\"><polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\" /></svg>\n  `,\n  monitor: html`\n    <svg viewBox=\"0 0 24 24\">\n      <rect width=\"20\" height=\"14\" x=\"2\" y=\"3\" rx=\"2\" />\n      <line x1=\"8\" x2=\"16\" y1=\"21\" y2=\"21\" />\n      <line x1=\"12\" x2=\"12\" y1=\"17\" y2=\"21\" />\n    </svg>\n  `,\n  settings: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path\n        d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"\n      />\n      <circle cx=\"12\" cy=\"12\" r=\"3\" />\n    </svg>\n  `,\n  bug: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"m8 2 1.88 1.88\" />\n      <path d=\"M14.12 3.88 16 2\" />\n      <path d=\"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1\" />\n      <path d=\"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6\" />\n      <path d=\"M12 20v-9\" />\n      <path d=\"M6.53 9C4.6 8.8 3 7.1 3 5\" />\n      <path d=\"M6 13H2\" />\n      <path d=\"M3 21c0-2.1 1.7-3.9 3.8-4\" />\n      <path d=\"M20.97 5c0 2.1-1.6 3.8-3.5 4\" />\n      <path d=\"M22 13h-4\" />\n      <path d=\"M17.2 17c2.1.1 3.8 1.9 3.8 4\" />\n    </svg>\n  `,\n  scrollText: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4\" />\n      <path d=\"M19 17V5a2 2 0 0 0-2-2H4\" />\n      <path d=\"M15 8h-5\" />\n      <path d=\"M15 12h-5\" />\n    </svg>\n  `,\n  folder: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path\n        d=\"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z\"\n      />\n    </svg>\n  `,\n\n  // UI icons\n  menu: html`\n    <svg viewBox=\"0 0 24 24\">\n      <line x1=\"4\" x2=\"20\" y1=\"12\" y2=\"12\" />\n      <line x1=\"4\" x2=\"20\" y1=\"6\" y2=\"6\" />\n      <line x1=\"4\" x2=\"20\" y1=\"18\" y2=\"18\" />\n    </svg>\n  `,\n  x: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M18 6 6 18\" />\n      <path d=\"m6 6 12 12\" />\n    </svg>\n  `,\n  check: html`\n    <svg viewBox=\"0 0 24 24\"><path d=\"M20 6 9 17l-5-5\" /></svg>\n  `,\n  arrowDown: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M12 5v14\" />\n      <path d=\"m19 12-7 7-7-7\" />\n    </svg>\n  `,\n  copy: html`\n    <svg viewBox=\"0 0 24 24\">\n      <rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\" />\n      <path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\" />\n    </svg>\n  `,\n  search: html`\n    <svg viewBox=\"0 0 24 24\">\n      <circle cx=\"11\" cy=\"11\" r=\"8\" />\n      <path d=\"m21 21-4.3-4.3\" />\n    </svg>\n  `,\n  brain: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z\" />\n      <path d=\"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z\" />\n      <path d=\"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4\" />\n      <path d=\"M17.599 6.5a3 3 0 0 0 .399-1.375\" />\n      <path d=\"M6.003 5.125A3 3 0 0 0 6.401 6.5\" />\n      <path d=\"M3.477 10.896a4 4 0 0 1 .585-.396\" />\n      <path d=\"M19.938 10.5a4 4 0 0 1 .585.396\" />\n      <path d=\"M6 18a4 4 0 0 1-1.967-.516\" />\n      <path d=\"M19.967 17.484A4 4 0 0 1 18 18\" />\n    </svg>\n  `,\n  book: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\" />\n    </svg>\n  `,\n  loader: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M12 2v4\" />\n      <path d=\"m16.2 7.8 2.9-2.9\" />\n      <path d=\"M18 12h4\" />\n      <path d=\"m16.2 16.2 2.9 2.9\" />\n      <path d=\"M12 18v4\" />\n      <path d=\"m4.9 19.1 2.9-2.9\" />\n      <path d=\"M2 12h4\" />\n      <path d=\"m4.9 4.9 2.9 2.9\" />\n    </svg>\n  `,\n\n  // Tool icons\n  wrench: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\n      />\n    </svg>\n  `,\n  fileCode: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14 2 14 8 20 8\" />\n      <path d=\"m10 13-2 2 2 2\" />\n      <path d=\"m14 17 2-2-2-2\" />\n    </svg>\n  `,\n  edit: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\n      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\" />\n    </svg>\n  `,\n  penLine: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M12 20h9\" />\n      <path d=\"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z\" />\n    </svg>\n  `,\n  paperclip: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path\n        d=\"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48\"\n      />\n    </svg>\n  `,\n  globe: html`\n    <svg viewBox=\"0 0 24 24\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20\" />\n      <path d=\"M2 12h20\" />\n    </svg>\n  `,\n  image: html`\n    <svg viewBox=\"0 0 24 24\">\n      <rect width=\"18\" height=\"18\" x=\"3\" y=\"3\" rx=\"2\" ry=\"2\" />\n      <circle cx=\"9\" cy=\"9\" r=\"2\" />\n      <path d=\"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\" />\n    </svg>\n  `,\n  smartphone: html`\n    <svg viewBox=\"0 0 24 24\">\n      <rect width=\"14\" height=\"20\" x=\"5\" y=\"2\" rx=\"2\" ry=\"2\" />\n      <path d=\"M12 18h.01\" />\n    </svg>\n  `,\n  plug: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path d=\"M12 22v-5\" />\n      <path d=\"M9 8V2\" />\n      <path d=\"M15 8V2\" />\n      <path d=\"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z\" />\n    </svg>\n  `,\n  circle: html`\n    <svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\" /></svg>\n  `,\n  puzzle: html`\n    <svg viewBox=\"0 0 24 24\">\n      <path\n        d=\"M19.439 7.85c-.049.322.059.648.289.878l1.568 1.568c.47.47.706 1.087.706 1.704s-.235 1.233-.706 1.704l-1.611 1.611a.98.98 0 0 1-.837.276c-.47-.07-.802-.48-.968-.925a2.501 2.501 0 1 0-3.214 3.214c.446.166.855.497.925.968a.979.979 0 0 1-.276.837l-1.61 1.61a2.404 2.404 0 0 1-1.705.707 2.402 2.402 0 0 1-1.704-.706l-1.568-1.568a1.026 1.026 0 0 0-.877-.29c-.493.074-.84.504-1.02.968a2.5 2.5 0 1 1-3.237-3.237c.464-.18.894-.527.967-1.02a1.026 1.026 0 0 0-.289-.877l-1.568-1.568A2.402 2.402 0 0 1 1.998 12c0-.617.236-1.234.706-1.704L4.23 8.77c.24-.24.581-.353.917-.303.515.076.874.54 1.02 1.02a2.5 2.5 0 1 0 3.237-3.237c-.48-.146-.944-.505-1.02-1.02a.98.98 0 0 1 .303-.917l1.526-1.526A2.402 2.402 0 0 1 11.998 2c.617 0 1.234.236 1.704.706l1.568 1.568c.23.23.556.338.877.29.493-.074.84-.504 1.02-.968a2.5 2.5 0 1 1 3.236 3.236c-.464.18-.894.527-.967 1.02Z\"\n      />\n    </svg>\n  `,\n} as const;\n\nexport type IconName = keyof typeof icons;\n\nexport function icon(name: IconName): TemplateResult {\n  return icons[name];\n}\n\nexport function renderIcon(name: IconName, className = \"nav-item__icon\"): TemplateResult {\n  return html`<span class=${className} aria-hidden=\"true\">${icons[name]}</span>`;\n}\n\n// Legacy function for compatibility\nexport function renderEmojiIcon(\n  iconContent: string | TemplateResult,\n  className: string,\n): TemplateResult {\n  return html`<span class=${className} aria-hidden=\"true\">${iconContent}</span>`;\n}\n\nexport function setEmojiIcon(target: HTMLElement | null, icon: string): void {\n  if (!target) {\n    return;\n  }\n  target.textContent = icon;\n}\n","import { html, nothing } from \"lit\";\nimport { repeat } from \"lit/directives/repeat.js\";\nimport type { AppViewState } from \"./app-view-state\";\nimport type { ThemeMode } from \"./theme\";\nimport type { ThemeTransitionContext } from \"./theme-transition\";\nimport type { SessionsListResult } from \"./types\";\nimport { refreshChat } from \"./app-chat\";\nimport { syncUrlWithSessionKey } from \"./app-settings\";\nimport { loadChatHistory } from \"./controllers/chat\";\nimport { icons } from \"./icons\";\nimport { iconForTab, pathForTab, titleForTab, type Tab } from \"./navigation\";\n\nexport function renderTab(state: AppViewState, tab: Tab) {\n  const href = pathForTab(tab, state.basePath);\n  const isActive = state.tab === tab;\n  return html`\n    <a\n      href=${href}\n      class=\"nav-item ${isActive ? \"active\" : \"\"}\"\n      aria-current=${isActive ? \"page\" : nothing}\n      @click=${(event: MouseEvent) => {\n        if (\n          event.defaultPrevented ||\n          event.button !== 0 ||\n          event.metaKey ||\n          event.ctrlKey ||\n          event.shiftKey ||\n          event.altKey\n        ) {\n          return;\n        }\n        event.preventDefault();\n        state.setTab(tab);\n      }}\n      title=${titleForTab(tab)}\n    >\n      <span class=\"nav-item__icon\" aria-hidden=\"true\">${icons[iconForTab(tab)]}</span>\n      <span class=\"nav-item__text\">${titleForTab(tab)}</span>\n    </a>\n  `;\n}\n\nexport function renderChatControls(state: AppViewState) {\n  const mainSessionKey = resolveMainSessionKey(state.hello, state.sessionsResult);\n  const sessionOptions = resolveSessionOptions(\n    state.sessionKey,\n    state.sessionsResult,\n    mainSessionKey,\n  );\n  const disableThinkingToggle = state.onboarding;\n  const disableFocusToggle = state.onboarding;\n  const showThinking = state.onboarding ? false : state.settings.chatShowThinking;\n  const focusActive = state.onboarding ? true : state.settings.chatFocusMode;\n  // Refresh icon\n  const refreshIcon = html`\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <path d=\"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8\"></path>\n      <path d=\"M21 3v5h-5\"></path>\n    </svg>\n  `;\n  const focusIcon = html`\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <path d=\"M4 7V4h3\"></path>\n      <path d=\"M20 7V4h-3\"></path>\n      <path d=\"M4 17v3h3\"></path>\n      <path d=\"M20 17v3h-3\"></path>\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n    </svg>\n  `;\n  return html`\n    <div class=\"chat-controls\">\n      <label class=\"field chat-controls__session\">\n        <select\n          .value=${state.sessionKey}\n          ?disabled=${!state.connected}\n          @change=${(e: Event) => {\n            const next = (e.target as HTMLSelectElement).value;\n            state.sessionKey = next;\n            state.chatMessage = \"\";\n            state.chatStream = null;\n            state.chatStreamStartedAt = null;\n            state.chatRunId = null;\n            state.resetToolStream();\n            state.resetChatScroll();\n            state.applySettings({\n              ...state.settings,\n              sessionKey: next,\n              lastActiveSessionKey: next,\n            });\n            void state.loadAssistantIdentity();\n            syncUrlWithSessionKey(state, next, true);\n            void loadChatHistory(state);\n          }}\n        >\n          ${repeat(\n            sessionOptions,\n            (entry) => entry.key,\n            (entry) =>\n              html`<option value=${entry.key}>\n                ${entry.displayName ?? entry.key}\n              </option>`,\n          )}\n        </select>\n      </label>\n      <button\n        class=\"btn btn--sm btn--icon\"\n        ?disabled=${state.chatLoading || !state.connected}\n        @click=${() => {\n          state.resetToolStream();\n          void refreshChat(state as unknown as Parameters<typeof refreshChat>[0]);\n        }}\n        title=\"Refresh chat data\"\n      >\n        ${refreshIcon}\n      </button>\n      <span class=\"chat-controls__separator\">|</span>\n      <button\n        class=\"btn btn--sm btn--icon ${showThinking ? \"active\" : \"\"}\"\n        ?disabled=${disableThinkingToggle}\n        @click=${() => {\n          if (disableThinkingToggle) {\n            return;\n          }\n          state.applySettings({\n            ...state.settings,\n            chatShowThinking: !state.settings.chatShowThinking,\n          });\n        }}\n        aria-pressed=${showThinking}\n        title=${\n          disableThinkingToggle\n            ? \"Disabled during onboarding\"\n            : \"Toggle assistant thinking/working output\"\n        }\n      >\n        ${icons.brain}\n      </button>\n      <button\n        class=\"btn btn--sm btn--icon ${focusActive ? \"active\" : \"\"}\"\n        ?disabled=${disableFocusToggle}\n        @click=${() => {\n          if (disableFocusToggle) {\n            return;\n          }\n          state.applySettings({\n            ...state.settings,\n            chatFocusMode: !state.settings.chatFocusMode,\n          });\n        }}\n        aria-pressed=${focusActive}\n        title=${\n          disableFocusToggle\n            ? \"Disabled during onboarding\"\n            : \"Toggle focus mode (hide sidebar + page header)\"\n        }\n      >\n        ${focusIcon}\n      </button>\n    </div>\n  `;\n}\n\ntype SessionDefaultsSnapshot = {\n  mainSessionKey?: string;\n  mainKey?: string;\n};\n\nfunction resolveMainSessionKey(\n  hello: AppViewState[\"hello\"],\n  sessions: SessionsListResult | null,\n): string | null {\n  const snapshot = hello?.snapshot as { sessionDefaults?: SessionDefaultsSnapshot } | undefined;\n  const mainSessionKey = snapshot?.sessionDefaults?.mainSessionKey?.trim();\n  if (mainSessionKey) {\n    return mainSessionKey;\n  }\n  const mainKey = snapshot?.sessionDefaults?.mainKey?.trim();\n  if (mainKey) {\n    return mainKey;\n  }\n  if (sessions?.sessions?.some((row) => row.key === \"main\")) {\n    return \"main\";\n  }\n  return null;\n}\n\nfunction resolveSessionDisplayName(key: string, row?: SessionsListResult[\"sessions\"][number]) {\n  const label = row?.label?.trim();\n  if (label) {\n    return `${label} (${key})`;\n  }\n  const displayName = row?.displayName?.trim();\n  if (displayName) {\n    return displayName;\n  }\n  return key;\n}\n\nfunction resolveSessionOptions(\n  sessionKey: string,\n  sessions: SessionsListResult | null,\n  mainSessionKey?: string | null,\n) {\n  const seen = new Set<string>();\n  const options: Array<{ key: string; displayName?: string }> = [];\n\n  const resolvedMain = mainSessionKey && sessions?.sessions?.find((s) => s.key === mainSessionKey);\n  const resolvedCurrent = sessions?.sessions?.find((s) => s.key === sessionKey);\n\n  // Add main session key first\n  if (mainSessionKey) {\n    seen.add(mainSessionKey);\n    options.push({\n      key: mainSessionKey,\n      displayName: resolveSessionDisplayName(mainSessionKey, resolvedMain),\n    });\n  }\n\n  // Add current session key next\n  if (!seen.has(sessionKey)) {\n    seen.add(sessionKey);\n    options.push({\n      key: sessionKey,\n      displayName: resolveSessionDisplayName(sessionKey, resolvedCurrent),\n    });\n  }\n\n  // Add sessions from the result\n  if (sessions?.sessions) {\n    for (const s of sessions.sessions) {\n      if (!seen.has(s.key)) {\n        seen.add(s.key);\n        options.push({\n          key: s.key,\n          displayName: resolveSessionDisplayName(s.key, s),\n        });\n      }\n    }\n  }\n\n  return options;\n}\n\nconst THEME_ORDER: ThemeMode[] = [\"system\", \"light\", \"dark\"];\n\nexport function renderThemeToggle(state: AppViewState) {\n  const index = Math.max(0, THEME_ORDER.indexOf(state.theme));\n  const applyTheme = (next: ThemeMode) => (event: MouseEvent) => {\n    const element = event.currentTarget as HTMLElement;\n    const context: ThemeTransitionContext = { element };\n    if (event.clientX || event.clientY) {\n      context.pointerClientX = event.clientX;\n      context.pointerClientY = event.clientY;\n    }\n    state.setTheme(next, context);\n  };\n\n  return html`\n    <div class=\"theme-toggle\" style=\"--theme-index: ${index};\">\n      <div class=\"theme-toggle__track\" role=\"group\" aria-label=\"Theme\">\n        <span class=\"theme-toggle__indicator\"></span>\n        <button\n          class=\"theme-toggle__button ${state.theme === \"system\" ? \"active\" : \"\"}\"\n          @click=${applyTheme(\"system\")}\n          aria-pressed=${state.theme === \"system\"}\n          aria-label=\"System theme\"\n          title=\"System\"\n        >\n          ${renderMonitorIcon()}\n        </button>\n        <button\n          class=\"theme-toggle__button ${state.theme === \"light\" ? \"active\" : \"\"}\"\n          @click=${applyTheme(\"light\")}\n          aria-pressed=${state.theme === \"light\"}\n          aria-label=\"Light theme\"\n          title=\"Light\"\n        >\n          ${renderSunIcon()}\n        </button>\n        <button\n          class=\"theme-toggle__button ${state.theme === \"dark\" ? \"active\" : \"\"}\"\n          @click=${applyTheme(\"dark\")}\n          aria-pressed=${state.theme === \"dark\"}\n          aria-label=\"Dark theme\"\n          title=\"Dark\"\n        >\n          ${renderMoonIcon()}\n        </button>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderSunIcon() {\n  return html`\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\n      <path d=\"M12 2v2\"></path>\n      <path d=\"M12 20v2\"></path>\n      <path d=\"m4.93 4.93 1.41 1.41\"></path>\n      <path d=\"m17.66 17.66 1.41 1.41\"></path>\n      <path d=\"M2 12h2\"></path>\n      <path d=\"M20 12h2\"></path>\n      <path d=\"m6.34 17.66-1.41 1.41\"></path>\n      <path d=\"m19.07 4.93-1.41 1.41\"></path>\n    </svg>\n  `;\n}\n\nfunction renderMoonIcon() {\n  return html`\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n      <path\n        d=\"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401\"\n      ></path>\n    </svg>\n  `;\n}\n\nfunction renderMonitorIcon() {\n  return html`\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n      <rect width=\"20\" height=\"14\" x=\"2\" y=\"3\" rx=\"2\"></rect>\n      <line x1=\"8\" x2=\"16\" y1=\"21\" y2=\"21\"></line>\n      <line x1=\"12\" x2=\"12\" y1=\"17\" y2=\"21\"></line>\n    </svg>\n  `;\n}\n","import type { GatewayBrowserClient } from \"../gateway\";\nimport type {\n  AgentFileEntry,\n  AgentsFilesGetResult,\n  AgentsFilesListResult,\n  AgentsFilesSetResult,\n} from \"../types\";\n\nexport type AgentFilesState = {\n  client: GatewayBrowserClient | null;\n  connected: boolean;\n  agentFilesLoading: boolean;\n  agentFilesError: string | null;\n  agentFilesList: AgentsFilesListResult | null;\n  agentFileContents: Record<string, string>;\n  agentFileDrafts: Record<string, string>;\n  agentFileActive: string | null;\n  agentFileSaving: boolean;\n};\n\nfunction mergeFileEntry(\n  list: AgentsFilesListResult | null,\n  entry: AgentFileEntry,\n): AgentsFilesListResult | null {\n  if (!list) {\n    return list;\n  }\n  const hasEntry = list.files.some((file) => file.name === entry.name);\n  const nextFiles = hasEntry\n    ? list.files.map((file) => (file.name === entry.name ? entry : file))\n    : [...list.files, entry];\n  return { ...list, files: nextFiles };\n}\n\nexport async function loadAgentFiles(state: AgentFilesState, agentId: string) {\n  if (!state.client || !state.connected || state.agentFilesLoading) {\n    return;\n  }\n  state.agentFilesLoading = true;\n  state.agentFilesError = null;\n  try {\n    const res = await state.client.request<AgentsFilesListResult | null>(\"agents.files.list\", {\n      agentId,\n    });\n    if (res) {\n      state.agentFilesList = res;\n      if (state.agentFileActive && !res.files.some((file) => file.name === state.agentFileActive)) {\n        state.agentFileActive = null;\n      }\n    }\n  } catch (err) {\n    state.agentFilesError = String(err);\n  } finally {\n    state.agentFilesLoading = false;\n  }\n}\n\nexport async function loadAgentFileContent(state: AgentFilesState, agentId: string, name: string) {\n  if (!state.client || !state.connected || state.agentFilesLoading) {\n    return;\n  }\n  if (Object.hasOwn(state.agentFileContents, name)) {\n    return;\n  }\n  state.agentFilesLoading = true;\n  state.agentFilesError = null;\n  try {\n    const res = await state.client.request<AgentsFilesGetResult | null>(\"agents.files.get\", {\n      agentId,\n      name,\n    });\n    if (res?.file) {\n      const content = res.file.content ?? \"\";\n      state.agentFilesList = mergeFileEntry(state.agentFilesList, res.file);\n      state.agentFileContents = { ...state.agentFileContents, [name]: content };\n      if (!Object.hasOwn(state.agentFileDrafts, name)) {\n        state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\n      }\n    }\n  } catch (err) {\n    state.agentFilesError = String(err);\n  } finally {\n    state.agentFilesLoading = false;\n  }\n}\n\nexport async function saveAgentFile(\n  state: AgentFilesState,\n  agentId: string,\n  name: string,\n  content: string,\n) {\n  if (!state.client || !state.connected || state.agentFileSaving) {\n    return;\n  }\n  state.agentFileSaving = true;\n  state.agentFilesError = null;\n  try {\n    const res = await state.client.request<AgentsFilesSetResult | null>(\"agents.files.set\", {\n      agentId,\n      name,\n      content,\n    });\n    if (res?.file) {\n      state.agentFilesList = mergeFileEntry(state.agentFilesList, res.file);\n      state.agentFileContents = { ...state.agentFileContents, [name]: content };\n      state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\n    }\n  } catch (err) {\n    state.agentFilesError = String(err);\n  } finally {\n    state.agentFileSaving = false;\n  }\n}\n","export type ToolProfileId = \"minimal\" | \"coding\" | \"messaging\" | \"full\";\n\ntype ToolProfilePolicy = {\n  allow?: string[];\n  deny?: string[];\n};\n\nconst TOOL_NAME_ALIASES: Record<string, string> = {\n  bash: \"exec\",\n  \"apply-patch\": \"apply_patch\",\n};\n\nexport const TOOL_GROUPS: Record<string, string[]> = {\n  // NOTE: Keep canonical (lowercase) tool names here.\n  \"group:memory\": [\"memory_search\", \"memory_get\"],\n  \"group:web\": [\"web_search\", \"web_fetch\"],\n  // Basic workspace/file tools\n  \"group:fs\": [\"read\", \"write\", \"edit\", \"apply_patch\"],\n  // Host/runtime execution tools\n  \"group:runtime\": [\"exec\", \"process\"],\n  // Session management tools\n  \"group:sessions\": [\n    \"sessions_list\",\n    \"sessions_history\",\n    \"sessions_send\",\n    \"sessions_spawn\",\n    \"session_status\",\n  ],\n  // UI helpers\n  \"group:ui\": [\"browser\", \"canvas\"],\n  // Automation + infra\n  \"group:automation\": [\"cron\", \"gateway\"],\n  // Messaging surface\n  \"group:messaging\": [\"message\"],\n  // Nodes + device tools\n  \"group:nodes\": [\"nodes\"],\n  // All OpenClaw native tools (excludes provider plugins).\n  \"group:openclaw\": [\n    \"browser\",\n    \"canvas\",\n    \"nodes\",\n    \"cron\",\n    \"message\",\n    \"gateway\",\n    \"agents_list\",\n    \"sessions_list\",\n    \"sessions_history\",\n    \"sessions_send\",\n    \"sessions_spawn\",\n    \"session_status\",\n    \"memory_search\",\n    \"memory_get\",\n    \"web_search\",\n    \"web_fetch\",\n    \"image\",\n  ],\n};\n\nconst TOOL_PROFILES: Record<ToolProfileId, ToolProfilePolicy> = {\n  minimal: {\n    allow: [\"session_status\"],\n  },\n  coding: {\n    allow: [\"group:fs\", \"group:runtime\", \"group:sessions\", \"group:memory\", \"image\"],\n  },\n  messaging: {\n    allow: [\n      \"group:messaging\",\n      \"sessions_list\",\n      \"sessions_history\",\n      \"sessions_send\",\n      \"session_status\",\n    ],\n  },\n  full: {},\n};\n\nexport function normalizeToolName(name: string) {\n  const normalized = name.trim().toLowerCase();\n  return TOOL_NAME_ALIASES[normalized] ?? normalized;\n}\n\nexport function normalizeToolList(list?: string[]) {\n  if (!list) {\n    return [];\n  }\n  return list.map(normalizeToolName).filter(Boolean);\n}\n\nexport type ToolPolicyLike = {\n  allow?: string[];\n  deny?: string[];\n};\n\nexport type PluginToolGroups = {\n  all: string[];\n  byPlugin: Map<string, string[]>;\n};\n\nexport type AllowlistResolution = {\n  policy: ToolPolicyLike | undefined;\n  unknownAllowlist: string[];\n  strippedAllowlist: boolean;\n};\n\nexport function expandToolGroups(list?: string[]) {\n  const normalized = normalizeToolList(list);\n  const expanded: string[] = [];\n  for (const value of normalized) {\n    const group = TOOL_GROUPS[value];\n    if (group) {\n      expanded.push(...group);\n      continue;\n    }\n    expanded.push(value);\n  }\n  return Array.from(new Set(expanded));\n}\n\nexport function collectExplicitAllowlist(policies: Array<ToolPolicyLike | undefined>): string[] {\n  const entries: string[] = [];\n  for (const policy of policies) {\n    if (!policy?.allow) {\n      continue;\n    }\n    for (const value of policy.allow) {\n      if (typeof value !== \"string\") {\n        continue;\n      }\n      const trimmed = value.trim();\n      if (trimmed) {\n        entries.push(trimmed);\n      }\n    }\n  }\n  return entries;\n}\n\nexport function buildPluginToolGroups<T extends { name: string }>(params: {\n  tools: T[];\n  toolMeta: (tool: T) => { pluginId: string } | undefined;\n}): PluginToolGroups {\n  const all: string[] = [];\n  const byPlugin = new Map<string, string[]>();\n  for (const tool of params.tools) {\n    const meta = params.toolMeta(tool);\n    if (!meta) {\n      continue;\n    }\n    const name = normalizeToolName(tool.name);\n    all.push(name);\n    const pluginId = meta.pluginId.toLowerCase();\n    const list = byPlugin.get(pluginId) ?? [];\n    list.push(name);\n    byPlugin.set(pluginId, list);\n  }\n  return { all, byPlugin };\n}\n\nexport function expandPluginGroups(\n  list: string[] | undefined,\n  groups: PluginToolGroups,\n): string[] | undefined {\n  if (!list || list.length === 0) {\n    return list;\n  }\n  const expanded: string[] = [];\n  for (const entry of list) {\n    const normalized = normalizeToolName(entry);\n    if (normalized === \"group:plugins\") {\n      if (groups.all.length > 0) {\n        expanded.push(...groups.all);\n      } else {\n        expanded.push(normalized);\n      }\n      continue;\n    }\n    const tools = groups.byPlugin.get(normalized);\n    if (tools && tools.length > 0) {\n      expanded.push(...tools);\n      continue;\n    }\n    expanded.push(normalized);\n  }\n  return Array.from(new Set(expanded));\n}\n\nexport function expandPolicyWithPluginGroups(\n  policy: ToolPolicyLike | undefined,\n  groups: PluginToolGroups,\n): ToolPolicyLike | undefined {\n  if (!policy) {\n    return undefined;\n  }\n  return {\n    allow: expandPluginGroups(policy.allow, groups),\n    deny: expandPluginGroups(policy.deny, groups),\n  };\n}\n\nexport function stripPluginOnlyAllowlist(\n  policy: ToolPolicyLike | undefined,\n  groups: PluginToolGroups,\n  coreTools: Set<string>,\n): AllowlistResolution {\n  if (!policy?.allow || policy.allow.length === 0) {\n    return { policy, unknownAllowlist: [], strippedAllowlist: false };\n  }\n  const normalized = normalizeToolList(policy.allow);\n  if (normalized.length === 0) {\n    return { policy, unknownAllowlist: [], strippedAllowlist: false };\n  }\n  const pluginIds = new Set(groups.byPlugin.keys());\n  const pluginTools = new Set(groups.all);\n  const unknownAllowlist: string[] = [];\n  let hasCoreEntry = false;\n  for (const entry of normalized) {\n    if (entry === \"*\") {\n      hasCoreEntry = true;\n      continue;\n    }\n    const isPluginEntry =\n      entry === \"group:plugins\" || pluginIds.has(entry) || pluginTools.has(entry);\n    const expanded = expandToolGroups([entry]);\n    const isCoreEntry = expanded.some((tool) => coreTools.has(tool));\n    if (isCoreEntry) {\n      hasCoreEntry = true;\n    }\n    if (!isCoreEntry && !isPluginEntry) {\n      unknownAllowlist.push(entry);\n    }\n  }\n  const strippedAllowlist = !hasCoreEntry;\n  // When an allowlist contains only plugin tools, we strip it to avoid accidentally\n  // disabling core tools. Users who want additive behavior should prefer `tools.alsoAllow`.\n  if (strippedAllowlist) {\n    // Note: logging happens in the caller (pi-tools/tools-invoke) after this function returns.\n    // We keep this note here for future maintainers.\n  }\n  return {\n    policy: strippedAllowlist ? { ...policy, allow: undefined } : policy,\n    unknownAllowlist: Array.from(new Set(unknownAllowlist)),\n    strippedAllowlist,\n  };\n}\n\nexport function resolveToolProfilePolicy(profile?: string): ToolProfilePolicy | undefined {\n  if (!profile) {\n    return undefined;\n  }\n  const resolved = TOOL_PROFILES[profile as ToolProfileId];\n  if (!resolved) {\n    return undefined;\n  }\n  if (!resolved.allow && !resolved.deny) {\n    return undefined;\n  }\n  return {\n    allow: resolved.allow ? [...resolved.allow] : undefined,\n    deny: resolved.deny ? [...resolved.deny] : undefined,\n  };\n}\n","import type { CronJob, GatewaySessionRow, PresenceEntry } from \"./types\";\nimport { formatAgo, formatDurationMs, formatMs } from \"./format\";\n\nexport function formatPresenceSummary(entry: PresenceEntry): string {\n  const host = entry.host ?? \"unknown\";\n  const ip = entry.ip ? `(${entry.ip})` : \"\";\n  const mode = entry.mode ?? \"\";\n  const version = entry.version ?? \"\";\n  return `${host} ${ip} ${mode} ${version}`.trim();\n}\n\nexport function formatPresenceAge(entry: PresenceEntry): string {\n  const ts = entry.ts ?? null;\n  return ts ? formatAgo(ts) : \"n/a\";\n}\n\nexport function formatNextRun(ms?: number | null) {\n  if (!ms) {\n    return \"n/a\";\n  }\n  return `${formatMs(ms)} (${formatAgo(ms)})`;\n}\n\nexport function formatSessionTokens(row: GatewaySessionRow) {\n  if (row.totalTokens == null) {\n    return \"n/a\";\n  }\n  const total = row.totalTokens ?? 0;\n  const ctx = row.contextTokens ?? 0;\n  return ctx ? `${total} / ${ctx}` : String(total);\n}\n\nexport function formatEventPayload(payload: unknown): string {\n  if (payload == null) {\n    return \"\";\n  }\n  try {\n    return JSON.stringify(payload, null, 2);\n  } catch {\n    // oxlint-disable typescript/no-base-to-string\n    return String(payload);\n  }\n}\n\nexport function formatCronState(job: CronJob) {\n  const state = job.state ?? {};\n  const next = state.nextRunAtMs ? formatMs(state.nextRunAtMs) : \"n/a\";\n  const last = state.lastRunAtMs ? formatMs(state.lastRunAtMs) : \"n/a\";\n  const status = state.lastStatus ?? \"n/a\";\n  return `${status} Â· next ${next} Â· last ${last}`;\n}\n\nexport function formatCronSchedule(job: CronJob) {\n  const s = job.schedule;\n  if (s.kind === \"at\") {\n    return `At ${formatMs(s.atMs)}`;\n  }\n  if (s.kind === \"every\") {\n    return `Every ${formatDurationMs(s.everyMs)}`;\n  }\n  return `Cron ${s.expr}${s.tz ? ` (${s.tz})` : \"\"}`;\n}\n\nexport function formatCronPayload(job: CronJob) {\n  const p = job.payload;\n  if (p.kind === \"systemEvent\") {\n    return `System: ${p.text}`;\n  }\n  return `Agent: ${p.message}`;\n}\n","import { html, nothing } from \"lit\";\nimport type {\n  AgentFileEntry,\n  AgentsFilesListResult,\n  AgentsListResult,\n  AgentIdentityResult,\n  ChannelAccountSnapshot,\n  ChannelsStatusSnapshot,\n  CronJob,\n  CronStatus,\n  SkillStatusEntry,\n  SkillStatusReport,\n} from \"../types\";\nimport {\n  expandToolGroups,\n  normalizeToolName,\n  resolveToolProfilePolicy,\n} from \"../../../../src/agents/tool-policy.js\";\nimport { formatAgo } from \"../format\";\nimport {\n  formatCronPayload,\n  formatCronSchedule,\n  formatCronState,\n  formatNextRun,\n} from \"../presenter\";\n\nexport type AgentsPanel = \"overview\" | \"files\" | \"tools\" | \"skills\" | \"channels\" | \"cron\";\n\nexport type AgentsProps = {\n  loading: boolean;\n  error: string | null;\n  agentsList: AgentsListResult | null;\n  selectedAgentId: string | null;\n  activePanel: AgentsPanel;\n  configForm: Record<string, unknown> | null;\n  configLoading: boolean;\n  configSaving: boolean;\n  configDirty: boolean;\n  channelsLoading: boolean;\n  channelsError: string | null;\n  channelsSnapshot: ChannelsStatusSnapshot | null;\n  channelsLastSuccess: number | null;\n  cronLoading: boolean;\n  cronStatus: CronStatus | null;\n  cronJobs: CronJob[];\n  cronError: string | null;\n  agentFilesLoading: boolean;\n  agentFilesError: string | null;\n  agentFilesList: AgentsFilesListResult | null;\n  agentFileActive: string | null;\n  agentFileContents: Record<string, string>;\n  agentFileDrafts: Record<string, string>;\n  agentFileSaving: boolean;\n  agentIdentityLoading: boolean;\n  agentIdentityError: string | null;\n  agentIdentityById: Record<string, AgentIdentityResult>;\n  agentSkillsLoading: boolean;\n  agentSkillsReport: SkillStatusReport | null;\n  agentSkillsError: string | null;\n  agentSkillsAgentId: string | null;\n  skillsFilter: string;\n  onRefresh: () => void;\n  onSelectAgent: (agentId: string) => void;\n  onSelectPanel: (panel: AgentsPanel) => void;\n  onLoadFiles: (agentId: string) => void;\n  onSelectFile: (name: string) => void;\n  onFileDraftChange: (name: string, content: string) => void;\n  onFileReset: (name: string) => void;\n  onFileSave: (name: string) => void;\n  onToolsProfileChange: (agentId: string, profile: string | null, clearAllow: boolean) => void;\n  onToolsOverridesChange: (agentId: string, alsoAllow: string[], deny: string[]) => void;\n  onConfigReload: () => void;\n  onConfigSave: () => void;\n  onModelChange: (agentId: string, modelId: string | null) => void;\n  onModelFallbacksChange: (agentId: string, fallbacks: string[]) => void;\n  onChannelsRefresh: () => void;\n  onCronRefresh: () => void;\n  onSkillsFilterChange: (next: string) => void;\n  onSkillsRefresh: () => void;\n  onAgentSkillToggle: (agentId: string, skillName: string, enabled: boolean) => void;\n  onAgentSkillsClear: (agentId: string) => void;\n  onAgentSkillsDisableAll: (agentId: string) => void;\n};\n\nconst TOOL_SECTIONS = [\n  {\n    id: \"fs\",\n    label: \"Files\",\n    tools: [\n      { id: \"read\", label: \"read\", description: \"Read file contents\" },\n      { id: \"write\", label: \"write\", description: \"Create or overwrite files\" },\n      { id: \"edit\", label: \"edit\", description: \"Make precise edits\" },\n      { id: \"apply_patch\", label: \"apply_patch\", description: \"Patch files (OpenAI)\" },\n    ],\n  },\n  {\n    id: \"runtime\",\n    label: \"Runtime\",\n    tools: [\n      { id: \"exec\", label: \"exec\", description: \"Run shell commands\" },\n      { id: \"process\", label: \"process\", description: \"Manage background processes\" },\n    ],\n  },\n  {\n    id: \"web\",\n    label: \"Web\",\n    tools: [\n      { id: \"web_search\", label: \"web_search\", description: \"Search the web\" },\n      { id: \"web_fetch\", label: \"web_fetch\", description: \"Fetch web content\" },\n    ],\n  },\n  {\n    id: \"memory\",\n    label: \"Memory\",\n    tools: [\n      { id: \"memory_search\", label: \"memory_search\", description: \"Semantic search\" },\n      { id: \"memory_get\", label: \"memory_get\", description: \"Read memory files\" },\n    ],\n  },\n  {\n    id: \"sessions\",\n    label: \"Sessions\",\n    tools: [\n      { id: \"sessions_list\", label: \"sessions_list\", description: \"List sessions\" },\n      { id: \"sessions_history\", label: \"sessions_history\", description: \"Session history\" },\n      { id: \"sessions_send\", label: \"sessions_send\", description: \"Send to session\" },\n      { id: \"sessions_spawn\", label: \"sessions_spawn\", description: \"Spawn sub-agent\" },\n      { id: \"session_status\", label: \"session_status\", description: \"Session status\" },\n    ],\n  },\n  {\n    id: \"ui\",\n    label: \"UI\",\n    tools: [\n      { id: \"browser\", label: \"browser\", description: \"Control web browser\" },\n      { id: \"canvas\", label: \"canvas\", description: \"Control canvases\" },\n    ],\n  },\n  {\n    id: \"messaging\",\n    label: \"Messaging\",\n    tools: [{ id: \"message\", label: \"message\", description: \"Send messages\" }],\n  },\n  {\n    id: \"automation\",\n    label: \"Automation\",\n    tools: [\n      { id: \"cron\", label: \"cron\", description: \"Schedule tasks\" },\n      { id: \"gateway\", label: \"gateway\", description: \"Gateway control\" },\n    ],\n  },\n  {\n    id: \"nodes\",\n    label: \"Nodes\",\n    tools: [{ id: \"nodes\", label: \"nodes\", description: \"Nodes + devices\" }],\n  },\n  {\n    id: \"agents\",\n    label: \"Agents\",\n    tools: [{ id: \"agents_list\", label: \"agents_list\", description: \"List agents\" }],\n  },\n  {\n    id: \"media\",\n    label: \"Media\",\n    tools: [{ id: \"image\", label: \"image\", description: \"Image understanding\" }],\n  },\n];\n\nconst PROFILE_OPTIONS = [\n  { id: \"minimal\", label: \"Minimal\" },\n  { id: \"coding\", label: \"Coding\" },\n  { id: \"messaging\", label: \"Messaging\" },\n  { id: \"full\", label: \"Full\" },\n] as const;\n\ntype ToolPolicy = {\n  allow?: string[];\n  deny?: string[];\n};\n\ntype AgentConfigEntry = {\n  id: string;\n  name?: string;\n  workspace?: string;\n  agentDir?: string;\n  model?: unknown;\n  skills?: string[];\n  tools?: {\n    profile?: string;\n    allow?: string[];\n    alsoAllow?: string[];\n    deny?: string[];\n  };\n};\n\ntype ConfigSnapshot = {\n  agents?: {\n    defaults?: { workspace?: string; model?: unknown; models?: Record<string, { alias?: string }> };\n    list?: AgentConfigEntry[];\n  };\n  tools?: {\n    profile?: string;\n    allow?: string[];\n    alsoAllow?: string[];\n    deny?: string[];\n  };\n};\n\nfunction normalizeAgentLabel(agent: { id: string; name?: string; identity?: { name?: string } }) {\n  return agent.name?.trim() || agent.identity?.name?.trim() || agent.id;\n}\n\nfunction isLikelyEmoji(value: string) {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return false;\n  }\n  if (trimmed.length > 16) {\n    return false;\n  }\n  let hasNonAscii = false;\n  for (let i = 0; i < trimmed.length; i += 1) {\n    if (trimmed.charCodeAt(i) > 127) {\n      hasNonAscii = true;\n      break;\n    }\n  }\n  if (!hasNonAscii) {\n    return false;\n  }\n  if (trimmed.includes(\"://\") || trimmed.includes(\"/\") || trimmed.includes(\".\")) {\n    return false;\n  }\n  return true;\n}\n\nfunction resolveAgentEmoji(\n  agent: { identity?: { emoji?: string; avatar?: string } },\n  agentIdentity?: AgentIdentityResult | null,\n) {\n  const identityEmoji = agentIdentity?.emoji?.trim();\n  if (identityEmoji && isLikelyEmoji(identityEmoji)) {\n    return identityEmoji;\n  }\n  const agentEmoji = agent.identity?.emoji?.trim();\n  if (agentEmoji && isLikelyEmoji(agentEmoji)) {\n    return agentEmoji;\n  }\n  const identityAvatar = agentIdentity?.avatar?.trim();\n  if (identityAvatar && isLikelyEmoji(identityAvatar)) {\n    return identityAvatar;\n  }\n  const avatar = agent.identity?.avatar?.trim();\n  if (avatar && isLikelyEmoji(avatar)) {\n    return avatar;\n  }\n  return \"\";\n}\n\nfunction agentBadgeText(agentId: string, defaultId: string | null) {\n  return defaultId && agentId === defaultId ? \"default\" : null;\n}\n\nfunction formatBytes(bytes?: number) {\n  if (bytes == null || !Number.isFinite(bytes)) {\n    return \"-\";\n  }\n  if (bytes < 1024) {\n    return `${bytes} B`;\n  }\n  const units = [\"KB\", \"MB\", \"GB\", \"TB\"];\n  let size = bytes / 1024;\n  let unitIndex = 0;\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024;\n    unitIndex += 1;\n  }\n  return `${size.toFixed(size < 10 ? 1 : 0)} ${units[unitIndex]}`;\n}\n\nfunction resolveAgentConfig(config: Record<string, unknown> | null, agentId: string) {\n  const cfg = config as ConfigSnapshot | null;\n  const list = cfg?.agents?.list ?? [];\n  const entry = list.find((agent) => agent?.id === agentId);\n  return {\n    entry,\n    defaults: cfg?.agents?.defaults,\n    globalTools: cfg?.tools,\n  };\n}\n\ntype AgentContext = {\n  workspace: string;\n  model: string;\n  identityName: string;\n  identityEmoji: string;\n  skillsLabel: string;\n  isDefault: boolean;\n};\n\nfunction buildAgentContext(\n  agent: AgentsListResult[\"agents\"][number],\n  configForm: Record<string, unknown> | null,\n  agentFilesList: AgentsFilesListResult | null,\n  defaultId: string | null,\n  agentIdentity?: AgentIdentityResult | null,\n): AgentContext {\n  const config = resolveAgentConfig(configForm, agent.id);\n  const workspaceFromFiles =\n    agentFilesList && agentFilesList.agentId === agent.id ? agentFilesList.workspace : null;\n  const workspace =\n    workspaceFromFiles || config.entry?.workspace || config.defaults?.workspace || \"default\";\n  const modelLabel = config.entry?.model\n    ? resolveModelLabel(config.entry?.model)\n    : resolveModelLabel(config.defaults?.model);\n  const identityName =\n    agentIdentity?.name?.trim() ||\n    agent.identity?.name?.trim() ||\n    agent.name?.trim() ||\n    config.entry?.name ||\n    agent.id;\n  const identityEmoji = resolveAgentEmoji(agent, agentIdentity) || \"-\";\n  const skillFilter = Array.isArray(config.entry?.skills) ? config.entry?.skills : null;\n  const skillCount = skillFilter?.length ?? null;\n  return {\n    workspace,\n    model: modelLabel,\n    identityName,\n    identityEmoji,\n    skillsLabel: skillFilter ? `${skillCount} selected` : \"all skills\",\n    isDefault: Boolean(defaultId && agent.id === defaultId),\n  };\n}\n\nfunction resolveModelLabel(model?: unknown): string {\n  if (!model) {\n    return \"-\";\n  }\n  if (typeof model === \"string\") {\n    return model.trim() || \"-\";\n  }\n  if (typeof model === \"object\" && model) {\n    const record = model as { primary?: string; fallbacks?: string[] };\n    const primary = record.primary?.trim();\n    if (primary) {\n      const fallbackCount = Array.isArray(record.fallbacks) ? record.fallbacks.length : 0;\n      return fallbackCount > 0 ? `${primary} (+${fallbackCount} fallback)` : primary;\n    }\n  }\n  return \"-\";\n}\n\nfunction normalizeModelValue(label: string): string {\n  const match = label.match(/^(.+) \\(\\+\\d+ fallback\\)$/);\n  return match ? match[1] : label;\n}\n\nfunction resolveModelPrimary(model?: unknown): string | null {\n  if (!model) {\n    return null;\n  }\n  if (typeof model === \"string\") {\n    const trimmed = model.trim();\n    return trimmed || null;\n  }\n  if (typeof model === \"object\" && model) {\n    const record = model as Record<string, unknown>;\n    const candidate =\n      typeof record.primary === \"string\"\n        ? record.primary\n        : typeof record.model === \"string\"\n          ? record.model\n          : typeof record.id === \"string\"\n            ? record.id\n            : typeof record.value === \"string\"\n              ? record.value\n              : null;\n    const primary = candidate?.trim();\n    return primary || null;\n  }\n  return null;\n}\n\nfunction resolveModelFallbacks(model?: unknown): string[] | null {\n  if (!model || typeof model === \"string\") {\n    return null;\n  }\n  if (typeof model === \"object\" && model) {\n    const record = model as Record<string, unknown>;\n    const fallbacks = Array.isArray(record.fallbacks)\n      ? record.fallbacks\n      : Array.isArray(record.fallback)\n        ? record.fallback\n        : null;\n    return fallbacks\n      ? fallbacks.filter((entry): entry is string => typeof entry === \"string\")\n      : null;\n  }\n  return null;\n}\n\nfunction parseFallbackList(value: string): string[] {\n  return value\n    .split(\",\")\n    .map((entry) => entry.trim())\n    .filter(Boolean);\n}\n\ntype ConfiguredModelOption = {\n  value: string;\n  label: string;\n};\n\nfunction resolveConfiguredModels(\n  configForm: Record<string, unknown> | null,\n): ConfiguredModelOption[] {\n  const cfg = configForm as ConfigSnapshot | null;\n  const models = cfg?.agents?.defaults?.models;\n  if (!models || typeof models !== \"object\") {\n    return [];\n  }\n  const options: ConfiguredModelOption[] = [];\n  for (const [modelId, modelRaw] of Object.entries(models)) {\n    const trimmed = modelId.trim();\n    if (!trimmed) {\n      continue;\n    }\n    const alias =\n      modelRaw && typeof modelRaw === \"object\" && \"alias\" in modelRaw\n        ? typeof (modelRaw as { alias?: unknown }).alias === \"string\"\n          ? (modelRaw as { alias?: string }).alias?.trim()\n          : undefined\n        : undefined;\n    const label = alias && alias !== trimmed ? `${alias} (${trimmed})` : trimmed;\n    options.push({ value: trimmed, label });\n  }\n  return options;\n}\n\nfunction buildModelOptions(configForm: Record<string, unknown> | null, current?: string | null) {\n  const options = resolveConfiguredModels(configForm);\n  const hasCurrent = current ? options.some((option) => option.value === current) : false;\n  if (current && !hasCurrent) {\n    options.unshift({ value: current, label: `Current (${current})` });\n  }\n  if (options.length === 0) {\n    return html`\n      <option value=\"\" disabled>No configured models</option>\n    `;\n  }\n  return options.map((option) => html`<option value=${option.value}>${option.label}</option>`);\n}\n\ntype CompiledPattern =\n  | { kind: \"all\" }\n  | { kind: \"exact\"; value: string }\n  | { kind: \"regex\"; value: RegExp };\n\nfunction compilePattern(pattern: string): CompiledPattern {\n  const normalized = normalizeToolName(pattern);\n  if (!normalized) {\n    return { kind: \"exact\", value: \"\" };\n  }\n  if (normalized === \"*\") {\n    return { kind: \"all\" };\n  }\n  if (!normalized.includes(\"*\")) {\n    return { kind: \"exact\", value: normalized };\n  }\n  const escaped = normalized.replace(/[.*+?^${}()|[\\\\]\\\\]/g, \"\\\\$&\");\n  return { kind: \"regex\", value: new RegExp(`^${escaped.replaceAll(\"\\\\*\", \".*\")}$`) };\n}\n\nfunction compilePatterns(patterns?: string[]): CompiledPattern[] {\n  if (!Array.isArray(patterns)) {\n    return [];\n  }\n  return expandToolGroups(patterns)\n    .map(compilePattern)\n    .filter((pattern) => {\n      return pattern.kind !== \"exact\" || pattern.value.length > 0;\n    });\n}\n\nfunction matchesAny(name: string, patterns: CompiledPattern[]) {\n  for (const pattern of patterns) {\n    if (pattern.kind === \"all\") {\n      return true;\n    }\n    if (pattern.kind === \"exact\" && name === pattern.value) {\n      return true;\n    }\n    if (pattern.kind === \"regex\" && pattern.value.test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isAllowedByPolicy(name: string, policy?: ToolPolicy) {\n  if (!policy) {\n    return true;\n  }\n  const normalized = normalizeToolName(name);\n  const deny = compilePatterns(policy.deny);\n  if (matchesAny(normalized, deny)) {\n    return false;\n  }\n  const allow = compilePatterns(policy.allow);\n  if (allow.length === 0) {\n    return true;\n  }\n  if (matchesAny(normalized, allow)) {\n    return true;\n  }\n  if (normalized === \"apply_patch\" && matchesAny(\"exec\", allow)) {\n    return true;\n  }\n  return false;\n}\n\nfunction matchesList(name: string, list?: string[]) {\n  if (!Array.isArray(list) || list.length === 0) {\n    return false;\n  }\n  const normalized = normalizeToolName(name);\n  const patterns = compilePatterns(list);\n  if (matchesAny(normalized, patterns)) {\n    return true;\n  }\n  if (normalized === \"apply_patch\" && matchesAny(\"exec\", patterns)) {\n    return true;\n  }\n  return false;\n}\n\nexport function renderAgents(props: AgentsProps) {\n  const agents = props.agentsList?.agents ?? [];\n  const defaultId = props.agentsList?.defaultId ?? null;\n  const selectedId = props.selectedAgentId ?? defaultId ?? agents[0]?.id ?? null;\n  const selectedAgent = selectedId\n    ? (agents.find((agent) => agent.id === selectedId) ?? null)\n    : null;\n\n  return html`\n    <div class=\"agents-layout\">\n      <section class=\"card agents-sidebar\">\n        <div class=\"row\" style=\"justify-content: space-between;\">\n          <div>\n            <div class=\"card-title\">Agents</div>\n            <div class=\"card-sub\">${agents.length} configured.</div>\n          </div>\n          <button class=\"btn btn--sm\" ?disabled=${props.loading} @click=${props.onRefresh}>\n            ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n          </button>\n        </div>\n        ${\n          props.error\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\n            : nothing\n        }\n        <div class=\"agent-list\" style=\"margin-top: 12px;\">\n          ${\n            agents.length === 0\n              ? html`\n                  <div class=\"muted\">No agents found.</div>\n                `\n              : agents.map((agent) => {\n                  const badge = agentBadgeText(agent.id, defaultId);\n                  const emoji = resolveAgentEmoji(agent, props.agentIdentityById[agent.id] ?? null);\n                  return html`\n                    <button\n                      type=\"button\"\n                      class=\"agent-row ${selectedId === agent.id ? \"active\" : \"\"}\"\n                      @click=${() => props.onSelectAgent(agent.id)}\n                    >\n                      <div class=\"agent-avatar\">\n                        ${emoji || normalizeAgentLabel(agent).slice(0, 1)}\n                      </div>\n                      <div class=\"agent-info\">\n                        <div class=\"agent-title\">${normalizeAgentLabel(agent)}</div>\n                        <div class=\"agent-sub mono\">${agent.id}</div>\n                      </div>\n                      ${badge ? html`<span class=\"agent-pill\">${badge}</span>` : nothing}\n                    </button>\n                  `;\n                })\n          }\n        </div>\n      </section>\n      <section class=\"agents-main\">\n        ${\n          !selectedAgent\n            ? html`\n                <div class=\"card\">\n                  <div class=\"card-title\">Select an agent</div>\n                  <div class=\"card-sub\">Pick an agent to inspect its workspace and tools.</div>\n                </div>\n              `\n            : html`\n              ${renderAgentHeader(\n                selectedAgent,\n                defaultId,\n                props.agentIdentityById[selectedAgent.id] ?? null,\n              )}\n              ${renderAgentTabs(props.activePanel, (panel) => props.onSelectPanel(panel))}\n              ${\n                props.activePanel === \"overview\"\n                  ? renderAgentOverview({\n                      agent: selectedAgent,\n                      defaultId,\n                      configForm: props.configForm,\n                      agentFilesList: props.agentFilesList,\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\n                      agentIdentityError: props.agentIdentityError,\n                      agentIdentityLoading: props.agentIdentityLoading,\n                      configLoading: props.configLoading,\n                      configSaving: props.configSaving,\n                      configDirty: props.configDirty,\n                      onConfigReload: props.onConfigReload,\n                      onConfigSave: props.onConfigSave,\n                      onModelChange: props.onModelChange,\n                      onModelFallbacksChange: props.onModelFallbacksChange,\n                    })\n                  : nothing\n              }\n              ${\n                props.activePanel === \"files\"\n                  ? renderAgentFiles({\n                      agentId: selectedAgent.id,\n                      agentFilesList: props.agentFilesList,\n                      agentFilesLoading: props.agentFilesLoading,\n                      agentFilesError: props.agentFilesError,\n                      agentFileActive: props.agentFileActive,\n                      agentFileContents: props.agentFileContents,\n                      agentFileDrafts: props.agentFileDrafts,\n                      agentFileSaving: props.agentFileSaving,\n                      onLoadFiles: props.onLoadFiles,\n                      onSelectFile: props.onSelectFile,\n                      onFileDraftChange: props.onFileDraftChange,\n                      onFileReset: props.onFileReset,\n                      onFileSave: props.onFileSave,\n                    })\n                  : nothing\n              }\n              ${\n                props.activePanel === \"tools\"\n                  ? renderAgentTools({\n                      agentId: selectedAgent.id,\n                      configForm: props.configForm,\n                      configLoading: props.configLoading,\n                      configSaving: props.configSaving,\n                      configDirty: props.configDirty,\n                      onProfileChange: props.onToolsProfileChange,\n                      onOverridesChange: props.onToolsOverridesChange,\n                      onConfigReload: props.onConfigReload,\n                      onConfigSave: props.onConfigSave,\n                    })\n                  : nothing\n              }\n              ${\n                props.activePanel === \"skills\"\n                  ? renderAgentSkills({\n                      agentId: selectedAgent.id,\n                      report: props.agentSkillsReport,\n                      loading: props.agentSkillsLoading,\n                      error: props.agentSkillsError,\n                      activeAgentId: props.agentSkillsAgentId,\n                      configForm: props.configForm,\n                      configLoading: props.configLoading,\n                      configSaving: props.configSaving,\n                      configDirty: props.configDirty,\n                      filter: props.skillsFilter,\n                      onFilterChange: props.onSkillsFilterChange,\n                      onRefresh: props.onSkillsRefresh,\n                      onToggle: props.onAgentSkillToggle,\n                      onClear: props.onAgentSkillsClear,\n                      onDisableAll: props.onAgentSkillsDisableAll,\n                      onConfigReload: props.onConfigReload,\n                      onConfigSave: props.onConfigSave,\n                    })\n                  : nothing\n              }\n              ${\n                props.activePanel === \"channels\"\n                  ? renderAgentChannels({\n                      agent: selectedAgent,\n                      defaultId,\n                      configForm: props.configForm,\n                      agentFilesList: props.agentFilesList,\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\n                      snapshot: props.channelsSnapshot,\n                      loading: props.channelsLoading,\n                      error: props.channelsError,\n                      lastSuccess: props.channelsLastSuccess,\n                      onRefresh: props.onChannelsRefresh,\n                    })\n                  : nothing\n              }\n              ${\n                props.activePanel === \"cron\"\n                  ? renderAgentCron({\n                      agent: selectedAgent,\n                      defaultId,\n                      configForm: props.configForm,\n                      agentFilesList: props.agentFilesList,\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\n                      jobs: props.cronJobs,\n                      status: props.cronStatus,\n                      loading: props.cronLoading,\n                      error: props.cronError,\n                      onRefresh: props.onCronRefresh,\n                    })\n                  : nothing\n              }\n            `\n        }\n      </section>\n    </div>\n  `;\n}\n\nfunction renderAgentHeader(\n  agent: AgentsListResult[\"agents\"][number],\n  defaultId: string | null,\n  agentIdentity: AgentIdentityResult | null,\n) {\n  const badge = agentBadgeText(agent.id, defaultId);\n  const displayName = normalizeAgentLabel(agent);\n  const subtitle = agent.identity?.theme?.trim() || \"Agent workspace and routing.\";\n  const emoji = resolveAgentEmoji(agent, agentIdentity);\n  return html`\n    <section class=\"card agent-header\">\n      <div class=\"agent-header-main\">\n        <div class=\"agent-avatar agent-avatar--lg\">\n          ${emoji || displayName.slice(0, 1)}\n        </div>\n        <div>\n          <div class=\"card-title\">${displayName}</div>\n          <div class=\"card-sub\">${subtitle}</div>\n        </div>\n      </div>\n      <div class=\"agent-header-meta\">\n        <div class=\"mono\">${agent.id}</div>\n        ${badge ? html`<span class=\"agent-pill\">${badge}</span>` : nothing}\n      </div>\n    </section>\n  `;\n}\n\nfunction renderAgentTabs(active: AgentsPanel, onSelect: (panel: AgentsPanel) => void) {\n  const tabs: Array<{ id: AgentsPanel; label: string }> = [\n    { id: \"overview\", label: \"Overview\" },\n    { id: \"files\", label: \"Files\" },\n    { id: \"tools\", label: \"Tools\" },\n    { id: \"skills\", label: \"Skills\" },\n    { id: \"channels\", label: \"Channels\" },\n    { id: \"cron\", label: \"Cron Jobs\" },\n  ];\n  return html`\n    <div class=\"agent-tabs\">\n      ${tabs.map(\n        (tab) => html`\n          <button\n            class=\"agent-tab ${active === tab.id ? \"active\" : \"\"}\"\n            type=\"button\"\n            @click=${() => onSelect(tab.id)}\n          >\n            ${tab.label}\n          </button>\n        `,\n      )}\n    </div>\n  `;\n}\n\nfunction renderAgentOverview(params: {\n  agent: AgentsListResult[\"agents\"][number];\n  defaultId: string | null;\n  configForm: Record<string, unknown> | null;\n  agentFilesList: AgentsFilesListResult | null;\n  agentIdentity: AgentIdentityResult | null;\n  agentIdentityLoading: boolean;\n  agentIdentityError: string | null;\n  configLoading: boolean;\n  configSaving: boolean;\n  configDirty: boolean;\n  onConfigReload: () => void;\n  onConfigSave: () => void;\n  onModelChange: (agentId: string, modelId: string | null) => void;\n  onModelFallbacksChange: (agentId: string, fallbacks: string[]) => void;\n}) {\n  const {\n    agent,\n    configForm,\n    agentFilesList,\n    agentIdentity,\n    agentIdentityLoading,\n    agentIdentityError,\n    configLoading,\n    configSaving,\n    configDirty,\n    onConfigReload,\n    onConfigSave,\n    onModelChange,\n    onModelFallbacksChange,\n  } = params;\n  const config = resolveAgentConfig(configForm, agent.id);\n  const workspaceFromFiles =\n    agentFilesList && agentFilesList.agentId === agent.id ? agentFilesList.workspace : null;\n  const workspace =\n    workspaceFromFiles || config.entry?.workspace || config.defaults?.workspace || \"default\";\n  const model = config.entry?.model\n    ? resolveModelLabel(config.entry?.model)\n    : resolveModelLabel(config.defaults?.model);\n  const defaultModel = resolveModelLabel(config.defaults?.model);\n  const modelPrimary =\n    resolveModelPrimary(config.entry?.model) || (model !== \"-\" ? normalizeModelValue(model) : null);\n  const defaultPrimary =\n    resolveModelPrimary(config.defaults?.model) ||\n    (defaultModel !== \"-\" ? normalizeModelValue(defaultModel) : null);\n  const effectivePrimary = modelPrimary ?? defaultPrimary ?? null;\n  const modelFallbacks = resolveModelFallbacks(config.entry?.model);\n  const fallbackText = modelFallbacks ? modelFallbacks.join(\", \") : \"\";\n  const identityName =\n    agentIdentity?.name?.trim() ||\n    agent.identity?.name?.trim() ||\n    agent.name?.trim() ||\n    config.entry?.name ||\n    \"-\";\n  const resolvedEmoji = resolveAgentEmoji(agent, agentIdentity);\n  const identityEmoji = resolvedEmoji || \"-\";\n  const skillFilter = Array.isArray(config.entry?.skills) ? config.entry?.skills : null;\n  const skillCount = skillFilter?.length ?? null;\n  const identityStatus = agentIdentityLoading\n    ? \"Loadingâ€¦\"\n    : agentIdentityError\n      ? \"Unavailable\"\n      : \"\";\n  const isDefault = Boolean(params.defaultId && agent.id === params.defaultId);\n\n  return html`\n    <section class=\"card\">\n      <div class=\"card-title\">Overview</div>\n      <div class=\"card-sub\">Workspace paths and identity metadata.</div>\n      <div class=\"agents-overview-grid\" style=\"margin-top: 16px;\">\n        <div class=\"agent-kv\">\n          <div class=\"label\">Workspace</div>\n          <div class=\"mono\">${workspace}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Primary Model</div>\n          <div class=\"mono\">${model}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Identity Name</div>\n          <div>${identityName}</div>\n          ${identityStatus ? html`<div class=\"agent-kv-sub muted\">${identityStatus}</div>` : nothing}\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Default</div>\n          <div>${isDefault ? \"yes\" : \"no\"}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Identity Emoji</div>\n          <div>${identityEmoji}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Skills Filter</div>\n          <div>${skillFilter ? `${skillCount} selected` : \"all skills\"}</div>\n        </div>\n      </div>\n\n      <div class=\"agent-model-select\" style=\"margin-top: 20px;\">\n        <div class=\"label\">Model Selection</div>\n        <div class=\"row\" style=\"gap: 12px; flex-wrap: wrap;\">\n          <label class=\"field\" style=\"min-width: 260px; flex: 1;\">\n            <span>Primary model</span>\n            <select\n              .value=${effectivePrimary ?? \"\"}\n              ?disabled=${!configForm || configLoading || configSaving}\n              @change=${(e: Event) =>\n                onModelChange(agent.id, (e.target as HTMLSelectElement).value || null)}\n            >\n              <option value=\"\">\n                ${defaultPrimary ? `Inherit default (${defaultPrimary})` : \"Inherit default\"}\n              </option>\n              ${buildModelOptions(configForm, effectivePrimary ?? undefined)}\n            </select>\n          </label>\n          <label class=\"field\" style=\"min-width: 260px; flex: 1;\">\n            <span>Fallbacks (comma-separated)</span>\n            <input\n              .value=${fallbackText}\n              ?disabled=${!configForm || configLoading || configSaving}\n              placeholder=\"provider/model, provider/model\"\n              @input=${(e: Event) =>\n                onModelFallbacksChange(\n                  agent.id,\n                  parseFallbackList((e.target as HTMLInputElement).value),\n                )}\n            />\n          </label>\n        </div>\n        <div class=\"row\" style=\"justify-content: flex-end; gap: 8px;\">\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${configLoading}\n            @click=${onConfigReload}\n          >\n            Reload Config\n          </button>\n          <button\n            class=\"btn btn--sm primary\"\n            ?disabled=${configSaving || !configDirty}\n            @click=${onConfigSave}\n          >\n            ${configSaving ? \"Savingâ€¦\" : \"Save\"}\n          </button>\n        </div>\n      </div>\n    </section>\n  `;\n}\n\nfunction renderAgentContextCard(context: AgentContext, subtitle: string) {\n  return html`\n    <section class=\"card\">\n      <div class=\"card-title\">Agent Context</div>\n      <div class=\"card-sub\">${subtitle}</div>\n      <div class=\"agents-overview-grid\" style=\"margin-top: 16px;\">\n        <div class=\"agent-kv\">\n          <div class=\"label\">Workspace</div>\n          <div class=\"mono\">${context.workspace}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Primary Model</div>\n          <div class=\"mono\">${context.model}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Identity Name</div>\n          <div>${context.identityName}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Identity Emoji</div>\n          <div>${context.identityEmoji}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Skills Filter</div>\n          <div>${context.skillsLabel}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Default</div>\n          <div>${context.isDefault ? \"yes\" : \"no\"}</div>\n        </div>\n      </div>\n    </section>\n  `;\n}\n\ntype ChannelSummaryEntry = {\n  id: string;\n  label: string;\n  accounts: ChannelAccountSnapshot[];\n};\n\nfunction resolveChannelLabel(snapshot: ChannelsStatusSnapshot, id: string) {\n  const meta = snapshot.channelMeta?.find((entry) => entry.id === id);\n  if (meta?.label) {\n    return meta.label;\n  }\n  return snapshot.channelLabels?.[id] ?? id;\n}\n\nfunction resolveChannelEntries(snapshot: ChannelsStatusSnapshot | null): ChannelSummaryEntry[] {\n  if (!snapshot) {\n    return [];\n  }\n  const ids = new Set<string>();\n  for (const id of snapshot.channelOrder ?? []) {\n    ids.add(id);\n  }\n  for (const entry of snapshot.channelMeta ?? []) {\n    ids.add(entry.id);\n  }\n  for (const id of Object.keys(snapshot.channelAccounts ?? {})) {\n    ids.add(id);\n  }\n  const ordered: string[] = [];\n  const seed = snapshot.channelOrder?.length ? snapshot.channelOrder : Array.from(ids);\n  for (const id of seed) {\n    if (!ids.has(id)) {\n      continue;\n    }\n    ordered.push(id);\n    ids.delete(id);\n  }\n  for (const id of ids) {\n    ordered.push(id);\n  }\n  return ordered.map((id) => ({\n    id,\n    label: resolveChannelLabel(snapshot, id),\n    accounts: snapshot.channelAccounts?.[id] ?? [],\n  }));\n}\n\nconst CHANNEL_EXTRA_FIELDS = [\"groupPolicy\", \"streamMode\", \"dmPolicy\"] as const;\n\nfunction resolveChannelConfigValue(\n  configForm: Record<string, unknown> | null,\n  channelId: string,\n): Record<string, unknown> | null {\n  if (!configForm) {\n    return null;\n  }\n  const channels = (configForm.channels ?? {}) as Record<string, unknown>;\n  const fromChannels = channels[channelId];\n  if (fromChannels && typeof fromChannels === \"object\") {\n    return fromChannels as Record<string, unknown>;\n  }\n  const fallback = configForm[channelId];\n  if (fallback && typeof fallback === \"object\") {\n    return fallback as Record<string, unknown>;\n  }\n  return null;\n}\n\nfunction formatChannelExtraValue(raw: unknown): string {\n  if (raw == null) {\n    return \"n/a\";\n  }\n  if (typeof raw === \"string\" || typeof raw === \"number\" || typeof raw === \"boolean\") {\n    return String(raw);\n  }\n  try {\n    return JSON.stringify(raw);\n  } catch {\n    return \"n/a\";\n  }\n}\n\nfunction resolveChannelExtras(\n  configForm: Record<string, unknown> | null,\n  channelId: string,\n): Array<{ label: string; value: string }> {\n  const value = resolveChannelConfigValue(configForm, channelId);\n  if (!value) {\n    return [];\n  }\n  return CHANNEL_EXTRA_FIELDS.flatMap((field) => {\n    if (!(field in value)) {\n      return [];\n    }\n    return [{ label: field, value: formatChannelExtraValue(value[field]) }];\n  });\n}\n\nfunction summarizeChannelAccounts(accounts: ChannelAccountSnapshot[]) {\n  let connected = 0;\n  let configured = 0;\n  let enabled = 0;\n  for (const account of accounts) {\n    const probeOk =\n      account.probe && typeof account.probe === \"object\" && \"ok\" in account.probe\n        ? Boolean((account.probe as { ok?: unknown }).ok)\n        : false;\n    const isConnected = account.connected === true || account.running === true || probeOk;\n    if (isConnected) {\n      connected += 1;\n    }\n    if (account.configured) {\n      configured += 1;\n    }\n    if (account.enabled) {\n      enabled += 1;\n    }\n  }\n  return {\n    total: accounts.length,\n    connected,\n    configured,\n    enabled,\n  };\n}\n\nfunction renderAgentChannels(params: {\n  agent: AgentsListResult[\"agents\"][number];\n  defaultId: string | null;\n  configForm: Record<string, unknown> | null;\n  agentFilesList: AgentsFilesListResult | null;\n  agentIdentity: AgentIdentityResult | null;\n  snapshot: ChannelsStatusSnapshot | null;\n  loading: boolean;\n  error: string | null;\n  lastSuccess: number | null;\n  onRefresh: () => void;\n}) {\n  const context = buildAgentContext(\n    params.agent,\n    params.configForm,\n    params.agentFilesList,\n    params.defaultId,\n    params.agentIdentity,\n  );\n  const entries = resolveChannelEntries(params.snapshot);\n  const lastSuccessLabel = params.lastSuccess ? formatAgo(params.lastSuccess) : \"never\";\n  return html`\n    <section class=\"grid grid-cols-2\">\n      ${renderAgentContextCard(context, \"Workspace, identity, and model configuration.\")}\n      <section class=\"card\">\n        <div class=\"row\" style=\"justify-content: space-between;\">\n          <div>\n            <div class=\"card-title\">Channels</div>\n            <div class=\"card-sub\">Gateway-wide channel status snapshot.</div>\n          </div>\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\n            ${params.loading ? \"Refreshingâ€¦\" : \"Refresh\"}\n          </button>\n        </div>\n        <div class=\"muted\" style=\"margin-top: 8px;\">\n          Last refresh: ${lastSuccessLabel}\n        </div>\n        ${\n          params.error\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\n            : nothing\n        }\n        ${\n          !params.snapshot\n            ? html`\n                <div class=\"callout info\" style=\"margin-top: 12px\">Load channels to see live status.</div>\n              `\n            : nothing\n        }\n        ${\n          entries.length === 0\n            ? html`\n                <div class=\"muted\" style=\"margin-top: 16px\">No channels found.</div>\n              `\n            : html`\n              <div class=\"list\" style=\"margin-top: 16px;\">\n                ${entries.map((entry) => {\n                  const summary = summarizeChannelAccounts(entry.accounts);\n                  const status = summary.total\n                    ? `${summary.connected}/${summary.total} connected`\n                    : \"no accounts\";\n                  const config = summary.configured\n                    ? `${summary.configured} configured`\n                    : \"not configured\";\n                  const enabled = summary.total ? `${summary.enabled} enabled` : \"disabled\";\n                  const extras = resolveChannelExtras(params.configForm, entry.id);\n                  return html`\n                    <div class=\"list-item\">\n                      <div class=\"list-main\">\n                        <div class=\"list-title\">${entry.label}</div>\n                        <div class=\"list-sub mono\">${entry.id}</div>\n                      </div>\n                      <div class=\"list-meta\">\n                        <div>${status}</div>\n                        <div>${config}</div>\n                        <div>${enabled}</div>\n                        ${\n                          extras.length > 0\n                            ? extras.map((extra) => html`<div>${extra.label}: ${extra.value}</div>`)\n                            : nothing\n                        }\n                      </div>\n                    </div>\n                  `;\n                })}\n              </div>\n            `\n        }\n      </section>\n    </section>\n  `;\n}\n\nfunction renderAgentCron(params: {\n  agent: AgentsListResult[\"agents\"][number];\n  defaultId: string | null;\n  configForm: Record<string, unknown> | null;\n  agentFilesList: AgentsFilesListResult | null;\n  agentIdentity: AgentIdentityResult | null;\n  jobs: CronJob[];\n  status: CronStatus | null;\n  loading: boolean;\n  error: string | null;\n  onRefresh: () => void;\n}) {\n  const context = buildAgentContext(\n    params.agent,\n    params.configForm,\n    params.agentFilesList,\n    params.defaultId,\n    params.agentIdentity,\n  );\n  const jobs = params.jobs.filter((job) => job.agentId === params.agent.id);\n  return html`\n    <section class=\"grid grid-cols-2\">\n      ${renderAgentContextCard(context, \"Workspace and scheduling targets.\")}\n      <section class=\"card\">\n        <div class=\"row\" style=\"justify-content: space-between;\">\n          <div>\n            <div class=\"card-title\">Scheduler</div>\n            <div class=\"card-sub\">Gateway cron status.</div>\n          </div>\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\n            ${params.loading ? \"Refreshingâ€¦\" : \"Refresh\"}\n          </button>\n        </div>\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\n          <div class=\"stat\">\n            <div class=\"stat-label\">Enabled</div>\n            <div class=\"stat-value\">\n              ${params.status ? (params.status.enabled ? \"Yes\" : \"No\") : \"n/a\"}\n            </div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Jobs</div>\n            <div class=\"stat-value\">${params.status?.jobs ?? \"n/a\"}</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Next wake</div>\n            <div class=\"stat-value\">${formatNextRun(params.status?.nextWakeAtMs ?? null)}</div>\n          </div>\n        </div>\n        ${\n          params.error\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\n            : nothing\n        }\n      </section>\n    </section>\n    <section class=\"card\">\n      <div class=\"card-title\">Agent Cron Jobs</div>\n      <div class=\"card-sub\">Scheduled jobs targeting this agent.</div>\n      ${\n        jobs.length === 0\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 16px\">No jobs assigned.</div>\n            `\n          : html`\n              <div class=\"list\" style=\"margin-top: 16px;\">\n                ${jobs.map(\n                  (job) => html`\n                  <div class=\"list-item\">\n                    <div class=\"list-main\">\n                      <div class=\"list-title\">${job.name}</div>\n                      ${job.description ? html`<div class=\"list-sub\">${job.description}</div>` : nothing}\n                      <div class=\"chip-row\" style=\"margin-top: 6px;\">\n                        <span class=\"chip\">${formatCronSchedule(job)}</span>\n                        <span class=\"chip ${job.enabled ? \"chip-ok\" : \"chip-warn\"}\">\n                          ${job.enabled ? \"enabled\" : \"disabled\"}\n                        </span>\n                        <span class=\"chip\">${job.sessionTarget}</span>\n                      </div>\n                    </div>\n                    <div class=\"list-meta\">\n                      <div class=\"mono\">${formatCronState(job)}</div>\n                      <div class=\"muted\">${formatCronPayload(job)}</div>\n                    </div>\n                  </div>\n                `,\n                )}\n              </div>\n            `\n      }\n    </section>\n  `;\n}\n\nfunction renderAgentFiles(params: {\n  agentId: string;\n  agentFilesList: AgentsFilesListResult | null;\n  agentFilesLoading: boolean;\n  agentFilesError: string | null;\n  agentFileActive: string | null;\n  agentFileContents: Record<string, string>;\n  agentFileDrafts: Record<string, string>;\n  agentFileSaving: boolean;\n  onLoadFiles: (agentId: string) => void;\n  onSelectFile: (name: string) => void;\n  onFileDraftChange: (name: string, content: string) => void;\n  onFileReset: (name: string) => void;\n  onFileSave: (name: string) => void;\n}) {\n  const list = params.agentFilesList?.agentId === params.agentId ? params.agentFilesList : null;\n  const files = list?.files ?? [];\n  const active = params.agentFileActive ?? null;\n  const activeEntry = active ? (files.find((file) => file.name === active) ?? null) : null;\n  const baseContent = active ? (params.agentFileContents[active] ?? \"\") : \"\";\n  const draft = active ? (params.agentFileDrafts[active] ?? baseContent) : \"\";\n  const isDirty = active ? draft !== baseContent : false;\n\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Core Files</div>\n          <div class=\"card-sub\">Bootstrap persona, identity, and tool guidance.</div>\n        </div>\n        <button\n          class=\"btn btn--sm\"\n          ?disabled=${params.agentFilesLoading}\n          @click=${() => params.onLoadFiles(params.agentId)}\n        >\n          ${params.agentFilesLoading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n      ${list ? html`<div class=\"muted mono\" style=\"margin-top: 8px;\">Workspace: ${list.workspace}</div>` : nothing}\n      ${\n        params.agentFilesError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${\n              params.agentFilesError\n            }</div>`\n          : nothing\n      }\n      ${\n        !list\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                Load the agent workspace files to edit core instructions.\n              </div>\n            `\n          : html`\n              <div class=\"agent-files-grid\" style=\"margin-top: 16px;\">\n                <div class=\"agent-files-list\">\n                  ${\n                    files.length === 0\n                      ? html`\n                          <div class=\"muted\">No files found.</div>\n                        `\n                      : files.map((file) =>\n                          renderAgentFileRow(file, active, () => params.onSelectFile(file.name)),\n                        )\n                  }\n                </div>\n                <div class=\"agent-files-editor\">\n                  ${\n                    !activeEntry\n                      ? html`\n                          <div class=\"muted\">Select a file to edit.</div>\n                        `\n                      : html`\n                          <div class=\"agent-file-header\">\n                            <div>\n                              <div class=\"agent-file-title mono\">${activeEntry.name}</div>\n                              <div class=\"agent-file-sub mono\">${activeEntry.path}</div>\n                            </div>\n                            <div class=\"agent-file-actions\">\n                              <button\n                                class=\"btn btn--sm\"\n                                ?disabled=${!isDirty}\n                                @click=${() => params.onFileReset(activeEntry.name)}\n                              >\n                                Reset\n                              </button>\n                              <button\n                                class=\"btn btn--sm primary\"\n                                ?disabled=${params.agentFileSaving || !isDirty}\n                                @click=${() => params.onFileSave(activeEntry.name)}\n                              >\n                                ${params.agentFileSaving ? \"Savingâ€¦\" : \"Save\"}\n                              </button>\n                            </div>\n                          </div>\n                          ${\n                            activeEntry.missing\n                              ? html`\n                                  <div class=\"callout info\" style=\"margin-top: 10px\">\n                                    This file is missing. Saving will create it in the agent workspace.\n                                  </div>\n                                `\n                              : nothing\n                          }\n                          <label class=\"field\" style=\"margin-top: 12px;\">\n                            <span>Content</span>\n                            <textarea\n                              .value=${draft}\n                              @input=${(e: Event) =>\n                                params.onFileDraftChange(\n                                  activeEntry.name,\n                                  (e.target as HTMLTextAreaElement).value,\n                                )}\n                            ></textarea>\n                          </label>\n                        `\n                  }\n                </div>\n              </div>\n            `\n      }\n    </section>\n  `;\n}\n\nfunction renderAgentFileRow(file: AgentFileEntry, active: string | null, onSelect: () => void) {\n  const status = file.missing\n    ? \"Missing\"\n    : `${formatBytes(file.size)} Â· ${formatAgo(file.updatedAtMs ?? null)}`;\n  return html`\n    <button\n      type=\"button\"\n      class=\"agent-file-row ${active === file.name ? \"active\" : \"\"}\"\n      @click=${onSelect}\n    >\n      <div>\n        <div class=\"agent-file-name mono\">${file.name}</div>\n        <div class=\"agent-file-meta\">${status}</div>\n      </div>\n      ${\n        file.missing\n          ? html`\n              <span class=\"agent-pill warn\">missing</span>\n            `\n          : nothing\n      }\n    </button>\n  `;\n}\n\nfunction renderAgentTools(params: {\n  agentId: string;\n  configForm: Record<string, unknown> | null;\n  configLoading: boolean;\n  configSaving: boolean;\n  configDirty: boolean;\n  onProfileChange: (agentId: string, profile: string | null, clearAllow: boolean) => void;\n  onOverridesChange: (agentId: string, alsoAllow: string[], deny: string[]) => void;\n  onConfigReload: () => void;\n  onConfigSave: () => void;\n}) {\n  const config = resolveAgentConfig(params.configForm, params.agentId);\n  const agentTools = config.entry?.tools ?? {};\n  const globalTools = config.globalTools ?? {};\n  const profile = agentTools.profile ?? globalTools.profile ?? \"full\";\n  const profileSource = agentTools.profile\n    ? \"agent override\"\n    : globalTools.profile\n      ? \"global default\"\n      : \"default\";\n  const hasAgentAllow = Array.isArray(agentTools.allow) && agentTools.allow.length > 0;\n  const hasGlobalAllow = Array.isArray(globalTools.allow) && globalTools.allow.length > 0;\n  const editable =\n    Boolean(params.configForm) && !params.configLoading && !params.configSaving && !hasAgentAllow;\n  const alsoAllow = hasAgentAllow\n    ? []\n    : Array.isArray(agentTools.alsoAllow)\n      ? agentTools.alsoAllow\n      : [];\n  const deny = hasAgentAllow ? [] : Array.isArray(agentTools.deny) ? agentTools.deny : [];\n  const basePolicy = hasAgentAllow\n    ? { allow: agentTools.allow ?? [], deny: agentTools.deny ?? [] }\n    : (resolveToolProfilePolicy(profile) ?? undefined);\n  const toolIds = TOOL_SECTIONS.flatMap((section) => section.tools.map((tool) => tool.id));\n\n  const resolveAllowed = (toolId: string) => {\n    const baseAllowed = isAllowedByPolicy(toolId, basePolicy);\n    const extraAllowed = matchesList(toolId, alsoAllow);\n    const denied = matchesList(toolId, deny);\n    const allowed = (baseAllowed || extraAllowed) && !denied;\n    return {\n      allowed,\n      baseAllowed,\n      denied,\n    };\n  };\n  const enabledCount = toolIds.filter((toolId) => resolveAllowed(toolId).allowed).length;\n\n  const updateTool = (toolId: string, nextEnabled: boolean) => {\n    const nextAllow = new Set(\n      alsoAllow.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\n    );\n    const nextDeny = new Set(\n      deny.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\n    );\n    const baseAllowed = resolveAllowed(toolId).baseAllowed;\n    const normalized = normalizeToolName(toolId);\n    if (nextEnabled) {\n      nextDeny.delete(normalized);\n      if (!baseAllowed) {\n        nextAllow.add(normalized);\n      }\n    } else {\n      nextAllow.delete(normalized);\n      nextDeny.add(normalized);\n    }\n    params.onOverridesChange(params.agentId, [...nextAllow], [...nextDeny]);\n  };\n\n  const updateAll = (nextEnabled: boolean) => {\n    const nextAllow = new Set(\n      alsoAllow.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\n    );\n    const nextDeny = new Set(\n      deny.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\n    );\n    for (const toolId of toolIds) {\n      const baseAllowed = resolveAllowed(toolId).baseAllowed;\n      const normalized = normalizeToolName(toolId);\n      if (nextEnabled) {\n        nextDeny.delete(normalized);\n        if (!baseAllowed) {\n          nextAllow.add(normalized);\n        }\n      } else {\n        nextAllow.delete(normalized);\n        nextDeny.add(normalized);\n      }\n    }\n    params.onOverridesChange(params.agentId, [...nextAllow], [...nextDeny]);\n  };\n\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Tool Access</div>\n          <div class=\"card-sub\">\n            Profile + per-tool overrides for this agent.\n            <span class=\"mono\">${enabledCount}/${toolIds.length}</span> enabled.\n          </div>\n        </div>\n        <div class=\"row\" style=\"gap: 8px;\">\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${!editable}\n            @click=${() => updateAll(true)}\n          >\n            Enable All\n          </button>\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${!editable}\n            @click=${() => updateAll(false)}\n          >\n            Disable All\n          </button>\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${params.configLoading}\n            @click=${params.onConfigReload}\n          >\n            Reload Config\n          </button>\n          <button\n            class=\"btn btn--sm primary\"\n            ?disabled=${params.configSaving || !params.configDirty}\n            @click=${params.onConfigSave}\n          >\n            ${params.configSaving ? \"Savingâ€¦\" : \"Save\"}\n          </button>\n        </div>\n      </div>\n\n      ${\n        !params.configForm\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                Load the gateway config to adjust tool profiles.\n              </div>\n            `\n          : nothing\n      }\n      ${\n        hasAgentAllow\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                This agent is using an explicit allowlist in config. Tool overrides are managed in the Config tab.\n              </div>\n            `\n          : nothing\n      }\n      ${\n        hasGlobalAllow\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                Global tools.allow is set. Agent overrides cannot enable tools that are globally blocked.\n              </div>\n            `\n          : nothing\n      }\n\n      <div class=\"agent-tools-meta\" style=\"margin-top: 16px;\">\n        <div class=\"agent-kv\">\n          <div class=\"label\">Profile</div>\n          <div class=\"mono\">${profile}</div>\n        </div>\n        <div class=\"agent-kv\">\n          <div class=\"label\">Source</div>\n          <div>${profileSource}</div>\n        </div>\n        ${\n          params.configDirty\n            ? html`\n                <div class=\"agent-kv\">\n                  <div class=\"label\">Status</div>\n                  <div class=\"mono\">unsaved</div>\n                </div>\n              `\n            : nothing\n        }\n      </div>\n\n      <div class=\"agent-tools-presets\" style=\"margin-top: 16px;\">\n        <div class=\"label\">Quick Presets</div>\n        <div class=\"agent-tools-buttons\">\n          ${PROFILE_OPTIONS.map(\n            (option) => html`\n              <button\n                class=\"btn btn--sm ${profile === option.id ? \"active\" : \"\"}\"\n                ?disabled=${!editable}\n                @click=${() => params.onProfileChange(params.agentId, option.id, true)}\n              >\n                ${option.label}\n              </button>\n            `,\n          )}\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${!editable}\n            @click=${() => params.onProfileChange(params.agentId, null, false)}\n          >\n            Inherit\n          </button>\n        </div>\n      </div>\n\n      <div class=\"agent-tools-grid\" style=\"margin-top: 20px;\">\n        ${TOOL_SECTIONS.map(\n          (section) =>\n            html`\n            <div class=\"agent-tools-section\">\n              <div class=\"agent-tools-header\">${section.label}</div>\n              <div class=\"agent-tools-list\">\n                ${section.tools.map((tool) => {\n                  const { allowed } = resolveAllowed(tool.id);\n                  return html`\n                    <div class=\"agent-tool-row\">\n                      <div>\n                        <div class=\"agent-tool-title mono\">${tool.label}</div>\n                        <div class=\"agent-tool-sub\">${tool.description}</div>\n                      </div>\n                      <label class=\"cfg-toggle\">\n                        <input\n                          type=\"checkbox\"\n                          .checked=${allowed}\n                          ?disabled=${!editable}\n                          @change=${(e: Event) =>\n                            updateTool(tool.id, (e.target as HTMLInputElement).checked)}\n                        />\n                        <span class=\"cfg-toggle__track\"></span>\n                      </label>\n                    </div>\n                  `;\n                })}\n              </div>\n            </div>\n          `,\n        )}\n      </div>\n    </section>\n  `;\n}\n\ntype SkillGroup = {\n  id: string;\n  label: string;\n  skills: SkillStatusEntry[];\n};\n\nconst SKILL_SOURCE_GROUPS: Array<{ id: string; label: string; sources: string[] }> = [\n  { id: \"workspace\", label: \"Workspace Skills\", sources: [\"openclaw-workspace\"] },\n  { id: \"built-in\", label: \"Built-in Skills\", sources: [\"openclaw-bundled\"] },\n  { id: \"installed\", label: \"Installed Skills\", sources: [\"openclaw-managed\"] },\n  { id: \"extra\", label: \"Extra Skills\", sources: [\"openclaw-extra\"] },\n];\n\nfunction groupSkills(skills: SkillStatusEntry[]): SkillGroup[] {\n  const groups = new Map<string, SkillGroup>();\n  for (const def of SKILL_SOURCE_GROUPS) {\n    groups.set(def.id, { id: def.id, label: def.label, skills: [] });\n  }\n  const other: SkillGroup = { id: \"other\", label: \"Other Skills\", skills: [] };\n  for (const skill of skills) {\n    const match = SKILL_SOURCE_GROUPS.find((group) => group.sources.includes(skill.source));\n    if (match) {\n      groups.get(match.id)?.skills.push(skill);\n    } else {\n      other.skills.push(skill);\n    }\n  }\n  const ordered = SKILL_SOURCE_GROUPS.map((group) => groups.get(group.id)).filter(\n    (group): group is SkillGroup => Boolean(group && group.skills.length > 0),\n  );\n  if (other.skills.length > 0) {\n    ordered.push(other);\n  }\n  return ordered;\n}\n\nfunction renderAgentSkills(params: {\n  agentId: string;\n  report: SkillStatusReport | null;\n  loading: boolean;\n  error: string | null;\n  activeAgentId: string | null;\n  configForm: Record<string, unknown> | null;\n  configLoading: boolean;\n  configSaving: boolean;\n  configDirty: boolean;\n  filter: string;\n  onFilterChange: (next: string) => void;\n  onRefresh: () => void;\n  onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\n  onClear: (agentId: string) => void;\n  onDisableAll: (agentId: string) => void;\n  onConfigReload: () => void;\n  onConfigSave: () => void;\n}) {\n  const editable = Boolean(params.configForm) && !params.configLoading && !params.configSaving;\n  const config = resolveAgentConfig(params.configForm, params.agentId);\n  const allowlist = Array.isArray(config.entry?.skills) ? config.entry?.skills : undefined;\n  const allowSet = new Set((allowlist ?? []).map((name) => name.trim()).filter(Boolean));\n  const usingAllowlist = allowlist !== undefined;\n  const reportReady = Boolean(params.report && params.activeAgentId === params.agentId);\n  const rawSkills = reportReady ? (params.report?.skills ?? []) : [];\n  const filter = params.filter.trim().toLowerCase();\n  const filtered = filter\n    ? rawSkills.filter((skill) =>\n        [skill.name, skill.description, skill.source].join(\" \").toLowerCase().includes(filter),\n      )\n    : rawSkills;\n  const groups = groupSkills(filtered);\n  const enabledCount = usingAllowlist\n    ? rawSkills.filter((skill) => allowSet.has(skill.name)).length\n    : rawSkills.length;\n  const totalCount = rawSkills.length;\n\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Skills</div>\n          <div class=\"card-sub\">\n            Per-agent skill allowlist and workspace skills.\n            ${totalCount > 0 ? html`<span class=\"mono\">${enabledCount}/${totalCount}</span>` : nothing}\n          </div>\n        </div>\n        <div class=\"row\" style=\"gap: 8px;\">\n          <button class=\"btn btn--sm\" ?disabled=${!editable} @click=${() => params.onClear(params.agentId)}>\n            Use All\n          </button>\n          <button class=\"btn btn--sm\" ?disabled=${!editable} @click=${() => params.onDisableAll(params.agentId)}>\n            Disable All\n          </button>\n          <button\n            class=\"btn btn--sm\"\n            ?disabled=${params.configLoading}\n            @click=${params.onConfigReload}\n          >\n            Reload Config\n          </button>\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\n            ${params.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n          </button>\n          <button\n            class=\"btn btn--sm primary\"\n            ?disabled=${params.configSaving || !params.configDirty}\n            @click=${params.onConfigSave}\n          >\n            ${params.configSaving ? \"Savingâ€¦\" : \"Save\"}\n          </button>\n        </div>\n      </div>\n\n      ${\n        !params.configForm\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                Load the gateway config to set per-agent skills.\n              </div>\n            `\n          : nothing\n      }\n      ${\n        usingAllowlist\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">This agent uses a custom skill allowlist.</div>\n            `\n          : html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                All skills are enabled. Disabling any skill will create a per-agent allowlist.\n              </div>\n            `\n      }\n      ${\n        !reportReady && !params.loading\n          ? html`\n              <div class=\"callout info\" style=\"margin-top: 12px\">\n                Load skills for this agent to view workspace-specific entries.\n              </div>\n            `\n          : nothing\n      }\n      ${\n        params.error\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\n          : nothing\n      }\n\n      <div class=\"filters\" style=\"margin-top: 14px;\">\n        <label class=\"field\" style=\"flex: 1;\">\n          <span>Filter</span>\n          <input\n            .value=${params.filter}\n            @input=${(e: Event) => params.onFilterChange((e.target as HTMLInputElement).value)}\n            placeholder=\"Search skills\"\n          />\n        </label>\n        <div class=\"muted\">${filtered.length} shown</div>\n      </div>\n\n      ${\n        filtered.length === 0\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 16px\">No skills found.</div>\n            `\n          : html`\n              <div class=\"agent-skills-groups\" style=\"margin-top: 16px;\">\n                ${groups.map((group) =>\n                  renderAgentSkillGroup(group, {\n                    agentId: params.agentId,\n                    allowSet,\n                    usingAllowlist,\n                    editable,\n                    onToggle: params.onToggle,\n                  }),\n                )}\n              </div>\n            `\n      }\n    </section>\n  `;\n}\n\nfunction renderAgentSkillGroup(\n  group: SkillGroup,\n  params: {\n    agentId: string;\n    allowSet: Set<string>;\n    usingAllowlist: boolean;\n    editable: boolean;\n    onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\n  },\n) {\n  const collapsedByDefault = group.id === \"workspace\" || group.id === \"built-in\";\n  return html`\n    <details class=\"agent-skills-group\" ?open=${!collapsedByDefault}>\n      <summary class=\"agent-skills-header\">\n        <span>${group.label}</span>\n        <span class=\"muted\">${group.skills.length}</span>\n      </summary>\n      <div class=\"list skills-grid\">\n        ${group.skills.map((skill) =>\n          renderAgentSkillRow(skill, {\n            agentId: params.agentId,\n            allowSet: params.allowSet,\n            usingAllowlist: params.usingAllowlist,\n            editable: params.editable,\n            onToggle: params.onToggle,\n          }),\n        )}\n      </div>\n    </details>\n  `;\n}\n\nfunction renderAgentSkillRow(\n  skill: SkillStatusEntry,\n  params: {\n    agentId: string;\n    allowSet: Set<string>;\n    usingAllowlist: boolean;\n    editable: boolean;\n    onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\n  },\n) {\n  const enabled = params.usingAllowlist ? params.allowSet.has(skill.name) : true;\n  const missing = [\n    ...skill.missing.bins.map((b) => `bin:${b}`),\n    ...skill.missing.env.map((e) => `env:${e}`),\n    ...skill.missing.config.map((c) => `config:${c}`),\n    ...skill.missing.os.map((o) => `os:${o}`),\n  ];\n  const reasons: string[] = [];\n  if (skill.disabled) {\n    reasons.push(\"disabled\");\n  }\n  if (skill.blockedByAllowlist) {\n    reasons.push(\"blocked by allowlist\");\n  }\n  return html`\n    <div class=\"list-item agent-skill-row\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">\n          ${skill.emoji ? `${skill.emoji} ` : \"\"}${skill.name}\n        </div>\n        <div class=\"list-sub\">${skill.description}</div>\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\n          <span class=\"chip\">${skill.source}</span>\n          <span class=\"chip ${skill.eligible ? \"chip-ok\" : \"chip-warn\"}\">\n            ${skill.eligible ? \"eligible\" : \"blocked\"}\n          </span>\n          ${\n            skill.disabled\n              ? html`\n                  <span class=\"chip chip-warn\">disabled</span>\n                `\n              : nothing\n          }\n        </div>\n        ${\n          missing.length > 0\n            ? html`<div class=\"muted\" style=\"margin-top: 6px;\">Missing: ${missing.join(\", \")}</div>`\n            : nothing\n        }\n        ${\n          reasons.length > 0\n            ? html`<div class=\"muted\" style=\"margin-top: 6px;\">Reason: ${reasons.join(\", \")}</div>`\n            : nothing\n        }\n      </div>\n      <div class=\"list-meta\">\n        <label class=\"cfg-toggle\">\n          <input\n            type=\"checkbox\"\n            .checked=${enabled}\n            ?disabled=${!params.editable}\n            @change=${(e: Event) =>\n              params.onToggle(params.agentId, skill.name, (e.target as HTMLInputElement).checked)}\n          />\n          <span class=\"cfg-toggle__track\"></span>\n        </label>\n      </div>\n    </div>\n  `;\n}\n","import type { ConfigUiHints } from \"../types\";\n\nexport type JsonSchema = {\n  type?: string | string[];\n  title?: string;\n  description?: string;\n  properties?: Record<string, JsonSchema>;\n  items?: JsonSchema | JsonSchema[];\n  additionalProperties?: JsonSchema | boolean;\n  enum?: unknown[];\n  const?: unknown;\n  default?: unknown;\n  anyOf?: JsonSchema[];\n  oneOf?: JsonSchema[];\n  allOf?: JsonSchema[];\n  nullable?: boolean;\n};\n\nexport function schemaType(schema: JsonSchema): string | undefined {\n  if (!schema) {\n    return undefined;\n  }\n  if (Array.isArray(schema.type)) {\n    const filtered = schema.type.filter((t) => t !== \"null\");\n    return filtered[0] ?? schema.type[0];\n  }\n  return schema.type;\n}\n\nexport function defaultValue(schema?: JsonSchema): unknown {\n  if (!schema) {\n    return \"\";\n  }\n  if (schema.default !== undefined) {\n    return schema.default;\n  }\n  const type = schemaType(schema);\n  switch (type) {\n    case \"object\":\n      return {};\n    case \"array\":\n      return [];\n    case \"boolean\":\n      return false;\n    case \"number\":\n    case \"integer\":\n      return 0;\n    case \"string\":\n      return \"\";\n    default:\n      return \"\";\n  }\n}\n\nexport function pathKey(path: Array<string | number>): string {\n  return path.filter((segment) => typeof segment === \"string\").join(\".\");\n}\n\nexport function hintForPath(path: Array<string | number>, hints: ConfigUiHints) {\n  const key = pathKey(path);\n  const direct = hints[key];\n  if (direct) {\n    return direct;\n  }\n  const segments = key.split(\".\");\n  for (const [hintKey, hint] of Object.entries(hints)) {\n    if (!hintKey.includes(\"*\")) {\n      continue;\n    }\n    const hintSegments = hintKey.split(\".\");\n    if (hintSegments.length !== segments.length) {\n      continue;\n    }\n    let match = true;\n    for (let i = 0; i < segments.length; i += 1) {\n      if (hintSegments[i] !== \"*\" && hintSegments[i] !== segments[i]) {\n        match = false;\n        break;\n      }\n    }\n    if (match) {\n      return hint;\n    }\n  }\n  return undefined;\n}\n\nexport function humanize(raw: string) {\n  return raw\n    .replace(/_/g, \" \")\n    .replace(/([a-z0-9])([A-Z])/g, \"$1 $2\")\n    .replace(/\\s+/g, \" \")\n    .replace(/^./, (m) => m.toUpperCase());\n}\n\nexport function isSensitivePath(path: Array<string | number>): boolean {\n  const key = pathKey(path).toLowerCase();\n  return (\n    key.includes(\"token\") ||\n    key.includes(\"password\") ||\n    key.includes(\"secret\") ||\n    key.includes(\"apikey\") ||\n    key.endsWith(\"key\")\n  );\n}\n","import { html, nothing, type TemplateResult } from \"lit\";\nimport type { ConfigUiHints } from \"../types\";\nimport {\n  defaultValue,\n  hintForPath,\n  humanize,\n  isSensitivePath,\n  pathKey,\n  schemaType,\n  type JsonSchema,\n} from \"./config-form.shared\";\n\nconst META_KEYS = new Set([\"title\", \"description\", \"default\", \"nullable\"]);\n\nfunction isAnySchema(schema: JsonSchema): boolean {\n  const keys = Object.keys(schema ?? {}).filter((key) => !META_KEYS.has(key));\n  return keys.length === 0;\n}\n\nfunction jsonValue(value: unknown): string {\n  if (value === undefined) {\n    return \"\";\n  }\n  try {\n    return JSON.stringify(value, null, 2) ?? \"\";\n  } catch {\n    return \"\";\n  }\n}\n\n// SVG Icons as template literals\nconst icons = {\n  chevronDown: html`\n    <svg\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <polyline points=\"6 9 12 15 18 9\"></polyline>\n    </svg>\n  `,\n  plus: html`\n    <svg\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\n      <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\n    </svg>\n  `,\n  minus: html`\n    <svg\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\n    </svg>\n  `,\n  trash: html`\n    <svg\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <polyline points=\"3 6 5 6 21 6\"></polyline>\n      <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path>\n    </svg>\n  `,\n  edit: html`\n    <svg\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    >\n      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n    </svg>\n  `,\n};\n\nexport function renderNode(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  unsupported: Set<string>;\n  disabled: boolean;\n  showLabel?: boolean;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult | typeof nothing {\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\n  const showLabel = params.showLabel ?? true;\n  const type = schemaType(schema);\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n  const key = pathKey(path);\n\n  if (unsupported.has(key)) {\n    return html`<div class=\"cfg-field cfg-field--error\">\n      <div class=\"cfg-field__label\">${label}</div>\n      <div class=\"cfg-field__error\">Unsupported schema node. Use Raw mode.</div>\n    </div>`;\n  }\n\n  // Handle anyOf/oneOf unions\n  if (schema.anyOf || schema.oneOf) {\n    const variants = schema.anyOf ?? schema.oneOf ?? [];\n    const nonNull = variants.filter(\n      (v) => !(v.type === \"null\" || (Array.isArray(v.type) && v.type.includes(\"null\"))),\n    );\n\n    if (nonNull.length === 1) {\n      return renderNode({ ...params, schema: nonNull[0] });\n    }\n\n    // Check if it's a set of literal values (enum-like)\n    const extractLiteral = (v: JsonSchema): unknown => {\n      if (v.const !== undefined) {\n        return v.const;\n      }\n      if (v.enum && v.enum.length === 1) {\n        return v.enum[0];\n      }\n      return undefined;\n    };\n    const literals = nonNull.map(extractLiteral);\n    const allLiterals = literals.every((v) => v !== undefined);\n\n    if (allLiterals && literals.length > 0 && literals.length <= 5) {\n      // Use segmented control for small sets\n      const resolvedValue = value ?? schema.default;\n      return html`\n        <div class=\"cfg-field\">\n          ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\n          ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\n          <div class=\"cfg-segmented\">\n            ${literals.map(\n              (lit) => html`\n              <button\n                type=\"button\"\n                class=\"cfg-segmented__btn ${\n                  // oxlint-disable typescript/no-base-to-string\n                  lit === resolvedValue || String(lit) === String(resolvedValue) ? \"active\" : \"\"\n                }\"\n                ?disabled=${disabled}\n                @click=${() => onPatch(path, lit)}\n              >\n                ${\n                  // oxlint-disable typescript/no-base-to-string\n                  String(lit)\n                }\n              </button>\n            `,\n            )}\n          </div>\n        </div>\n      `;\n    }\n\n    if (allLiterals && literals.length > 5) {\n      // Use dropdown for larger sets\n      return renderSelect({ ...params, options: literals, value: value ?? schema.default });\n    }\n\n    // Handle mixed primitive types\n    const primitiveTypes = new Set(nonNull.map((variant) => schemaType(variant)).filter(Boolean));\n    const normalizedTypes = new Set(\n      [...primitiveTypes].map((v) => (v === \"integer\" ? \"number\" : v)),\n    );\n\n    if ([...normalizedTypes].every((v) => [\"string\", \"number\", \"boolean\"].includes(v as string))) {\n      const hasString = normalizedTypes.has(\"string\");\n      const hasNumber = normalizedTypes.has(\"number\");\n      const hasBoolean = normalizedTypes.has(\"boolean\");\n\n      if (hasBoolean && normalizedTypes.size === 1) {\n        return renderNode({\n          ...params,\n          schema: { ...schema, type: \"boolean\", anyOf: undefined, oneOf: undefined },\n        });\n      }\n\n      if (hasString || hasNumber) {\n        return renderTextInput({\n          ...params,\n          inputType: hasNumber && !hasString ? \"number\" : \"text\",\n        });\n      }\n    }\n  }\n\n  // Enum - use segmented for small, dropdown for large\n  if (schema.enum) {\n    const options = schema.enum;\n    if (options.length <= 5) {\n      const resolvedValue = value ?? schema.default;\n      return html`\n        <div class=\"cfg-field\">\n          ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\n          ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\n          <div class=\"cfg-segmented\">\n            ${options.map(\n              (opt) => html`\n              <button\n                type=\"button\"\n                class=\"cfg-segmented__btn ${opt === resolvedValue || String(opt) === String(resolvedValue) ? \"active\" : \"\"}\"\n                ?disabled=${disabled}\n                @click=${() => onPatch(path, opt)}\n              >\n                ${String(opt)}\n              </button>\n            `,\n            )}\n          </div>\n        </div>\n      `;\n    }\n    return renderSelect({ ...params, options, value: value ?? schema.default });\n  }\n\n  // Object type - collapsible section\n  if (type === \"object\") {\n    return renderObject(params);\n  }\n\n  // Array type\n  if (type === \"array\") {\n    return renderArray(params);\n  }\n\n  // Boolean - toggle row\n  if (type === \"boolean\") {\n    const displayValue =\n      typeof value === \"boolean\"\n        ? value\n        : typeof schema.default === \"boolean\"\n          ? schema.default\n          : false;\n    return html`\n      <label class=\"cfg-toggle-row ${disabled ? \"disabled\" : \"\"}\">\n        <div class=\"cfg-toggle-row__content\">\n          <span class=\"cfg-toggle-row__label\">${label}</span>\n          ${help ? html`<span class=\"cfg-toggle-row__help\">${help}</span>` : nothing}\n        </div>\n        <div class=\"cfg-toggle\">\n          <input\n            type=\"checkbox\"\n            .checked=${displayValue}\n            ?disabled=${disabled}\n            @change=${(e: Event) => onPatch(path, (e.target as HTMLInputElement).checked)}\n          />\n          <span class=\"cfg-toggle__track\"></span>\n        </div>\n      </label>\n    `;\n  }\n\n  // Number/Integer\n  if (type === \"number\" || type === \"integer\") {\n    return renderNumberInput(params);\n  }\n\n  // String\n  if (type === \"string\") {\n    return renderTextInput({ ...params, inputType: \"text\" });\n  }\n\n  // Fallback\n  return html`\n    <div class=\"cfg-field cfg-field--error\">\n      <div class=\"cfg-field__label\">${label}</div>\n      <div class=\"cfg-field__error\">Unsupported type: ${type}. Use Raw mode.</div>\n    </div>\n  `;\n}\n\nfunction renderTextInput(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  disabled: boolean;\n  showLabel?: boolean;\n  inputType: \"text\" | \"number\";\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, disabled, onPatch, inputType } = params;\n  const showLabel = params.showLabel ?? true;\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n  const isSensitive = hint?.sensitive ?? isSensitivePath(path);\n  const placeholder =\n    hint?.placeholder ??\n    // oxlint-disable typescript/no-base-to-string\n    (isSensitive\n      ? \"â€¢â€¢â€¢â€¢\"\n      : schema.default !== undefined\n        ? `Default: ${String(schema.default)}`\n        : \"\");\n  const displayValue = value ?? \"\";\n\n  return html`\n    <div class=\"cfg-field\">\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\n      <div class=\"cfg-input-wrap\">\n        <input\n          type=${isSensitive ? \"password\" : inputType}\n          class=\"cfg-input\"\n          placeholder=${placeholder}\n          .value=${displayValue == null ? \"\" : String(displayValue)}\n          ?disabled=${disabled}\n          @input=${(e: Event) => {\n            const raw = (e.target as HTMLInputElement).value;\n            if (inputType === \"number\") {\n              if (raw.trim() === \"\") {\n                onPatch(path, undefined);\n                return;\n              }\n              const parsed = Number(raw);\n              onPatch(path, Number.isNaN(parsed) ? raw : parsed);\n              return;\n            }\n            onPatch(path, raw);\n          }}\n          @change=${(e: Event) => {\n            if (inputType === \"number\") {\n              return;\n            }\n            const raw = (e.target as HTMLInputElement).value;\n            onPatch(path, raw.trim());\n          }}\n        />\n        ${\n          schema.default !== undefined\n            ? html`\n          <button\n            type=\"button\"\n            class=\"cfg-input__reset\"\n            title=\"Reset to default\"\n            ?disabled=${disabled}\n            @click=${() => onPatch(path, schema.default)}\n          >â†º</button>\n        `\n            : nothing\n        }\n      </div>\n    </div>\n  `;\n}\n\nfunction renderNumberInput(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  disabled: boolean;\n  showLabel?: boolean;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, disabled, onPatch } = params;\n  const showLabel = params.showLabel ?? true;\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n  const displayValue = value ?? schema.default ?? \"\";\n  const numValue = typeof displayValue === \"number\" ? displayValue : 0;\n\n  return html`\n    <div class=\"cfg-field\">\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\n      <div class=\"cfg-number\">\n        <button\n          type=\"button\"\n          class=\"cfg-number__btn\"\n          ?disabled=${disabled}\n          @click=${() => onPatch(path, numValue - 1)}\n        >âˆ’</button>\n        <input\n          type=\"number\"\n          class=\"cfg-number__input\"\n          .value=${displayValue == null ? \"\" : String(displayValue)}\n          ?disabled=${disabled}\n          @input=${(e: Event) => {\n            const raw = (e.target as HTMLInputElement).value;\n            const parsed = raw === \"\" ? undefined : Number(raw);\n            onPatch(path, parsed);\n          }}\n        />\n        <button\n          type=\"button\"\n          class=\"cfg-number__btn\"\n          ?disabled=${disabled}\n          @click=${() => onPatch(path, numValue + 1)}\n        >+</button>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderSelect(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  disabled: boolean;\n  showLabel?: boolean;\n  options: unknown[];\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, disabled, options, onPatch } = params;\n  const showLabel = params.showLabel ?? true;\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n  const resolvedValue = value ?? schema.default;\n  const currentIndex = options.findIndex(\n    (opt) => opt === resolvedValue || String(opt) === String(resolvedValue),\n  );\n  const unset = \"__unset__\";\n\n  return html`\n    <div class=\"cfg-field\">\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\n      <select\n        class=\"cfg-select\"\n        ?disabled=${disabled}\n        .value=${currentIndex >= 0 ? String(currentIndex) : unset}\n        @change=${(e: Event) => {\n          const val = (e.target as HTMLSelectElement).value;\n          onPatch(path, val === unset ? undefined : options[Number(val)]);\n        }}\n      >\n        <option value=${unset}>Select...</option>\n        ${options.map(\n          (opt, idx) => html`\n          <option value=${String(idx)}>${String(opt)}</option>\n        `,\n        )}\n      </select>\n    </div>\n  `;\n}\n\nfunction renderObject(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  unsupported: Set<string>;\n  disabled: boolean;\n  showLabel?: boolean;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n\n  const fallback = value ?? schema.default;\n  const obj =\n    fallback && typeof fallback === \"object\" && !Array.isArray(fallback)\n      ? (fallback as Record<string, unknown>)\n      : {};\n  const props = schema.properties ?? {};\n  const entries = Object.entries(props);\n\n  // Sort by hint order\n  const sorted = entries.toSorted((a, b) => {\n    const orderA = hintForPath([...path, a[0]], hints)?.order ?? 0;\n    const orderB = hintForPath([...path, b[0]], hints)?.order ?? 0;\n    if (orderA !== orderB) {\n      return orderA - orderB;\n    }\n    return a[0].localeCompare(b[0]);\n  });\n\n  const reserved = new Set(Object.keys(props));\n  const additional = schema.additionalProperties;\n  const allowExtra = Boolean(additional) && typeof additional === \"object\";\n\n  // For top-level, don't wrap in collapsible\n  if (path.length === 1) {\n    return html`\n      <div class=\"cfg-fields\">\n        ${sorted.map(([propKey, node]) =>\n          renderNode({\n            schema: node,\n            value: obj[propKey],\n            path: [...path, propKey],\n            hints,\n            unsupported,\n            disabled,\n            onPatch,\n          }),\n        )}\n        ${\n          allowExtra\n            ? renderMapField({\n                schema: additional,\n                value: obj,\n                path,\n                hints,\n                unsupported,\n                disabled,\n                reservedKeys: reserved,\n                onPatch,\n              })\n            : nothing\n        }\n      </div>\n    `;\n  }\n\n  // Nested objects get collapsible treatment\n  return html`\n    <details class=\"cfg-object\" open>\n      <summary class=\"cfg-object__header\">\n        <span class=\"cfg-object__title\">${label}</span>\n        <span class=\"cfg-object__chevron\">${icons.chevronDown}</span>\n      </summary>\n      ${help ? html`<div class=\"cfg-object__help\">${help}</div>` : nothing}\n      <div class=\"cfg-object__content\">\n        ${sorted.map(([propKey, node]) =>\n          renderNode({\n            schema: node,\n            value: obj[propKey],\n            path: [...path, propKey],\n            hints,\n            unsupported,\n            disabled,\n            onPatch,\n          }),\n        )}\n        ${\n          allowExtra\n            ? renderMapField({\n                schema: additional,\n                value: obj,\n                path,\n                hints,\n                unsupported,\n                disabled,\n                reservedKeys: reserved,\n                onPatch,\n              })\n            : nothing\n        }\n      </div>\n    </details>\n  `;\n}\n\nfunction renderArray(params: {\n  schema: JsonSchema;\n  value: unknown;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  unsupported: Set<string>;\n  disabled: boolean;\n  showLabel?: boolean;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\n  const showLabel = params.showLabel ?? true;\n  const hint = hintForPath(path, hints);\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\n  const help = hint?.help ?? schema.description;\n\n  const itemsSchema = Array.isArray(schema.items) ? schema.items[0] : schema.items;\n  if (!itemsSchema) {\n    return html`\n      <div class=\"cfg-field cfg-field--error\">\n        <div class=\"cfg-field__label\">${label}</div>\n        <div class=\"cfg-field__error\">Unsupported array schema. Use Raw mode.</div>\n      </div>\n    `;\n  }\n\n  const arr = Array.isArray(value) ? value : Array.isArray(schema.default) ? schema.default : [];\n\n  return html`\n    <div class=\"cfg-array\">\n      <div class=\"cfg-array__header\">\n        ${showLabel ? html`<span class=\"cfg-array__label\">${label}</span>` : nothing}\n        <span class=\"cfg-array__count\">${arr.length} item${arr.length !== 1 ? \"s\" : \"\"}</span>\n        <button\n          type=\"button\"\n          class=\"cfg-array__add\"\n          ?disabled=${disabled}\n          @click=${() => {\n            const next = [...arr, defaultValue(itemsSchema)];\n            onPatch(path, next);\n          }}\n        >\n          <span class=\"cfg-array__add-icon\">${icons.plus}</span>\n          Add\n        </button>\n      </div>\n      ${help ? html`<div class=\"cfg-array__help\">${help}</div>` : nothing}\n\n      ${\n        arr.length === 0\n          ? html`\n              <div class=\"cfg-array__empty\">No items yet. Click \"Add\" to create one.</div>\n            `\n          : html`\n        <div class=\"cfg-array__items\">\n          ${arr.map(\n            (item, idx) => html`\n            <div class=\"cfg-array__item\">\n              <div class=\"cfg-array__item-header\">\n                <span class=\"cfg-array__item-index\">#${idx + 1}</span>\n                <button\n                  type=\"button\"\n                  class=\"cfg-array__item-remove\"\n                  title=\"Remove item\"\n                  ?disabled=${disabled}\n                  @click=${() => {\n                    const next = [...arr];\n                    next.splice(idx, 1);\n                    onPatch(path, next);\n                  }}\n                >\n                  ${icons.trash}\n                </button>\n              </div>\n              <div class=\"cfg-array__item-content\">\n                ${renderNode({\n                  schema: itemsSchema,\n                  value: item,\n                  path: [...path, idx],\n                  hints,\n                  unsupported,\n                  disabled,\n                  showLabel: false,\n                  onPatch,\n                })}\n              </div>\n            </div>\n          `,\n          )}\n        </div>\n      `\n      }\n    </div>\n  `;\n}\n\nfunction renderMapField(params: {\n  schema: JsonSchema;\n  value: Record<string, unknown>;\n  path: Array<string | number>;\n  hints: ConfigUiHints;\n  unsupported: Set<string>;\n  disabled: boolean;\n  reservedKeys: Set<string>;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n}): TemplateResult {\n  const { schema, value, path, hints, unsupported, disabled, reservedKeys, onPatch } = params;\n  const anySchema = isAnySchema(schema);\n  const entries = Object.entries(value ?? {}).filter(([key]) => !reservedKeys.has(key));\n\n  return html`\n    <div class=\"cfg-map\">\n      <div class=\"cfg-map__header\">\n        <span class=\"cfg-map__label\">Custom entries</span>\n        <button\n          type=\"button\"\n          class=\"cfg-map__add\"\n          ?disabled=${disabled}\n          @click=${() => {\n            const next = { ...value };\n            let index = 1;\n            let key = `custom-${index}`;\n            while (key in next) {\n              index += 1;\n              key = `custom-${index}`;\n            }\n            next[key] = anySchema ? {} : defaultValue(schema);\n            onPatch(path, next);\n          }}\n        >\n          <span class=\"cfg-map__add-icon\">${icons.plus}</span>\n          Add Entry\n        </button>\n      </div>\n\n      ${\n        entries.length === 0\n          ? html`\n              <div class=\"cfg-map__empty\">No custom entries.</div>\n            `\n          : html`\n        <div class=\"cfg-map__items\">\n          ${entries.map(([key, entryValue]) => {\n            const valuePath = [...path, key];\n            const fallback = jsonValue(entryValue);\n            return html`\n              <div class=\"cfg-map__item\">\n                <div class=\"cfg-map__item-key\">\n                  <input\n                    type=\"text\"\n                    class=\"cfg-input cfg-input--sm\"\n                    placeholder=\"Key\"\n                    .value=${key}\n                    ?disabled=${disabled}\n                    @change=${(e: Event) => {\n                      const nextKey = (e.target as HTMLInputElement).value.trim();\n                      if (!nextKey || nextKey === key) {\n                        return;\n                      }\n                      const next = { ...value };\n                      if (nextKey in next) {\n                        return;\n                      }\n                      next[nextKey] = next[key];\n                      delete next[key];\n                      onPatch(path, next);\n                    }}\n                  />\n                </div>\n                <div class=\"cfg-map__item-value\">\n                  ${\n                    anySchema\n                      ? html`\n                        <textarea\n                          class=\"cfg-textarea cfg-textarea--sm\"\n                          placeholder=\"JSON value\"\n                          rows=\"2\"\n                          .value=${fallback}\n                          ?disabled=${disabled}\n                          @change=${(e: Event) => {\n                            const target = e.target as HTMLTextAreaElement;\n                            const raw = target.value.trim();\n                            if (!raw) {\n                              onPatch(valuePath, undefined);\n                              return;\n                            }\n                            try {\n                              onPatch(valuePath, JSON.parse(raw));\n                            } catch {\n                              target.value = fallback;\n                            }\n                          }}\n                        ></textarea>\n                      `\n                      : renderNode({\n                          schema,\n                          value: entryValue,\n                          path: valuePath,\n                          hints,\n                          unsupported,\n                          disabled,\n                          showLabel: false,\n                          onPatch,\n                        })\n                  }\n                </div>\n                <button\n                  type=\"button\"\n                  class=\"cfg-map__item-remove\"\n                  title=\"Remove entry\"\n                  ?disabled=${disabled}\n                  @click=${() => {\n                    const next = { ...value };\n                    delete next[key];\n                    onPatch(path, next);\n                  }}\n                >\n                  ${icons.trash}\n                </button>\n              </div>\n            `;\n          })}\n        </div>\n      `\n      }\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { ConfigUiHints } from \"../types\";\nimport { icons } from \"../icons\";\nimport { renderNode } from \"./config-form.node\";\nimport { hintForPath, humanize, schemaType, type JsonSchema } from \"./config-form.shared\";\n\nexport type ConfigFormProps = {\n  schema: JsonSchema | null;\n  uiHints: ConfigUiHints;\n  value: Record<string, unknown> | null;\n  disabled?: boolean;\n  unsupportedPaths?: string[];\n  searchQuery?: string;\n  activeSection?: string | null;\n  activeSubsection?: string | null;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n};\n\n// SVG Icons for section cards (Lucide-style)\nconst sectionIcons = {\n  env: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n      <path\n        d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n      ></path>\n    </svg>\n  `,\n  update: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n      <polyline points=\"7 10 12 15 17 10\"></polyline>\n      <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n    </svg>\n  `,\n  agents: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path\n        d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"\n      ></path>\n      <circle cx=\"8\" cy=\"14\" r=\"1\"></circle>\n      <circle cx=\"16\" cy=\"14\" r=\"1\"></circle>\n    </svg>\n  `,\n  auth: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\n      <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\n    </svg>\n  `,\n  channels: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n    </svg>\n  `,\n  messages: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\n      <polyline points=\"22,6 12,13 2,6\"></polyline>\n    </svg>\n  `,\n  commands: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <polyline points=\"4 17 10 11 4 5\"></polyline>\n      <line x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"></line>\n    </svg>\n  `,\n  hooks: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\n    </svg>\n  `,\n  skills: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <polygon\n        points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"\n      ></polygon>\n    </svg>\n  `,\n  tools: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\n      ></path>\n    </svg>\n  `,\n  gateway: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\n      <path\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\n      ></path>\n    </svg>\n  `,\n  wizard: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M15 4V2\"></path>\n      <path d=\"M15 16v-2\"></path>\n      <path d=\"M8 9h2\"></path>\n      <path d=\"M20 9h2\"></path>\n      <path d=\"M17.8 11.8 19 13\"></path>\n      <path d=\"M15 9h0\"></path>\n      <path d=\"M17.8 6.2 19 5\"></path>\n      <path d=\"m3 21 9-9\"></path>\n      <path d=\"M12.2 6.2 11 5\"></path>\n    </svg>\n  `,\n  // Additional sections\n  meta: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M12 20h9\"></path>\n      <path d=\"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\"></path>\n    </svg>\n  `,\n  logging: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n      <polyline points=\"10 9 9 9 8 9\"></polyline>\n    </svg>\n  `,\n  browser: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\n      <line x1=\"21.17\" y1=\"8\" x2=\"12\" y2=\"8\"></line>\n      <line x1=\"3.95\" y1=\"6.06\" x2=\"8.54\" y2=\"14\"></line>\n      <line x1=\"10.88\" y1=\"21.94\" x2=\"15.46\" y2=\"14\"></line>\n    </svg>\n  `,\n  ui: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\n      <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\n    </svg>\n  `,\n  models: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path\n        d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"\n      ></path>\n      <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline>\n      <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line>\n    </svg>\n  `,\n  bindings: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\n      <rect x=\"2\" y=\"14\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\n      <line x1=\"6\" y1=\"6\" x2=\"6.01\" y2=\"6\"></line>\n      <line x1=\"6\" y1=\"18\" x2=\"6.01\" y2=\"18\"></line>\n    </svg>\n  `,\n  broadcast: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M4.9 19.1C1 15.2 1 8.8 4.9 4.9\"></path>\n      <path d=\"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5\"></path>\n      <circle cx=\"12\" cy=\"12\" r=\"2\"></circle>\n      <path d=\"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5\"></path>\n      <path d=\"M19.1 4.9C23 8.8 23 15.1 19.1 19\"></path>\n    </svg>\n  `,\n  audio: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M9 18V5l12-2v13\"></path>\n      <circle cx=\"6\" cy=\"18\" r=\"3\"></circle>\n      <circle cx=\"18\" cy=\"16\" r=\"3\"></circle>\n    </svg>\n  `,\n  session: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\n      <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\n      <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path>\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\n    </svg>\n  `,\n  cron: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <polyline points=\"12 6 12 12 16 14\"></polyline>\n    </svg>\n  `,\n  web: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\n      <path\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\n      ></path>\n    </svg>\n  `,\n  discovery: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n      <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\n    </svg>\n  `,\n  canvasHost: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n      <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\n      <polyline points=\"21 15 16 10 5 21\"></polyline>\n    </svg>\n  `,\n  talk: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"></path>\n      <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"></path>\n      <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"></line>\n      <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"></line>\n    </svg>\n  `,\n  plugins: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M12 2v6\"></path>\n      <path d=\"m4.93 10.93 4.24 4.24\"></path>\n      <path d=\"M2 12h6\"></path>\n      <path d=\"m4.93 13.07 4.24-4.24\"></path>\n      <path d=\"M12 22v-6\"></path>\n      <path d=\"m19.07 13.07-4.24-4.24\"></path>\n      <path d=\"M22 12h-6\"></path>\n      <path d=\"m19.07 10.93-4.24 4.24\"></path>\n    </svg>\n  `,\n  default: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\n    </svg>\n  `,\n};\n\n// Section metadata\nexport const SECTION_META: Record<string, { label: string; description: string }> = {\n  env: {\n    label: \"Environment Variables\",\n    description: \"Environment variables passed to the gateway process\",\n  },\n  update: { label: \"Updates\", description: \"Auto-update settings and release channel\" },\n  agents: { label: \"Agents\", description: \"Agent configurations, models, and identities\" },\n  auth: { label: \"Authentication\", description: \"API keys and authentication profiles\" },\n  channels: {\n    label: \"Channels\",\n    description: \"Messaging channels (Telegram, Discord, Slack, etc.)\",\n  },\n  messages: { label: \"Messages\", description: \"Message handling and routing settings\" },\n  commands: { label: \"Commands\", description: \"Custom slash commands\" },\n  hooks: { label: \"Hooks\", description: \"Webhooks and event hooks\" },\n  skills: { label: \"Skills\", description: \"Skill packs and capabilities\" },\n  tools: { label: \"Tools\", description: \"Tool configurations (browser, search, etc.)\" },\n  gateway: { label: \"Gateway\", description: \"Gateway server settings (port, auth, binding)\" },\n  wizard: { label: \"Setup Wizard\", description: \"Setup wizard state and history\" },\n  // Additional sections\n  meta: { label: \"Metadata\", description: \"Gateway metadata and version information\" },\n  logging: { label: \"Logging\", description: \"Log levels and output configuration\" },\n  browser: { label: \"Browser\", description: \"Browser automation settings\" },\n  ui: { label: \"UI\", description: \"User interface preferences\" },\n  models: { label: \"Models\", description: \"AI model configurations and providers\" },\n  bindings: { label: \"Bindings\", description: \"Key bindings and shortcuts\" },\n  broadcast: { label: \"Broadcast\", description: \"Broadcast and notification settings\" },\n  audio: { label: \"Audio\", description: \"Audio input/output settings\" },\n  session: { label: \"Session\", description: \"Session management and persistence\" },\n  cron: { label: \"Cron\", description: \"Scheduled tasks and automation\" },\n  web: { label: \"Web\", description: \"Web server and API settings\" },\n  discovery: { label: \"Discovery\", description: \"Service discovery and networking\" },\n  canvasHost: { label: \"Canvas Host\", description: \"Canvas rendering and display\" },\n  talk: { label: \"Talk\", description: \"Voice and speech settings\" },\n  plugins: { label: \"Plugins\", description: \"Plugin management and extensions\" },\n};\n\nfunction getSectionIcon(key: string) {\n  return sectionIcons[key as keyof typeof sectionIcons] ?? sectionIcons.default;\n}\n\nfunction matchesSearch(key: string, schema: JsonSchema, query: string): boolean {\n  if (!query) {\n    return true;\n  }\n  const q = query.toLowerCase();\n  const meta = SECTION_META[key];\n\n  // Check key name\n  if (key.toLowerCase().includes(q)) {\n    return true;\n  }\n\n  // Check label and description\n  if (meta) {\n    if (meta.label.toLowerCase().includes(q)) {\n      return true;\n    }\n    if (meta.description.toLowerCase().includes(q)) {\n      return true;\n    }\n  }\n\n  return schemaMatches(schema, q);\n}\n\nfunction schemaMatches(schema: JsonSchema, query: string): boolean {\n  if (schema.title?.toLowerCase().includes(query)) {\n    return true;\n  }\n  if (schema.description?.toLowerCase().includes(query)) {\n    return true;\n  }\n  if (schema.enum?.some((value) => String(value).toLowerCase().includes(query))) {\n    return true;\n  }\n\n  if (schema.properties) {\n    for (const [propKey, propSchema] of Object.entries(schema.properties)) {\n      if (propKey.toLowerCase().includes(query)) {\n        return true;\n      }\n      if (schemaMatches(propSchema, query)) {\n        return true;\n      }\n    }\n  }\n\n  if (schema.items) {\n    const items = Array.isArray(schema.items) ? schema.items : [schema.items];\n    for (const item of items) {\n      if (item && schemaMatches(item, query)) {\n        return true;\n      }\n    }\n  }\n\n  if (schema.additionalProperties && typeof schema.additionalProperties === \"object\") {\n    if (schemaMatches(schema.additionalProperties, query)) {\n      return true;\n    }\n  }\n\n  const unions = schema.anyOf ?? schema.oneOf ?? schema.allOf;\n  if (unions) {\n    for (const entry of unions) {\n      if (entry && schemaMatches(entry, query)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nexport function renderConfigForm(props: ConfigFormProps) {\n  if (!props.schema) {\n    return html`\n      <div class=\"muted\">Schema unavailable.</div>\n    `;\n  }\n  const schema = props.schema;\n  const value = props.value ?? {};\n  if (schemaType(schema) !== \"object\" || !schema.properties) {\n    return html`\n      <div class=\"callout danger\">Unsupported schema. Use Raw.</div>\n    `;\n  }\n  const unsupported = new Set(props.unsupportedPaths ?? []);\n  const properties = schema.properties;\n  const searchQuery = props.searchQuery ?? \"\";\n  const activeSection = props.activeSection;\n  const activeSubsection = props.activeSubsection ?? null;\n\n  const entries = Object.entries(properties).toSorted((a, b) => {\n    const orderA = hintForPath([a[0]], props.uiHints)?.order ?? 50;\n    const orderB = hintForPath([b[0]], props.uiHints)?.order ?? 50;\n    if (orderA !== orderB) {\n      return orderA - orderB;\n    }\n    return a[0].localeCompare(b[0]);\n  });\n\n  const filteredEntries = entries.filter(([key, node]) => {\n    if (activeSection && key !== activeSection) {\n      return false;\n    }\n    if (searchQuery && !matchesSearch(key, node, searchQuery)) {\n      return false;\n    }\n    return true;\n  });\n\n  let subsectionContext: { sectionKey: string; subsectionKey: string; schema: JsonSchema } | null =\n    null;\n  if (activeSection && activeSubsection && filteredEntries.length === 1) {\n    const sectionSchema = filteredEntries[0]?.[1];\n    if (\n      sectionSchema &&\n      schemaType(sectionSchema) === \"object\" &&\n      sectionSchema.properties &&\n      sectionSchema.properties[activeSubsection]\n    ) {\n      subsectionContext = {\n        sectionKey: activeSection,\n        subsectionKey: activeSubsection,\n        schema: sectionSchema.properties[activeSubsection],\n      };\n    }\n  }\n\n  if (filteredEntries.length === 0) {\n    return html`\n      <div class=\"config-empty\">\n        <div class=\"config-empty__icon\">${icons.search}</div>\n        <div class=\"config-empty__text\">\n          ${searchQuery ? `No settings match \"${searchQuery}\"` : \"No settings in this section\"}\n        </div>\n      </div>\n    `;\n  }\n\n  return html`\n    <div class=\"config-form config-form--modern\">\n      ${\n        subsectionContext\n          ? (() => {\n              const { sectionKey, subsectionKey, schema: node } = subsectionContext;\n              const hint = hintForPath([sectionKey, subsectionKey], props.uiHints);\n              const label = hint?.label ?? node.title ?? humanize(subsectionKey);\n              const description = hint?.help ?? node.description ?? \"\";\n              const sectionValue = value[sectionKey];\n              const scopedValue =\n                sectionValue && typeof sectionValue === \"object\"\n                  ? (sectionValue as Record<string, unknown>)[subsectionKey]\n                  : undefined;\n              const id = `config-section-${sectionKey}-${subsectionKey}`;\n              return html`\n              <section class=\"config-section-card\" id=${id}>\n                <div class=\"config-section-card__header\">\n                  <span class=\"config-section-card__icon\">${getSectionIcon(sectionKey)}</span>\n                  <div class=\"config-section-card__titles\">\n                    <h3 class=\"config-section-card__title\">${label}</h3>\n                    ${\n                      description\n                        ? html`<p class=\"config-section-card__desc\">${description}</p>`\n                        : nothing\n                    }\n                  </div>\n                </div>\n                <div class=\"config-section-card__content\">\n                  ${renderNode({\n                    schema: node,\n                    value: scopedValue,\n                    path: [sectionKey, subsectionKey],\n                    hints: props.uiHints,\n                    unsupported,\n                    disabled: props.disabled ?? false,\n                    showLabel: false,\n                    onPatch: props.onPatch,\n                  })}\n                </div>\n              </section>\n            `;\n            })()\n          : filteredEntries.map(([key, node]) => {\n              const meta = SECTION_META[key] ?? {\n                label: key.charAt(0).toUpperCase() + key.slice(1),\n                description: node.description ?? \"\",\n              };\n\n              return html`\n              <section class=\"config-section-card\" id=\"config-section-${key}\">\n                <div class=\"config-section-card__header\">\n                  <span class=\"config-section-card__icon\">${getSectionIcon(key)}</span>\n                  <div class=\"config-section-card__titles\">\n                    <h3 class=\"config-section-card__title\">${meta.label}</h3>\n                    ${\n                      meta.description\n                        ? html`<p class=\"config-section-card__desc\">${meta.description}</p>`\n                        : nothing\n                    }\n                  </div>\n                </div>\n                <div class=\"config-section-card__content\">\n                  ${renderNode({\n                    schema: node,\n                    value: value[key],\n                    path: [key],\n                    hints: props.uiHints,\n                    unsupported,\n                    disabled: props.disabled ?? false,\n                    showLabel: false,\n                    onPatch: props.onPatch,\n                  })}\n                </div>\n              </section>\n            `;\n            })\n      }\n    </div>\n  `;\n}\n","import { pathKey, schemaType, type JsonSchema } from \"./config-form.shared\";\n\nexport type ConfigSchemaAnalysis = {\n  schema: JsonSchema | null;\n  unsupportedPaths: string[];\n};\n\nconst META_KEYS = new Set([\"title\", \"description\", \"default\", \"nullable\"]);\n\nfunction isAnySchema(schema: JsonSchema): boolean {\n  const keys = Object.keys(schema ?? {}).filter((key) => !META_KEYS.has(key));\n  return keys.length === 0;\n}\n\nfunction normalizeEnum(values: unknown[]): { enumValues: unknown[]; nullable: boolean } {\n  const filtered = values.filter((value) => value != null);\n  const nullable = filtered.length !== values.length;\n  const enumValues: unknown[] = [];\n  for (const value of filtered) {\n    if (!enumValues.some((existing) => Object.is(existing, value))) {\n      enumValues.push(value);\n    }\n  }\n  return { enumValues, nullable };\n}\n\nexport function analyzeConfigSchema(raw: unknown): ConfigSchemaAnalysis {\n  if (!raw || typeof raw !== \"object\") {\n    return { schema: null, unsupportedPaths: [\"<root>\"] };\n  }\n  return normalizeSchemaNode(raw as JsonSchema, []);\n}\n\nfunction normalizeSchemaNode(\n  schema: JsonSchema,\n  path: Array<string | number>,\n): ConfigSchemaAnalysis {\n  const unsupported = new Set<string>();\n  const normalized: JsonSchema = { ...schema };\n  const pathLabel = pathKey(path) || \"<root>\";\n\n  if (schema.anyOf || schema.oneOf || schema.allOf) {\n    const union = normalizeUnion(schema, path);\n    if (union) {\n      return union;\n    }\n    return { schema, unsupportedPaths: [pathLabel] };\n  }\n\n  const nullable = Array.isArray(schema.type) && schema.type.includes(\"null\");\n  const type =\n    schemaType(schema) ?? (schema.properties || schema.additionalProperties ? \"object\" : undefined);\n  normalized.type = type ?? schema.type;\n  normalized.nullable = nullable || schema.nullable;\n\n  if (normalized.enum) {\n    const { enumValues, nullable: enumNullable } = normalizeEnum(normalized.enum);\n    normalized.enum = enumValues;\n    if (enumNullable) {\n      normalized.nullable = true;\n    }\n    if (enumValues.length === 0) {\n      unsupported.add(pathLabel);\n    }\n  }\n\n  if (type === \"object\") {\n    const properties = schema.properties ?? {};\n    const normalizedProps: Record<string, JsonSchema> = {};\n    for (const [key, value] of Object.entries(properties)) {\n      const res = normalizeSchemaNode(value, [...path, key]);\n      if (res.schema) {\n        normalizedProps[key] = res.schema;\n      }\n      for (const entry of res.unsupportedPaths) {\n        unsupported.add(entry);\n      }\n    }\n    normalized.properties = normalizedProps;\n\n    if (schema.additionalProperties === true) {\n      unsupported.add(pathLabel);\n    } else if (schema.additionalProperties === false) {\n      normalized.additionalProperties = false;\n    } else if (schema.additionalProperties && typeof schema.additionalProperties === \"object\") {\n      if (!isAnySchema(schema.additionalProperties)) {\n        const res = normalizeSchemaNode(schema.additionalProperties, [...path, \"*\"]);\n        normalized.additionalProperties = res.schema ?? schema.additionalProperties;\n        if (res.unsupportedPaths.length > 0) {\n          unsupported.add(pathLabel);\n        }\n      }\n    }\n  } else if (type === \"array\") {\n    const itemsSchema = Array.isArray(schema.items) ? schema.items[0] : schema.items;\n    if (!itemsSchema) {\n      unsupported.add(pathLabel);\n    } else {\n      const res = normalizeSchemaNode(itemsSchema, [...path, \"*\"]);\n      normalized.items = res.schema ?? itemsSchema;\n      if (res.unsupportedPaths.length > 0) {\n        unsupported.add(pathLabel);\n      }\n    }\n  } else if (\n    type !== \"string\" &&\n    type !== \"number\" &&\n    type !== \"integer\" &&\n    type !== \"boolean\" &&\n    !normalized.enum\n  ) {\n    unsupported.add(pathLabel);\n  }\n\n  return {\n    schema: normalized,\n    unsupportedPaths: Array.from(unsupported),\n  };\n}\n\nfunction normalizeUnion(\n  schema: JsonSchema,\n  path: Array<string | number>,\n): ConfigSchemaAnalysis | null {\n  if (schema.allOf) {\n    return null;\n  }\n  const union = schema.anyOf ?? schema.oneOf;\n  if (!union) {\n    return null;\n  }\n\n  const literals: unknown[] = [];\n  const remaining: JsonSchema[] = [];\n  let nullable = false;\n\n  for (const entry of union) {\n    if (!entry || typeof entry !== \"object\") {\n      return null;\n    }\n    if (Array.isArray(entry.enum)) {\n      const { enumValues, nullable: enumNullable } = normalizeEnum(entry.enum);\n      literals.push(...enumValues);\n      if (enumNullable) {\n        nullable = true;\n      }\n      continue;\n    }\n    if (\"const\" in entry) {\n      if (entry.const == null) {\n        nullable = true;\n        continue;\n      }\n      literals.push(entry.const);\n      continue;\n    }\n    if (schemaType(entry) === \"null\") {\n      nullable = true;\n      continue;\n    }\n    remaining.push(entry);\n  }\n\n  if (literals.length > 0 && remaining.length === 0) {\n    const unique: unknown[] = [];\n    for (const value of literals) {\n      if (!unique.some((existing) => Object.is(existing, value))) {\n        unique.push(value);\n      }\n    }\n    return {\n      schema: {\n        ...schema,\n        enum: unique,\n        nullable,\n        anyOf: undefined,\n        oneOf: undefined,\n        allOf: undefined,\n      },\n      unsupportedPaths: [],\n    };\n  }\n\n  if (remaining.length === 1) {\n    const res = normalizeSchemaNode(remaining[0], path);\n    if (res.schema) {\n      res.schema.nullable = nullable || res.schema.nullable;\n    }\n    return res;\n  }\n\n  const primitiveTypes = new Set([\"string\", \"number\", \"integer\", \"boolean\"]);\n  if (\n    remaining.length > 0 &&\n    literals.length === 0 &&\n    remaining.every((entry) => entry.type && primitiveTypes.has(String(entry.type)))\n  ) {\n    return {\n      schema: {\n        ...schema,\n        nullable,\n      },\n      unsupportedPaths: [],\n    };\n  }\n\n  return null;\n}\n","import { html } from \"lit\";\nimport type { ConfigUiHints } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { analyzeConfigSchema, renderNode, schemaType, type JsonSchema } from \"./config-form\";\n\ntype ChannelConfigFormProps = {\n  channelId: string;\n  configValue: Record<string, unknown> | null;\n  schema: unknown;\n  uiHints: ConfigUiHints;\n  disabled: boolean;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n};\n\nfunction resolveSchemaNode(\n  schema: JsonSchema | null,\n  path: Array<string | number>,\n): JsonSchema | null {\n  let current = schema;\n  for (const key of path) {\n    if (!current) {\n      return null;\n    }\n    const type = schemaType(current);\n    if (type === \"object\") {\n      const properties = current.properties ?? {};\n      if (typeof key === \"string\" && properties[key]) {\n        current = properties[key];\n        continue;\n      }\n      const additional = current.additionalProperties;\n      if (typeof key === \"string\" && additional && typeof additional === \"object\") {\n        current = additional;\n        continue;\n      }\n      return null;\n    }\n    if (type === \"array\") {\n      if (typeof key !== \"number\") {\n        return null;\n      }\n      const items = Array.isArray(current.items) ? current.items[0] : current.items;\n      current = items ?? null;\n      continue;\n    }\n    return null;\n  }\n  return current;\n}\n\nfunction resolveChannelValue(\n  config: Record<string, unknown>,\n  channelId: string,\n): Record<string, unknown> {\n  const channels = (config.channels ?? {}) as Record<string, unknown>;\n  const fromChannels = channels[channelId];\n  const fallback = config[channelId];\n  const resolved =\n    (fromChannels && typeof fromChannels === \"object\"\n      ? (fromChannels as Record<string, unknown>)\n      : null) ??\n    (fallback && typeof fallback === \"object\" ? (fallback as Record<string, unknown>) : null);\n  return resolved ?? {};\n}\n\nconst EXTRA_CHANNEL_FIELDS = [\"groupPolicy\", \"streamMode\", \"dmPolicy\"] as const;\n\nfunction formatExtraValue(raw: unknown): string {\n  if (raw == null) {\n    return \"n/a\";\n  }\n  if (typeof raw === \"string\" || typeof raw === \"number\" || typeof raw === \"boolean\") {\n    return String(raw);\n  }\n  try {\n    return JSON.stringify(raw);\n  } catch {\n    return \"n/a\";\n  }\n}\n\nfunction renderExtraChannelFields(value: Record<string, unknown>) {\n  const entries = EXTRA_CHANNEL_FIELDS.flatMap((field) => {\n    if (!(field in value)) {\n      return [];\n    }\n    return [[field, value[field]]] as Array<[string, unknown]>;\n  });\n  if (entries.length === 0) {\n    return null;\n  }\n  return html`\n    <div class=\"status-list\" style=\"margin-top: 12px;\">\n      ${entries.map(\n        ([field, raw]) => html`\n          <div>\n            <span class=\"label\">${field}</span>\n            <span>${formatExtraValue(raw)}</span>\n          </div>\n        `,\n      )}\n    </div>\n  `;\n}\n\nexport function renderChannelConfigForm(props: ChannelConfigFormProps) {\n  const analysis = analyzeConfigSchema(props.schema);\n  const normalized = analysis.schema;\n  if (!normalized) {\n    return html`\n      <div class=\"callout danger\">Schema unavailable. Use Raw.</div>\n    `;\n  }\n  const node = resolveSchemaNode(normalized, [\"channels\", props.channelId]);\n  if (!node) {\n    return html`\n      <div class=\"callout danger\">Channel config schema unavailable.</div>\n    `;\n  }\n  const configValue = props.configValue ?? {};\n  const value = resolveChannelValue(configValue, props.channelId);\n  return html`\n    <div class=\"config-form\">\n      ${renderNode({\n        schema: node,\n        value,\n        path: [\"channels\", props.channelId],\n        hints: props.uiHints,\n        unsupported: new Set(analysis.unsupportedPaths),\n        disabled: props.disabled,\n        showLabel: false,\n        onPatch: props.onPatch,\n      })}\n    </div>\n    ${renderExtraChannelFields(value)}\n  `;\n}\n\nexport function renderChannelConfigSection(params: { channelId: string; props: ChannelsProps }) {\n  const { channelId, props } = params;\n  const disabled = props.configSaving || props.configSchemaLoading;\n  return html`\n    <div style=\"margin-top: 16px;\">\n      ${\n        props.configSchemaLoading\n          ? html`\n              <div class=\"muted\">Loading config schemaâ€¦</div>\n            `\n          : renderChannelConfigForm({\n              channelId,\n              configValue: props.configForm,\n              schema: props.configSchema,\n              uiHints: props.configUiHints,\n              disabled,\n              onPatch: props.onConfigPatch,\n            })\n      }\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button\n          class=\"btn primary\"\n          ?disabled=${disabled || !props.configFormDirty}\n          @click=${() => props.onConfigSave()}\n        >\n          ${props.configSaving ? \"Savingâ€¦\" : \"Save\"}\n        </button>\n        <button\n          class=\"btn\"\n          ?disabled=${disabled}\n          @click=${() => props.onConfigReload()}\n        >\n          Reload\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { DiscordStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderDiscordCard(params: {\n  props: ChannelsProps;\n  discord?: DiscordStatus | null;\n  accountCountLabel: unknown;\n}) {\n  const { props, discord, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Discord</div>\n      <div class=\"card-sub\">Bot status and channel configuration.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${discord?.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${discord?.running ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last start</span>\n          <span>${discord?.lastStartAt ? formatAgo(discord.lastStartAt) : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last probe</span>\n          <span>${discord?.lastProbeAt ? formatAgo(discord.lastProbeAt) : \"n/a\"}</span>\n        </div>\n      </div>\n\n      ${\n        discord?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${discord.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        discord?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${discord.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${discord.probe.status ?? \"\"} ${discord.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"discord\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { GoogleChatStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderGoogleChatCard(params: {\n  props: ChannelsProps;\n  googleChat?: GoogleChatStatus | null;\n  accountCountLabel: unknown;\n}) {\n  const { props, googleChat, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Google Chat</div>\n      <div class=\"card-sub\">Chat API webhook status and channel configuration.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${googleChat ? (googleChat.configured ? \"Yes\" : \"No\") : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${googleChat ? (googleChat.running ? \"Yes\" : \"No\") : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Credential</span>\n          <span>${googleChat?.credentialSource ?? \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Audience</span>\n          <span>\n            ${\n              googleChat?.audienceType\n                ? `${googleChat.audienceType}${googleChat.audience ? ` Â· ${googleChat.audience}` : \"\"}`\n                : \"n/a\"\n            }\n          </span>\n        </div>\n        <div>\n          <span class=\"label\">Last start</span>\n          <span>${googleChat?.lastStartAt ? formatAgo(googleChat.lastStartAt) : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last probe</span>\n          <span>${googleChat?.lastProbeAt ? formatAgo(googleChat.lastProbeAt) : \"n/a\"}</span>\n        </div>\n      </div>\n\n      ${\n        googleChat?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${googleChat.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        googleChat?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${googleChat.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${googleChat.probe.status ?? \"\"} ${googleChat.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"googlechat\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { IMessageStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderIMessageCard(params: {\n  props: ChannelsProps;\n  imessage?: IMessageStatus | null;\n  accountCountLabel: unknown;\n}) {\n  const { props, imessage, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">iMessage</div>\n      <div class=\"card-sub\">macOS bridge status and channel configuration.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${imessage?.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${imessage?.running ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last start</span>\n          <span>${imessage?.lastStartAt ? formatAgo(imessage.lastStartAt) : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last probe</span>\n          <span>${imessage?.lastProbeAt ? formatAgo(imessage.lastProbeAt) : \"n/a\"}</span>\n        </div>\n      </div>\n\n      ${\n        imessage?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${imessage.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        imessage?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${imessage.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${imessage.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"imessage\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { ChannelAccountSnapshot, NostrStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\nimport {\n  renderNostrProfileForm,\n  type NostrProfileFormState,\n  type NostrProfileFormCallbacks,\n} from \"./channels.nostr-profile-form\";\n\n/**\n * Truncate a pubkey for display (shows first and last 8 chars)\n */\nfunction truncatePubkey(pubkey: string | null | undefined): string {\n  if (!pubkey) {\n    return \"n/a\";\n  }\n  if (pubkey.length <= 20) {\n    return pubkey;\n  }\n  return `${pubkey.slice(0, 8)}...${pubkey.slice(-8)}`;\n}\n\nexport function renderNostrCard(params: {\n  props: ChannelsProps;\n  nostr?: NostrStatus | null;\n  nostrAccounts: ChannelAccountSnapshot[];\n  accountCountLabel: unknown;\n  /** Profile form state (optional - if provided, shows form) */\n  profileFormState?: NostrProfileFormState | null;\n  /** Profile form callbacks */\n  profileFormCallbacks?: NostrProfileFormCallbacks | null;\n  /** Called when Edit Profile is clicked */\n  onEditProfile?: () => void;\n}) {\n  const {\n    props,\n    nostr,\n    nostrAccounts,\n    accountCountLabel,\n    profileFormState,\n    profileFormCallbacks,\n    onEditProfile,\n  } = params;\n  const primaryAccount = nostrAccounts[0];\n  const summaryConfigured = nostr?.configured ?? primaryAccount?.configured ?? false;\n  const summaryRunning = nostr?.running ?? primaryAccount?.running ?? false;\n  const summaryPublicKey =\n    nostr?.publicKey ?? (primaryAccount as { publicKey?: string } | undefined)?.publicKey;\n  const summaryLastStartAt = nostr?.lastStartAt ?? primaryAccount?.lastStartAt ?? null;\n  const summaryLastError = nostr?.lastError ?? primaryAccount?.lastError ?? null;\n  const hasMultipleAccounts = nostrAccounts.length > 1;\n  const showingForm = profileFormState !== null && profileFormState !== undefined;\n\n  const renderAccountCard = (account: ChannelAccountSnapshot) => {\n    const publicKey = (account as { publicKey?: string }).publicKey;\n    const profile = (account as { profile?: { name?: string; displayName?: string } }).profile;\n    const displayName = profile?.displayName ?? profile?.name ?? account.name ?? account.accountId;\n\n    return html`\n      <div class=\"account-card\">\n        <div class=\"account-card-header\">\n          <div class=\"account-card-title\">${displayName}</div>\n          <div class=\"account-card-id\">${account.accountId}</div>\n        </div>\n        <div class=\"status-list account-card-status\">\n          <div>\n            <span class=\"label\">Running</span>\n            <span>${account.running ? \"Yes\" : \"No\"}</span>\n          </div>\n          <div>\n            <span class=\"label\">Configured</span>\n            <span>${account.configured ? \"Yes\" : \"No\"}</span>\n          </div>\n          <div>\n            <span class=\"label\">Public Key</span>\n            <span class=\"monospace\" title=\"${publicKey ?? \"\"}\">${truncatePubkey(publicKey)}</span>\n          </div>\n          <div>\n            <span class=\"label\">Last inbound</span>\n            <span>${account.lastInboundAt ? formatAgo(account.lastInboundAt) : \"n/a\"}</span>\n          </div>\n          ${\n            account.lastError\n              ? html`\n                <div class=\"account-card-error\">${account.lastError}</div>\n              `\n              : nothing\n          }\n        </div>\n      </div>\n    `;\n  };\n\n  const renderProfileSection = () => {\n    // If showing form, render the form instead of the read-only view\n    if (showingForm && profileFormCallbacks) {\n      return renderNostrProfileForm({\n        state: profileFormState,\n        callbacks: profileFormCallbacks,\n        accountId: nostrAccounts[0]?.accountId ?? \"default\",\n      });\n    }\n\n    const profile =\n      (\n        primaryAccount as\n          | {\n              profile?: {\n                name?: string;\n                displayName?: string;\n                about?: string;\n                picture?: string;\n                nip05?: string;\n              };\n            }\n          | undefined\n      )?.profile ?? nostr?.profile;\n    const { name, displayName, about, picture, nip05 } = profile ?? {};\n    const hasAnyProfileData = name || displayName || about || picture || nip05;\n\n    return html`\n      <div style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n          <div style=\"font-weight: 500;\">Profile</div>\n          ${\n            summaryConfigured\n              ? html`\n                <button\n                  class=\"btn btn-sm\"\n                  @click=${onEditProfile}\n                  style=\"font-size: 12px; padding: 4px 8px;\"\n                >\n                  Edit Profile\n                </button>\n              `\n              : nothing\n          }\n        </div>\n        ${\n          hasAnyProfileData\n            ? html`\n              <div class=\"status-list\">\n                ${\n                  picture\n                    ? html`\n                      <div style=\"margin-bottom: 8px;\">\n                        <img\n                          src=${picture}\n                          alt=\"Profile picture\"\n                          style=\"width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color);\"\n                          @error=${(e: Event) => {\n                            (e.target as HTMLImageElement).style.display = \"none\";\n                          }}\n                        />\n                      </div>\n                    `\n                    : nothing\n                }\n                ${name ? html`<div><span class=\"label\">Name</span><span>${name}</span></div>` : nothing}\n                ${\n                  displayName\n                    ? html`<div><span class=\"label\">Display Name</span><span>${displayName}</span></div>`\n                    : nothing\n                }\n                ${\n                  about\n                    ? html`<div><span class=\"label\">About</span><span style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis;\">${about}</span></div>`\n                    : nothing\n                }\n                ${nip05 ? html`<div><span class=\"label\">NIP-05</span><span>${nip05}</span></div>` : nothing}\n              </div>\n            `\n            : html`\n                <div style=\"color: var(--text-muted); font-size: 13px\">\n                  No profile set. Click \"Edit Profile\" to add your name, bio, and avatar.\n                </div>\n              `\n        }\n      </div>\n    `;\n  };\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Nostr</div>\n      <div class=\"card-sub\">Decentralized DMs via Nostr relays (NIP-04).</div>\n      ${accountCountLabel}\n\n      ${\n        hasMultipleAccounts\n          ? html`\n            <div class=\"account-card-list\">\n              ${nostrAccounts.map((account) => renderAccountCard(account))}\n            </div>\n          `\n          : html`\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\n              <div>\n                <span class=\"label\">Configured</span>\n                <span>${summaryConfigured ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Running</span>\n                <span>${summaryRunning ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Public Key</span>\n                <span class=\"monospace\" title=\"${summaryPublicKey ?? \"\"}\"\n                  >${truncatePubkey(summaryPublicKey)}</span\n                >\n              </div>\n              <div>\n                <span class=\"label\">Last start</span>\n                <span>${summaryLastStartAt ? formatAgo(summaryLastStartAt) : \"n/a\"}</span>\n              </div>\n            </div>\n          `\n      }\n\n      ${\n        summaryLastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${summaryLastError}</div>`\n          : nothing\n      }\n\n      ${renderProfileSection()}\n\n      ${renderChannelConfigSection({ channelId: \"nostr\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(false)}>Refresh</button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { ChannelAccountSnapshot } from \"../types\";\nimport type { ChannelKey, ChannelsProps } from \"./channels.types\";\n\nexport function formatDuration(ms?: number | null) {\n  if (!ms && ms !== 0) {\n    return \"n/a\";\n  }\n  const sec = Math.round(ms / 1000);\n  if (sec < 60) {\n    return `${sec}s`;\n  }\n  const min = Math.round(sec / 60);\n  if (min < 60) {\n    return `${min}m`;\n  }\n  const hr = Math.round(min / 60);\n  return `${hr}h`;\n}\n\nexport function channelEnabled(key: ChannelKey, props: ChannelsProps) {\n  const snapshot = props.snapshot;\n  const channels = snapshot?.channels as Record<string, unknown> | null;\n  if (!snapshot || !channels) {\n    return false;\n  }\n  const channelStatus = channels[key] as Record<string, unknown> | undefined;\n  const configured = typeof channelStatus?.configured === \"boolean\" && channelStatus.configured;\n  const running = typeof channelStatus?.running === \"boolean\" && channelStatus.running;\n  const connected = typeof channelStatus?.connected === \"boolean\" && channelStatus.connected;\n  const accounts = snapshot.channelAccounts?.[key] ?? [];\n  const accountActive = accounts.some(\n    (account) => account.configured || account.running || account.connected,\n  );\n  return configured || running || connected || accountActive;\n}\n\nexport function getChannelAccountCount(\n  key: ChannelKey,\n  channelAccounts?: Record<string, ChannelAccountSnapshot[]> | null,\n): number {\n  return channelAccounts?.[key]?.length ?? 0;\n}\n\nexport function renderChannelAccountCount(\n  key: ChannelKey,\n  channelAccounts?: Record<string, ChannelAccountSnapshot[]> | null,\n) {\n  const count = getChannelAccountCount(key, channelAccounts);\n  if (count < 2) {\n    return nothing;\n  }\n  return html`<div class=\"account-count\">Accounts (${count})</div>`;\n}\n","import { html, nothing } from \"lit\";\nimport type { SignalStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderSignalCard(params: {\n  props: ChannelsProps;\n  signal?: SignalStatus | null;\n  accountCountLabel: unknown;\n}) {\n  const { props, signal, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Signal</div>\n      <div class=\"card-sub\">signal-cli status and channel configuration.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${signal?.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${signal?.running ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Base URL</span>\n          <span>${signal?.baseUrl ?? \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last start</span>\n          <span>${signal?.lastStartAt ? formatAgo(signal.lastStartAt) : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last probe</span>\n          <span>${signal?.lastProbeAt ? formatAgo(signal.lastProbeAt) : \"n/a\"}</span>\n        </div>\n      </div>\n\n      ${\n        signal?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${signal.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        signal?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${signal.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${signal.probe.status ?? \"\"} ${signal.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"signal\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { SlackStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderSlackCard(params: {\n  props: ChannelsProps;\n  slack?: SlackStatus | null;\n  accountCountLabel: unknown;\n}) {\n  const { props, slack, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Slack</div>\n      <div class=\"card-sub\">Socket mode status and channel configuration.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${slack?.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${slack?.running ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last start</span>\n          <span>${slack?.lastStartAt ? formatAgo(slack.lastStartAt) : \"n/a\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last probe</span>\n          <span>${slack?.lastProbeAt ? formatAgo(slack.lastProbeAt) : \"n/a\"}</span>\n        </div>\n      </div>\n\n      ${\n        slack?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${slack.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        slack?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${slack.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${slack.probe.status ?? \"\"} ${slack.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"slack\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { ChannelAccountSnapshot, TelegramStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\n\nexport function renderTelegramCard(params: {\n  props: ChannelsProps;\n  telegram?: TelegramStatus;\n  telegramAccounts: ChannelAccountSnapshot[];\n  accountCountLabel: unknown;\n}) {\n  const { props, telegram, telegramAccounts, accountCountLabel } = params;\n  const hasMultipleAccounts = telegramAccounts.length > 1;\n\n  const renderAccountCard = (account: ChannelAccountSnapshot) => {\n    const probe = account.probe as { bot?: { username?: string } } | undefined;\n    const botUsername = probe?.bot?.username;\n    const label = account.name || account.accountId;\n    return html`\n      <div class=\"account-card\">\n        <div class=\"account-card-header\">\n          <div class=\"account-card-title\">\n            ${botUsername ? `@${botUsername}` : label}\n          </div>\n          <div class=\"account-card-id\">${account.accountId}</div>\n        </div>\n        <div class=\"status-list account-card-status\">\n          <div>\n            <span class=\"label\">Running</span>\n            <span>${account.running ? \"Yes\" : \"No\"}</span>\n          </div>\n          <div>\n            <span class=\"label\">Configured</span>\n            <span>${account.configured ? \"Yes\" : \"No\"}</span>\n          </div>\n          <div>\n            <span class=\"label\">Last inbound</span>\n            <span>${account.lastInboundAt ? formatAgo(account.lastInboundAt) : \"n/a\"}</span>\n          </div>\n          ${\n            account.lastError\n              ? html`\n                <div class=\"account-card-error\">\n                  ${account.lastError}\n                </div>\n              `\n              : nothing\n          }\n        </div>\n      </div>\n    `;\n  };\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">Telegram</div>\n      <div class=\"card-sub\">Bot status and channel configuration.</div>\n      ${accountCountLabel}\n\n      ${\n        hasMultipleAccounts\n          ? html`\n            <div class=\"account-card-list\">\n              ${telegramAccounts.map((account) => renderAccountCard(account))}\n            </div>\n          `\n          : html`\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\n              <div>\n                <span class=\"label\">Configured</span>\n                <span>${telegram?.configured ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Running</span>\n                <span>${telegram?.running ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Mode</span>\n                <span>${telegram?.mode ?? \"n/a\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Last start</span>\n                <span>${telegram?.lastStartAt ? formatAgo(telegram.lastStartAt) : \"n/a\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Last probe</span>\n                <span>${telegram?.lastProbeAt ? formatAgo(telegram.lastProbeAt) : \"n/a\"}</span>\n              </div>\n            </div>\n          `\n      }\n\n      ${\n        telegram?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${telegram.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        telegram?.probe\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            Probe ${telegram.probe.ok ? \"ok\" : \"failed\"} Â·\n            ${telegram.probe.status ?? \"\"} ${telegram.probe.error ?? \"\"}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: \"telegram\", props })}\n\n      <div class=\"row\" style=\"margin-top: 12px;\">\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Probe\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { WhatsAppStatus } from \"../types\";\nimport type { ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\nimport { formatDuration } from \"./channels.shared\";\n\nexport function renderWhatsAppCard(params: {\n  props: ChannelsProps;\n  whatsapp?: WhatsAppStatus;\n  accountCountLabel: unknown;\n}) {\n  const { props, whatsapp, accountCountLabel } = params;\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">WhatsApp</div>\n      <div class=\"card-sub\">Link WhatsApp Web and monitor connection health.</div>\n      ${accountCountLabel}\n\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${whatsapp?.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Linked</span>\n          <span>${whatsapp?.linked ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${whatsapp?.running ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Connected</span>\n          <span>${whatsapp?.connected ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last connect</span>\n          <span>\n            ${whatsapp?.lastConnectedAt ? formatAgo(whatsapp.lastConnectedAt) : \"n/a\"}\n          </span>\n        </div>\n        <div>\n          <span class=\"label\">Last message</span>\n          <span>\n            ${whatsapp?.lastMessageAt ? formatAgo(whatsapp.lastMessageAt) : \"n/a\"}\n          </span>\n        </div>\n        <div>\n          <span class=\"label\">Auth age</span>\n          <span>\n            ${whatsapp?.authAgeMs != null ? formatDuration(whatsapp.authAgeMs) : \"n/a\"}\n          </span>\n        </div>\n      </div>\n\n      ${\n        whatsapp?.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${whatsapp.lastError}\n          </div>`\n          : nothing\n      }\n\n      ${\n        props.whatsappMessage\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            ${props.whatsappMessage}\n          </div>`\n          : nothing\n      }\n\n      ${\n        props.whatsappQrDataUrl\n          ? html`<div class=\"qr-wrap\">\n            <img src=${props.whatsappQrDataUrl} alt=\"WhatsApp QR\" />\n          </div>`\n          : nothing\n      }\n\n      <div class=\"row\" style=\"margin-top: 14px; flex-wrap: wrap;\">\n        <button\n          class=\"btn primary\"\n          ?disabled=${props.whatsappBusy}\n          @click=${() => props.onWhatsAppStart(false)}\n        >\n          ${props.whatsappBusy ? \"Workingâ€¦\" : \"Show QR\"}\n        </button>\n        <button\n          class=\"btn\"\n          ?disabled=${props.whatsappBusy}\n          @click=${() => props.onWhatsAppStart(true)}\n        >\n          Relink\n        </button>\n        <button\n          class=\"btn\"\n          ?disabled=${props.whatsappBusy}\n          @click=${() => props.onWhatsAppWait()}\n        >\n          Wait for scan\n        </button>\n        <button\n          class=\"btn danger\"\n          ?disabled=${props.whatsappBusy}\n          @click=${() => props.onWhatsAppLogout()}\n        >\n          Logout\n        </button>\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\n          Refresh\n        </button>\n      </div>\n\n      ${renderChannelConfigSection({ channelId: \"whatsapp\", props })}\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type {\n  ChannelAccountSnapshot,\n  ChannelUiMetaEntry,\n  ChannelsStatusSnapshot,\n  DiscordStatus,\n  GoogleChatStatus,\n  IMessageStatus,\n  NostrProfile,\n  NostrStatus,\n  SignalStatus,\n  SlackStatus,\n  TelegramStatus,\n  WhatsAppStatus,\n} from \"../types\";\nimport type { ChannelKey, ChannelsChannelData, ChannelsProps } from \"./channels.types\";\nimport { formatAgo } from \"../format\";\nimport { renderChannelConfigSection } from \"./channels.config\";\nimport { renderDiscordCard } from \"./channels.discord\";\nimport { renderGoogleChatCard } from \"./channels.googlechat\";\nimport { renderIMessageCard } from \"./channels.imessage\";\nimport { renderNostrCard } from \"./channels.nostr\";\nimport { channelEnabled, renderChannelAccountCount } from \"./channels.shared\";\nimport { renderSignalCard } from \"./channels.signal\";\nimport { renderSlackCard } from \"./channels.slack\";\nimport { renderTelegramCard } from \"./channels.telegram\";\nimport { renderWhatsAppCard } from \"./channels.whatsapp\";\n\nexport function renderChannels(props: ChannelsProps) {\n  const channels = props.snapshot?.channels as Record<string, unknown> | null;\n  const whatsapp = (channels?.whatsapp ?? undefined) as WhatsAppStatus | undefined;\n  const telegram = (channels?.telegram ?? undefined) as TelegramStatus | undefined;\n  const discord = (channels?.discord ?? null) as DiscordStatus | null;\n  const googlechat = (channels?.googlechat ?? null) as GoogleChatStatus | null;\n  const slack = (channels?.slack ?? null) as SlackStatus | null;\n  const signal = (channels?.signal ?? null) as SignalStatus | null;\n  const imessage = (channels?.imessage ?? null) as IMessageStatus | null;\n  const nostr = (channels?.nostr ?? null) as NostrStatus | null;\n  const channelOrder = resolveChannelOrder(props.snapshot);\n  const orderedChannels = channelOrder\n    .map((key, index) => ({\n      key,\n      enabled: channelEnabled(key, props),\n      order: index,\n    }))\n    .toSorted((a, b) => {\n      if (a.enabled !== b.enabled) {\n        return a.enabled ? -1 : 1;\n      }\n      return a.order - b.order;\n    });\n\n  return html`\n    <section class=\"grid grid-cols-2\">\n      ${orderedChannels.map((channel) =>\n        renderChannel(channel.key, props, {\n          whatsapp,\n          telegram,\n          discord,\n          googlechat,\n          slack,\n          signal,\n          imessage,\n          nostr,\n          channelAccounts: props.snapshot?.channelAccounts ?? null,\n        }),\n      )}\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Channel health</div>\n          <div class=\"card-sub\">Channel status snapshots from the gateway.</div>\n        </div>\n        <div class=\"muted\">${props.lastSuccessAt ? formatAgo(props.lastSuccessAt) : \"n/a\"}</div>\n      </div>\n      ${\n        props.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${props.lastError}\n          </div>`\n          : nothing\n      }\n      <pre class=\"code-block\" style=\"margin-top: 12px;\">\n${props.snapshot ? JSON.stringify(props.snapshot, null, 2) : \"No snapshot yet.\"}\n      </pre>\n    </section>\n  `;\n}\n\nfunction resolveChannelOrder(snapshot: ChannelsStatusSnapshot | null): ChannelKey[] {\n  if (snapshot?.channelMeta?.length) {\n    return snapshot.channelMeta.map((entry) => entry.id);\n  }\n  if (snapshot?.channelOrder?.length) {\n    return snapshot.channelOrder;\n  }\n  return [\"whatsapp\", \"telegram\", \"discord\", \"googlechat\", \"slack\", \"signal\", \"imessage\", \"nostr\"];\n}\n\nfunction renderChannel(key: ChannelKey, props: ChannelsProps, data: ChannelsChannelData) {\n  const accountCountLabel = renderChannelAccountCount(key, data.channelAccounts);\n  switch (key) {\n    case \"whatsapp\":\n      return renderWhatsAppCard({\n        props,\n        whatsapp: data.whatsapp,\n        accountCountLabel,\n      });\n    case \"telegram\":\n      return renderTelegramCard({\n        props,\n        telegram: data.telegram,\n        telegramAccounts: data.channelAccounts?.telegram ?? [],\n        accountCountLabel,\n      });\n    case \"discord\":\n      return renderDiscordCard({\n        props,\n        discord: data.discord,\n        accountCountLabel,\n      });\n    case \"googlechat\":\n      return renderGoogleChatCard({\n        props,\n        googlechat: data.googlechat,\n        accountCountLabel,\n      });\n    case \"slack\":\n      return renderSlackCard({\n        props,\n        slack: data.slack,\n        accountCountLabel,\n      });\n    case \"signal\":\n      return renderSignalCard({\n        props,\n        signal: data.signal,\n        accountCountLabel,\n      });\n    case \"imessage\":\n      return renderIMessageCard({\n        props,\n        imessage: data.imessage,\n        accountCountLabel,\n      });\n    case \"nostr\": {\n      const nostrAccounts = data.channelAccounts?.nostr ?? [];\n      const primaryAccount = nostrAccounts[0];\n      const accountId = primaryAccount?.accountId ?? \"default\";\n      const profile =\n        (primaryAccount as { profile?: NostrProfile | null } | undefined)?.profile ?? null;\n      const showForm =\n        props.nostrProfileAccountId === accountId ? props.nostrProfileFormState : null;\n      const profileFormCallbacks = showForm\n        ? {\n            onFieldChange: props.onNostrProfileFieldChange,\n            onSave: props.onNostrProfileSave,\n            onImport: props.onNostrProfileImport,\n            onCancel: props.onNostrProfileCancel,\n            onToggleAdvanced: props.onNostrProfileToggleAdvanced,\n          }\n        : null;\n      return renderNostrCard({\n        props,\n        nostr: data.nostr,\n        nostrAccounts,\n        accountCountLabel,\n        profileFormState: showForm,\n        profileFormCallbacks,\n        onEditProfile: () => props.onNostrProfileEdit(accountId, profile),\n      });\n    }\n    default:\n      return renderGenericChannelCard(key, props, data.channelAccounts ?? {});\n  }\n}\n\nfunction renderGenericChannelCard(\n  key: ChannelKey,\n  props: ChannelsProps,\n  channelAccounts: Record<string, ChannelAccountSnapshot[]>,\n) {\n  const label = resolveChannelLabel(props.snapshot, key);\n  const status = props.snapshot?.channels?.[key] as Record<string, unknown> | undefined;\n  const configured = typeof status?.configured === \"boolean\" ? status.configured : undefined;\n  const running = typeof status?.running === \"boolean\" ? status.running : undefined;\n  const connected = typeof status?.connected === \"boolean\" ? status.connected : undefined;\n  const lastError = typeof status?.lastError === \"string\" ? status.lastError : undefined;\n  const accounts = channelAccounts[key] ?? [];\n  const accountCountLabel = renderChannelAccountCount(key, channelAccounts);\n\n  return html`\n    <div class=\"card\">\n      <div class=\"card-title\">${label}</div>\n      <div class=\"card-sub\">Channel status and configuration.</div>\n      ${accountCountLabel}\n\n      ${\n        accounts.length > 0\n          ? html`\n            <div class=\"account-card-list\">\n              ${accounts.map((account) => renderGenericAccount(account))}\n            </div>\n          `\n          : html`\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\n              <div>\n                <span class=\"label\">Configured</span>\n                <span>${configured == null ? \"n/a\" : configured ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Running</span>\n                <span>${running == null ? \"n/a\" : running ? \"Yes\" : \"No\"}</span>\n              </div>\n              <div>\n                <span class=\"label\">Connected</span>\n                <span>${connected == null ? \"n/a\" : connected ? \"Yes\" : \"No\"}</span>\n              </div>\n            </div>\n          `\n      }\n\n      ${\n        lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${lastError}\n          </div>`\n          : nothing\n      }\n\n      ${renderChannelConfigSection({ channelId: key, props })}\n    </div>\n  `;\n}\n\nfunction resolveChannelMetaMap(\n  snapshot: ChannelsStatusSnapshot | null,\n): Record<string, ChannelUiMetaEntry> {\n  if (!snapshot?.channelMeta?.length) {\n    return {};\n  }\n  return Object.fromEntries(snapshot.channelMeta.map((entry) => [entry.id, entry]));\n}\n\nfunction resolveChannelLabel(snapshot: ChannelsStatusSnapshot | null, key: string): string {\n  const meta = resolveChannelMetaMap(snapshot)[key];\n  return meta?.label ?? snapshot?.channelLabels?.[key] ?? key;\n}\n\nconst RECENT_ACTIVITY_THRESHOLD_MS = 10 * 60 * 1000; // 10 minutes\n\nfunction hasRecentActivity(account: ChannelAccountSnapshot): boolean {\n  if (!account.lastInboundAt) {\n    return false;\n  }\n  return Date.now() - account.lastInboundAt < RECENT_ACTIVITY_THRESHOLD_MS;\n}\n\nfunction deriveRunningStatus(account: ChannelAccountSnapshot): \"Yes\" | \"No\" | \"Active\" {\n  if (account.running) {\n    return \"Yes\";\n  }\n  // If we have recent inbound activity, the channel is effectively running\n  if (hasRecentActivity(account)) {\n    return \"Active\";\n  }\n  return \"No\";\n}\n\nfunction deriveConnectedStatus(account: ChannelAccountSnapshot): \"Yes\" | \"No\" | \"Active\" | \"n/a\" {\n  if (account.connected === true) {\n    return \"Yes\";\n  }\n  if (account.connected === false) {\n    return \"No\";\n  }\n  // If connected is null/undefined but we have recent activity, show as active\n  if (hasRecentActivity(account)) {\n    return \"Active\";\n  }\n  return \"n/a\";\n}\n\nfunction renderGenericAccount(account: ChannelAccountSnapshot) {\n  const runningStatus = deriveRunningStatus(account);\n  const connectedStatus = deriveConnectedStatus(account);\n\n  return html`\n    <div class=\"account-card\">\n      <div class=\"account-card-header\">\n        <div class=\"account-card-title\">${account.name || account.accountId}</div>\n        <div class=\"account-card-id\">${account.accountId}</div>\n      </div>\n      <div class=\"status-list account-card-status\">\n        <div>\n          <span class=\"label\">Running</span>\n          <span>${runningStatus}</span>\n        </div>\n        <div>\n          <span class=\"label\">Configured</span>\n          <span>${account.configured ? \"Yes\" : \"No\"}</span>\n        </div>\n        <div>\n          <span class=\"label\">Connected</span>\n          <span>${connectedStatus}</span>\n        </div>\n        <div>\n          <span class=\"label\">Last inbound</span>\n          <span>${account.lastInboundAt ? formatAgo(account.lastInboundAt) : \"n/a\"}</span>\n        </div>\n        ${\n          account.lastError\n            ? html`\n              <div class=\"account-card-error\">\n                ${account.lastError}\n              </div>\n            `\n            : nothing\n        }\n      </div>\n    </div>\n  `;\n}\n","import{nothing as t,noChange as i}from\"../lit-html.js\";import{directive as r,Directive as s,PartType as n}from\"../directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */class e extends s{constructor(i){if(super(i),this.it=t,i.type!==n.CHILD)throw Error(this.constructor.directiveName+\"() can only be used in child bindings\")}render(r){if(r===t||null==r)return this._t=void 0,this.it=r;if(r===i)return r;if(\"string\"!=typeof r)throw Error(this.constructor.directiveName+\"() called with a non-string value\");if(r===this.it)return this._t;this.it=r;const s=[r];return s.raw=s,this._t={_$litType$:this.constructor.resultType,strings:s,values:[]}}}e.directiveName=\"unsafeHTML\",e.resultType=1;const o=r(e);export{e as UnsafeHTMLDirective,o as unsafeHTML};\n//# sourceMappingURL=unsafe-html.js.map\n","import DOMPurify from \"dompurify\";\nimport { marked } from \"marked\";\nimport { truncateText } from \"./format\";\n\nmarked.setOptions({\n  gfm: true,\n  breaks: true,\n  mangle: false,\n});\n\nconst allowedTags = [\n  \"a\",\n  \"b\",\n  \"blockquote\",\n  \"br\",\n  \"code\",\n  \"del\",\n  \"em\",\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"hr\",\n  \"i\",\n  \"li\",\n  \"ol\",\n  \"p\",\n  \"pre\",\n  \"strong\",\n  \"table\",\n  \"tbody\",\n  \"td\",\n  \"th\",\n  \"thead\",\n  \"tr\",\n  \"ul\",\n];\n\nconst allowedAttrs = [\"class\", \"href\", \"rel\", \"target\", \"title\", \"start\"];\n\nlet hooksInstalled = false;\nconst MARKDOWN_CHAR_LIMIT = 140_000;\nconst MARKDOWN_PARSE_LIMIT = 40_000;\nconst MARKDOWN_CACHE_LIMIT = 200;\nconst MARKDOWN_CACHE_MAX_CHARS = 50_000;\nconst markdownCache = new Map<string, string>();\n\nfunction getCachedMarkdown(key: string): string | null {\n  const cached = markdownCache.get(key);\n  if (cached === undefined) {\n    return null;\n  }\n  markdownCache.delete(key);\n  markdownCache.set(key, cached);\n  return cached;\n}\n\nfunction setCachedMarkdown(key: string, value: string) {\n  markdownCache.set(key, value);\n  if (markdownCache.size <= MARKDOWN_CACHE_LIMIT) {\n    return;\n  }\n  const oldest = markdownCache.keys().next().value;\n  if (oldest) {\n    markdownCache.delete(oldest);\n  }\n}\n\nfunction installHooks() {\n  if (hooksInstalled) {\n    return;\n  }\n  hooksInstalled = true;\n\n  DOMPurify.addHook(\"afterSanitizeAttributes\", (node) => {\n    if (!(node instanceof HTMLAnchorElement)) {\n      return;\n    }\n    const href = node.getAttribute(\"href\");\n    if (!href) {\n      return;\n    }\n    node.setAttribute(\"rel\", \"noreferrer noopener\");\n    node.setAttribute(\"target\", \"_blank\");\n  });\n}\n\nexport function toSanitizedMarkdownHtml(markdown: string): string {\n  const input = markdown.trim();\n  if (!input) {\n    return \"\";\n  }\n  installHooks();\n  if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\n    const cached = getCachedMarkdown(input);\n    if (cached !== null) {\n      return cached;\n    }\n  }\n  const truncated = truncateText(input, MARKDOWN_CHAR_LIMIT);\n  const suffix = truncated.truncated\n    ? `\\n\\nâ€¦ truncated (${truncated.total} chars, showing first ${truncated.text.length}).`\n    : \"\";\n  if (truncated.text.length > MARKDOWN_PARSE_LIMIT) {\n    const escaped = escapeHtml(`${truncated.text}${suffix}`);\n    const html = `<pre class=\"code-block\">${escaped}</pre>`;\n    const sanitized = DOMPurify.sanitize(html, {\n      ALLOWED_TAGS: allowedTags,\n      ALLOWED_ATTR: allowedAttrs,\n    });\n    if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\n      setCachedMarkdown(input, sanitized);\n    }\n    return sanitized;\n  }\n  const rendered = marked.parse(`${truncated.text}${suffix}`) as string;\n  const sanitized = DOMPurify.sanitize(rendered, {\n    ALLOWED_TAGS: allowedTags,\n    ALLOWED_ATTR: allowedAttrs,\n  });\n  if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\n    setCachedMarkdown(input, sanitized);\n  }\n  return sanitized;\n}\n\nfunction escapeHtml(value: string): string {\n  return value\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n","import { html, type TemplateResult } from \"lit\";\nimport { icons } from \"../icons\";\n\nconst COPIED_FOR_MS = 1500;\nconst ERROR_FOR_MS = 2000;\nconst COPY_LABEL = \"Copy as markdown\";\nconst COPIED_LABEL = \"Copied\";\nconst ERROR_LABEL = \"Copy failed\";\n\ntype CopyButtonOptions = {\n  text: () => string;\n  label?: string;\n};\n\nasync function copyTextToClipboard(text: string): Promise<boolean> {\n  if (!text) {\n    return false;\n  }\n\n  try {\n    await navigator.clipboard.writeText(text);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction setButtonLabel(button: HTMLButtonElement, label: string) {\n  button.title = label;\n  button.setAttribute(\"aria-label\", label);\n}\n\nfunction createCopyButton(options: CopyButtonOptions): TemplateResult {\n  const idleLabel = options.label ?? COPY_LABEL;\n  return html`\n    <button\n      class=\"chat-copy-btn\"\n      type=\"button\"\n      title=${idleLabel}\n      aria-label=${idleLabel}\n      @click=${async (e: Event) => {\n        const btn = e.currentTarget as HTMLButtonElement | null;\n\n        if (!btn || btn.dataset.copying === \"1\") {\n          return;\n        }\n\n        btn.dataset.copying = \"1\";\n        btn.setAttribute(\"aria-busy\", \"true\");\n        btn.disabled = true;\n\n        const copied = await copyTextToClipboard(options.text());\n        if (!btn.isConnected) {\n          return;\n        }\n\n        delete btn.dataset.copying;\n        btn.removeAttribute(\"aria-busy\");\n        btn.disabled = false;\n\n        if (!copied) {\n          btn.dataset.error = \"1\";\n          setButtonLabel(btn, ERROR_LABEL);\n\n          window.setTimeout(() => {\n            if (!btn.isConnected) {\n              return;\n            }\n            delete btn.dataset.error;\n            setButtonLabel(btn, idleLabel);\n          }, ERROR_FOR_MS);\n          return;\n        }\n\n        btn.dataset.copied = \"1\";\n        setButtonLabel(btn, COPIED_LABEL);\n\n        window.setTimeout(() => {\n          if (!btn.isConnected) {\n            return;\n          }\n          delete btn.dataset.copied;\n          setButtonLabel(btn, idleLabel);\n        }, COPIED_FOR_MS);\n      }}\n    >\n      <span class=\"chat-copy-btn__icon\" aria-hidden=\"true\">\n        <span class=\"chat-copy-btn__icon-copy\">${icons.copy}</span>\n        <span class=\"chat-copy-btn__icon-check\">${icons.check}</span>\n      </span>\n    </button>\n  `;\n}\n\nexport function renderCopyAsMarkdownButton(markdown: string): TemplateResult {\n  return createCopyButton({ text: () => markdown, label: COPY_LABEL });\n}\n","async function copyTextToClipboard(text: string): Promise<boolean> {\n  if (!text) {\n    return false;\n  }\n  try {\n    await navigator.clipboard.writeText(text);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nconst COPY_ICON_SVG = `<svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\" /><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\" /></svg>`;\n\nexport function attachCopyButtonsToCodeBlocks(container: HTMLElement): void {\n  const codeBlocks = container.querySelectorAll(\"pre\");\n  codeBlocks.forEach((pre) => {\n    // Skip if already has copy button\n    if (pre.querySelector(\".code-block-copy-btn\")) {\n      return;\n    }\n\n    const code = pre.querySelector(\"code\");\n    const text = code?.textContent || pre.textContent || \"\";\n\n    if (!text.trim()) {\n      return;\n    }\n\n    const button = document.createElement(\"button\");\n    button.className = \"code-block-copy-btn\";\n    button.type = \"button\";\n    button.setAttribute(\"aria-label\", \"Copy code\");\n    button.title = \"Copy code\";\n    button.innerHTML = `<span class=\"code-block-copy-btn__icon\" aria-hidden=\"true\">${COPY_ICON_SVG}</span>`;\n\n    let copiedTimeout: number | null = null;\n    button.addEventListener(\"click\", async () => {\n      if (button.dataset.copying === \"1\") {\n        return;\n      }\n\n      button.dataset.copying = \"1\";\n      button.disabled = true;\n      button.setAttribute(\"aria-busy\", \"true\");\n\n      const copied = await copyTextToClipboard(text);\n\n      if (!button.isConnected) {\n        return;\n      }\n\n      button.dataset.copying = \"\";\n      button.disabled = false;\n      button.removeAttribute(\"aria-busy\");\n\n      if (copied) {\n        button.dataset.copied = \"1\";\n        button.setAttribute(\"aria-label\", \"Copied!\");\n        button.title = \"Copied!\";\n\n        if (copiedTimeout !== null) {\n          window.clearTimeout(copiedTimeout);\n        }\n        copiedTimeout = window.setTimeout(() => {\n          if (!button.isConnected) {\n            return;\n          }\n          button.dataset.copied = \"\";\n          button.setAttribute(\"aria-label\", \"Copy code\");\n          button.title = \"Copy code\";\n        }, 2000);\n      } else {\n        button.dataset.error = \"1\";\n        button.setAttribute(\"aria-label\", \"Copy failed\");\n        button.title = \"Copy failed\";\n\n        if (copiedTimeout !== null) {\n          window.clearTimeout(copiedTimeout);\n        }\n        copiedTimeout = window.setTimeout(() => {\n          if (!button.isConnected) {\n            return;\n          }\n          button.dataset.error = \"\";\n          button.setAttribute(\"aria-label\", \"Copy code\");\n          button.title = \"Copy code\";\n        }, 2000);\n      }\n    });\n\n    pre.style.position = \"relative\";\n    pre.appendChild(button);\n  });\n}\n","/**\n * Message normalization utilities for chat rendering.\n */\n\nimport type { NormalizedMessage, MessageContentItem } from \"../types/chat-types\";\n\n/**\n * Normalize a raw message object into a consistent structure.\n */\nexport function normalizeMessage(message: unknown): NormalizedMessage {\n  const m = message as Record<string, unknown>;\n  let role = typeof m.role === \"string\" ? m.role : \"unknown\";\n\n  // Detect tool messages by common gateway shapes.\n  // Some tool events come through as assistant role with tool_* items in the content array.\n  const hasToolId = typeof m.toolCallId === \"string\" || typeof m.tool_call_id === \"string\";\n\n  const contentRaw = m.content;\n  const contentItems = Array.isArray(contentRaw) ? contentRaw : null;\n  const hasToolContent =\n    Array.isArray(contentItems) &&\n    contentItems.some((item) => {\n      const x = item as Record<string, unknown>;\n      const t = (typeof x.type === \"string\" ? x.type : \"\").toLowerCase();\n      return t === \"toolresult\" || t === \"tool_result\";\n    });\n\n  const hasToolName = typeof m.toolName === \"string\" || typeof m.tool_name === \"string\";\n\n  if (hasToolId || hasToolContent || hasToolName) {\n    role = \"toolResult\";\n  }\n\n  // Extract content\n  let content: MessageContentItem[] = [];\n\n  if (typeof m.content === \"string\") {\n    content = [{ type: \"text\", text: m.content }];\n  } else if (Array.isArray(m.content)) {\n    content = m.content.map((item: Record<string, unknown>) => ({\n      type: (item.type as MessageContentItem[\"type\"]) || \"text\",\n      text: item.text as string | undefined,\n      name: item.name as string | undefined,\n      args: item.args || item.arguments,\n    }));\n  } else if (typeof m.text === \"string\") {\n    content = [{ type: \"text\", text: m.text }];\n  }\n\n  const timestamp = typeof m.timestamp === \"number\" ? m.timestamp : Date.now();\n  const id = typeof m.id === \"string\" ? m.id : undefined;\n\n  return { role, content, timestamp, id };\n}\n\n/**\n * Normalize role for grouping purposes.\n */\nexport function normalizeRoleForGrouping(role: string): string {\n  const lower = role.toLowerCase();\n  // Preserve original casing when it's already a core role.\n  if (role === \"user\" || role === \"User\") {\n    return role;\n  }\n  if (role === \"assistant\") {\n    return \"assistant\";\n  }\n  if (role === \"system\") {\n    return \"system\";\n  }\n  // Keep tool-related roles distinct so the UI can style/toggle them.\n  if (\n    lower === \"toolresult\" ||\n    lower === \"tool_result\" ||\n    lower === \"tool\" ||\n    lower === \"function\"\n  ) {\n    return \"tool\";\n  }\n  return role;\n}\n\n/**\n * Check if a message is a tool result message based on its role.\n */\nexport function isToolResultMessage(message: unknown): boolean {\n  const m = message as Record<string, unknown>;\n  const role = typeof m.role === \"string\" ? m.role.toLowerCase() : \"\";\n  return role === \"toolresult\" || role === \"tool_result\";\n}\n","import type { IconName } from \"./icons\";\nimport rawConfig from \"./tool-display.json\";\n\ntype ToolDisplayActionSpec = {\n  label?: string;\n  detailKeys?: string[];\n};\n\ntype ToolDisplaySpec = {\n  icon?: string;\n  title?: string;\n  label?: string;\n  detailKeys?: string[];\n  actions?: Record<string, ToolDisplayActionSpec>;\n};\n\ntype ToolDisplayConfig = {\n  version?: number;\n  fallback?: ToolDisplaySpec;\n  tools?: Record<string, ToolDisplaySpec>;\n};\n\nexport type ToolDisplay = {\n  name: string;\n  icon: IconName;\n  title: string;\n  label: string;\n  verb?: string;\n  detail?: string;\n};\n\nconst TOOL_DISPLAY_CONFIG = rawConfig as ToolDisplayConfig;\nconst FALLBACK = TOOL_DISPLAY_CONFIG.fallback ?? { icon: \"puzzle\" };\nconst TOOL_MAP = TOOL_DISPLAY_CONFIG.tools ?? {};\n\nfunction normalizeToolName(name?: string): string {\n  return (name ?? \"tool\").trim();\n}\n\nfunction defaultTitle(name: string): string {\n  const cleaned = name.replace(/_/g, \" \").trim();\n  if (!cleaned) {\n    return \"Tool\";\n  }\n  return cleaned\n    .split(/\\s+/)\n    .map((part) =>\n      part.length <= 2 && part.toUpperCase() === part\n        ? part\n        : `${part.at(0)?.toUpperCase() ?? \"\"}${part.slice(1)}`,\n    )\n    .join(\" \");\n}\n\nfunction normalizeVerb(value?: string): string | undefined {\n  const trimmed = value?.trim();\n  if (!trimmed) {\n    return undefined;\n  }\n  return trimmed.replace(/_/g, \" \");\n}\n\nfunction coerceDisplayValue(value: unknown): string | undefined {\n  if (value === null || value === undefined) {\n    return undefined;\n  }\n  if (typeof value === \"string\") {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return undefined;\n    }\n    const firstLine = trimmed.split(/\\r?\\n/)[0]?.trim() ?? \"\";\n    if (!firstLine) {\n      return undefined;\n    }\n    return firstLine.length > 160 ? `${firstLine.slice(0, 157)}â€¦` : firstLine;\n  }\n  if (typeof value === \"number\" || typeof value === \"boolean\") {\n    return String(value);\n  }\n  if (Array.isArray(value)) {\n    const values = value\n      .map((item) => coerceDisplayValue(item))\n      .filter((item): item is string => Boolean(item));\n    if (values.length === 0) {\n      return undefined;\n    }\n    const preview = values.slice(0, 3).join(\", \");\n    return values.length > 3 ? `${preview}â€¦` : preview;\n  }\n  return undefined;\n}\n\nfunction lookupValueByPath(args: unknown, path: string): unknown {\n  if (!args || typeof args !== \"object\") {\n    return undefined;\n  }\n  let current: unknown = args;\n  for (const segment of path.split(\".\")) {\n    if (!segment) {\n      return undefined;\n    }\n    if (!current || typeof current !== \"object\") {\n      return undefined;\n    }\n    const record = current as Record<string, unknown>;\n    current = record[segment];\n  }\n  return current;\n}\n\nfunction resolveDetailFromKeys(args: unknown, keys: string[]): string | undefined {\n  for (const key of keys) {\n    const value = lookupValueByPath(args, key);\n    const display = coerceDisplayValue(value);\n    if (display) {\n      return display;\n    }\n  }\n  return undefined;\n}\n\nfunction resolveReadDetail(args: unknown): string | undefined {\n  if (!args || typeof args !== \"object\") {\n    return undefined;\n  }\n  const record = args as Record<string, unknown>;\n  const path = typeof record.path === \"string\" ? record.path : undefined;\n  if (!path) {\n    return undefined;\n  }\n  const offset = typeof record.offset === \"number\" ? record.offset : undefined;\n  const limit = typeof record.limit === \"number\" ? record.limit : undefined;\n  if (offset !== undefined && limit !== undefined) {\n    return `${path}:${offset}-${offset + limit}`;\n  }\n  return path;\n}\n\nfunction resolveWriteDetail(args: unknown): string | undefined {\n  if (!args || typeof args !== \"object\") {\n    return undefined;\n  }\n  const record = args as Record<string, unknown>;\n  const path = typeof record.path === \"string\" ? record.path : undefined;\n  return path;\n}\n\nfunction resolveActionSpec(\n  spec: ToolDisplaySpec | undefined,\n  action: string | undefined,\n): ToolDisplayActionSpec | undefined {\n  if (!spec || !action) {\n    return undefined;\n  }\n  return spec.actions?.[action] ?? undefined;\n}\n\nexport function resolveToolDisplay(params: {\n  name?: string;\n  args?: unknown;\n  meta?: string;\n}): ToolDisplay {\n  const name = normalizeToolName(params.name);\n  const key = name.toLowerCase();\n  const spec = TOOL_MAP[key];\n  const icon = (spec?.icon ?? FALLBACK.icon ?? \"puzzle\") as IconName;\n  const title = spec?.title ?? defaultTitle(name);\n  const label = spec?.label ?? name;\n  const actionRaw =\n    params.args && typeof params.args === \"object\"\n      ? ((params.args as Record<string, unknown>).action as string | undefined)\n      : undefined;\n  const action = typeof actionRaw === \"string\" ? actionRaw.trim() : undefined;\n  const actionSpec = resolveActionSpec(spec, action);\n  const verb = normalizeVerb(actionSpec?.label ?? action);\n\n  let detail: string | undefined;\n  if (key === \"read\") {\n    detail = resolveReadDetail(params.args);\n  }\n  if (!detail && (key === \"write\" || key === \"edit\" || key === \"attach\")) {\n    detail = resolveWriteDetail(params.args);\n  }\n\n  const detailKeys = actionSpec?.detailKeys ?? spec?.detailKeys ?? FALLBACK.detailKeys ?? [];\n  if (!detail && detailKeys.length > 0) {\n    detail = resolveDetailFromKeys(params.args, detailKeys);\n  }\n\n  if (!detail && params.meta) {\n    detail = params.meta;\n  }\n\n  if (detail) {\n    detail = shortenHomeInString(detail);\n  }\n\n  return {\n    name,\n    icon,\n    title,\n    label,\n    verb,\n    detail,\n  };\n}\n\nexport function formatToolDetail(display: ToolDisplay): string | undefined {\n  const parts: string[] = [];\n  if (display.verb) {\n    parts.push(display.verb);\n  }\n  if (display.detail) {\n    parts.push(display.detail);\n  }\n  if (parts.length === 0) {\n    return undefined;\n  }\n  return parts.join(\" Â· \");\n}\n\nexport function formatToolSummary(display: ToolDisplay): string {\n  const detail = formatToolDetail(display);\n  return detail ? `${display.label}: ${detail}` : display.label;\n}\n\nfunction shortenHomeInString(input: string): string {\n  if (!input) {\n    return input;\n  }\n  return input.replace(/\\/Users\\/[^/]+/g, \"~\").replace(/\\/home\\/[^/]+/g, \"~\");\n}\n","/**\n * Chat-related constants for the UI layer.\n */\n\n/** Character threshold for showing tool output inline vs collapsed */\nexport const TOOL_INLINE_THRESHOLD = 80;\n\n/** Maximum lines to show in collapsed preview */\nexport const PREVIEW_MAX_LINES = 2;\n\n/** Maximum characters to show in collapsed preview */\nexport const PREVIEW_MAX_CHARS = 100;\n","/**\n * Helper functions for tool card rendering.\n */\n\nimport { PREVIEW_MAX_CHARS, PREVIEW_MAX_LINES } from \"./constants\";\n\n/**\n * Format tool output content for display in the sidebar.\n * Detects JSON and wraps it in a code block with formatting.\n */\nexport function formatToolOutputForSidebar(text: string): string {\n  const trimmed = text.trim();\n  // Try to detect and format JSON\n  if (trimmed.startsWith(\"{\") || trimmed.startsWith(\"[\")) {\n    try {\n      const parsed = JSON.parse(trimmed);\n      return \"```json\\n\" + JSON.stringify(parsed, null, 2) + \"\\n```\";\n    } catch {\n      // Not valid JSON, return as-is\n    }\n  }\n  return text;\n}\n\n/**\n * Get a truncated preview of tool output text.\n * Truncates to first N lines or first N characters, whichever is shorter.\n */\nexport function getTruncatedPreview(text: string): string {\n  const allLines = text.split(\"\\n\");\n  const lines = allLines.slice(0, PREVIEW_MAX_LINES);\n  const preview = lines.join(\"\\n\");\n  if (preview.length > PREVIEW_MAX_CHARS) {\n    return preview.slice(0, PREVIEW_MAX_CHARS) + \"â€¦\";\n  }\n  return lines.length < allLines.length ? preview + \"â€¦\" : preview;\n}\n","import { html, nothing } from \"lit\";\nimport type { ToolCard } from \"../types/chat-types\";\nimport { icons } from \"../icons\";\nimport { formatToolDetail, resolveToolDisplay } from \"../tool-display\";\nimport { TOOL_INLINE_THRESHOLD } from \"./constants\";\nimport { extractTextCached } from \"./message-extract\";\nimport { isToolResultMessage } from \"./message-normalizer\";\nimport { formatToolOutputForSidebar, getTruncatedPreview } from \"./tool-helpers\";\n\nexport function extractToolCards(message: unknown): ToolCard[] {\n  const m = message as Record<string, unknown>;\n  const content = normalizeContent(m.content);\n  const cards: ToolCard[] = [];\n\n  for (const item of content) {\n    const kind = (typeof item.type === \"string\" ? item.type : \"\").toLowerCase();\n    const isToolCall =\n      [\"toolcall\", \"tool_call\", \"tooluse\", \"tool_use\"].includes(kind) ||\n      (typeof item.name === \"string\" && item.arguments != null);\n    if (isToolCall) {\n      cards.push({\n        kind: \"call\",\n        name: (item.name as string) ?? \"tool\",\n        args: coerceArgs(item.arguments ?? item.args),\n      });\n    }\n  }\n\n  for (const item of content) {\n    const kind = (typeof item.type === \"string\" ? item.type : \"\").toLowerCase();\n    if (kind !== \"toolresult\" && kind !== \"tool_result\") {\n      continue;\n    }\n    const text = extractToolText(item);\n    const name = typeof item.name === \"string\" ? item.name : \"tool\";\n    cards.push({ kind: \"result\", name, text });\n  }\n\n  if (isToolResultMessage(message) && !cards.some((card) => card.kind === \"result\")) {\n    const name =\n      (typeof m.toolName === \"string\" && m.toolName) ||\n      (typeof m.tool_name === \"string\" && m.tool_name) ||\n      \"tool\";\n    const text = extractTextCached(message) ?? undefined;\n    cards.push({ kind: \"result\", name, text });\n  }\n\n  return cards;\n}\n\nexport function renderToolCardSidebar(card: ToolCard, onOpenSidebar?: (content: string) => void) {\n  const display = resolveToolDisplay({ name: card.name, args: card.args });\n  const detail = formatToolDetail(display);\n  const hasText = Boolean(card.text?.trim());\n\n  const canClick = Boolean(onOpenSidebar);\n  const handleClick = canClick\n    ? () => {\n        if (hasText) {\n          onOpenSidebar!(formatToolOutputForSidebar(card.text!));\n          return;\n        }\n        const info = `## ${display.label}\\n\\n${\n          detail ? `**Command:** \\`${detail}\\`\\n\\n` : \"\"\n        }*No output â€” tool completed successfully.*`;\n        onOpenSidebar!(info);\n      }\n    : undefined;\n\n  const isShort = hasText && (card.text?.length ?? 0) <= TOOL_INLINE_THRESHOLD;\n  const showCollapsed = hasText && !isShort;\n  const showInline = hasText && isShort;\n  const isEmpty = !hasText;\n\n  return html`\n    <div\n      class=\"chat-tool-card ${canClick ? \"chat-tool-card--clickable\" : \"\"}\"\n      @click=${handleClick}\n      role=${canClick ? \"button\" : nothing}\n      tabindex=${canClick ? \"0\" : nothing}\n      @keydown=${\n        canClick\n          ? (e: KeyboardEvent) => {\n              if (e.key !== \"Enter\" && e.key !== \" \") {\n                return;\n              }\n              e.preventDefault();\n              handleClick?.();\n            }\n          : nothing\n      }\n    >\n      <div class=\"chat-tool-card__header\">\n        <div class=\"chat-tool-card__title\">\n          <span class=\"chat-tool-card__icon\">${icons[display.icon]}</span>\n          <span>${display.label}</span>\n        </div>\n        ${\n          canClick\n            ? html`<span class=\"chat-tool-card__action\">${hasText ? \"View\" : \"\"} ${icons.check}</span>`\n            : nothing\n        }\n        ${isEmpty && !canClick ? html`<span class=\"chat-tool-card__status\">${icons.check}</span>` : nothing}\n      </div>\n      ${detail ? html`<div class=\"chat-tool-card__detail\">${detail}</div>` : nothing}\n      ${\n        isEmpty\n          ? html`\n              <div class=\"chat-tool-card__status-text muted\">Completed</div>\n            `\n          : nothing\n      }\n      ${\n        showCollapsed\n          ? html`<div class=\"chat-tool-card__preview mono\">${getTruncatedPreview(card.text!)}</div>`\n          : nothing\n      }\n      ${showInline ? html`<div class=\"chat-tool-card__inline mono\">${card.text}</div>` : nothing}\n    </div>\n  `;\n}\n\nfunction normalizeContent(content: unknown): Array<Record<string, unknown>> {\n  if (!Array.isArray(content)) {\n    return [];\n  }\n  return content.filter(Boolean) as Array<Record<string, unknown>>;\n}\n\nfunction coerceArgs(value: unknown): unknown {\n  if (typeof value !== \"string\") {\n    return value;\n  }\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return value;\n  }\n  if (!trimmed.startsWith(\"{\") && !trimmed.startsWith(\"[\")) {\n    return value;\n  }\n  try {\n    return JSON.parse(trimmed);\n  } catch {\n    return value;\n  }\n}\n\nfunction extractToolText(item: Record<string, unknown>): string | undefined {\n  if (typeof item.text === \"string\") {\n    return item.text;\n  }\n  if (typeof item.content === \"string\") {\n    return item.content;\n  }\n  return undefined;\n}\n","import { html, nothing } from \"lit\";\nimport { ref } from \"lit/directives/ref.js\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport type { AssistantIdentity } from \"../assistant-identity\";\nimport type { MessageGroup } from \"../types/chat-types\";\nimport { toSanitizedMarkdownHtml } from \"../markdown\";\nimport { renderCopyAsMarkdownButton } from \"./copy-as-markdown\";\nimport { attachCopyButtonsToCodeBlocks } from \"./copy-code-block\";\nimport {\n  extractTextCached,\n  extractThinkingCached,\n  formatReasoningMarkdown,\n} from \"./message-extract\";\nimport { isToolResultMessage, normalizeRoleForGrouping } from \"./message-normalizer\";\nimport { extractToolCards, renderToolCardSidebar } from \"./tool-cards\";\n\ntype ImageBlock = {\n  url: string;\n  alt?: string;\n};\n\nfunction extractImages(message: unknown): ImageBlock[] {\n  const m = message as Record<string, unknown>;\n  const content = m.content;\n  const images: ImageBlock[] = [];\n\n  if (Array.isArray(content)) {\n    for (const block of content) {\n      if (typeof block !== \"object\" || block === null) {\n        continue;\n      }\n      const b = block as Record<string, unknown>;\n\n      if (b.type === \"image\") {\n        // Handle source object format (from sendChatMessage)\n        const source = b.source as Record<string, unknown> | undefined;\n        if (source?.type === \"base64\" && typeof source.data === \"string\") {\n          const data = source.data;\n          const mediaType = (source.media_type as string) || \"image/png\";\n          // If data is already a data URL, use it directly\n          const url = data.startsWith(\"data:\") ? data : `data:${mediaType};base64,${data}`;\n          images.push({ url });\n        } else if (typeof b.url === \"string\") {\n          images.push({ url: b.url });\n        }\n      } else if (b.type === \"image_url\") {\n        // OpenAI format\n        const imageUrl = b.image_url as Record<string, unknown> | undefined;\n        if (typeof imageUrl?.url === \"string\") {\n          images.push({ url: imageUrl.url });\n        }\n      }\n    }\n  }\n\n  return images;\n}\n\nexport function renderReadingIndicatorGroup(assistant?: AssistantIdentity) {\n  return html`\n    <div class=\"chat-group assistant\">\n      ${renderAvatar(\"assistant\", assistant)}\n      <div class=\"chat-group-messages\">\n        <div class=\"chat-bubble chat-reading-indicator\" aria-hidden=\"true\">\n          <span class=\"chat-reading-indicator__dots\">\n            <span></span><span></span><span></span>\n          </span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nexport function renderStreamingGroup(\n  text: string,\n  startedAt: number,\n  onOpenSidebar?: (content: string) => void,\n  assistant?: AssistantIdentity,\n) {\n  const timestamp = new Date(startedAt).toLocaleTimeString([], {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n  });\n  const name = assistant?.name ?? \"Assistant\";\n\n  return html`\n    <div class=\"chat-group assistant\">\n      ${renderAvatar(\"assistant\", assistant)}\n      <div class=\"chat-group-messages\">\n        ${renderGroupedMessage(\n          {\n            role: \"assistant\",\n            content: [{ type: \"text\", text }],\n            timestamp: startedAt,\n          },\n          { isStreaming: true, showReasoning: false },\n          onOpenSidebar,\n        )}\n        <div class=\"chat-group-footer\">\n          <span class=\"chat-sender-name\">${name}</span>\n          <span class=\"chat-group-timestamp\">${timestamp}</span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nexport function renderMessageGroup(\n  group: MessageGroup,\n  opts: {\n    onOpenSidebar?: (content: string) => void;\n    showReasoning: boolean;\n    assistantName?: string;\n    assistantAvatar?: string | null;\n  },\n) {\n  const normalizedRole = normalizeRoleForGrouping(group.role);\n  const assistantName = opts.assistantName ?? \"Assistant\";\n  const who =\n    normalizedRole === \"user\"\n      ? \"You\"\n      : normalizedRole === \"assistant\"\n        ? assistantName\n        : normalizedRole;\n  const roleClass =\n    normalizedRole === \"user\" ? \"user\" : normalizedRole === \"assistant\" ? \"assistant\" : \"other\";\n  const timestamp = new Date(group.timestamp).toLocaleTimeString([], {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n  });\n\n  return html`\n    <div class=\"chat-group ${roleClass}\">\n      ${renderAvatar(group.role, {\n        name: assistantName,\n        avatar: opts.assistantAvatar ?? null,\n      })}\n      <div class=\"chat-group-messages\">\n        ${group.messages.map((item, index) =>\n          renderGroupedMessage(\n            item.message,\n            {\n              isStreaming: group.isStreaming && index === group.messages.length - 1,\n              showReasoning: opts.showReasoning,\n            },\n            opts.onOpenSidebar,\n          ),\n        )}\n        <div class=\"chat-group-footer\">\n          <span class=\"chat-sender-name\">${who}</span>\n          <span class=\"chat-group-timestamp\">${timestamp}</span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderAvatar(role: string, assistant?: Pick<AssistantIdentity, \"name\" | \"avatar\">) {\n  const normalized = normalizeRoleForGrouping(role);\n  const assistantName = assistant?.name?.trim() || \"Assistant\";\n  const assistantAvatar = assistant?.avatar?.trim() || \"\";\n  const initial =\n    normalized === \"user\"\n      ? \"U\"\n      : normalized === \"assistant\"\n        ? assistantName.charAt(0).toUpperCase() || \"A\"\n        : normalized === \"tool\"\n          ? \"âš™\"\n          : \"?\";\n  const className =\n    normalized === \"user\"\n      ? \"user\"\n      : normalized === \"assistant\"\n        ? \"assistant\"\n        : normalized === \"tool\"\n          ? \"tool\"\n          : \"other\";\n\n  if (assistantAvatar && normalized === \"assistant\") {\n    if (isAvatarUrl(assistantAvatar)) {\n      return html`<img\n        class=\"chat-avatar ${className}\"\n        src=\"${assistantAvatar}\"\n        alt=\"${assistantName}\"\n      />`;\n    }\n    return html`<div class=\"chat-avatar ${className}\">${assistantAvatar}</div>`;\n  }\n\n  return html`<div class=\"chat-avatar ${className}\">${initial}</div>`;\n}\n\nfunction isAvatarUrl(value: string): boolean {\n  return (\n    /^https?:\\/\\//i.test(value) || /^data:image\\//i.test(value) || value.startsWith(\"/\") // Relative paths from avatar endpoint\n  );\n}\n\nfunction renderMessageImages(images: ImageBlock[]) {\n  if (images.length === 0) {\n    return nothing;\n  }\n\n  return html`\n    <div class=\"chat-message-images\">\n      ${images.map(\n        (img) => html`\n          <img\n            src=${img.url}\n            alt=${img.alt ?? \"Attached image\"}\n            class=\"chat-message-image\"\n            @click=${() => window.open(img.url, \"_blank\")}\n          />\n        `,\n      )}\n    </div>\n  `;\n}\n\nfunction renderGroupedMessage(\n  message: unknown,\n  opts: { isStreaming: boolean; showReasoning: boolean },\n  onOpenSidebar?: (content: string) => void,\n) {\n  const m = message as Record<string, unknown>;\n  const role = typeof m.role === \"string\" ? m.role : \"unknown\";\n  const isToolResult =\n    isToolResultMessage(message) ||\n    role.toLowerCase() === \"toolresult\" ||\n    role.toLowerCase() === \"tool_result\" ||\n    typeof m.toolCallId === \"string\" ||\n    typeof m.tool_call_id === \"string\";\n\n  const toolCards = extractToolCards(message);\n  const hasToolCards = toolCards.length > 0;\n  const images = extractImages(message);\n  const hasImages = images.length > 0;\n\n  const extractedText = extractTextCached(message);\n  const extractedThinking =\n    opts.showReasoning && role === \"assistant\" ? extractThinkingCached(message) : null;\n  const markdownBase = extractedText?.trim() ? extractedText : null;\n  const reasoningMarkdown = extractedThinking ? formatReasoningMarkdown(extractedThinking) : null;\n  const markdown = markdownBase;\n  const canCopyMarkdown = role === \"assistant\" && Boolean(markdown?.trim());\n\n  const bubbleClasses = [\n    \"chat-bubble\",\n    canCopyMarkdown ? \"has-copy\" : \"\",\n    opts.isStreaming ? \"streaming\" : \"\",\n    \"fade-in\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  if (!markdown && hasToolCards && isToolResult) {\n    return html`${toolCards.map((card) => renderToolCardSidebar(card, onOpenSidebar))}`;\n  }\n\n  if (!markdown && !hasToolCards && !hasImages) {\n    return nothing;\n  }\n\n  return html`\n    <div class=\"${bubbleClasses}\">\n      ${canCopyMarkdown ? renderCopyAsMarkdownButton(markdown!) : nothing}\n      ${renderMessageImages(images)}\n      ${\n        reasoningMarkdown\n          ? html`<div class=\"chat-thinking\" ${ref((el) => {\n              if (el) {\n                requestAnimationFrame(() => {\n                  attachCopyButtonsToCodeBlocks(el as HTMLElement);\n                });\n              }\n            })}>${unsafeHTML(toSanitizedMarkdownHtml(reasoningMarkdown))}</div>`\n          : nothing\n      }\n      ${\n        markdown\n          ? html`<div class=\"chat-text\" ${ref((el) => {\n              if (el) {\n                // Attach copy buttons after DOM is ready\n                requestAnimationFrame(() => {\n                  attachCopyButtonsToCodeBlocks(el as HTMLElement);\n                });\n              }\n            })}>${unsafeHTML(toSanitizedMarkdownHtml(markdown))}</div>`\n          : nothing\n      }\n      ${toolCards.map((card) => renderToolCardSidebar(card, onOpenSidebar))}\n    </div>\n  `;\n}\n","import { html } from \"lit\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { icons } from \"../icons\";\nimport { toSanitizedMarkdownHtml } from \"../markdown\";\n\nexport type MarkdownSidebarProps = {\n  content: string | null;\n  error: string | null;\n  onClose: () => void;\n  onViewRawText: () => void;\n};\n\nexport function renderMarkdownSidebar(props: MarkdownSidebarProps) {\n  return html`\n    <div class=\"sidebar-panel\">\n      <div class=\"sidebar-header\">\n        <div class=\"sidebar-title\">Tool Output</div>\n        <button @click=${props.onClose} class=\"btn\" title=\"Close sidebar\">\n          ${icons.x}\n        </button>\n      </div>\n      <div class=\"sidebar-content\">\n        ${\n          props.error\n            ? html`\n              <div class=\"callout danger\">${props.error}</div>\n              <button @click=${props.onViewRawText} class=\"btn\" style=\"margin-top: 12px;\">\n                View Raw Text\n              </button>\n            `\n            : props.content\n              ? html`<div class=\"sidebar-markdown\">${unsafeHTML(toSanitizedMarkdownHtml(props.content))}</div>`\n              : html`\n                  <div class=\"muted\">No content available</div>\n                `\n        }\n      </div>\n    </div>\n  `;\n}\n","import { LitElement, css, nothing } from \"lit\";\nimport { customElement, property } from \"lit/decorators.js\";\n\n/**\n * A draggable divider for resizable split views.\n * Dispatches 'resize' events with { splitRatio: number } detail.\n */\n@customElement(\"resizable-divider\")\nexport class ResizableDivider extends LitElement {\n  @property({ type: Number }) splitRatio = 0.6;\n  @property({ type: Number }) minRatio = 0.4;\n  @property({ type: Number }) maxRatio = 0.7;\n\n  private isDragging = false;\n  private startX = 0;\n  private startRatio = 0;\n\n  static styles = css`\n    :host {\n      width: 4px;\n      cursor: col-resize;\n      background: var(--border, #333);\n      transition: background 150ms ease-out;\n      flex-shrink: 0;\n      position: relative;\n    }\n    :host::before {\n      content: \"\";\n      position: absolute;\n      top: 0;\n      left: -4px;\n      right: -4px;\n      bottom: 0;\n    }\n    :host(:hover) {\n      background: var(--accent, #007bff);\n    }\n    :host(.dragging) {\n      background: var(--accent, #007bff);\n    }\n  `;\n\n  render() {\n    return nothing;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener(\"mousedown\", this.handleMouseDown);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener(\"mousedown\", this.handleMouseDown);\n    document.removeEventListener(\"mousemove\", this.handleMouseMove);\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\n  }\n\n  private handleMouseDown = (e: MouseEvent) => {\n    this.isDragging = true;\n    this.startX = e.clientX;\n    this.startRatio = this.splitRatio;\n    this.classList.add(\"dragging\");\n\n    document.addEventListener(\"mousemove\", this.handleMouseMove);\n    document.addEventListener(\"mouseup\", this.handleMouseUp);\n\n    e.preventDefault();\n  };\n\n  private handleMouseMove = (e: MouseEvent) => {\n    if (!this.isDragging) {\n      return;\n    }\n\n    const container = this.parentElement;\n    if (!container) {\n      return;\n    }\n\n    const containerWidth = container.getBoundingClientRect().width;\n    const deltaX = e.clientX - this.startX;\n    const deltaRatio = deltaX / containerWidth;\n\n    let newRatio = this.startRatio + deltaRatio;\n    newRatio = Math.max(this.minRatio, Math.min(this.maxRatio, newRatio));\n\n    this.dispatchEvent(\n      new CustomEvent(\"resize\", {\n        detail: { splitRatio: newRatio },\n        bubbles: true,\n        composed: true,\n      }),\n    );\n  };\n\n  private handleMouseUp = () => {\n    this.isDragging = false;\n    this.classList.remove(\"dragging\");\n\n    document.removeEventListener(\"mousemove\", this.handleMouseMove);\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"resizable-divider\": ResizableDivider;\n  }\n}\n","import { html, nothing } from \"lit\";\nimport { ref } from \"lit/directives/ref.js\";\nimport { repeat } from \"lit/directives/repeat.js\";\nimport type { SessionsListResult } from \"../types\";\nimport type { ChatItem, MessageGroup } from \"../types/chat-types\";\nimport type { ChatAttachment, ChatQueueItem } from \"../ui-types\";\nimport {\n  renderMessageGroup,\n  renderReadingIndicatorGroup,\n  renderStreamingGroup,\n} from \"../chat/grouped-render\";\nimport { normalizeMessage, normalizeRoleForGrouping } from \"../chat/message-normalizer\";\nimport { icons } from \"../icons\";\nimport { renderMarkdownSidebar } from \"./markdown-sidebar\";\nimport \"../components/resizable-divider\";\n\nexport type CompactionIndicatorStatus = {\n  active: boolean;\n  startedAt: number | null;\n  completedAt: number | null;\n};\n\nexport type ChatProps = {\n  sessionKey: string;\n  onSessionKeyChange: (next: string) => void;\n  thinkingLevel: string | null;\n  showThinking: boolean;\n  loading: boolean;\n  sending: boolean;\n  canAbort?: boolean;\n  compactionStatus?: CompactionIndicatorStatus | null;\n  messages: unknown[];\n  toolMessages: unknown[];\n  stream: string | null;\n  streamStartedAt: number | null;\n  assistantAvatarUrl?: string | null;\n  draft: string;\n  queue: ChatQueueItem[];\n  connected: boolean;\n  canSend: boolean;\n  disabledReason: string | null;\n  error: string | null;\n  sessions: SessionsListResult | null;\n  // Focus mode\n  focusMode: boolean;\n  // Sidebar state\n  sidebarOpen?: boolean;\n  sidebarContent?: string | null;\n  sidebarError?: string | null;\n  splitRatio?: number;\n  assistantName: string;\n  assistantAvatar: string | null;\n  // Image attachments\n  attachments?: ChatAttachment[];\n  onAttachmentsChange?: (attachments: ChatAttachment[]) => void;\n  // Scroll control\n  showNewMessages?: boolean;\n  onScrollToBottom?: () => void;\n  // Event handlers\n  onRefresh: () => void;\n  onToggleFocusMode: () => void;\n  onDraftChange: (next: string) => void;\n  onSend: () => void;\n  onAbort?: () => void;\n  onQueueRemove: (id: string) => void;\n  onNewSession: () => void;\n  onOpenSidebar?: (content: string) => void;\n  onCloseSidebar?: () => void;\n  onSplitRatioChange?: (ratio: number) => void;\n  onChatScroll?: (event: Event) => void;\n};\n\nconst COMPACTION_TOAST_DURATION_MS = 5000;\n\nfunction adjustTextareaHeight(el: HTMLTextAreaElement) {\n  el.style.height = \"auto\";\n  el.style.height = `${el.scrollHeight}px`;\n}\n\nfunction renderCompactionIndicator(status: CompactionIndicatorStatus | null | undefined) {\n  if (!status) {\n    return nothing;\n  }\n\n  // Show \"compacting...\" while active\n  if (status.active) {\n    return html`\n      <div class=\"callout info compaction-indicator compaction-indicator--active\">\n        ${icons.loader} Compacting context...\n      </div>\n    `;\n  }\n\n  // Show \"compaction complete\" briefly after completion\n  if (status.completedAt) {\n    const elapsed = Date.now() - status.completedAt;\n    if (elapsed < COMPACTION_TOAST_DURATION_MS) {\n      return html`\n        <div class=\"callout success compaction-indicator compaction-indicator--complete\">\n          ${icons.check} Context compacted\n        </div>\n      `;\n    }\n  }\n\n  return nothing;\n}\n\nfunction generateAttachmentId(): string {\n  return `att-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n}\n\nfunction handlePaste(e: ClipboardEvent, props: ChatProps) {\n  const items = e.clipboardData?.items;\n  if (!items || !props.onAttachmentsChange) {\n    return;\n  }\n\n  const imageItems: DataTransferItem[] = [];\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i];\n    if (item.type.startsWith(\"image/\")) {\n      imageItems.push(item);\n    }\n  }\n\n  if (imageItems.length === 0) {\n    return;\n  }\n\n  e.preventDefault();\n\n  for (const item of imageItems) {\n    const file = item.getAsFile();\n    if (!file) {\n      continue;\n    }\n\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => {\n      const dataUrl = reader.result as string;\n      const newAttachment: ChatAttachment = {\n        id: generateAttachmentId(),\n        dataUrl,\n        mimeType: file.type,\n      };\n      const current = props.attachments ?? [];\n      props.onAttachmentsChange?.([...current, newAttachment]);\n    });\n    reader.readAsDataURL(file);\n  }\n}\n\nfunction renderAttachmentPreview(props: ChatProps) {\n  const attachments = props.attachments ?? [];\n  if (attachments.length === 0) {\n    return nothing;\n  }\n\n  return html`\n    <div class=\"chat-attachments\">\n      ${attachments.map(\n        (att) => html`\n          <div class=\"chat-attachment\">\n            <img\n              src=${att.dataUrl}\n              alt=\"Attachment preview\"\n              class=\"chat-attachment__img\"\n            />\n            <button\n              class=\"chat-attachment__remove\"\n              type=\"button\"\n              aria-label=\"Remove attachment\"\n              @click=${() => {\n                const next = (props.attachments ?? []).filter((a) => a.id !== att.id);\n                props.onAttachmentsChange?.(next);\n              }}\n            >\n              ${icons.x}\n            </button>\n          </div>\n        `,\n      )}\n    </div>\n  `;\n}\n\nexport function renderChat(props: ChatProps) {\n  const canCompose = props.connected;\n  const isBusy = props.sending || props.stream !== null;\n  const canAbort = Boolean(props.canAbort && props.onAbort);\n  const activeSession = props.sessions?.sessions?.find((row) => row.key === props.sessionKey);\n  const reasoningLevel = activeSession?.reasoningLevel ?? \"off\";\n  const showReasoning = props.showThinking && reasoningLevel !== \"off\";\n  const assistantIdentity = {\n    name: props.assistantName,\n    avatar: props.assistantAvatar ?? props.assistantAvatarUrl ?? null,\n  };\n\n  const hasAttachments = (props.attachments?.length ?? 0) > 0;\n  const composePlaceholder = props.connected\n    ? hasAttachments\n      ? \"Add a message or paste more images...\"\n      : \"Message (â†© to send, Shift+â†© for line breaks, paste images)\"\n    : \"Connect to the gateway to start chattingâ€¦\";\n\n  const splitRatio = props.splitRatio ?? 0.6;\n  const sidebarOpen = Boolean(props.sidebarOpen && props.onCloseSidebar);\n  const thread = html`\n    <div\n      class=\"chat-thread\"\n      role=\"log\"\n      aria-live=\"polite\"\n      @scroll=${props.onChatScroll}\n    >\n      ${\n        props.loading\n          ? html`\n              <div class=\"muted\">Loading chatâ€¦</div>\n            `\n          : nothing\n      }\n      ${repeat(\n        buildChatItems(props),\n        (item) => item.key,\n        (item) => {\n          if (item.kind === \"reading-indicator\") {\n            return renderReadingIndicatorGroup(assistantIdentity);\n          }\n\n          if (item.kind === \"stream\") {\n            return renderStreamingGroup(\n              item.text,\n              item.startedAt,\n              props.onOpenSidebar,\n              assistantIdentity,\n            );\n          }\n\n          if (item.kind === \"group\") {\n            return renderMessageGroup(item, {\n              onOpenSidebar: props.onOpenSidebar,\n              showReasoning,\n              assistantName: props.assistantName,\n              assistantAvatar: assistantIdentity.avatar,\n            });\n          }\n\n          return nothing;\n        },\n      )}\n    </div>\n  `;\n\n  return html`\n    <section class=\"card chat\">\n      ${props.disabledReason ? html`<div class=\"callout\">${props.disabledReason}</div>` : nothing}\n\n      ${props.error ? html`<div class=\"callout danger\">${props.error}</div>` : nothing}\n\n      ${renderCompactionIndicator(props.compactionStatus)}\n\n      ${\n        props.focusMode\n          ? html`\n            <button\n              class=\"chat-focus-exit\"\n              type=\"button\"\n              @click=${props.onToggleFocusMode}\n              aria-label=\"Exit focus mode\"\n              title=\"Exit focus mode\"\n            >\n              ${icons.x}\n            </button>\n          `\n          : nothing\n      }\n\n      <div\n        class=\"chat-split-container ${sidebarOpen ? \"chat-split-container--open\" : \"\"}\"\n      >\n        <div\n          class=\"chat-main\"\n          style=\"flex: ${sidebarOpen ? `0 0 ${splitRatio * 100}%` : \"1 1 100%\"}\"\n        >\n          ${thread}\n        </div>\n\n        ${\n          sidebarOpen\n            ? html`\n              <resizable-divider\n                .splitRatio=${splitRatio}\n                @resize=${(e: CustomEvent) => props.onSplitRatioChange?.(e.detail.splitRatio)}\n              ></resizable-divider>\n              <div class=\"chat-sidebar\">\n                ${renderMarkdownSidebar({\n                  content: props.sidebarContent ?? null,\n                  error: props.sidebarError ?? null,\n                  onClose: props.onCloseSidebar!,\n                  onViewRawText: () => {\n                    if (!props.sidebarContent || !props.onOpenSidebar) {\n                      return;\n                    }\n                    props.onOpenSidebar(`\\`\\`\\`\\n${props.sidebarContent}\\n\\`\\`\\``);\n                  },\n                })}\n              </div>\n            `\n            : nothing\n        }\n      </div>\n\n      ${\n        props.queue.length\n          ? html`\n            <div class=\"chat-queue\" role=\"status\" aria-live=\"polite\">\n              <div class=\"chat-queue__title\">Queued (${props.queue.length})</div>\n              <div class=\"chat-queue__list\">\n                ${props.queue.map(\n                  (item) => html`\n                    <div class=\"chat-queue__item\">\n                      <div class=\"chat-queue__text\">\n                        ${\n                          item.text ||\n                          (item.attachments?.length ? `Image (${item.attachments.length})` : \"\")\n                        }\n                      </div>\n                      <button\n                        class=\"btn chat-queue__remove\"\n                        type=\"button\"\n                        aria-label=\"Remove queued message\"\n                        @click=${() => props.onQueueRemove(item.id)}\n                      >\n                        ${icons.x}\n                      </button>\n                    </div>\n                  `,\n                )}\n              </div>\n            </div>\n          `\n          : nothing\n      }\n\n      ${\n        props.showNewMessages\n          ? html`\n            <button\n              class=\"chat-new-messages\"\n              type=\"button\"\n              @click=${props.onScrollToBottom}\n            >\n              New messages ${icons.arrowDown}\n            </button>\n          `\n          : nothing\n      }\n\n      <div class=\"chat-compose\">\n        ${renderAttachmentPreview(props)}\n        <div class=\"chat-compose__row\">\n          <label class=\"field chat-compose__field\">\n            <span>Message</span>\n            <textarea\n              ${ref((el) => el && adjustTextareaHeight(el as HTMLTextAreaElement))}\n              .value=${props.draft}\n              ?disabled=${!props.connected}\n              @keydown=${(e: KeyboardEvent) => {\n                if (e.key !== \"Enter\") {\n                  return;\n                }\n                if (e.isComposing || e.keyCode === 229) {\n                  return;\n                }\n                if (e.shiftKey) {\n                  return;\n                } // Allow Shift+Enter for line breaks\n                if (!props.connected) {\n                  return;\n                }\n                e.preventDefault();\n                if (canCompose) {\n                  props.onSend();\n                }\n              }}\n              @input=${(e: Event) => {\n                const target = e.target as HTMLTextAreaElement;\n                adjustTextareaHeight(target);\n                props.onDraftChange(target.value);\n              }}\n              @paste=${(e: ClipboardEvent) => handlePaste(e, props)}\n              placeholder=${composePlaceholder}\n            ></textarea>\n          </label>\n          <div class=\"chat-compose__actions\">\n            <button\n              class=\"btn\"\n              ?disabled=${!props.connected || (!canAbort && props.sending)}\n              @click=${canAbort ? props.onAbort : props.onNewSession}\n            >\n              ${canAbort ? \"Stop\" : \"New session\"}\n            </button>\n            <button\n              class=\"btn primary\"\n              ?disabled=${!props.connected}\n              @click=${props.onSend}\n            >\n              ${isBusy ? \"Queue\" : \"Send\"}<kbd class=\"btn-kbd\">â†µ</kbd>\n            </button>\n          </div>\n        </div>\n      </div>\n    </section>\n  `;\n}\n\nconst CHAT_HISTORY_RENDER_LIMIT = 200;\n\nfunction groupMessages(items: ChatItem[]): Array<ChatItem | MessageGroup> {\n  const result: Array<ChatItem | MessageGroup> = [];\n  let currentGroup: MessageGroup | null = null;\n\n  for (const item of items) {\n    if (item.kind !== \"message\") {\n      if (currentGroup) {\n        result.push(currentGroup);\n        currentGroup = null;\n      }\n      result.push(item);\n      continue;\n    }\n\n    const normalized = normalizeMessage(item.message);\n    const role = normalizeRoleForGrouping(normalized.role);\n    const timestamp = normalized.timestamp || Date.now();\n\n    if (!currentGroup || currentGroup.role !== role) {\n      if (currentGroup) {\n        result.push(currentGroup);\n      }\n      currentGroup = {\n        kind: \"group\",\n        key: `group:${role}:${item.key}`,\n        role,\n        messages: [{ message: item.message, key: item.key }],\n        timestamp,\n        isStreaming: false,\n      };\n    } else {\n      currentGroup.messages.push({ message: item.message, key: item.key });\n    }\n  }\n\n  if (currentGroup) {\n    result.push(currentGroup);\n  }\n  return result;\n}\n\nfunction buildChatItems(props: ChatProps): Array<ChatItem | MessageGroup> {\n  const items: ChatItem[] = [];\n  const history = Array.isArray(props.messages) ? props.messages : [];\n  const tools = Array.isArray(props.toolMessages) ? props.toolMessages : [];\n  const historyStart = Math.max(0, history.length - CHAT_HISTORY_RENDER_LIMIT);\n  if (historyStart > 0) {\n    items.push({\n      kind: \"message\",\n      key: \"chat:history:notice\",\n      message: {\n        role: \"system\",\n        content: `Showing last ${CHAT_HISTORY_RENDER_LIMIT} messages (${historyStart} hidden).`,\n        timestamp: Date.now(),\n      },\n    });\n  }\n  for (let i = historyStart; i < history.length; i++) {\n    const msg = history[i];\n    const normalized = normalizeMessage(msg);\n\n    if (!props.showThinking && normalized.role.toLowerCase() === \"toolresult\") {\n      continue;\n    }\n\n    items.push({\n      kind: \"message\",\n      key: messageKey(msg, i),\n      message: msg,\n    });\n  }\n  if (props.showThinking) {\n    for (let i = 0; i < tools.length; i++) {\n      items.push({\n        kind: \"message\",\n        key: messageKey(tools[i], i + history.length),\n        message: tools[i],\n      });\n    }\n  }\n\n  if (props.stream !== null) {\n    const key = `stream:${props.sessionKey}:${props.streamStartedAt ?? \"live\"}`;\n    if (props.stream.trim().length > 0) {\n      items.push({\n        kind: \"stream\",\n        key,\n        text: props.stream,\n        startedAt: props.streamStartedAt ?? Date.now(),\n      });\n    } else {\n      items.push({ kind: \"reading-indicator\", key });\n    }\n  }\n\n  return groupMessages(items);\n}\n\nfunction messageKey(message: unknown, index: number): string {\n  const m = message as Record<string, unknown>;\n  const toolCallId = typeof m.toolCallId === \"string\" ? m.toolCallId : \"\";\n  if (toolCallId) {\n    return `tool:${toolCallId}`;\n  }\n  const id = typeof m.id === \"string\" ? m.id : \"\";\n  if (id) {\n    return `msg:${id}`;\n  }\n  const messageId = typeof m.messageId === \"string\" ? m.messageId : \"\";\n  if (messageId) {\n    return `msg:${messageId}`;\n  }\n  const timestamp = typeof m.timestamp === \"number\" ? m.timestamp : null;\n  const role = typeof m.role === \"string\" ? m.role : \"unknown\";\n  if (timestamp != null) {\n    return `msg:${role}:${timestamp}:${index}`;\n  }\n  return `msg:${role}:${index}`;\n}\n","import { html, nothing } from \"lit\";\nimport type { ConfigUiHints } from \"../types\";\nimport { analyzeConfigSchema, renderConfigForm, SECTION_META } from \"./config-form\";\nimport { hintForPath, humanize, schemaType, type JsonSchema } from \"./config-form.shared\";\n\nexport type ConfigProps = {\n  raw: string;\n  originalRaw: string;\n  valid: boolean | null;\n  issues: unknown[];\n  loading: boolean;\n  saving: boolean;\n  applying: boolean;\n  updating: boolean;\n  connected: boolean;\n  schema: unknown;\n  schemaLoading: boolean;\n  uiHints: ConfigUiHints;\n  formMode: \"form\" | \"raw\";\n  formValue: Record<string, unknown> | null;\n  originalValue: Record<string, unknown> | null;\n  searchQuery: string;\n  activeSection: string | null;\n  activeSubsection: string | null;\n  onRawChange: (next: string) => void;\n  onFormModeChange: (mode: \"form\" | \"raw\") => void;\n  onFormPatch: (path: Array<string | number>, value: unknown) => void;\n  onSearchChange: (query: string) => void;\n  onSectionChange: (section: string | null) => void;\n  onSubsectionChange: (section: string | null) => void;\n  onReload: () => void;\n  onSave: () => void;\n  onApply: () => void;\n  onUpdate: () => void;\n};\n\n// SVG Icons for sidebar (Lucide-style)\nconst sidebarIcons = {\n  all: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect>\n      <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect>\n      <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect>\n      <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect>\n    </svg>\n  `,\n  env: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n      <path\n        d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n      ></path>\n    </svg>\n  `,\n  update: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n      <polyline points=\"7 10 12 15 17 10\"></polyline>\n      <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n    </svg>\n  `,\n  agents: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path\n        d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"\n      ></path>\n      <circle cx=\"8\" cy=\"14\" r=\"1\"></circle>\n      <circle cx=\"16\" cy=\"14\" r=\"1\"></circle>\n    </svg>\n  `,\n  auth: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\n      <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\n    </svg>\n  `,\n  channels: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n    </svg>\n  `,\n  messages: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\n      <polyline points=\"22,6 12,13 2,6\"></polyline>\n    </svg>\n  `,\n  commands: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <polyline points=\"4 17 10 11 4 5\"></polyline>\n      <line x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"></line>\n    </svg>\n  `,\n  hooks: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\n    </svg>\n  `,\n  skills: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <polygon\n        points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"\n      ></polygon>\n    </svg>\n  `,\n  tools: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\n      ></path>\n    </svg>\n  `,\n  gateway: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\n      <path\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\n      ></path>\n    </svg>\n  `,\n  wizard: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M15 4V2\"></path>\n      <path d=\"M15 16v-2\"></path>\n      <path d=\"M8 9h2\"></path>\n      <path d=\"M20 9h2\"></path>\n      <path d=\"M17.8 11.8 19 13\"></path>\n      <path d=\"M15 9h0\"></path>\n      <path d=\"M17.8 6.2 19 5\"></path>\n      <path d=\"m3 21 9-9\"></path>\n      <path d=\"M12.2 6.2 11 5\"></path>\n    </svg>\n  `,\n  // Additional sections\n  meta: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M12 20h9\"></path>\n      <path d=\"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\"></path>\n    </svg>\n  `,\n  logging: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n      <polyline points=\"10 9 9 9 8 9\"></polyline>\n    </svg>\n  `,\n  browser: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\n      <line x1=\"21.17\" y1=\"8\" x2=\"12\" y2=\"8\"></line>\n      <line x1=\"3.95\" y1=\"6.06\" x2=\"8.54\" y2=\"14\"></line>\n      <line x1=\"10.88\" y1=\"21.94\" x2=\"15.46\" y2=\"14\"></line>\n    </svg>\n  `,\n  ui: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\n      <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\n    </svg>\n  `,\n  models: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path\n        d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"\n      ></path>\n      <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline>\n      <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line>\n    </svg>\n  `,\n  bindings: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\n      <rect x=\"2\" y=\"14\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\n      <line x1=\"6\" y1=\"6\" x2=\"6.01\" y2=\"6\"></line>\n      <line x1=\"6\" y1=\"18\" x2=\"6.01\" y2=\"18\"></line>\n    </svg>\n  `,\n  broadcast: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M4.9 19.1C1 15.2 1 8.8 4.9 4.9\"></path>\n      <path d=\"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5\"></path>\n      <circle cx=\"12\" cy=\"12\" r=\"2\"></circle>\n      <path d=\"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5\"></path>\n      <path d=\"M19.1 4.9C23 8.8 23 15.1 19.1 19\"></path>\n    </svg>\n  `,\n  audio: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M9 18V5l12-2v13\"></path>\n      <circle cx=\"6\" cy=\"18\" r=\"3\"></circle>\n      <circle cx=\"18\" cy=\"16\" r=\"3\"></circle>\n    </svg>\n  `,\n  session: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\n      <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\n      <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path>\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\n    </svg>\n  `,\n  cron: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <polyline points=\"12 6 12 12 16 14\"></polyline>\n    </svg>\n  `,\n  web: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\n      <path\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\n      ></path>\n    </svg>\n  `,\n  discovery: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n      <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\n    </svg>\n  `,\n  canvasHost: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n      <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\n      <polyline points=\"21 15 16 10 5 21\"></polyline>\n    </svg>\n  `,\n  talk: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"></path>\n      <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"></path>\n      <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"></line>\n      <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"></line>\n    </svg>\n  `,\n  plugins: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M12 2v6\"></path>\n      <path d=\"m4.93 10.93 4.24 4.24\"></path>\n      <path d=\"M2 12h6\"></path>\n      <path d=\"m4.93 13.07 4.24-4.24\"></path>\n      <path d=\"M12 22v-6\"></path>\n      <path d=\"m19.07 13.07-4.24-4.24\"></path>\n      <path d=\"M22 12h-6\"></path>\n      <path d=\"m19.07 10.93-4.24 4.24\"></path>\n    </svg>\n  `,\n  default: html`\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\n    </svg>\n  `,\n};\n\n// Section definitions\nconst SECTIONS: Array<{ key: string; label: string }> = [\n  { key: \"env\", label: \"Environment\" },\n  { key: \"update\", label: \"Updates\" },\n  { key: \"agents\", label: \"Agents\" },\n  { key: \"auth\", label: \"Authentication\" },\n  { key: \"channels\", label: \"Channels\" },\n  { key: \"messages\", label: \"Messages\" },\n  { key: \"commands\", label: \"Commands\" },\n  { key: \"hooks\", label: \"Hooks\" },\n  { key: \"skills\", label: \"Skills\" },\n  { key: \"tools\", label: \"Tools\" },\n  { key: \"gateway\", label: \"Gateway\" },\n  { key: \"wizard\", label: \"Setup Wizard\" },\n];\n\ntype SubsectionEntry = {\n  key: string;\n  label: string;\n  description?: string;\n  order: number;\n};\n\nconst ALL_SUBSECTION = \"__all__\";\n\nfunction getSectionIcon(key: string) {\n  return sidebarIcons[key as keyof typeof sidebarIcons] ?? sidebarIcons.default;\n}\n\nfunction resolveSectionMeta(\n  key: string,\n  schema?: JsonSchema,\n): {\n  label: string;\n  description?: string;\n} {\n  const meta = SECTION_META[key];\n  if (meta) {\n    return meta;\n  }\n  return {\n    label: schema?.title ?? humanize(key),\n    description: schema?.description ?? \"\",\n  };\n}\n\nfunction resolveSubsections(params: {\n  key: string;\n  schema: JsonSchema | undefined;\n  uiHints: ConfigUiHints;\n}): SubsectionEntry[] {\n  const { key, schema, uiHints } = params;\n  if (!schema || schemaType(schema) !== \"object\" || !schema.properties) {\n    return [];\n  }\n  const entries = Object.entries(schema.properties).map(([subKey, node]) => {\n    const hint = hintForPath([key, subKey], uiHints);\n    const label = hint?.label ?? node.title ?? humanize(subKey);\n    const description = hint?.help ?? node.description ?? \"\";\n    const order = hint?.order ?? 50;\n    return { key: subKey, label, description, order };\n  });\n  entries.sort((a, b) => (a.order !== b.order ? a.order - b.order : a.key.localeCompare(b.key)));\n  return entries;\n}\n\nfunction computeDiff(\n  original: Record<string, unknown> | null,\n  current: Record<string, unknown> | null,\n): Array<{ path: string; from: unknown; to: unknown }> {\n  if (!original || !current) {\n    return [];\n  }\n  const changes: Array<{ path: string; from: unknown; to: unknown }> = [];\n\n  function compare(orig: unknown, curr: unknown, path: string) {\n    if (orig === curr) {\n      return;\n    }\n    if (typeof orig !== typeof curr) {\n      changes.push({ path, from: orig, to: curr });\n      return;\n    }\n    if (typeof orig !== \"object\" || orig === null || curr === null) {\n      if (orig !== curr) {\n        changes.push({ path, from: orig, to: curr });\n      }\n      return;\n    }\n    if (Array.isArray(orig) && Array.isArray(curr)) {\n      if (JSON.stringify(orig) !== JSON.stringify(curr)) {\n        changes.push({ path, from: orig, to: curr });\n      }\n      return;\n    }\n    const origObj = orig as Record<string, unknown>;\n    const currObj = curr as Record<string, unknown>;\n    const allKeys = new Set([...Object.keys(origObj), ...Object.keys(currObj)]);\n    for (const key of allKeys) {\n      compare(origObj[key], currObj[key], path ? `${path}.${key}` : key);\n    }\n  }\n\n  compare(original, current, \"\");\n  return changes;\n}\n\nfunction truncateValue(value: unknown, maxLen = 40): string {\n  let str: string;\n  try {\n    const json = JSON.stringify(value);\n    str = json ?? String(value);\n  } catch {\n    str = String(value);\n  }\n  if (str.length <= maxLen) {\n    return str;\n  }\n  return str.slice(0, maxLen - 3) + \"...\";\n}\n\nexport function renderConfig(props: ConfigProps) {\n  const validity = props.valid == null ? \"unknown\" : props.valid ? \"valid\" : \"invalid\";\n  const analysis = analyzeConfigSchema(props.schema);\n  const formUnsafe = analysis.schema ? analysis.unsupportedPaths.length > 0 : false;\n\n  // Get available sections from schema\n  const schemaProps = analysis.schema?.properties ?? {};\n  const availableSections = SECTIONS.filter((s) => s.key in schemaProps);\n\n  // Add any sections in schema but not in our list\n  const knownKeys = new Set(SECTIONS.map((s) => s.key));\n  const extraSections = Object.keys(schemaProps)\n    .filter((k) => !knownKeys.has(k))\n    .map((k) => ({ key: k, label: k.charAt(0).toUpperCase() + k.slice(1) }));\n\n  const allSections = [...availableSections, ...extraSections];\n\n  const activeSectionSchema =\n    props.activeSection && analysis.schema && schemaType(analysis.schema) === \"object\"\n      ? analysis.schema.properties?.[props.activeSection]\n      : undefined;\n  const activeSectionMeta = props.activeSection\n    ? resolveSectionMeta(props.activeSection, activeSectionSchema)\n    : null;\n  const subsections = props.activeSection\n    ? resolveSubsections({\n        key: props.activeSection,\n        schema: activeSectionSchema,\n        uiHints: props.uiHints,\n      })\n    : [];\n  const allowSubnav =\n    props.formMode === \"form\" && Boolean(props.activeSection) && subsections.length > 0;\n  const isAllSubsection = props.activeSubsection === ALL_SUBSECTION;\n  const effectiveSubsection = props.searchQuery\n    ? null\n    : isAllSubsection\n      ? null\n      : (props.activeSubsection ?? subsections[0]?.key ?? null);\n\n  // Compute diff for showing changes (works for both form and raw modes)\n  const diff = props.formMode === \"form\" ? computeDiff(props.originalValue, props.formValue) : [];\n  const hasRawChanges = props.formMode === \"raw\" && props.raw !== props.originalRaw;\n  const hasChanges = props.formMode === \"form\" ? diff.length > 0 : hasRawChanges;\n\n  // Save/apply buttons require actual changes to be enabled.\n  // Note: formUnsafe warns about unsupported schema paths but shouldn't block saving.\n  const canSaveForm = Boolean(props.formValue) && !props.loading && Boolean(analysis.schema);\n  const canSave =\n    props.connected &&\n    !props.saving &&\n    hasChanges &&\n    (props.formMode === \"raw\" ? true : canSaveForm);\n  const canApply =\n    props.connected &&\n    !props.applying &&\n    !props.updating &&\n    hasChanges &&\n    (props.formMode === \"raw\" ? true : canSaveForm);\n  const canUpdate = props.connected && !props.applying && !props.updating;\n\n  return html`\n    <div class=\"config-layout\">\n      <!-- Sidebar -->\n      <aside class=\"config-sidebar\">\n        <div class=\"config-sidebar__header\">\n          <div class=\"config-sidebar__title\">Settings</div>\n          <span\n            class=\"pill pill--sm ${\n              validity === \"valid\" ? \"pill--ok\" : validity === \"invalid\" ? \"pill--danger\" : \"\"\n            }\"\n            >${validity}</span\n          >\n        </div>\n\n        <!-- Search -->\n        <div class=\"config-search\">\n          <svg\n            class=\"config-search__icon\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            stroke-width=\"2\"\n          >\n            <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n            <path d=\"M21 21l-4.35-4.35\"></path>\n          </svg>\n          <input\n            type=\"text\"\n            class=\"config-search__input\"\n            placeholder=\"Search settings...\"\n            .value=${props.searchQuery}\n            @input=${(e: Event) => props.onSearchChange((e.target as HTMLInputElement).value)}\n          />\n          ${\n            props.searchQuery\n              ? html`\n                <button\n                  class=\"config-search__clear\"\n                  @click=${() => props.onSearchChange(\"\")}\n                >\n                  Ã—\n                </button>\n              `\n              : nothing\n          }\n        </div>\n\n        <!-- Section nav -->\n        <nav class=\"config-nav\">\n          <button\n            class=\"config-nav__item ${props.activeSection === null ? \"active\" : \"\"}\"\n            @click=${() => props.onSectionChange(null)}\n          >\n            <span class=\"config-nav__icon\">${sidebarIcons.all}</span>\n            <span class=\"config-nav__label\">All Settings</span>\n          </button>\n          ${allSections.map(\n            (section) => html`\n              <button\n                class=\"config-nav__item ${props.activeSection === section.key ? \"active\" : \"\"}\"\n                @click=${() => props.onSectionChange(section.key)}\n              >\n                <span class=\"config-nav__icon\"\n                  >${getSectionIcon(section.key)}</span\n                >\n                <span class=\"config-nav__label\">${section.label}</span>\n              </button>\n            `,\n          )}\n        </nav>\n\n        <!-- Mode toggle at bottom -->\n        <div class=\"config-sidebar__footer\">\n          <div class=\"config-mode-toggle\">\n            <button\n              class=\"config-mode-toggle__btn ${props.formMode === \"form\" ? \"active\" : \"\"}\"\n              ?disabled=${props.schemaLoading || !props.schema}\n              @click=${() => props.onFormModeChange(\"form\")}\n            >\n              Form\n            </button>\n            <button\n              class=\"config-mode-toggle__btn ${props.formMode === \"raw\" ? \"active\" : \"\"}\"\n              @click=${() => props.onFormModeChange(\"raw\")}\n            >\n              Raw\n            </button>\n          </div>\n        </div>\n      </aside>\n\n      <!-- Main content -->\n      <main class=\"config-main\">\n        <!-- Action bar -->\n        <div class=\"config-actions\">\n          <div class=\"config-actions__left\">\n            ${\n              hasChanges\n                ? html`\n                  <span class=\"config-changes-badge\"\n                    >${\n                      props.formMode === \"raw\"\n                        ? \"Unsaved changes\"\n                        : `${diff.length} unsaved change${diff.length !== 1 ? \"s\" : \"\"}`\n                    }</span\n                  >\n                `\n                : html`\n                    <span class=\"config-status muted\">No changes</span>\n                  `\n            }\n          </div>\n          <div class=\"config-actions__right\">\n            <button\n              class=\"btn btn--sm\"\n              ?disabled=${props.loading}\n              @click=${props.onReload}\n            >\n              ${props.loading ? \"Loadingâ€¦\" : \"Reload\"}\n            </button>\n            <button\n              class=\"btn btn--sm primary\"\n              ?disabled=${!canSave}\n              @click=${props.onSave}\n            >\n              ${props.saving ? \"Savingâ€¦\" : \"Save\"}\n            </button>\n            <button\n              class=\"btn btn--sm\"\n              ?disabled=${!canApply}\n              @click=${props.onApply}\n            >\n              ${props.applying ? \"Applyingâ€¦\" : \"Apply\"}\n            </button>\n            <button\n              class=\"btn btn--sm\"\n              ?disabled=${!canUpdate}\n              @click=${props.onUpdate}\n            >\n              ${props.updating ? \"Updatingâ€¦\" : \"Update\"}\n            </button>\n          </div>\n        </div>\n\n        <!-- Diff panel (form mode only - raw mode doesn't have granular diff) -->\n        ${\n          hasChanges && props.formMode === \"form\"\n            ? html`\n              <details class=\"config-diff\">\n                <summary class=\"config-diff__summary\">\n                  <span\n                    >View ${diff.length} pending\n                    change${diff.length !== 1 ? \"s\" : \"\"}</span\n                  >\n                  <svg\n                    class=\"config-diff__chevron\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    stroke-width=\"2\"\n                  >\n                    <polyline points=\"6 9 12 15 18 9\"></polyline>\n                  </svg>\n                </summary>\n                <div class=\"config-diff__content\">\n                  ${diff.map(\n                    (change) => html`\n                      <div class=\"config-diff__item\">\n                        <div class=\"config-diff__path\">${change.path}</div>\n                        <div class=\"config-diff__values\">\n                          <span class=\"config-diff__from\"\n                            >${truncateValue(change.from)}</span\n                          >\n                          <span class=\"config-diff__arrow\">â†’</span>\n                          <span class=\"config-diff__to\"\n                            >${truncateValue(change.to)}</span\n                          >\n                        </div>\n                      </div>\n                    `,\n                  )}\n                </div>\n              </details>\n            `\n            : nothing\n        }\n        ${\n          activeSectionMeta && props.formMode === \"form\"\n            ? html`\n              <div class=\"config-section-hero\">\n                <div class=\"config-section-hero__icon\">\n                  ${getSectionIcon(props.activeSection ?? \"\")}\n                </div>\n                <div class=\"config-section-hero__text\">\n                  <div class=\"config-section-hero__title\">\n                    ${activeSectionMeta.label}\n                  </div>\n                  ${\n                    activeSectionMeta.description\n                      ? html`<div class=\"config-section-hero__desc\">\n                        ${activeSectionMeta.description}\n                      </div>`\n                      : nothing\n                  }\n                </div>\n              </div>\n            `\n            : nothing\n        }\n        ${\n          allowSubnav\n            ? html`\n              <div class=\"config-subnav\">\n                <button\n                  class=\"config-subnav__item ${effectiveSubsection === null ? \"active\" : \"\"}\"\n                  @click=${() => props.onSubsectionChange(ALL_SUBSECTION)}\n                >\n                  All\n                </button>\n                ${subsections.map(\n                  (entry) => html`\n                    <button\n                      class=\"config-subnav__item ${\n                        effectiveSubsection === entry.key ? \"active\" : \"\"\n                      }\"\n                      title=${entry.description || entry.label}\n                      @click=${() => props.onSubsectionChange(entry.key)}\n                    >\n                      ${entry.label}\n                    </button>\n                  `,\n                )}\n              </div>\n            `\n            : nothing\n        }\n\n        <!-- Form content -->\n        <div class=\"config-content\">\n          ${\n            props.formMode === \"form\"\n              ? html`\n                ${\n                  props.schemaLoading\n                    ? html`\n                        <div class=\"config-loading\">\n                          <div class=\"config-loading__spinner\"></div>\n                          <span>Loading schemaâ€¦</span>\n                        </div>\n                      `\n                    : renderConfigForm({\n                        schema: analysis.schema,\n                        uiHints: props.uiHints,\n                        value: props.formValue,\n                        disabled: props.loading || !props.formValue,\n                        unsupportedPaths: analysis.unsupportedPaths,\n                        onPatch: props.onFormPatch,\n                        searchQuery: props.searchQuery,\n                        activeSection: props.activeSection,\n                        activeSubsection: effectiveSubsection,\n                      })\n                }\n                ${\n                  formUnsafe\n                    ? html`\n                        <div class=\"callout danger\" style=\"margin-top: 12px\">\n                          Form view can't safely edit some fields. Use Raw to avoid losing config entries.\n                        </div>\n                      `\n                    : nothing\n                }\n              `\n              : html`\n                <label class=\"field config-raw-field\">\n                  <span>Raw JSON5</span>\n                  <textarea\n                    .value=${props.raw}\n                    @input=${(e: Event) =>\n                      props.onRawChange((e.target as HTMLTextAreaElement).value)}\n                  ></textarea>\n                </label>\n              `\n          }\n        </div>\n\n        ${\n          props.issues.length > 0\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n              <pre class=\"code-block\">\n${JSON.stringify(props.issues, null, 2)}</pre\n              >\n            </div>`\n            : nothing\n        }\n      </main>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { ChannelUiMetaEntry, CronJob, CronRunLogEntry, CronStatus } from \"../types\";\nimport type { CronFormState } from \"../ui-types\";\nimport { formatMs } from \"../format\";\nimport {\n  formatCronPayload,\n  formatCronSchedule,\n  formatCronState,\n  formatNextRun,\n} from \"../presenter\";\n\nexport type CronProps = {\n  loading: boolean;\n  status: CronStatus | null;\n  jobs: CronJob[];\n  error: string | null;\n  busy: boolean;\n  form: CronFormState;\n  channels: string[];\n  channelLabels?: Record<string, string>;\n  channelMeta?: ChannelUiMetaEntry[];\n  runsJobId: string | null;\n  runs: CronRunLogEntry[];\n  onFormChange: (patch: Partial<CronFormState>) => void;\n  onRefresh: () => void;\n  onAdd: () => void;\n  onToggle: (job: CronJob, enabled: boolean) => void;\n  onRun: (job: CronJob) => void;\n  onRemove: (job: CronJob) => void;\n  onLoadRuns: (jobId: string) => void;\n};\n\nfunction buildChannelOptions(props: CronProps): string[] {\n  const options = [\"last\", ...props.channels.filter(Boolean)];\n  const current = props.form.channel?.trim();\n  if (current && !options.includes(current)) {\n    options.push(current);\n  }\n  const seen = new Set<string>();\n  return options.filter((value) => {\n    if (seen.has(value)) {\n      return false;\n    }\n    seen.add(value);\n    return true;\n  });\n}\n\nfunction resolveChannelLabel(props: CronProps, channel: string): string {\n  if (channel === \"last\") {\n    return \"last\";\n  }\n  const meta = props.channelMeta?.find((entry) => entry.id === channel);\n  if (meta?.label) {\n    return meta.label;\n  }\n  return props.channelLabels?.[channel] ?? channel;\n}\n\nexport function renderCron(props: CronProps) {\n  const channelOptions = buildChannelOptions(props);\n  return html`\n    <section class=\"grid grid-cols-2\">\n      <div class=\"card\">\n        <div class=\"card-title\">Scheduler</div>\n        <div class=\"card-sub\">Gateway-owned cron scheduler status.</div>\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\n          <div class=\"stat\">\n            <div class=\"stat-label\">Enabled</div>\n            <div class=\"stat-value\">\n              ${props.status ? (props.status.enabled ? \"Yes\" : \"No\") : \"n/a\"}\n            </div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Jobs</div>\n            <div class=\"stat-value\">${props.status?.jobs ?? \"n/a\"}</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Next wake</div>\n            <div class=\"stat-value\">${formatNextRun(props.status?.nextWakeAtMs ?? null)}</div>\n          </div>\n        </div>\n        <div class=\"row\" style=\"margin-top: 12px;\">\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n            ${props.loading ? \"Refreshingâ€¦\" : \"Refresh\"}\n          </button>\n          ${props.error ? html`<span class=\"muted\">${props.error}</span>` : nothing}\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-title\">New Job</div>\n        <div class=\"card-sub\">Create a scheduled wakeup or agent run.</div>\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\n          <label class=\"field\">\n            <span>Name</span>\n            <input\n              .value=${props.form.name}\n              @input=${(e: Event) =>\n                props.onFormChange({ name: (e.target as HTMLInputElement).value })}\n            />\n          </label>\n          <label class=\"field\">\n            <span>Description</span>\n            <input\n              .value=${props.form.description}\n              @input=${(e: Event) =>\n                props.onFormChange({ description: (e.target as HTMLInputElement).value })}\n            />\n          </label>\n          <label class=\"field\">\n            <span>Agent ID</span>\n            <input\n              .value=${props.form.agentId}\n              @input=${(e: Event) =>\n                props.onFormChange({ agentId: (e.target as HTMLInputElement).value })}\n              placeholder=\"default\"\n            />\n          </label>\n          <label class=\"field checkbox\">\n            <span>Enabled</span>\n            <input\n              type=\"checkbox\"\n              .checked=${props.form.enabled}\n              @change=${(e: Event) =>\n                props.onFormChange({ enabled: (e.target as HTMLInputElement).checked })}\n            />\n          </label>\n          <label class=\"field\">\n            <span>Schedule</span>\n            <select\n              .value=${props.form.scheduleKind}\n              @change=${(e: Event) =>\n                props.onFormChange({\n                  scheduleKind: (e.target as HTMLSelectElement)\n                    .value as CronFormState[\"scheduleKind\"],\n                })}\n            >\n              <option value=\"every\">Every</option>\n              <option value=\"at\">At</option>\n              <option value=\"cron\">Cron</option>\n            </select>\n          </label>\n        </div>\n        ${renderScheduleFields(props)}\n        <div class=\"form-grid\" style=\"margin-top: 12px;\">\n          <label class=\"field\">\n            <span>Session</span>\n            <select\n              .value=${props.form.sessionTarget}\n              @change=${(e: Event) =>\n                props.onFormChange({\n                  sessionTarget: (e.target as HTMLSelectElement)\n                    .value as CronFormState[\"sessionTarget\"],\n                })}\n            >\n              <option value=\"main\">Main</option>\n              <option value=\"isolated\">Isolated</option>\n            </select>\n          </label>\n          <label class=\"field\">\n            <span>Wake mode</span>\n            <select\n              .value=${props.form.wakeMode}\n              @change=${(e: Event) =>\n                props.onFormChange({\n                  wakeMode: (e.target as HTMLSelectElement).value as CronFormState[\"wakeMode\"],\n                })}\n            >\n              <option value=\"next-heartbeat\">Next heartbeat</option>\n              <option value=\"now\">Now</option>\n            </select>\n          </label>\n          <label class=\"field\">\n            <span>Payload</span>\n            <select\n              .value=${props.form.payloadKind}\n              @change=${(e: Event) =>\n                props.onFormChange({\n                  payloadKind: (e.target as HTMLSelectElement)\n                    .value as CronFormState[\"payloadKind\"],\n                })}\n            >\n              <option value=\"systemEvent\">System event</option>\n              <option value=\"agentTurn\">Agent turn</option>\n            </select>\n          </label>\n        </div>\n        <label class=\"field\" style=\"margin-top: 12px;\">\n          <span>${props.form.payloadKind === \"systemEvent\" ? \"System text\" : \"Agent message\"}</span>\n          <textarea\n            .value=${props.form.payloadText}\n            @input=${(e: Event) =>\n              props.onFormChange({\n                payloadText: (e.target as HTMLTextAreaElement).value,\n              })}\n            rows=\"4\"\n          ></textarea>\n        </label>\n\t          ${\n              props.form.payloadKind === \"agentTurn\"\n                ? html`\n\t              <div class=\"form-grid\" style=\"margin-top: 12px;\">\n                <label class=\"field checkbox\">\n                  <span>Deliver</span>\n                  <input\n                    type=\"checkbox\"\n                    .checked=${props.form.deliver}\n                    @change=${(e: Event) =>\n                      props.onFormChange({\n                        deliver: (e.target as HTMLInputElement).checked,\n                      })}\n                  />\n\t                </label>\n\t                <label class=\"field\">\n\t                  <span>Channel</span>\n\t                  <select\n\t                    .value=${props.form.channel || \"last\"}\n\t                    @change=${(e: Event) =>\n                        props.onFormChange({\n                          channel: (e.target as HTMLSelectElement).value,\n                        })}\n\t                  >\n\t                    ${channelOptions.map(\n                        (channel) =>\n                          html`<option value=${channel}>\n                            ${resolveChannelLabel(props, channel)}\n                          </option>`,\n                      )}\n                  </select>\n                </label>\n                <label class=\"field\">\n                  <span>To</span>\n                  <input\n                    .value=${props.form.to}\n                    @input=${(e: Event) =>\n                      props.onFormChange({ to: (e.target as HTMLInputElement).value })}\n                    placeholder=\"+1555â€¦ or chat id\"\n                  />\n                </label>\n                <label class=\"field\">\n                  <span>Timeout (seconds)</span>\n                  <input\n                    .value=${props.form.timeoutSeconds}\n                    @input=${(e: Event) =>\n                      props.onFormChange({\n                        timeoutSeconds: (e.target as HTMLInputElement).value,\n                      })}\n                  />\n                </label>\n                ${\n                  props.form.sessionTarget === \"isolated\"\n                    ? html`\n                      <label class=\"field\">\n                        <span>Post to main prefix</span>\n                        <input\n                          .value=${props.form.postToMainPrefix}\n                          @input=${(e: Event) =>\n                            props.onFormChange({\n                              postToMainPrefix: (e.target as HTMLInputElement).value,\n                            })}\n                        />\n                      </label>\n                    `\n                    : nothing\n                }\n              </div>\n            `\n                : nothing\n            }\n        <div class=\"row\" style=\"margin-top: 14px;\">\n          <button class=\"btn primary\" ?disabled=${props.busy} @click=${props.onAdd}>\n            ${props.busy ? \"Savingâ€¦\" : \"Add job\"}\n          </button>\n        </div>\n      </div>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Jobs</div>\n      <div class=\"card-sub\">All scheduled jobs stored in the gateway.</div>\n      ${\n        props.jobs.length === 0\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 12px\">No jobs yet.</div>\n            `\n          : html`\n            <div class=\"list\" style=\"margin-top: 12px;\">\n              ${props.jobs.map((job) => renderJob(job, props))}\n            </div>\n          `\n      }\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Run history</div>\n      <div class=\"card-sub\">Latest runs for ${props.runsJobId ?? \"(select a job)\"}.</div>\n      ${\n        props.runsJobId == null\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 12px\">Select a job to inspect run history.</div>\n            `\n          : props.runs.length === 0\n            ? html`\n                <div class=\"muted\" style=\"margin-top: 12px\">No runs yet.</div>\n              `\n            : html`\n              <div class=\"list\" style=\"margin-top: 12px;\">\n                ${props.runs.map((entry) => renderRun(entry))}\n              </div>\n            `\n      }\n    </section>\n  `;\n}\n\nfunction renderScheduleFields(props: CronProps) {\n  const form = props.form;\n  if (form.scheduleKind === \"at\") {\n    return html`\n      <label class=\"field\" style=\"margin-top: 12px;\">\n        <span>Run at</span>\n        <input\n          type=\"datetime-local\"\n          .value=${form.scheduleAt}\n          @input=${(e: Event) =>\n            props.onFormChange({\n              scheduleAt: (e.target as HTMLInputElement).value,\n            })}\n        />\n      </label>\n    `;\n  }\n  if (form.scheduleKind === \"every\") {\n    return html`\n      <div class=\"form-grid\" style=\"margin-top: 12px;\">\n        <label class=\"field\">\n          <span>Every</span>\n          <input\n            .value=${form.everyAmount}\n            @input=${(e: Event) =>\n              props.onFormChange({\n                everyAmount: (e.target as HTMLInputElement).value,\n              })}\n          />\n        </label>\n        <label class=\"field\">\n          <span>Unit</span>\n          <select\n            .value=${form.everyUnit}\n            @change=${(e: Event) =>\n              props.onFormChange({\n                everyUnit: (e.target as HTMLSelectElement).value as CronFormState[\"everyUnit\"],\n              })}\n          >\n            <option value=\"minutes\">Minutes</option>\n            <option value=\"hours\">Hours</option>\n            <option value=\"days\">Days</option>\n          </select>\n        </label>\n      </div>\n    `;\n  }\n  return html`\n    <div class=\"form-grid\" style=\"margin-top: 12px;\">\n      <label class=\"field\">\n        <span>Expression</span>\n        <input\n          .value=${form.cronExpr}\n          @input=${(e: Event) =>\n            props.onFormChange({ cronExpr: (e.target as HTMLInputElement).value })}\n        />\n      </label>\n      <label class=\"field\">\n        <span>Timezone (optional)</span>\n        <input\n          .value=${form.cronTz}\n          @input=${(e: Event) =>\n            props.onFormChange({ cronTz: (e.target as HTMLInputElement).value })}\n        />\n      </label>\n    </div>\n  `;\n}\n\nfunction renderJob(job: CronJob, props: CronProps) {\n  const isSelected = props.runsJobId === job.id;\n  const itemClass = `list-item list-item-clickable${isSelected ? \" list-item-selected\" : \"\"}`;\n  return html`\n    <div class=${itemClass} @click=${() => props.onLoadRuns(job.id)}>\n      <div class=\"list-main\">\n        <div class=\"list-title\">${job.name}</div>\n        <div class=\"list-sub\">${formatCronSchedule(job)}</div>\n        <div class=\"muted\">${formatCronPayload(job)}</div>\n        ${job.agentId ? html`<div class=\"muted\">Agent: ${job.agentId}</div>` : nothing}\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\n          <span class=\"chip\">${job.enabled ? \"enabled\" : \"disabled\"}</span>\n          <span class=\"chip\">${job.sessionTarget}</span>\n          <span class=\"chip\">${job.wakeMode}</span>\n        </div>\n      </div>\n      <div class=\"list-meta\">\n        <div>${formatCronState(job)}</div>\n        <div class=\"row\" style=\"justify-content: flex-end; margin-top: 8px;\">\n          <button\n            class=\"btn\"\n            ?disabled=${props.busy}\n            @click=${(event: Event) => {\n              event.stopPropagation();\n              props.onToggle(job, !job.enabled);\n            }}\n          >\n            ${job.enabled ? \"Disable\" : \"Enable\"}\n          </button>\n          <button\n            class=\"btn\"\n            ?disabled=${props.busy}\n            @click=${(event: Event) => {\n              event.stopPropagation();\n              props.onRun(job);\n            }}\n          >\n            Run\n          </button>\n          <button\n            class=\"btn\"\n            ?disabled=${props.busy}\n            @click=${(event: Event) => {\n              event.stopPropagation();\n              props.onLoadRuns(job.id);\n            }}\n          >\n            Runs\n          </button>\n          <button\n            class=\"btn danger\"\n            ?disabled=${props.busy}\n            @click=${(event: Event) => {\n              event.stopPropagation();\n              props.onRemove(job);\n            }}\n          >\n            Remove\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderRun(entry: CronRunLogEntry) {\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${entry.status}</div>\n        <div class=\"list-sub\">${entry.summary ?? \"\"}</div>\n      </div>\n      <div class=\"list-meta\">\n        <div>${formatMs(entry.ts)}</div>\n        <div class=\"muted\">${entry.durationMs ?? 0}ms</div>\n        ${entry.error ? html`<div class=\"muted\">${entry.error}</div>` : nothing}\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { EventLogEntry } from \"../app-events\";\nimport { formatEventPayload } from \"../presenter\";\n\nexport type DebugProps = {\n  loading: boolean;\n  status: Record<string, unknown> | null;\n  health: Record<string, unknown> | null;\n  models: unknown[];\n  heartbeat: unknown;\n  eventLog: EventLogEntry[];\n  callMethod: string;\n  callParams: string;\n  callResult: string | null;\n  callError: string | null;\n  onCallMethodChange: (next: string) => void;\n  onCallParamsChange: (next: string) => void;\n  onRefresh: () => void;\n  onCall: () => void;\n};\n\nexport function renderDebug(props: DebugProps) {\n  const securityAudit =\n    props.status && typeof props.status === \"object\"\n      ? (props.status as { securityAudit?: { summary?: Record<string, number> } }).securityAudit\n      : null;\n  const securitySummary = securityAudit?.summary ?? null;\n  const critical = securitySummary?.critical ?? 0;\n  const warn = securitySummary?.warn ?? 0;\n  const info = securitySummary?.info ?? 0;\n  const securityTone = critical > 0 ? \"danger\" : warn > 0 ? \"warn\" : \"success\";\n  const securityLabel =\n    critical > 0 ? `${critical} critical` : warn > 0 ? `${warn} warnings` : \"No critical issues\";\n\n  return html`\n    <section class=\"grid grid-cols-2\">\n      <div class=\"card\">\n        <div class=\"row\" style=\"justify-content: space-between;\">\n          <div>\n            <div class=\"card-title\">Snapshots</div>\n            <div class=\"card-sub\">Status, health, and heartbeat data.</div>\n          </div>\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n            ${props.loading ? \"Refreshingâ€¦\" : \"Refresh\"}\n          </button>\n        </div>\n        <div class=\"stack\" style=\"margin-top: 12px;\">\n          <div>\n            <div class=\"muted\">Status</div>\n            ${\n              securitySummary\n                ? html`<div class=\"callout ${securityTone}\" style=\"margin-top: 8px;\">\n                  Security audit: ${securityLabel}${info > 0 ? ` Â· ${info} info` : \"\"}. Run\n                  <span class=\"mono\">openclaw security audit --deep</span> for details.\n                </div>`\n                : nothing\n            }\n            <pre class=\"code-block\">${JSON.stringify(props.status ?? {}, null, 2)}</pre>\n          </div>\n          <div>\n            <div class=\"muted\">Health</div>\n            <pre class=\"code-block\">${JSON.stringify(props.health ?? {}, null, 2)}</pre>\n          </div>\n          <div>\n            <div class=\"muted\">Last heartbeat</div>\n            <pre class=\"code-block\">${JSON.stringify(props.heartbeat ?? {}, null, 2)}</pre>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-title\">Manual RPC</div>\n        <div class=\"card-sub\">Send a raw gateway method with JSON params.</div>\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\n          <label class=\"field\">\n            <span>Method</span>\n            <input\n              .value=${props.callMethod}\n              @input=${(e: Event) => props.onCallMethodChange((e.target as HTMLInputElement).value)}\n              placeholder=\"system-presence\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Params (JSON)</span>\n            <textarea\n              .value=${props.callParams}\n              @input=${(e: Event) =>\n                props.onCallParamsChange((e.target as HTMLTextAreaElement).value)}\n              rows=\"6\"\n            ></textarea>\n          </label>\n        </div>\n        <div class=\"row\" style=\"margin-top: 12px;\">\n          <button class=\"btn primary\" @click=${props.onCall}>Call</button>\n        </div>\n        ${\n          props.callError\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n              ${props.callError}\n            </div>`\n            : nothing\n        }\n        ${\n          props.callResult\n            ? html`<pre class=\"code-block\" style=\"margin-top: 12px;\">${props.callResult}</pre>`\n            : nothing\n        }\n      </div>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Models</div>\n      <div class=\"card-sub\">Catalog from models.list.</div>\n      <pre class=\"code-block\" style=\"margin-top: 12px;\">${JSON.stringify(\n        props.models ?? [],\n        null,\n        2,\n      )}</pre>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Event Log</div>\n      <div class=\"card-sub\">Latest gateway events.</div>\n      ${\n        props.eventLog.length === 0\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 12px\">No events yet.</div>\n            `\n          : html`\n            <div class=\"list\" style=\"margin-top: 12px;\">\n              ${props.eventLog.map(\n                (evt) => html`\n                  <div class=\"list-item\">\n                    <div class=\"list-main\">\n                      <div class=\"list-title\">${evt.event}</div>\n                      <div class=\"list-sub\">${new Date(evt.ts).toLocaleTimeString()}</div>\n                    </div>\n                    <div class=\"list-meta\">\n                      <pre class=\"code-block\">${formatEventPayload(evt.payload)}</pre>\n                    </div>\n                  </div>\n                `,\n              )}\n            </div>\n          `\n      }\n    </section>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { AppViewState } from \"../app-view-state\";\n\nfunction formatRemaining(ms: number): string {\n  const remaining = Math.max(0, ms);\n  const totalSeconds = Math.floor(remaining / 1000);\n  if (totalSeconds < 60) {\n    return `${totalSeconds}s`;\n  }\n  const minutes = Math.floor(totalSeconds / 60);\n  if (minutes < 60) {\n    return `${minutes}m`;\n  }\n  const hours = Math.floor(minutes / 60);\n  return `${hours}h`;\n}\n\nfunction renderMetaRow(label: string, value?: string | null) {\n  if (!value) {\n    return nothing;\n  }\n  return html`<div class=\"exec-approval-meta-row\"><span>${label}</span><span>${value}</span></div>`;\n}\n\nexport function renderExecApprovalPrompt(state: AppViewState) {\n  const active = state.execApprovalQueue[0];\n  if (!active) {\n    return nothing;\n  }\n  const request = active.request;\n  const remainingMs = active.expiresAtMs - Date.now();\n  const remaining = remainingMs > 0 ? `expires in ${formatRemaining(remainingMs)}` : \"expired\";\n  const queueCount = state.execApprovalQueue.length;\n  return html`\n    <div class=\"exec-approval-overlay\" role=\"dialog\" aria-live=\"polite\">\n      <div class=\"exec-approval-card\">\n        <div class=\"exec-approval-header\">\n          <div>\n            <div class=\"exec-approval-title\">Exec approval needed</div>\n            <div class=\"exec-approval-sub\">${remaining}</div>\n          </div>\n          ${\n            queueCount > 1\n              ? html`<div class=\"exec-approval-queue\">${queueCount} pending</div>`\n              : nothing\n          }\n        </div>\n        <div class=\"exec-approval-command mono\">${request.command}</div>\n        <div class=\"exec-approval-meta\">\n          ${renderMetaRow(\"Host\", request.host)}\n          ${renderMetaRow(\"Agent\", request.agentId)}\n          ${renderMetaRow(\"Session\", request.sessionKey)}\n          ${renderMetaRow(\"CWD\", request.cwd)}\n          ${renderMetaRow(\"Resolved\", request.resolvedPath)}\n          ${renderMetaRow(\"Security\", request.security)}\n          ${renderMetaRow(\"Ask\", request.ask)}\n        </div>\n        ${\n          state.execApprovalError\n            ? html`<div class=\"exec-approval-error\">${state.execApprovalError}</div>`\n            : nothing\n        }\n        <div class=\"exec-approval-actions\">\n          <button\n            class=\"btn primary\"\n            ?disabled=${state.execApprovalBusy}\n            @click=${() => state.handleExecApprovalDecision(\"allow-once\")}\n          >\n            Allow once\n          </button>\n          <button\n            class=\"btn\"\n            ?disabled=${state.execApprovalBusy}\n            @click=${() => state.handleExecApprovalDecision(\"allow-always\")}\n          >\n            Always allow\n          </button>\n          <button\n            class=\"btn danger\"\n            ?disabled=${state.execApprovalBusy}\n            @click=${() => state.handleExecApprovalDecision(\"deny\")}\n          >\n            Deny\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { AppViewState } from \"../app-view-state\";\n\nexport function renderGatewayUrlConfirmation(state: AppViewState) {\n  const { pendingGatewayUrl } = state;\n  if (!pendingGatewayUrl) {\n    return nothing;\n  }\n\n  return html`\n    <div class=\"exec-approval-overlay\" role=\"dialog\" aria-modal=\"true\" aria-live=\"polite\">\n      <div class=\"exec-approval-card\">\n        <div class=\"exec-approval-header\">\n          <div>\n            <div class=\"exec-approval-title\">Change Gateway URL</div>\n            <div class=\"exec-approval-sub\">This will reconnect to a different gateway server</div>\n          </div>\n        </div>\n        <div class=\"exec-approval-command mono\">${pendingGatewayUrl}</div>\n        <div class=\"callout danger\" style=\"margin-top: 12px;\">\n          Only confirm if you trust this URL. Malicious URLs can compromise your system.\n        </div>\n        <div class=\"exec-approval-actions\">\n          <button\n            class=\"btn primary\"\n            @click=${() => state.handleGatewayUrlConfirm()}\n          >\n            Confirm\n          </button>\n          <button\n            class=\"btn\"\n            @click=${() => state.handleGatewayUrlCancel()}\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { PresenceEntry } from \"../types\";\nimport { formatPresenceAge, formatPresenceSummary } from \"../presenter\";\n\nexport type InstancesProps = {\n  loading: boolean;\n  entries: PresenceEntry[];\n  lastError: string | null;\n  statusMessage: string | null;\n  onRefresh: () => void;\n};\n\nexport function renderInstances(props: InstancesProps) {\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Connected Instances</div>\n          <div class=\"card-sub\">Presence beacons from the gateway and clients.</div>\n        </div>\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n          ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n      ${\n        props.lastError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\n            ${props.lastError}\n          </div>`\n          : nothing\n      }\n      ${\n        props.statusMessage\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\n            ${props.statusMessage}\n          </div>`\n          : nothing\n      }\n      <div class=\"list\" style=\"margin-top: 16px;\">\n        ${\n          props.entries.length === 0\n            ? html`\n                <div class=\"muted\">No instances reported yet.</div>\n              `\n            : props.entries.map((entry) => renderEntry(entry))\n        }\n      </div>\n    </section>\n  `;\n}\n\nfunction renderEntry(entry: PresenceEntry) {\n  const lastInput = entry.lastInputSeconds != null ? `${entry.lastInputSeconds}s ago` : \"n/a\";\n  const mode = entry.mode ?? \"unknown\";\n  const roles = Array.isArray(entry.roles) ? entry.roles.filter(Boolean) : [];\n  const scopes = Array.isArray(entry.scopes) ? entry.scopes.filter(Boolean) : [];\n  const scopesLabel =\n    scopes.length > 0\n      ? scopes.length > 3\n        ? `${scopes.length} scopes`\n        : `scopes: ${scopes.join(\", \")}`\n      : null;\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${entry.host ?? \"unknown host\"}</div>\n        <div class=\"list-sub\">${formatPresenceSummary(entry)}</div>\n        <div class=\"chip-row\">\n          <span class=\"chip\">${mode}</span>\n          ${roles.map((role) => html`<span class=\"chip\">${role}</span>`)}\n          ${scopesLabel ? html`<span class=\"chip\">${scopesLabel}</span>` : nothing}\n          ${entry.platform ? html`<span class=\"chip\">${entry.platform}</span>` : nothing}\n          ${entry.deviceFamily ? html`<span class=\"chip\">${entry.deviceFamily}</span>` : nothing}\n          ${\n            entry.modelIdentifier\n              ? html`<span class=\"chip\">${entry.modelIdentifier}</span>`\n              : nothing\n          }\n          ${entry.version ? html`<span class=\"chip\">${entry.version}</span>` : nothing}\n        </div>\n      </div>\n      <div class=\"list-meta\">\n        <div>${formatPresenceAge(entry)}</div>\n        <div class=\"muted\">Last input ${lastInput}</div>\n        <div class=\"muted\">Reason ${entry.reason ?? \"\"}</div>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { LogEntry, LogLevel } from \"../types\";\n\nconst LEVELS: LogLevel[] = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"fatal\"];\n\nexport type LogsProps = {\n  loading: boolean;\n  error: string | null;\n  file: string | null;\n  entries: LogEntry[];\n  filterText: string;\n  levelFilters: Record<LogLevel, boolean>;\n  autoFollow: boolean;\n  truncated: boolean;\n  onFilterTextChange: (next: string) => void;\n  onLevelToggle: (level: LogLevel, enabled: boolean) => void;\n  onToggleAutoFollow: (next: boolean) => void;\n  onRefresh: () => void;\n  onExport: (lines: string[], label: string) => void;\n  onScroll: (event: Event) => void;\n};\n\nfunction formatTime(value?: string | null) {\n  if (!value) {\n    return \"\";\n  }\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return value;\n  }\n  return date.toLocaleTimeString();\n}\n\nfunction matchesFilter(entry: LogEntry, needle: string) {\n  if (!needle) {\n    return true;\n  }\n  const haystack = [entry.message, entry.subsystem, entry.raw]\n    .filter(Boolean)\n    .join(\" \")\n    .toLowerCase();\n  return haystack.includes(needle);\n}\n\nexport function renderLogs(props: LogsProps) {\n  const needle = props.filterText.trim().toLowerCase();\n  const levelFiltered = LEVELS.some((level) => !props.levelFilters[level]);\n  const filtered = props.entries.filter((entry) => {\n    if (entry.level && !props.levelFilters[entry.level]) {\n      return false;\n    }\n    return matchesFilter(entry, needle);\n  });\n  const exportLabel = needle || levelFiltered ? \"filtered\" : \"visible\";\n\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Logs</div>\n          <div class=\"card-sub\">Gateway file logs (JSONL).</div>\n        </div>\n        <div class=\"row\" style=\"gap: 8px;\">\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n            ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n          </button>\n          <button\n            class=\"btn\"\n            ?disabled=${filtered.length === 0}\n            @click=${() =>\n              props.onExport(\n                filtered.map((entry) => entry.raw),\n                exportLabel,\n              )}\n          >\n            Export ${exportLabel}\n          </button>\n        </div>\n      </div>\n\n      <div class=\"filters\" style=\"margin-top: 14px;\">\n        <label class=\"field\" style=\"min-width: 220px;\">\n          <span>Filter</span>\n          <input\n            .value=${props.filterText}\n            @input=${(e: Event) => props.onFilterTextChange((e.target as HTMLInputElement).value)}\n            placeholder=\"Search logs\"\n          />\n        </label>\n        <label class=\"field checkbox\">\n          <span>Auto-follow</span>\n          <input\n            type=\"checkbox\"\n            .checked=${props.autoFollow}\n            @change=${(e: Event) =>\n              props.onToggleAutoFollow((e.target as HTMLInputElement).checked)}\n          />\n        </label>\n      </div>\n\n      <div class=\"chip-row\" style=\"margin-top: 12px;\">\n        ${LEVELS.map(\n          (level) => html`\n            <label class=\"chip log-chip ${level}\">\n              <input\n                type=\"checkbox\"\n                .checked=${props.levelFilters[level]}\n                @change=${(e: Event) =>\n                  props.onLevelToggle(level, (e.target as HTMLInputElement).checked)}\n              />\n              <span>${level}</span>\n            </label>\n          `,\n        )}\n      </div>\n\n      ${\n        props.file\n          ? html`<div class=\"muted\" style=\"margin-top: 10px;\">File: ${props.file}</div>`\n          : nothing\n      }\n      ${\n        props.truncated\n          ? html`\n              <div class=\"callout\" style=\"margin-top: 10px\">Log output truncated; showing latest chunk.</div>\n            `\n          : nothing\n      }\n      ${\n        props.error\n          ? html`<div class=\"callout danger\" style=\"margin-top: 10px;\">${props.error}</div>`\n          : nothing\n      }\n\n      <div class=\"log-stream\" style=\"margin-top: 12px;\" @scroll=${props.onScroll}>\n        ${\n          filtered.length === 0\n            ? html`\n                <div class=\"muted\" style=\"padding: 12px\">No log entries.</div>\n              `\n            : filtered.map(\n                (entry) => html`\n                <div class=\"log-row\">\n                  <div class=\"log-time mono\">${formatTime(entry.time)}</div>\n                  <div class=\"log-level ${entry.level ?? \"\"}\">${entry.level ?? \"\"}</div>\n                  <div class=\"log-subsystem mono\">${entry.subsystem ?? \"\"}</div>\n                  <div class=\"log-message mono\">${entry.message ?? entry.raw}</div>\n                </div>\n              `,\n              )\n        }\n      </div>\n    </section>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type {\n  DevicePairingList,\n  DeviceTokenSummary,\n  PairedDevice,\n  PendingDevice,\n} from \"../controllers/devices\";\nimport type {\n  ExecApprovalsAllowlistEntry,\n  ExecApprovalsFile,\n  ExecApprovalsSnapshot,\n} from \"../controllers/exec-approvals\";\nimport { clampText, formatAgo, formatList } from \"../format\";\n\nexport type NodesProps = {\n  loading: boolean;\n  nodes: Array<Record<string, unknown>>;\n  devicesLoading: boolean;\n  devicesError: string | null;\n  devicesList: DevicePairingList | null;\n  configForm: Record<string, unknown> | null;\n  configLoading: boolean;\n  configSaving: boolean;\n  configDirty: boolean;\n  configFormMode: \"form\" | \"raw\";\n  execApprovalsLoading: boolean;\n  execApprovalsSaving: boolean;\n  execApprovalsDirty: boolean;\n  execApprovalsSnapshot: ExecApprovalsSnapshot | null;\n  execApprovalsForm: ExecApprovalsFile | null;\n  execApprovalsSelectedAgent: string | null;\n  execApprovalsTarget: \"gateway\" | \"node\";\n  execApprovalsTargetNodeId: string | null;\n  onRefresh: () => void;\n  onDevicesRefresh: () => void;\n  onDeviceApprove: (requestId: string) => void;\n  onDeviceReject: (requestId: string) => void;\n  onDeviceRotate: (deviceId: string, role: string, scopes?: string[]) => void;\n  onDeviceRevoke: (deviceId: string, role: string) => void;\n  onLoadConfig: () => void;\n  onLoadExecApprovals: () => void;\n  onBindDefault: (nodeId: string | null) => void;\n  onBindAgent: (agentIndex: number, nodeId: string | null) => void;\n  onSaveBindings: () => void;\n  onExecApprovalsTargetChange: (kind: \"gateway\" | \"node\", nodeId: string | null) => void;\n  onExecApprovalsSelectAgent: (agentId: string) => void;\n  onExecApprovalsPatch: (path: Array<string | number>, value: unknown) => void;\n  onExecApprovalsRemove: (path: Array<string | number>) => void;\n  onSaveExecApprovals: () => void;\n};\n\nexport function renderNodes(props: NodesProps) {\n  const bindingState = resolveBindingsState(props);\n  const approvalsState = resolveExecApprovalsState(props);\n  return html`\n    ${renderExecApprovals(approvalsState)}\n    ${renderBindings(bindingState)}\n    ${renderDevices(props)}\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Nodes</div>\n          <div class=\"card-sub\">Paired devices and live links.</div>\n        </div>\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n          ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n      <div class=\"list\" style=\"margin-top: 16px;\">\n        ${\n          props.nodes.length === 0\n            ? html`\n                <div class=\"muted\">No nodes found.</div>\n              `\n            : props.nodes.map((n) => renderNode(n))\n        }\n      </div>\n    </section>\n  `;\n}\n\nfunction renderDevices(props: NodesProps) {\n  const list = props.devicesList ?? { pending: [], paired: [] };\n  const pending = Array.isArray(list.pending) ? list.pending : [];\n  const paired = Array.isArray(list.paired) ? list.paired : [];\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Devices</div>\n          <div class=\"card-sub\">Pairing requests + role tokens.</div>\n        </div>\n        <button class=\"btn\" ?disabled=${props.devicesLoading} @click=${props.onDevicesRefresh}>\n          ${props.devicesLoading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n      ${\n        props.devicesError\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.devicesError}</div>`\n          : nothing\n      }\n      <div class=\"list\" style=\"margin-top: 16px;\">\n        ${\n          pending.length > 0\n            ? html`\n              <div class=\"muted\" style=\"margin-bottom: 8px;\">Pending</div>\n              ${pending.map((req) => renderPendingDevice(req, props))}\n            `\n            : nothing\n        }\n        ${\n          paired.length > 0\n            ? html`\n              <div class=\"muted\" style=\"margin-top: 12px; margin-bottom: 8px;\">Paired</div>\n              ${paired.map((device) => renderPairedDevice(device, props))}\n            `\n            : nothing\n        }\n        ${\n          pending.length === 0 && paired.length === 0\n            ? html`\n                <div class=\"muted\">No paired devices.</div>\n              `\n            : nothing\n        }\n      </div>\n    </section>\n  `;\n}\n\nfunction renderPendingDevice(req: PendingDevice, props: NodesProps) {\n  const name = req.displayName?.trim() || req.deviceId;\n  const age = typeof req.ts === \"number\" ? formatAgo(req.ts) : \"n/a\";\n  const role = req.role?.trim() ? `role: ${req.role}` : \"role: -\";\n  const repair = req.isRepair ? \" Â· repair\" : \"\";\n  const ip = req.remoteIp ? ` Â· ${req.remoteIp}` : \"\";\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${name}</div>\n        <div class=\"list-sub\">${req.deviceId}${ip}</div>\n        <div class=\"muted\" style=\"margin-top: 6px;\">\n          ${role} Â· requested ${age}${repair}\n        </div>\n      </div>\n      <div class=\"list-meta\">\n        <div class=\"row\" style=\"justify-content: flex-end; gap: 8px; flex-wrap: wrap;\">\n          <button class=\"btn btn--sm primary\" @click=${() => props.onDeviceApprove(req.requestId)}>\n            Approve\n          </button>\n          <button class=\"btn btn--sm\" @click=${() => props.onDeviceReject(req.requestId)}>\n            Reject\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderPairedDevice(device: PairedDevice, props: NodesProps) {\n  const name = device.displayName?.trim() || device.deviceId;\n  const ip = device.remoteIp ? ` Â· ${device.remoteIp}` : \"\";\n  const roles = `roles: ${formatList(device.roles)}`;\n  const scopes = `scopes: ${formatList(device.scopes)}`;\n  const tokens = Array.isArray(device.tokens) ? device.tokens : [];\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${name}</div>\n        <div class=\"list-sub\">${device.deviceId}${ip}</div>\n        <div class=\"muted\" style=\"margin-top: 6px;\">${roles} Â· ${scopes}</div>\n        ${\n          tokens.length === 0\n            ? html`\n                <div class=\"muted\" style=\"margin-top: 6px\">Tokens: none</div>\n              `\n            : html`\n              <div class=\"muted\" style=\"margin-top: 10px;\">Tokens</div>\n              <div style=\"display: flex; flex-direction: column; gap: 8px; margin-top: 6px;\">\n                ${tokens.map((token) => renderTokenRow(device.deviceId, token, props))}\n              </div>\n            `\n        }\n      </div>\n    </div>\n  `;\n}\n\nfunction renderTokenRow(deviceId: string, token: DeviceTokenSummary, props: NodesProps) {\n  const status = token.revokedAtMs ? \"revoked\" : \"active\";\n  const scopes = `scopes: ${formatList(token.scopes)}`;\n  const when = formatAgo(token.rotatedAtMs ?? token.createdAtMs ?? token.lastUsedAtMs ?? null);\n  return html`\n    <div class=\"row\" style=\"justify-content: space-between; gap: 8px;\">\n      <div class=\"list-sub\">${token.role} Â· ${status} Â· ${scopes} Â· ${when}</div>\n      <div class=\"row\" style=\"justify-content: flex-end; gap: 6px; flex-wrap: wrap;\">\n        <button\n          class=\"btn btn--sm\"\n          @click=${() => props.onDeviceRotate(deviceId, token.role, token.scopes)}\n        >\n          Rotate\n        </button>\n        ${\n          token.revokedAtMs\n            ? nothing\n            : html`\n              <button\n                class=\"btn btn--sm danger\"\n                @click=${() => props.onDeviceRevoke(deviceId, token.role)}\n              >\n                Revoke\n              </button>\n            `\n        }\n      </div>\n    </div>\n  `;\n}\n\ntype BindingAgent = {\n  id: string;\n  name?: string;\n  index: number;\n  isDefault: boolean;\n  binding?: string | null;\n};\n\ntype BindingNode = {\n  id: string;\n  label: string;\n};\n\ntype BindingState = {\n  ready: boolean;\n  disabled: boolean;\n  configDirty: boolean;\n  configLoading: boolean;\n  configSaving: boolean;\n  defaultBinding?: string | null;\n  agents: BindingAgent[];\n  nodes: BindingNode[];\n  onBindDefault: (nodeId: string | null) => void;\n  onBindAgent: (agentIndex: number, nodeId: string | null) => void;\n  onSave: () => void;\n  onLoadConfig: () => void;\n  formMode: \"form\" | \"raw\";\n};\n\ntype ExecSecurity = \"deny\" | \"allowlist\" | \"full\";\ntype ExecAsk = \"off\" | \"on-miss\" | \"always\";\n\ntype ExecApprovalsResolvedDefaults = {\n  security: ExecSecurity;\n  ask: ExecAsk;\n  askFallback: ExecSecurity;\n  autoAllowSkills: boolean;\n};\n\ntype ExecApprovalsAgentOption = {\n  id: string;\n  name?: string;\n  isDefault?: boolean;\n};\n\ntype ExecApprovalsTargetNode = {\n  id: string;\n  label: string;\n};\n\ntype ExecApprovalsState = {\n  ready: boolean;\n  disabled: boolean;\n  dirty: boolean;\n  loading: boolean;\n  saving: boolean;\n  form: ExecApprovalsFile | null;\n  defaults: ExecApprovalsResolvedDefaults;\n  selectedScope: string;\n  selectedAgent: Record<string, unknown> | null;\n  agents: ExecApprovalsAgentOption[];\n  allowlist: ExecApprovalsAllowlistEntry[];\n  target: \"gateway\" | \"node\";\n  targetNodeId: string | null;\n  targetNodes: ExecApprovalsTargetNode[];\n  onSelectScope: (agentId: string) => void;\n  onSelectTarget: (kind: \"gateway\" | \"node\", nodeId: string | null) => void;\n  onPatch: (path: Array<string | number>, value: unknown) => void;\n  onRemove: (path: Array<string | number>) => void;\n  onLoad: () => void;\n  onSave: () => void;\n};\n\nconst EXEC_APPROVALS_DEFAULT_SCOPE = \"__defaults__\";\n\nconst SECURITY_OPTIONS: Array<{ value: ExecSecurity; label: string }> = [\n  { value: \"deny\", label: \"Deny\" },\n  { value: \"allowlist\", label: \"Allowlist\" },\n  { value: \"full\", label: \"Full\" },\n];\n\nconst ASK_OPTIONS: Array<{ value: ExecAsk; label: string }> = [\n  { value: \"off\", label: \"Off\" },\n  { value: \"on-miss\", label: \"On miss\" },\n  { value: \"always\", label: \"Always\" },\n];\n\nfunction resolveBindingsState(props: NodesProps): BindingState {\n  const config = props.configForm;\n  const nodes = resolveExecNodes(props.nodes);\n  const { defaultBinding, agents } = resolveAgentBindings(config);\n  const ready = Boolean(config);\n  const disabled = props.configSaving || props.configFormMode === \"raw\";\n  return {\n    ready,\n    disabled,\n    configDirty: props.configDirty,\n    configLoading: props.configLoading,\n    configSaving: props.configSaving,\n    defaultBinding,\n    agents,\n    nodes,\n    onBindDefault: props.onBindDefault,\n    onBindAgent: props.onBindAgent,\n    onSave: props.onSaveBindings,\n    onLoadConfig: props.onLoadConfig,\n    formMode: props.configFormMode,\n  };\n}\n\nfunction normalizeSecurity(value?: string): ExecSecurity {\n  if (value === \"allowlist\" || value === \"full\" || value === \"deny\") {\n    return value;\n  }\n  return \"deny\";\n}\n\nfunction normalizeAsk(value?: string): ExecAsk {\n  if (value === \"always\" || value === \"off\" || value === \"on-miss\") {\n    return value;\n  }\n  return \"on-miss\";\n}\n\nfunction resolveExecApprovalsDefaults(\n  form: ExecApprovalsFile | null,\n): ExecApprovalsResolvedDefaults {\n  const defaults = form?.defaults ?? {};\n  return {\n    security: normalizeSecurity(defaults.security),\n    ask: normalizeAsk(defaults.ask),\n    askFallback: normalizeSecurity(defaults.askFallback ?? \"deny\"),\n    autoAllowSkills: Boolean(defaults.autoAllowSkills ?? false),\n  };\n}\n\nfunction resolveConfigAgents(config: Record<string, unknown> | null): ExecApprovalsAgentOption[] {\n  const agentsNode = (config?.agents ?? {}) as Record<string, unknown>;\n  const list = Array.isArray(agentsNode.list) ? agentsNode.list : [];\n  const agents: ExecApprovalsAgentOption[] = [];\n  list.forEach((entry) => {\n    if (!entry || typeof entry !== \"object\") {\n      return;\n    }\n    const record = entry as Record<string, unknown>;\n    const id = typeof record.id === \"string\" ? record.id.trim() : \"\";\n    if (!id) {\n      return;\n    }\n    const name = typeof record.name === \"string\" ? record.name.trim() : undefined;\n    const isDefault = record.default === true;\n    agents.push({ id, name: name || undefined, isDefault });\n  });\n  return agents;\n}\n\nfunction resolveExecApprovalsAgents(\n  config: Record<string, unknown> | null,\n  form: ExecApprovalsFile | null,\n): ExecApprovalsAgentOption[] {\n  const configAgents = resolveConfigAgents(config);\n  const approvalsAgents = Object.keys(form?.agents ?? {});\n  const merged = new Map<string, ExecApprovalsAgentOption>();\n  configAgents.forEach((agent) => merged.set(agent.id, agent));\n  approvalsAgents.forEach((id) => {\n    if (merged.has(id)) {\n      return;\n    }\n    merged.set(id, { id });\n  });\n  const agents = Array.from(merged.values());\n  if (agents.length === 0) {\n    agents.push({ id: \"main\", isDefault: true });\n  }\n  agents.sort((a, b) => {\n    if (a.isDefault && !b.isDefault) {\n      return -1;\n    }\n    if (!a.isDefault && b.isDefault) {\n      return 1;\n    }\n    const aLabel = a.name?.trim() ? a.name : a.id;\n    const bLabel = b.name?.trim() ? b.name : b.id;\n    return aLabel.localeCompare(bLabel);\n  });\n  return agents;\n}\n\nfunction resolveExecApprovalsScope(\n  selected: string | null,\n  agents: ExecApprovalsAgentOption[],\n): string {\n  if (selected === EXEC_APPROVALS_DEFAULT_SCOPE) {\n    return EXEC_APPROVALS_DEFAULT_SCOPE;\n  }\n  if (selected && agents.some((agent) => agent.id === selected)) {\n    return selected;\n  }\n  return EXEC_APPROVALS_DEFAULT_SCOPE;\n}\n\nfunction resolveExecApprovalsState(props: NodesProps): ExecApprovalsState {\n  const form = props.execApprovalsForm ?? props.execApprovalsSnapshot?.file ?? null;\n  const ready = Boolean(form);\n  const defaults = resolveExecApprovalsDefaults(form);\n  const agents = resolveExecApprovalsAgents(props.configForm, form);\n  const targetNodes = resolveExecApprovalsNodes(props.nodes);\n  const target = props.execApprovalsTarget;\n  let targetNodeId =\n    target === \"node\" && props.execApprovalsTargetNodeId ? props.execApprovalsTargetNodeId : null;\n  if (target === \"node\" && targetNodeId && !targetNodes.some((node) => node.id === targetNodeId)) {\n    targetNodeId = null;\n  }\n  const selectedScope = resolveExecApprovalsScope(props.execApprovalsSelectedAgent, agents);\n  const selectedAgent =\n    selectedScope !== EXEC_APPROVALS_DEFAULT_SCOPE\n      ? (((form?.agents ?? {})[selectedScope] as Record<string, unknown> | undefined) ?? null)\n      : null;\n  const allowlist = Array.isArray((selectedAgent as { allowlist?: unknown })?.allowlist)\n    ? ((selectedAgent as { allowlist?: ExecApprovalsAllowlistEntry[] }).allowlist ?? [])\n    : [];\n  return {\n    ready,\n    disabled: props.execApprovalsSaving || props.execApprovalsLoading,\n    dirty: props.execApprovalsDirty,\n    loading: props.execApprovalsLoading,\n    saving: props.execApprovalsSaving,\n    form,\n    defaults,\n    selectedScope,\n    selectedAgent,\n    agents,\n    allowlist,\n    target,\n    targetNodeId,\n    targetNodes,\n    onSelectScope: props.onExecApprovalsSelectAgent,\n    onSelectTarget: props.onExecApprovalsTargetChange,\n    onPatch: props.onExecApprovalsPatch,\n    onRemove: props.onExecApprovalsRemove,\n    onLoad: props.onLoadExecApprovals,\n    onSave: props.onSaveExecApprovals,\n  };\n}\n\nfunction renderBindings(state: BindingState) {\n  const supportsBinding = state.nodes.length > 0;\n  const defaultValue = state.defaultBinding ?? \"\";\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between; align-items: center;\">\n        <div>\n          <div class=\"card-title\">Exec node binding</div>\n          <div class=\"card-sub\">\n            Pin agents to a specific node when using <span class=\"mono\">exec host=node</span>.\n          </div>\n        </div>\n        <button\n          class=\"btn\"\n          ?disabled=${state.disabled || !state.configDirty}\n          @click=${state.onSave}\n        >\n          ${state.configSaving ? \"Savingâ€¦\" : \"Save\"}\n        </button>\n      </div>\n\n      ${\n        state.formMode === \"raw\"\n          ? html`\n              <div class=\"callout warn\" style=\"margin-top: 12px\">\n                Switch the Config tab to <strong>Form</strong> mode to edit bindings here.\n              </div>\n            `\n          : nothing\n      }\n\n      ${\n        !state.ready\n          ? html`<div class=\"row\" style=\"margin-top: 12px; gap: 12px;\">\n            <div class=\"muted\">Load config to edit bindings.</div>\n            <button class=\"btn\" ?disabled=${state.configLoading} @click=${state.onLoadConfig}>\n              ${state.configLoading ? \"Loadingâ€¦\" : \"Load config\"}\n            </button>\n          </div>`\n          : html`\n            <div class=\"list\" style=\"margin-top: 16px;\">\n              <div class=\"list-item\">\n                <div class=\"list-main\">\n                  <div class=\"list-title\">Default binding</div>\n                  <div class=\"list-sub\">Used when agents do not override a node binding.</div>\n                </div>\n                <div class=\"list-meta\">\n                  <label class=\"field\">\n                    <span>Node</span>\n                    <select\n                      ?disabled=${state.disabled || !supportsBinding}\n                      @change=${(event: Event) => {\n                        const target = event.target as HTMLSelectElement;\n                        const value = target.value.trim();\n                        state.onBindDefault(value ? value : null);\n                      }}\n                    >\n                      <option value=\"\" ?selected=${defaultValue === \"\"}>Any node</option>\n                      ${state.nodes.map(\n                        (node) =>\n                          html`<option\n                            value=${node.id}\n                            ?selected=${defaultValue === node.id}\n                          >\n                            ${node.label}\n                          </option>`,\n                      )}\n                    </select>\n                  </label>\n                  ${\n                    !supportsBinding\n                      ? html`\n                          <div class=\"muted\">No nodes with system.run available.</div>\n                        `\n                      : nothing\n                  }\n                </div>\n              </div>\n\n              ${\n                state.agents.length === 0\n                  ? html`\n                      <div class=\"muted\">No agents found.</div>\n                    `\n                  : state.agents.map((agent) => renderAgentBinding(agent, state))\n              }\n            </div>\n          `\n      }\n    </section>\n  `;\n}\n\nfunction renderExecApprovals(state: ExecApprovalsState) {\n  const ready = state.ready;\n  const targetReady = state.target !== \"node\" || Boolean(state.targetNodeId);\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between; align-items: center;\">\n        <div>\n          <div class=\"card-title\">Exec approvals</div>\n          <div class=\"card-sub\">\n            Allowlist and approval policy for <span class=\"mono\">exec host=gateway/node</span>.\n          </div>\n        </div>\n        <button\n          class=\"btn\"\n          ?disabled=${state.disabled || !state.dirty || !targetReady}\n          @click=${state.onSave}\n        >\n          ${state.saving ? \"Savingâ€¦\" : \"Save\"}\n        </button>\n      </div>\n\n      ${renderExecApprovalsTarget(state)}\n\n      ${\n        !ready\n          ? html`<div class=\"row\" style=\"margin-top: 12px; gap: 12px;\">\n            <div class=\"muted\">Load exec approvals to edit allowlists.</div>\n            <button class=\"btn\" ?disabled=${state.loading || !targetReady} @click=${state.onLoad}>\n              ${state.loading ? \"Loadingâ€¦\" : \"Load approvals\"}\n            </button>\n          </div>`\n          : html`\n            ${renderExecApprovalsTabs(state)}\n            ${renderExecApprovalsPolicy(state)}\n            ${\n              state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE\n                ? nothing\n                : renderExecApprovalsAllowlist(state)\n            }\n          `\n      }\n    </section>\n  `;\n}\n\nfunction renderExecApprovalsTarget(state: ExecApprovalsState) {\n  const hasNodes = state.targetNodes.length > 0;\n  const nodeValue = state.targetNodeId ?? \"\";\n  return html`\n    <div class=\"list\" style=\"margin-top: 12px;\">\n      <div class=\"list-item\">\n        <div class=\"list-main\">\n          <div class=\"list-title\">Target</div>\n          <div class=\"list-sub\">\n            Gateway edits local approvals; node edits the selected node.\n          </div>\n        </div>\n        <div class=\"list-meta\">\n          <label class=\"field\">\n            <span>Host</span>\n            <select\n              ?disabled=${state.disabled}\n              @change=${(event: Event) => {\n                const target = event.target as HTMLSelectElement;\n                const value = target.value;\n                if (value === \"node\") {\n                  const first = state.targetNodes[0]?.id ?? null;\n                  state.onSelectTarget(\"node\", nodeValue || first);\n                } else {\n                  state.onSelectTarget(\"gateway\", null);\n                }\n              }}\n            >\n              <option value=\"gateway\" ?selected=${state.target === \"gateway\"}>Gateway</option>\n              <option value=\"node\" ?selected=${state.target === \"node\"}>Node</option>\n            </select>\n          </label>\n          ${\n            state.target === \"node\"\n              ? html`\n                <label class=\"field\">\n                  <span>Node</span>\n                  <select\n                    ?disabled=${state.disabled || !hasNodes}\n                    @change=${(event: Event) => {\n                      const target = event.target as HTMLSelectElement;\n                      const value = target.value.trim();\n                      state.onSelectTarget(\"node\", value ? value : null);\n                    }}\n                  >\n                    <option value=\"\" ?selected=${nodeValue === \"\"}>Select node</option>\n                    ${state.targetNodes.map(\n                      (node) =>\n                        html`<option\n                          value=${node.id}\n                          ?selected=${nodeValue === node.id}\n                        >\n                          ${node.label}\n                        </option>`,\n                    )}\n                  </select>\n                </label>\n              `\n              : nothing\n          }\n        </div>\n      </div>\n      ${\n        state.target === \"node\" && !hasNodes\n          ? html`\n              <div class=\"muted\">No nodes advertise exec approvals yet.</div>\n            `\n          : nothing\n      }\n    </div>\n  `;\n}\n\nfunction renderExecApprovalsTabs(state: ExecApprovalsState) {\n  return html`\n    <div class=\"row\" style=\"margin-top: 12px; gap: 8px; flex-wrap: wrap;\">\n      <span class=\"label\">Scope</span>\n      <div class=\"row\" style=\"gap: 8px; flex-wrap: wrap;\">\n        <button\n          class=\"btn btn--sm ${state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE ? \"active\" : \"\"}\"\n          @click=${() => state.onSelectScope(EXEC_APPROVALS_DEFAULT_SCOPE)}\n        >\n          Defaults\n        </button>\n        ${state.agents.map((agent) => {\n          const label = agent.name?.trim() ? `${agent.name} (${agent.id})` : agent.id;\n          return html`\n            <button\n              class=\"btn btn--sm ${state.selectedScope === agent.id ? \"active\" : \"\"}\"\n              @click=${() => state.onSelectScope(agent.id)}\n            >\n              ${label}\n            </button>\n          `;\n        })}\n      </div>\n    </div>\n  `;\n}\n\nfunction renderExecApprovalsPolicy(state: ExecApprovalsState) {\n  const isDefaults = state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE;\n  const defaults = state.defaults;\n  const agent = state.selectedAgent ?? {};\n  const basePath = isDefaults ? [\"defaults\"] : [\"agents\", state.selectedScope];\n  const agentSecurity = typeof agent.security === \"string\" ? agent.security : undefined;\n  const agentAsk = typeof agent.ask === \"string\" ? agent.ask : undefined;\n  const agentAskFallback = typeof agent.askFallback === \"string\" ? agent.askFallback : undefined;\n  const securityValue = isDefaults ? defaults.security : (agentSecurity ?? \"__default__\");\n  const askValue = isDefaults ? defaults.ask : (agentAsk ?? \"__default__\");\n  const askFallbackValue = isDefaults ? defaults.askFallback : (agentAskFallback ?? \"__default__\");\n  const autoOverride =\n    typeof agent.autoAllowSkills === \"boolean\" ? agent.autoAllowSkills : undefined;\n  const autoEffective = autoOverride ?? defaults.autoAllowSkills;\n  const autoIsDefault = autoOverride == null;\n\n  return html`\n    <div class=\"list\" style=\"margin-top: 16px;\">\n      <div class=\"list-item\">\n        <div class=\"list-main\">\n          <div class=\"list-title\">Security</div>\n          <div class=\"list-sub\">\n            ${isDefaults ? \"Default security mode.\" : `Default: ${defaults.security}.`}\n          </div>\n        </div>\n        <div class=\"list-meta\">\n          <label class=\"field\">\n            <span>Mode</span>\n            <select\n              ?disabled=${state.disabled}\n              @change=${(event: Event) => {\n                const target = event.target as HTMLSelectElement;\n                const value = target.value;\n                if (!isDefaults && value === \"__default__\") {\n                  state.onRemove([...basePath, \"security\"]);\n                } else {\n                  state.onPatch([...basePath, \"security\"], value);\n                }\n              }}\n            >\n              ${\n                !isDefaults\n                  ? html`<option value=\"__default__\" ?selected=${securityValue === \"__default__\"}>\n                    Use default (${defaults.security})\n                  </option>`\n                  : nothing\n              }\n              ${SECURITY_OPTIONS.map(\n                (option) =>\n                  html`<option\n                    value=${option.value}\n                    ?selected=${securityValue === option.value}\n                  >\n                    ${option.label}\n                  </option>`,\n              )}\n            </select>\n          </label>\n        </div>\n      </div>\n\n      <div class=\"list-item\">\n        <div class=\"list-main\">\n          <div class=\"list-title\">Ask</div>\n          <div class=\"list-sub\">\n            ${isDefaults ? \"Default prompt policy.\" : `Default: ${defaults.ask}.`}\n          </div>\n        </div>\n        <div class=\"list-meta\">\n          <label class=\"field\">\n            <span>Mode</span>\n            <select\n              ?disabled=${state.disabled}\n              @change=${(event: Event) => {\n                const target = event.target as HTMLSelectElement;\n                const value = target.value;\n                if (!isDefaults && value === \"__default__\") {\n                  state.onRemove([...basePath, \"ask\"]);\n                } else {\n                  state.onPatch([...basePath, \"ask\"], value);\n                }\n              }}\n            >\n              ${\n                !isDefaults\n                  ? html`<option value=\"__default__\" ?selected=${askValue === \"__default__\"}>\n                    Use default (${defaults.ask})\n                  </option>`\n                  : nothing\n              }\n              ${ASK_OPTIONS.map(\n                (option) =>\n                  html`<option\n                    value=${option.value}\n                    ?selected=${askValue === option.value}\n                  >\n                    ${option.label}\n                  </option>`,\n              )}\n            </select>\n          </label>\n        </div>\n      </div>\n\n      <div class=\"list-item\">\n        <div class=\"list-main\">\n          <div class=\"list-title\">Ask fallback</div>\n          <div class=\"list-sub\">\n            ${\n              isDefaults\n                ? \"Applied when the UI prompt is unavailable.\"\n                : `Default: ${defaults.askFallback}.`\n            }\n          </div>\n        </div>\n        <div class=\"list-meta\">\n          <label class=\"field\">\n            <span>Fallback</span>\n            <select\n              ?disabled=${state.disabled}\n              @change=${(event: Event) => {\n                const target = event.target as HTMLSelectElement;\n                const value = target.value;\n                if (!isDefaults && value === \"__default__\") {\n                  state.onRemove([...basePath, \"askFallback\"]);\n                } else {\n                  state.onPatch([...basePath, \"askFallback\"], value);\n                }\n              }}\n            >\n              ${\n                !isDefaults\n                  ? html`<option value=\"__default__\" ?selected=${askFallbackValue === \"__default__\"}>\n                    Use default (${defaults.askFallback})\n                  </option>`\n                  : nothing\n              }\n              ${SECURITY_OPTIONS.map(\n                (option) =>\n                  html`<option\n                    value=${option.value}\n                    ?selected=${askFallbackValue === option.value}\n                  >\n                    ${option.label}\n                  </option>`,\n              )}\n            </select>\n          </label>\n        </div>\n      </div>\n\n      <div class=\"list-item\">\n        <div class=\"list-main\">\n          <div class=\"list-title\">Auto-allow skill CLIs</div>\n          <div class=\"list-sub\">\n            ${\n              isDefaults\n                ? \"Allow skill executables listed by the Gateway.\"\n                : autoIsDefault\n                  ? `Using default (${defaults.autoAllowSkills ? \"on\" : \"off\"}).`\n                  : `Override (${autoEffective ? \"on\" : \"off\"}).`\n            }\n          </div>\n        </div>\n        <div class=\"list-meta\">\n          <label class=\"field\">\n            <span>Enabled</span>\n            <input\n              type=\"checkbox\"\n              ?disabled=${state.disabled}\n              .checked=${autoEffective}\n              @change=${(event: Event) => {\n                const target = event.target as HTMLInputElement;\n                state.onPatch([...basePath, \"autoAllowSkills\"], target.checked);\n              }}\n            />\n          </label>\n          ${\n            !isDefaults && !autoIsDefault\n              ? html`<button\n                class=\"btn btn--sm\"\n                ?disabled=${state.disabled}\n                @click=${() => state.onRemove([...basePath, \"autoAllowSkills\"])}\n              >\n                Use default\n              </button>`\n              : nothing\n          }\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderExecApprovalsAllowlist(state: ExecApprovalsState) {\n  const allowlistPath = [\"agents\", state.selectedScope, \"allowlist\"];\n  const entries = state.allowlist;\n  return html`\n    <div class=\"row\" style=\"margin-top: 18px; justify-content: space-between;\">\n      <div>\n        <div class=\"card-title\">Allowlist</div>\n        <div class=\"card-sub\">Case-insensitive glob patterns.</div>\n      </div>\n      <button\n        class=\"btn btn--sm\"\n        ?disabled=${state.disabled}\n        @click=${() => {\n          const next = [...entries, { pattern: \"\" }];\n          state.onPatch(allowlistPath, next);\n        }}\n      >\n        Add pattern\n      </button>\n    </div>\n    <div class=\"list\" style=\"margin-top: 12px;\">\n      ${\n        entries.length === 0\n          ? html`\n              <div class=\"muted\">No allowlist entries yet.</div>\n            `\n          : entries.map((entry, index) => renderAllowlistEntry(state, entry, index))\n      }\n    </div>\n  `;\n}\n\nfunction renderAllowlistEntry(\n  state: ExecApprovalsState,\n  entry: ExecApprovalsAllowlistEntry,\n  index: number,\n) {\n  const lastUsed = entry.lastUsedAt ? formatAgo(entry.lastUsedAt) : \"never\";\n  const lastCommand = entry.lastUsedCommand ? clampText(entry.lastUsedCommand, 120) : null;\n  const lastPath = entry.lastResolvedPath ? clampText(entry.lastResolvedPath, 120) : null;\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${entry.pattern?.trim() ? entry.pattern : \"New pattern\"}</div>\n        <div class=\"list-sub\">Last used: ${lastUsed}</div>\n        ${lastCommand ? html`<div class=\"list-sub mono\">${lastCommand}</div>` : nothing}\n        ${lastPath ? html`<div class=\"list-sub mono\">${lastPath}</div>` : nothing}\n      </div>\n      <div class=\"list-meta\">\n        <label class=\"field\">\n          <span>Pattern</span>\n          <input\n            type=\"text\"\n            .value=${entry.pattern ?? \"\"}\n            ?disabled=${state.disabled}\n            @input=${(event: Event) => {\n              const target = event.target as HTMLInputElement;\n              state.onPatch(\n                [\"agents\", state.selectedScope, \"allowlist\", index, \"pattern\"],\n                target.value,\n              );\n            }}\n          />\n        </label>\n        <button\n          class=\"btn btn--sm danger\"\n          ?disabled=${state.disabled}\n          @click=${() => {\n            if (state.allowlist.length <= 1) {\n              state.onRemove([\"agents\", state.selectedScope, \"allowlist\"]);\n              return;\n            }\n            state.onRemove([\"agents\", state.selectedScope, \"allowlist\", index]);\n          }}\n        >\n          Remove\n        </button>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderAgentBinding(agent: BindingAgent, state: BindingState) {\n  const bindingValue = agent.binding ?? \"__default__\";\n  const label = agent.name?.trim() ? `${agent.name} (${agent.id})` : agent.id;\n  const supportsBinding = state.nodes.length > 0;\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${label}</div>\n        <div class=\"list-sub\">\n          ${agent.isDefault ? \"default agent\" : \"agent\"} Â·\n          ${\n            bindingValue === \"__default__\"\n              ? `uses default (${state.defaultBinding ?? \"any\"})`\n              : `override: ${agent.binding}`\n          }\n        </div>\n      </div>\n      <div class=\"list-meta\">\n        <label class=\"field\">\n          <span>Binding</span>\n          <select\n            ?disabled=${state.disabled || !supportsBinding}\n            @change=${(event: Event) => {\n              const target = event.target as HTMLSelectElement;\n              const value = target.value.trim();\n              state.onBindAgent(agent.index, value === \"__default__\" ? null : value);\n            }}\n          >\n            <option value=\"__default__\" ?selected=${bindingValue === \"__default__\"}>\n              Use default\n            </option>\n            ${state.nodes.map(\n              (node) =>\n                html`<option\n                  value=${node.id}\n                  ?selected=${bindingValue === node.id}\n                >\n                  ${node.label}\n                </option>`,\n            )}\n          </select>\n        </label>\n      </div>\n    </div>\n  `;\n}\n\nfunction resolveExecNodes(nodes: Array<Record<string, unknown>>): BindingNode[] {\n  const list: BindingNode[] = [];\n  for (const node of nodes) {\n    const commands = Array.isArray(node.commands) ? node.commands : [];\n    const supports = commands.some((cmd) => String(cmd) === \"system.run\");\n    if (!supports) {\n      continue;\n    }\n    const nodeId = typeof node.nodeId === \"string\" ? node.nodeId.trim() : \"\";\n    if (!nodeId) {\n      continue;\n    }\n    const displayName =\n      typeof node.displayName === \"string\" && node.displayName.trim()\n        ? node.displayName.trim()\n        : nodeId;\n    list.push({\n      id: nodeId,\n      label: displayName === nodeId ? nodeId : `${displayName} Â· ${nodeId}`,\n    });\n  }\n  list.sort((a, b) => a.label.localeCompare(b.label));\n  return list;\n}\n\nfunction resolveExecApprovalsNodes(\n  nodes: Array<Record<string, unknown>>,\n): ExecApprovalsTargetNode[] {\n  const list: ExecApprovalsTargetNode[] = [];\n  for (const node of nodes) {\n    const commands = Array.isArray(node.commands) ? node.commands : [];\n    const supports = commands.some(\n      (cmd) =>\n        String(cmd) === \"system.execApprovals.get\" || String(cmd) === \"system.execApprovals.set\",\n    );\n    if (!supports) {\n      continue;\n    }\n    const nodeId = typeof node.nodeId === \"string\" ? node.nodeId.trim() : \"\";\n    if (!nodeId) {\n      continue;\n    }\n    const displayName =\n      typeof node.displayName === \"string\" && node.displayName.trim()\n        ? node.displayName.trim()\n        : nodeId;\n    list.push({\n      id: nodeId,\n      label: displayName === nodeId ? nodeId : `${displayName} Â· ${nodeId}`,\n    });\n  }\n  list.sort((a, b) => a.label.localeCompare(b.label));\n  return list;\n}\n\nfunction resolveAgentBindings(config: Record<string, unknown> | null): {\n  defaultBinding?: string | null;\n  agents: BindingAgent[];\n} {\n  const fallbackAgent: BindingAgent = {\n    id: \"main\",\n    name: undefined,\n    index: 0,\n    isDefault: true,\n    binding: null,\n  };\n  if (!config || typeof config !== \"object\") {\n    return { defaultBinding: null, agents: [fallbackAgent] };\n  }\n  const tools = (config.tools ?? {}) as Record<string, unknown>;\n  const exec = (tools.exec ?? {}) as Record<string, unknown>;\n  const defaultBinding =\n    typeof exec.node === \"string\" && exec.node.trim() ? exec.node.trim() : null;\n\n  const agentsNode = (config.agents ?? {}) as Record<string, unknown>;\n  const list = Array.isArray(agentsNode.list) ? agentsNode.list : [];\n  if (list.length === 0) {\n    return { defaultBinding, agents: [fallbackAgent] };\n  }\n\n  const agents: BindingAgent[] = [];\n  list.forEach((entry, index) => {\n    if (!entry || typeof entry !== \"object\") {\n      return;\n    }\n    const record = entry as Record<string, unknown>;\n    const id = typeof record.id === \"string\" ? record.id.trim() : \"\";\n    if (!id) {\n      return;\n    }\n    const name = typeof record.name === \"string\" ? record.name.trim() : undefined;\n    const isDefault = record.default === true;\n    const toolsEntry = (record.tools ?? {}) as Record<string, unknown>;\n    const execEntry = (toolsEntry.exec ?? {}) as Record<string, unknown>;\n    const binding =\n      typeof execEntry.node === \"string\" && execEntry.node.trim() ? execEntry.node.trim() : null;\n    agents.push({\n      id,\n      name: name || undefined,\n      index,\n      isDefault,\n      binding,\n    });\n  });\n\n  if (agents.length === 0) {\n    agents.push(fallbackAgent);\n  }\n\n  return { defaultBinding, agents };\n}\n\nfunction renderNode(node: Record<string, unknown>) {\n  const connected = Boolean(node.connected);\n  const paired = Boolean(node.paired);\n  const title =\n    (typeof node.displayName === \"string\" && node.displayName.trim()) ||\n    (typeof node.nodeId === \"string\" ? node.nodeId : \"unknown\");\n  const caps = Array.isArray(node.caps) ? (node.caps as unknown[]) : [];\n  const commands = Array.isArray(node.commands) ? (node.commands as unknown[]) : [];\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">${title}</div>\n        <div class=\"list-sub\">\n          ${typeof node.nodeId === \"string\" ? node.nodeId : \"\"}\n          ${typeof node.remoteIp === \"string\" ? ` Â· ${node.remoteIp}` : \"\"}\n          ${typeof node.version === \"string\" ? ` Â· ${node.version}` : \"\"}\n        </div>\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\n          <span class=\"chip\">${paired ? \"paired\" : \"unpaired\"}</span>\n          <span class=\"chip ${connected ? \"chip-ok\" : \"chip-warn\"}\">\n            ${connected ? \"connected\" : \"offline\"}\n          </span>\n          ${caps.slice(0, 12).map((c) => html`<span class=\"chip\">${String(c)}</span>`)}\n          ${commands.slice(0, 8).map((c) => html`<span class=\"chip\">${String(c)}</span>`)}\n        </div>\n      </div>\n    </div>\n  `;\n}\n","import { html } from \"lit\";\nimport type { GatewayHelloOk } from \"../gateway\";\nimport type { UiSettings } from \"../storage\";\nimport { formatAgo, formatDurationMs } from \"../format\";\nimport { formatNextRun } from \"../presenter\";\n\nexport type OverviewProps = {\n  connected: boolean;\n  hello: GatewayHelloOk | null;\n  settings: UiSettings;\n  password: string;\n  lastError: string | null;\n  presenceCount: number;\n  sessionsCount: number | null;\n  cronEnabled: boolean | null;\n  cronNext: number | null;\n  lastChannelsRefresh: number | null;\n  onSettingsChange: (next: UiSettings) => void;\n  onPasswordChange: (next: string) => void;\n  onSessionKeyChange: (next: string) => void;\n  onConnect: () => void;\n  onRefresh: () => void;\n};\n\nexport function renderOverview(props: OverviewProps) {\n  const snapshot = props.hello?.snapshot as\n    | { uptimeMs?: number; policy?: { tickIntervalMs?: number } }\n    | undefined;\n  const uptime = snapshot?.uptimeMs ? formatDurationMs(snapshot.uptimeMs) : \"n/a\";\n  const tick = snapshot?.policy?.tickIntervalMs ? `${snapshot.policy.tickIntervalMs}ms` : \"n/a\";\n  const authHint = (() => {\n    if (props.connected || !props.lastError) {\n      return null;\n    }\n    const lower = props.lastError.toLowerCase();\n    const authFailed = lower.includes(\"unauthorized\") || lower.includes(\"connect failed\");\n    if (!authFailed) {\n      return null;\n    }\n    const hasToken = Boolean(props.settings.token.trim());\n    const hasPassword = Boolean(props.password.trim());\n    if (!hasToken && !hasPassword) {\n      return html`\n        <div class=\"muted\" style=\"margin-top: 8px\">\n          This gateway requires auth. Add a token or password, then click Connect.\n          <div style=\"margin-top: 6px\">\n            <span class=\"mono\">openclaw dashboard --no-open</span> â†’ tokenized URL<br />\n            <span class=\"mono\">openclaw doctor --generate-gateway-token</span> â†’ set token\n          </div>\n          <div style=\"margin-top: 6px\">\n            <a\n              class=\"session-link\"\n              href=\"https://docs.openclaw.ai/web/dashboard\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"Control UI auth docs (opens in new tab)\"\n              >Docs: Control UI auth</a\n            >\n          </div>\n        </div>\n      `;\n    }\n    return html`\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        Auth failed. Re-copy a tokenized URL with\n        <span class=\"mono\">openclaw dashboard --no-open</span>, or update the token, then click Connect.\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/dashboard\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Control UI auth docs (opens in new tab)\"\n            >Docs: Control UI auth</a\n          >\n        </div>\n      </div>\n    `;\n  })();\n  const insecureContextHint = (() => {\n    if (props.connected || !props.lastError) {\n      return null;\n    }\n    const isSecureContext = typeof window !== \"undefined\" ? window.isSecureContext : true;\n    if (isSecureContext) {\n      return null;\n    }\n    const lower = props.lastError.toLowerCase();\n    if (!lower.includes(\"secure context\") && !lower.includes(\"device identity required\")) {\n      return null;\n    }\n    return html`\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        This page is HTTP, so the browser blocks device identity. Use HTTPS (Tailscale Serve) or open\n        <span class=\"mono\">http://127.0.0.1:18789</span> on the gateway host.\n        <div style=\"margin-top: 6px\">\n          If you must stay on HTTP, set\n          <span class=\"mono\">gateway.controlUi.allowInsecureAuth: true</span> (token-only).\n        </div>\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/gateway/tailscale\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Tailscale Serve docs (opens in new tab)\"\n            >Docs: Tailscale Serve</a\n          >\n          <span class=\"muted\"> Â· </span>\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/control-ui#insecure-http\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Insecure HTTP docs (opens in new tab)\"\n            >Docs: Insecure HTTP</a\n          >\n        </div>\n      </div>\n    `;\n  })();\n\n  return html`\n    <section class=\"grid grid-cols-2\">\n      <div class=\"card\">\n        <div class=\"card-title\">Gateway Access</div>\n        <div class=\"card-sub\">Where the dashboard connects and how it authenticates.</div>\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\n          <label class=\"field\">\n            <span>WebSocket URL</span>\n            <input\n              .value=${props.settings.gatewayUrl}\n              @input=${(e: Event) => {\n                const v = (e.target as HTMLInputElement).value;\n                props.onSettingsChange({ ...props.settings, gatewayUrl: v });\n              }}\n              placeholder=\"ws://100.x.y.z:18789\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Gateway Token</span>\n            <input\n              .value=${props.settings.token}\n              @input=${(e: Event) => {\n                const v = (e.target as HTMLInputElement).value;\n                props.onSettingsChange({ ...props.settings, token: v });\n              }}\n              placeholder=\"OPENCLAW_GATEWAY_TOKEN\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Password (not stored)</span>\n            <input\n              type=\"password\"\n              .value=${props.password}\n              @input=${(e: Event) => {\n                const v = (e.target as HTMLInputElement).value;\n                props.onPasswordChange(v);\n              }}\n              placeholder=\"system or shared password\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Default Session Key</span>\n            <input\n              .value=${props.settings.sessionKey}\n              @input=${(e: Event) => {\n                const v = (e.target as HTMLInputElement).value;\n                props.onSessionKeyChange(v);\n              }}\n            />\n          </label>\n        </div>\n        <div class=\"row\" style=\"margin-top: 14px;\">\n          <button class=\"btn\" @click=${() => props.onConnect()}>Connect</button>\n          <button class=\"btn\" @click=${() => props.onRefresh()}>Refresh</button>\n          <span class=\"muted\">Click Connect to apply connection changes.</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-title\">Snapshot</div>\n        <div class=\"card-sub\">Latest gateway handshake information.</div>\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\n          <div class=\"stat\">\n            <div class=\"stat-label\">Status</div>\n            <div class=\"stat-value ${props.connected ? \"ok\" : \"warn\"}\">\n              ${props.connected ? \"Connected\" : \"Disconnected\"}\n            </div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Uptime</div>\n            <div class=\"stat-value\">${uptime}</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Tick Interval</div>\n            <div class=\"stat-value\">${tick}</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Last Channels Refresh</div>\n            <div class=\"stat-value\">\n              ${props.lastChannelsRefresh ? formatAgo(props.lastChannelsRefresh) : \"n/a\"}\n            </div>\n          </div>\n        </div>\n        ${\n          props.lastError\n            ? html`<div class=\"callout danger\" style=\"margin-top: 14px;\">\n              <div>${props.lastError}</div>\n              ${authHint ?? \"\"}\n              ${insecureContextHint ?? \"\"}\n            </div>`\n            : html`\n                <div class=\"callout\" style=\"margin-top: 14px\">\n                  Use Channels to link WhatsApp, Telegram, Discord, Signal, or iMessage.\n                </div>\n              `\n        }\n      </div>\n    </section>\n\n    <section class=\"grid grid-cols-3\" style=\"margin-top: 18px;\">\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Instances</div>\n        <div class=\"stat-value\">${props.presenceCount}</div>\n        <div class=\"muted\">Presence beacons in the last 5 minutes.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Sessions</div>\n        <div class=\"stat-value\">${props.sessionsCount ?? \"n/a\"}</div>\n        <div class=\"muted\">Recent session keys tracked by the gateway.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Cron</div>\n        <div class=\"stat-value\">\n          ${props.cronEnabled == null ? \"n/a\" : props.cronEnabled ? \"Enabled\" : \"Disabled\"}\n        </div>\n        <div class=\"muted\">Next wake ${formatNextRun(props.cronNext)}</div>\n      </div>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Notes</div>\n      <div class=\"card-sub\">Quick reminders for remote control setups.</div>\n      <div class=\"note-grid\" style=\"margin-top: 14px;\">\n        <div>\n          <div class=\"note-title\">Tailscale serve</div>\n          <div class=\"muted\">\n            Prefer serve mode to keep the gateway on loopback with tailnet auth.\n          </div>\n        </div>\n        <div>\n          <div class=\"note-title\">Session hygiene</div>\n          <div class=\"muted\">Use /new or sessions.patch to reset context.</div>\n        </div>\n        <div>\n          <div class=\"note-title\">Cron reminders</div>\n          <div class=\"muted\">Use isolated sessions for recurring runs.</div>\n        </div>\n      </div>\n    </section>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { GatewaySessionRow, SessionsListResult } from \"../types\";\nimport { formatAgo } from \"../format\";\nimport { pathForTab } from \"../navigation\";\nimport { formatSessionTokens } from \"../presenter\";\n\nexport type SessionsProps = {\n  loading: boolean;\n  result: SessionsListResult | null;\n  error: string | null;\n  activeMinutes: string;\n  limit: string;\n  includeGlobal: boolean;\n  includeUnknown: boolean;\n  filterText: string;\n  basePath: string;\n  onFiltersChange: (next: {\n    activeMinutes: string;\n    limit: string;\n    includeGlobal: boolean;\n    includeUnknown: boolean;\n    filterText: string;\n  }) => void;\n  onRefresh: () => void;\n  onPatch: (\n    key: string,\n    patch: {\n      label?: string | null;\n      thinkingLevel?: string | null;\n      verboseLevel?: string | null;\n      reasoningLevel?: string | null;\n    },\n  ) => void;\n  onDelete: (key: string) => void;\n};\n\nconst THINK_LEVELS = [\"\", \"off\", \"minimal\", \"low\", \"medium\", \"high\"] as const;\nconst BINARY_THINK_LEVELS = [\"\", \"off\", \"on\"] as const;\nconst VERBOSE_LEVELS = [\n  { value: \"\", label: \"inherit\" },\n  { value: \"off\", label: \"off (explicit)\" },\n  { value: \"on\", label: \"on\" },\n] as const;\nconst REASONING_LEVELS = [\"\", \"off\", \"on\", \"stream\"] as const;\n\nfunction normalizeProviderId(provider?: string | null): string {\n  if (!provider) {\n    return \"\";\n  }\n  const normalized = provider.trim().toLowerCase();\n  if (normalized === \"z.ai\" || normalized === \"z-ai\") {\n    return \"zai\";\n  }\n  return normalized;\n}\n\nfunction isBinaryThinkingProvider(provider?: string | null): boolean {\n  return normalizeProviderId(provider) === \"zai\";\n}\n\nfunction resolveThinkLevelOptions(provider?: string | null): readonly string[] {\n  return isBinaryThinkingProvider(provider) ? BINARY_THINK_LEVELS : THINK_LEVELS;\n}\n\nfunction resolveThinkLevelDisplay(value: string, isBinary: boolean): string {\n  if (!isBinary) {\n    return value;\n  }\n  if (!value || value === \"off\") {\n    return value;\n  }\n  return \"on\";\n}\n\nfunction resolveThinkLevelPatchValue(value: string, isBinary: boolean): string | null {\n  if (!value) {\n    return null;\n  }\n  if (!isBinary) {\n    return value;\n  }\n  if (value === \"on\") {\n    return \"low\";\n  }\n  return value;\n}\n\nfunction matchesFilter(row: GatewaySessionRow, needle: string): boolean {\n  if (!needle) {\n    return true;\n  }\n  const haystack = [row.key, row.label ?? \"\", row.kind, row.displayName ?? \"\"]\n    .filter(Boolean)\n    .join(\" \")\n    .toLowerCase();\n  return haystack.includes(needle.toLowerCase());\n}\n\nexport function renderSessions(props: SessionsProps) {\n  const rows = props.result?.sessions ?? [];\n  const filterText = props.filterText.trim();\n  const filtered = filterText ? rows.filter((row) => matchesFilter(row, filterText)) : rows;\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Sessions</div>\n          <div class=\"card-sub\">Active session keys and per-session overrides.</div>\n        </div>\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh} aria-label=\"Refresh sessions\">\n          ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n\n      <div class=\"filters\" style=\"margin-top: 14px;\">\n        <label class=\"field\" style=\"flex: 1;\">\n          <span>Search</span>\n          <input\n            type=\"search\"\n            .value=${props.filterText}\n            @input=${(e: Event) =>\n              props.onFiltersChange({\n                activeMinutes: props.activeMinutes,\n                limit: props.limit,\n                includeGlobal: props.includeGlobal,\n                includeUnknown: props.includeUnknown,\n                filterText: (e.target as HTMLInputElement).value,\n              })}\n            placeholder=\"Filter by key, label, or kind\"\n            aria-label=\"Search sessions\"\n          />\n        </label>\n        <label class=\"field\">\n          <span>Active within (minutes)</span>\n          <input\n            .value=${props.activeMinutes}\n            @input=${(e: Event) =>\n              props.onFiltersChange({\n                activeMinutes: (e.target as HTMLInputElement).value,\n                limit: props.limit,\n                includeGlobal: props.includeGlobal,\n                includeUnknown: props.includeUnknown,\n                filterText: props.filterText,\n              })}\n          />\n        </label>\n        <label class=\"field\">\n          <span>Limit</span>\n          <input\n            .value=${props.limit}\n            @input=${(e: Event) =>\n              props.onFiltersChange({\n                activeMinutes: props.activeMinutes,\n                limit: (e.target as HTMLInputElement).value,\n                includeGlobal: props.includeGlobal,\n                includeUnknown: props.includeUnknown,\n                filterText: props.filterText,\n              })}\n          />\n        </label>\n        <label class=\"field checkbox\">\n          <span>Include global</span>\n          <input\n            type=\"checkbox\"\n            .checked=${props.includeGlobal}\n            @change=${(e: Event) =>\n              props.onFiltersChange({\n                activeMinutes: props.activeMinutes,\n                limit: props.limit,\n                includeGlobal: (e.target as HTMLInputElement).checked,\n                includeUnknown: props.includeUnknown,\n                filterText: props.filterText,\n              })}\n          />\n        </label>\n        <label class=\"field checkbox\">\n          <span>Include unknown</span>\n          <input\n            type=\"checkbox\"\n            .checked=${props.includeUnknown}\n            @change=${(e: Event) =>\n              props.onFiltersChange({\n                activeMinutes: props.activeMinutes,\n                limit: props.limit,\n                includeGlobal: props.includeGlobal,\n                includeUnknown: (e.target as HTMLInputElement).checked,\n                filterText: props.filterText,\n              })}\n          />\n        </label>\n      </div>\n\n      ${\n        props.error\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\n          : nothing\n      }\n\n      <div class=\"muted\" style=\"margin-top: 12px;\">\n        ${props.result ? `Store: ${props.result.path}` : \"\"}\n        ${filterText ? html` Â· ${filtered.length} of ${rows.length} shown` : \"\"}\n      </div>\n\n      <div class=\"table\" style=\"margin-top: 16px;\">\n        <div class=\"table-head\">\n          <div>Key</div>\n          <div>Label</div>\n          <div>Kind</div>\n          <div>Updated</div>\n          <div>Tokens</div>\n          <div>Thinking</div>\n          <div>Verbose</div>\n          <div>Reasoning</div>\n          <div>Actions</div>\n        </div>\n        ${\n          filtered.length === 0\n            ? html`\n                <div class=\"muted\">No sessions found${filterText ? \" matching filter\" : \"\"}.</div>\n              `\n            : filtered.map((row) =>\n                renderRow(row, props.basePath, props.onPatch, props.onDelete, props.loading),\n              )\n        }\n      </div>\n    </section>\n  `;\n}\n\nfunction renderRow(\n  row: GatewaySessionRow,\n  basePath: string,\n  onPatch: SessionsProps[\"onPatch\"],\n  onDelete: SessionsProps[\"onDelete\"],\n  disabled: boolean,\n) {\n  const updated = row.updatedAt ? formatAgo(row.updatedAt) : \"n/a\";\n  const rawThinking = row.thinkingLevel ?? \"\";\n  const isBinaryThinking = isBinaryThinkingProvider(row.modelProvider);\n  const thinking = resolveThinkLevelDisplay(rawThinking, isBinaryThinking);\n  const thinkLevels = resolveThinkLevelOptions(row.modelProvider);\n  const verbose = row.verboseLevel ?? \"\";\n  const reasoning = row.reasoningLevel ?? \"\";\n  const displayName = row.displayName ?? row.key;\n  const canLink = row.kind !== \"global\";\n  const chatUrl = canLink\n    ? `${pathForTab(\"chat\", basePath)}?session=${encodeURIComponent(row.key)}`\n    : null;\n\n  return html`\n    <div class=\"table-row\">\n      <div class=\"mono\">${\n        canLink ? html`<a href=${chatUrl} class=\"session-link\">${displayName}</a>` : displayName\n      }</div>\n      <div>\n        <input\n          .value=${row.label ?? \"\"}\n          ?disabled=${disabled}\n          placeholder=\"(optional)\"\n          @change=${(e: Event) => {\n            const value = (e.target as HTMLInputElement).value.trim();\n            onPatch(row.key, { label: value || null });\n          }}\n        />\n      </div>\n      <div>${row.kind}</div>\n      <div>${updated}</div>\n      <div>${formatSessionTokens(row)}</div>\n      <div>\n        <select\n          .value=${thinking}\n          ?disabled=${disabled}\n          @change=${(e: Event) => {\n            const value = (e.target as HTMLSelectElement).value;\n            onPatch(row.key, {\n              thinkingLevel: resolveThinkLevelPatchValue(value, isBinaryThinking),\n            });\n          }}\n        >\n          ${thinkLevels.map((level) => html`<option value=${level}>${level || \"inherit\"}</option>`)}\n        </select>\n      </div>\n      <div>\n        <select\n          .value=${verbose}\n          ?disabled=${disabled}\n          @change=${(e: Event) => {\n            const value = (e.target as HTMLSelectElement).value;\n            onPatch(row.key, { verboseLevel: value || null });\n          }}\n        >\n          ${VERBOSE_LEVELS.map(\n            (level) => html`<option value=${level.value}>${level.label}</option>`,\n          )}\n        </select>\n      </div>\n      <div>\n        <select\n          .value=${reasoning}\n          ?disabled=${disabled}\n          @change=${(e: Event) => {\n            const value = (e.target as HTMLSelectElement).value;\n            onPatch(row.key, { reasoningLevel: value || null });\n          }}\n        >\n          ${REASONING_LEVELS.map(\n            (level) => html`<option value=${level}>${level || \"inherit\"}</option>`,\n          )}\n        </select>\n      </div>\n      <div>\n        <button class=\"btn danger\" ?disabled=${disabled} @click=${() => onDelete(row.key)}>\n          Delete\n        </button>\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport type { SkillMessageMap } from \"../controllers/skills\";\nimport type { SkillStatusEntry, SkillStatusReport } from \"../types\";\nimport { clampText } from \"../format\";\n\ntype SkillGroup = {\n  id: string;\n  label: string;\n  skills: SkillStatusEntry[];\n};\n\nconst SKILL_SOURCE_GROUPS: Array<{ id: string; label: string; sources: string[] }> = [\n  { id: \"workspace\", label: \"Workspace Skills\", sources: [\"openclaw-workspace\"] },\n  { id: \"built-in\", label: \"Built-in Skills\", sources: [\"openclaw-bundled\"] },\n  { id: \"installed\", label: \"Installed Skills\", sources: [\"openclaw-managed\"] },\n  { id: \"extra\", label: \"Extra Skills\", sources: [\"openclaw-extra\"] },\n];\n\nfunction groupSkills(skills: SkillStatusEntry[]): SkillGroup[] {\n  const groups = new Map<string, SkillGroup>();\n  for (const def of SKILL_SOURCE_GROUPS) {\n    groups.set(def.id, { id: def.id, label: def.label, skills: [] });\n  }\n  const other: SkillGroup = { id: \"other\", label: \"Other Skills\", skills: [] };\n  for (const skill of skills) {\n    const match = SKILL_SOURCE_GROUPS.find((group) => group.sources.includes(skill.source));\n    if (match) {\n      groups.get(match.id)?.skills.push(skill);\n    } else {\n      other.skills.push(skill);\n    }\n  }\n  const ordered = SKILL_SOURCE_GROUPS.map((group) => groups.get(group.id)).filter(\n    (group): group is SkillGroup => Boolean(group && group.skills.length > 0),\n  );\n  if (other.skills.length > 0) {\n    ordered.push(other);\n  }\n  return ordered;\n}\n\nexport type SkillsProps = {\n  loading: boolean;\n  report: SkillStatusReport | null;\n  error: string | null;\n  filter: string;\n  edits: Record<string, string>;\n  busyKey: string | null;\n  messages: SkillMessageMap;\n  onFilterChange: (next: string) => void;\n  onRefresh: () => void;\n  onToggle: (skillKey: string, enabled: boolean) => void;\n  onEdit: (skillKey: string, value: string) => void;\n  onSaveKey: (skillKey: string) => void;\n  onInstall: (skillKey: string, name: string, installId: string) => void;\n};\n\nexport function renderSkills(props: SkillsProps) {\n  const skills = props.report?.skills ?? [];\n  const filter = props.filter.trim().toLowerCase();\n  const filtered = filter\n    ? skills.filter((skill) =>\n        [skill.name, skill.description, skill.source].join(\" \").toLowerCase().includes(filter),\n      )\n    : skills;\n  const groups = groupSkills(filtered);\n\n  return html`\n    <section class=\"card\">\n      <div class=\"row\" style=\"justify-content: space-between;\">\n        <div>\n          <div class=\"card-title\">Skills</div>\n          <div class=\"card-sub\">Bundled, managed, and workspace skills.</div>\n        </div>\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\n          ${props.loading ? \"Loadingâ€¦\" : \"Refresh\"}\n        </button>\n      </div>\n\n      <div class=\"filters\" style=\"margin-top: 14px;\">\n        <label class=\"field\" style=\"flex: 1;\">\n          <span>Filter</span>\n          <input\n            .value=${props.filter}\n            @input=${(e: Event) => props.onFilterChange((e.target as HTMLInputElement).value)}\n            placeholder=\"Search skills\"\n          />\n        </label>\n        <div class=\"muted\">${filtered.length} shown</div>\n      </div>\n\n      ${\n        props.error\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\n          : nothing\n      }\n\n      ${\n        filtered.length === 0\n          ? html`\n              <div class=\"muted\" style=\"margin-top: 16px\">No skills found.</div>\n            `\n          : html`\n            <div class=\"agent-skills-groups\" style=\"margin-top: 16px;\">\n              ${groups.map((group) => {\n                const collapsedByDefault = group.id === \"workspace\" || group.id === \"built-in\";\n                return html`\n                  <details class=\"agent-skills-group\" ?open=${!collapsedByDefault}>\n                    <summary class=\"agent-skills-header\">\n                      <span>${group.label}</span>\n                      <span class=\"muted\">${group.skills.length}</span>\n                    </summary>\n                    <div class=\"list skills-grid\">\n                      ${group.skills.map((skill) => renderSkill(skill, props))}\n                    </div>\n                  </details>\n                `;\n              })}\n            </div>\n          `\n      }\n    </section>\n  `;\n}\n\nfunction renderSkill(skill: SkillStatusEntry, props: SkillsProps) {\n  const busy = props.busyKey === skill.skillKey;\n  const apiKey = props.edits[skill.skillKey] ?? \"\";\n  const message = props.messages[skill.skillKey] ?? null;\n  const canInstall = skill.install.length > 0 && skill.missing.bins.length > 0;\n  const missing = [\n    ...skill.missing.bins.map((b) => `bin:${b}`),\n    ...skill.missing.env.map((e) => `env:${e}`),\n    ...skill.missing.config.map((c) => `config:${c}`),\n    ...skill.missing.os.map((o) => `os:${o}`),\n  ];\n  const reasons: string[] = [];\n  if (skill.disabled) {\n    reasons.push(\"disabled\");\n  }\n  if (skill.blockedByAllowlist) {\n    reasons.push(\"blocked by allowlist\");\n  }\n  return html`\n    <div class=\"list-item\">\n      <div class=\"list-main\">\n        <div class=\"list-title\">\n          ${skill.emoji ? `${skill.emoji} ` : \"\"}${skill.name}\n        </div>\n        <div class=\"list-sub\">${clampText(skill.description, 140)}</div>\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\n          <span class=\"chip\">${skill.source}</span>\n          <span class=\"chip ${skill.eligible ? \"chip-ok\" : \"chip-warn\"}\">\n            ${skill.eligible ? \"eligible\" : \"blocked\"}\n          </span>\n          ${\n            skill.disabled\n              ? html`\n                  <span class=\"chip chip-warn\">disabled</span>\n                `\n              : nothing\n          }\n        </div>\n        ${\n          missing.length > 0\n            ? html`\n              <div class=\"muted\" style=\"margin-top: 6px;\">\n                Missing: ${missing.join(\", \")}\n              </div>\n            `\n            : nothing\n        }\n        ${\n          reasons.length > 0\n            ? html`\n              <div class=\"muted\" style=\"margin-top: 6px;\">\n                Reason: ${reasons.join(\", \")}\n              </div>\n            `\n            : nothing\n        }\n      </div>\n      <div class=\"list-meta\">\n        <div class=\"row\" style=\"justify-content: flex-end; flex-wrap: wrap;\">\n          <button\n            class=\"btn\"\n            ?disabled=${busy}\n            @click=${() => props.onToggle(skill.skillKey, skill.disabled)}\n          >\n            ${skill.disabled ? \"Enable\" : \"Disable\"}\n          </button>\n          ${\n            canInstall\n              ? html`<button\n                class=\"btn\"\n                ?disabled=${busy}\n                @click=${() => props.onInstall(skill.skillKey, skill.name, skill.install[0].id)}\n              >\n                ${busy ? \"Installingâ€¦\" : skill.install[0].label}\n              </button>`\n              : nothing\n          }\n        </div>\n        ${\n          message\n            ? html`<div\n              class=\"muted\"\n              style=\"margin-top: 8px; color: ${\n                message.kind === \"error\"\n                  ? \"var(--danger-color, #d14343)\"\n                  : \"var(--success-color, #0a7f5a)\"\n              };\"\n            >\n              ${message.message}\n            </div>`\n            : nothing\n        }\n        ${\n          skill.primaryEnv\n            ? html`\n              <div class=\"field\" style=\"margin-top: 10px;\">\n                <span>API key</span>\n                <input\n                  type=\"password\"\n                  .value=${apiKey}\n                  @input=${(e: Event) =>\n                    props.onEdit(skill.skillKey, (e.target as HTMLInputElement).value)}\n                />\n              </div>\n              <button\n                class=\"btn primary\"\n                style=\"margin-top: 8px;\"\n                ?disabled=${busy}\n                @click=${() => props.onSaveKey(skill.skillKey)}\n              >\n                Save key\n              </button>\n            `\n            : nothing\n        }\n      </div>\n    </div>\n  `;\n}\n","import { html, nothing } from \"lit\";\nimport { ref } from \"lit/directives/ref.js\";\nimport type { AppViewState } from \"./app-view-state\";\nimport { parseAgentSessionKey } from \"../../../src/routing/session-key.js\";\nimport { refreshChatAvatar } from \"./app-chat\";\nimport { renderChatControls, renderTab, renderThemeToggle } from \"./app-render.helpers\";\nimport { loadAgentFileContent, loadAgentFiles, saveAgentFile } from \"./controllers/agent-files\";\nimport { loadAgentIdentities, loadAgentIdentity } from \"./controllers/agent-identity\";\nimport { loadAgentSkills } from \"./controllers/agent-skills\";\nimport { loadAgents } from \"./controllers/agents\";\nimport { loadChannels } from \"./controllers/channels\";\nimport { loadChatHistory } from \"./controllers/chat\";\nimport {\n  applyConfig,\n  loadConfig,\n  removeConfigFormValue,\n  runUpdate,\n  saveConfig,\n  updateConfigFormValue,\n} from \"./controllers/config\";\nimport {\n  addCronJob,\n  loadCronRuns,\n  removeCronJob,\n  runCronJob,\n  toggleCronJob,\n} from \"./controllers/cron\";\nimport { callDebugMethod, loadDebug } from \"./controllers/debug\";\nimport {\n  approveDevicePairing,\n  loadDevices,\n  rejectDevicePairing,\n  revokeDeviceToken,\n  rotateDeviceToken,\n} from \"./controllers/devices\";\nimport {\n  loadExecApprovals,\n  removeExecApprovalsFormValue,\n  saveExecApprovals,\n  updateExecApprovalsFormValue,\n} from \"./controllers/exec-approvals\";\nimport { loadLogs } from \"./controllers/logs\";\nimport { loadNodes } from \"./controllers/nodes\";\nimport { loadPresence } from \"./controllers/presence\";\nimport { deleteSession, loadSessions, patchSession } from \"./controllers/sessions\";\nimport {\n  installSkill,\n  loadSkills,\n  saveSkillApiKey,\n  updateSkillEdit,\n  updateSkillEnabled,\n} from \"./controllers/skills\";\nimport { icons } from \"./icons\";\nimport { TAB_GROUPS, subtitleForTab, titleForTab } from \"./navigation\";\nimport { renderAgents } from \"./views/agents\";\nimport { renderChannels } from \"./views/channels\";\nimport { renderChat } from \"./views/chat\";\nimport { renderConfig } from \"./views/config\";\nimport { renderCron } from \"./views/cron\";\nimport { renderDebug } from \"./views/debug\";\nimport { renderExecApprovalPrompt } from \"./views/exec-approval\";\nimport { renderGatewayUrlConfirmation } from \"./views/gateway-url-confirmation\";\nimport { renderInstances } from \"./views/instances\";\nimport { renderLogs } from \"./views/logs\";\nimport { renderNodes } from \"./views/nodes\";\nimport { renderOverview } from \"./views/overview\";\nimport { renderSessions } from \"./views/sessions\";\nimport { renderSkills } from \"./views/skills\";\n\nconst AVATAR_DATA_RE = /^data:/i;\nconst AVATAR_HTTP_RE = /^https?:\\/\\//i;\n\nfunction resolveAssistantAvatarUrl(state: AppViewState): string | undefined {\n  const list = state.agentsList?.agents ?? [];\n  const parsed = parseAgentSessionKey(state.sessionKey);\n  const agentId = parsed?.agentId ?? state.agentsList?.defaultId ?? \"main\";\n  const agent = list.find((entry) => entry.id === agentId);\n  const identity = agent?.identity;\n  const candidate = identity?.avatarUrl ?? identity?.avatar;\n  if (!candidate) {\n    return undefined;\n  }\n  if (AVATAR_DATA_RE.test(candidate) || AVATAR_HTTP_RE.test(candidate)) {\n    return candidate;\n  }\n  return identity?.avatarUrl;\n}\n\nexport function renderApp(state: AppViewState) {\n  const presenceCount = state.presenceEntries.length;\n  const sessionsCount = state.sessionsResult?.count ?? null;\n  const cronNext = state.cronStatus?.nextWakeAtMs ?? null;\n  const chatDisabledReason = state.connected ? null : \"Disconnected from gateway.\";\n  const isChat = state.tab === \"chat\";\n  const chatFocus = isChat && (state.settings.chatFocusMode || state.onboarding);\n  const showThinking = state.onboarding ? false : state.settings.chatShowThinking;\n  const assistantAvatarUrl = resolveAssistantAvatarUrl(state);\n  const chatAvatarUrl = state.chatAvatarUrl ?? assistantAvatarUrl ?? null;\n  const configValue =\n    state.configForm ?? (state.configSnapshot?.config as Record<string, unknown> | null);\n  const resolvedAgentId =\n    state.agentsSelectedId ??\n    state.agentsList?.defaultId ??\n    state.agentsList?.agents?.[0]?.id ??\n    null;\n\n  return html`\n    <a href=\"#main-content\" class=\"skip-link\">Skip to main content</a>\n    <div class=\"toast-container\" role=\"status\" aria-live=\"polite\" aria-atomic=\"false\">\n      ${state.toasts.map(\n        (toast) => html`\n          <div class=\"toast toast--${toast.type}\" role=\"alert\">\n            <span class=\"toast__message\">${toast.message}</span>\n            <button\n              class=\"toast__close\"\n              @click=${() => state.dismissToast(toast.id)}\n              aria-label=\"Dismiss notification\"\n            >\n              Ã—\n            </button>\n          </div>\n        `,\n      )}\n    </div>\n    <div class=\"shell ${isChat ? \"shell--chat\" : \"\"} ${chatFocus ? \"shell--chat-focus\" : \"\"} ${state.settings.navCollapsed ? \"shell--nav-collapsed\" : \"\"} ${state.onboarding ? \"shell--onboarding\" : \"\"}\">\n      <header class=\"topbar\">\n        <div class=\"topbar-left\">\n          <button\n            class=\"nav-collapse-toggle\"\n            @click=${() =>\n              state.applySettings({\n                ...state.settings,\n                navCollapsed: !state.settings.navCollapsed,\n              })}\n            title=\"${state.settings.navCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\"\n            aria-label=\"${state.settings.navCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\"\n          >\n            <span class=\"nav-collapse-toggle__icon\">${icons.menu}</span>\n          </button>\n          <div class=\"brand\">\n            <div class=\"brand-logo\">\n              <img src=\"/favicon.svg\" alt=\"OpenClaw\" />\n            </div>\n            <div class=\"brand-text\">\n              <div class=\"brand-title\">OPENCLAW</div>\n              <div class=\"brand-sub\">Gateway Dashboard</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"topbar-status\">\n          <div class=\"pill\" title=\"${state.connected ? \"Connected to gateway\" : state.connectionState === \"reconnecting\" ? \"Reconnecting to gateway\" : \"Disconnected from gateway\"}\">\n            <span class=\"statusDot ${state.connectionState === \"connected\" ? \"ok\" : state.connectionState === \"reconnecting\" ? \"warn\" : \"\"}\"></span>\n            <span>Health</span>\n            <span class=\"mono\">${\n              state.connectionState === \"connected\"\n                ? \"OK\"\n                : state.connectionState === \"reconnecting\"\n                  ? \"Reconnecting\"\n                  : \"Offline\"\n            }</span>\n          </div>\n          ${renderThemeToggle(state)}\n        </div>\n      </header>\n      <aside class=\"nav ${state.settings.navCollapsed ? \"nav--collapsed\" : \"\"}\">\n        ${TAB_GROUPS.map((group) => {\n          const isGroupCollapsed = state.settings.navGroupsCollapsed[group.label] ?? false;\n          const hasActiveTab = group.tabs.some((tab) => tab === state.tab);\n          return html`\n            <div class=\"nav-group ${isGroupCollapsed && !hasActiveTab ? \"nav-group--collapsed\" : \"\"}\">\n              <button\n                class=\"nav-label\"\n                @click=${() => {\n                  const next = { ...state.settings.navGroupsCollapsed };\n                  next[group.label] = !isGroupCollapsed;\n                  state.applySettings({\n                    ...state.settings,\n                    navGroupsCollapsed: next,\n                  });\n                }}\n                aria-expanded=${!isGroupCollapsed}\n              >\n                <span class=\"nav-label__text\">${group.label}</span>\n                <span class=\"nav-label__chevron\">${isGroupCollapsed ? \"+\" : \"âˆ’\"}</span>\n              </button>\n              <div class=\"nav-group__items\">\n                ${group.tabs.map((tab) => renderTab(state, tab))}\n              </div>\n            </div>\n          `;\n        })}\n        <div class=\"nav-group nav-group--links\">\n          <div class=\"nav-label nav-label--static\">\n            <span class=\"nav-label__text\">Resources</span>\n          </div>\n          <div class=\"nav-group__items\">\n            <a\n              class=\"nav-item nav-item--external\"\n              href=\"https://docs.openclaw.ai\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"Docs (opens in new tab)\"\n            >\n              <span class=\"nav-item__icon\" aria-hidden=\"true\">${icons.book}</span>\n              <span class=\"nav-item__text\">Docs</span>\n            </a>\n          </div>\n        </div>\n      </aside>\n      <main id=\"main-content\" class=\"content ${isChat ? \"content--chat\" : \"\"}\">\n        <section class=\"content-header\">\n          <div>\n            <h1 class=\"page-title\">${titleForTab(state.tab)}</h1>\n            <div class=\"page-sub\">${subtitleForTab(state.tab)}</div>\n          </div>\n          <div class=\"page-meta\">\n            ${state.lastError ? html`<div class=\"pill danger\">${state.lastError}</div>` : nothing}\n            ${isChat ? renderChatControls(state) : nothing}\n          </div>\n        </section>\n\n        ${\n          state.tab === \"overview\"\n            ? renderOverview({\n                connected: state.connected,\n                hello: state.hello,\n                settings: state.settings,\n                password: state.password,\n                lastError: state.lastError,\n                presenceCount,\n                sessionsCount,\n                cronEnabled: state.cronStatus?.enabled ?? null,\n                cronNext,\n                lastChannelsRefresh: state.channelsLastSuccess,\n                onSettingsChange: (next) => state.applySettings(next),\n                onPasswordChange: (next) => (state.password = next),\n                onSessionKeyChange: (next) => {\n                  state.sessionKey = next;\n                  state.chatMessage = \"\";\n                  state.resetToolStream();\n                  state.applySettings({\n                    ...state.settings,\n                    sessionKey: next,\n                    lastActiveSessionKey: next,\n                  });\n                  void state.loadAssistantIdentity();\n                },\n                onConnect: () => state.connect(),\n                onRefresh: () => state.loadOverview(),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"channels\"\n            ? renderChannels({\n                connected: state.connected,\n                loading: state.channelsLoading,\n                snapshot: state.channelsSnapshot,\n                lastError: state.channelsError,\n                lastSuccessAt: state.channelsLastSuccess,\n                whatsappMessage: state.whatsappLoginMessage,\n                whatsappQrDataUrl: state.whatsappLoginQrDataUrl,\n                whatsappConnected: state.whatsappLoginConnected,\n                whatsappBusy: state.whatsappBusy,\n                configSchema: state.configSchema,\n                configSchemaLoading: state.configSchemaLoading,\n                configForm: state.configForm,\n                configUiHints: state.configUiHints,\n                configSaving: state.configSaving,\n                configFormDirty: state.configFormDirty,\n                nostrProfileFormState: state.nostrProfileFormState,\n                nostrProfileAccountId: state.nostrProfileAccountId,\n                onRefresh: (probe) => loadChannels(state, probe),\n                onWhatsAppStart: (force) => state.handleWhatsAppStart(force),\n                onWhatsAppWait: () => state.handleWhatsAppWait(),\n                onWhatsAppLogout: () => state.handleWhatsAppLogout(),\n                onConfigPatch: (path, value) => updateConfigFormValue(state, path, value),\n                onConfigSave: () => state.handleChannelConfigSave(),\n                onConfigReload: () => state.handleChannelConfigReload(),\n                onNostrProfileEdit: (accountId, profile) =>\n                  state.handleNostrProfileEdit(accountId, profile),\n                onNostrProfileCancel: () => state.handleNostrProfileCancel(),\n                onNostrProfileFieldChange: (field, value) =>\n                  state.handleNostrProfileFieldChange(field, value),\n                onNostrProfileSave: () => state.handleNostrProfileSave(),\n                onNostrProfileImport: () => state.handleNostrProfileImport(),\n                onNostrProfileToggleAdvanced: () => state.handleNostrProfileToggleAdvanced(),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"instances\"\n            ? renderInstances({\n                loading: state.presenceLoading,\n                entries: state.presenceEntries,\n                lastError: state.presenceError,\n                statusMessage: state.presenceStatus,\n                onRefresh: () => loadPresence(state),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"sessions\"\n            ? renderSessions({\n                loading: state.sessionsLoading,\n                result: state.sessionsResult,\n                error: state.sessionsError,\n                activeMinutes: state.sessionsFilterActive,\n                limit: state.sessionsFilterLimit,\n                filterText: state.sessionsFilterText,\n                includeGlobal: state.sessionsIncludeGlobal,\n                includeUnknown: state.sessionsIncludeUnknown,\n                basePath: state.basePath,\n                onFiltersChange: (next) => {\n                  state.sessionsFilterActive = next.activeMinutes;\n                  state.sessionsFilterLimit = next.limit;\n                  state.sessionsFilterText = next.filterText;\n                  state.sessionsIncludeGlobal = next.includeGlobal;\n                  state.sessionsIncludeUnknown = next.includeUnknown;\n                },\n                onRefresh: () => loadSessions(state),\n                onPatch: (key, patch) => patchSession(state, key, patch),\n                onDelete: (key) => deleteSession(state, key),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"cron\"\n            ? renderCron({\n                loading: state.cronLoading,\n                status: state.cronStatus,\n                jobs: state.cronJobs,\n                error: state.cronError,\n                busy: state.cronBusy,\n                form: state.cronForm,\n                channels: state.channelsSnapshot?.channelMeta?.length\n                  ? state.channelsSnapshot.channelMeta.map((entry) => entry.id)\n                  : (state.channelsSnapshot?.channelOrder ?? []),\n                channelLabels: state.channelsSnapshot?.channelLabels ?? {},\n                channelMeta: state.channelsSnapshot?.channelMeta ?? [],\n                runsJobId: state.cronRunsJobId,\n                runs: state.cronRuns,\n                onFormChange: (patch) => (state.cronForm = { ...state.cronForm, ...patch }),\n                onRefresh: () => state.loadCron(),\n                onAdd: () => addCronJob(state),\n                onToggle: (job, enabled) => toggleCronJob(state, job, enabled),\n                onRun: (job) => runCronJob(state, job),\n                onRemove: (job) => removeCronJob(state, job),\n                onLoadRuns: (jobId) => loadCronRuns(state, jobId),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"agents\"\n            ? renderAgents({\n                loading: state.agentsLoading,\n                error: state.agentsError,\n                agentsList: state.agentsList,\n                selectedAgentId: resolvedAgentId,\n                activePanel: state.agentsPanel,\n                configForm: configValue,\n                configLoading: state.configLoading,\n                configSaving: state.configSaving,\n                configDirty: state.configFormDirty,\n                channelsLoading: state.channelsLoading,\n                channelsError: state.channelsError,\n                channelsSnapshot: state.channelsSnapshot,\n                channelsLastSuccess: state.channelsLastSuccess,\n                cronLoading: state.cronLoading,\n                cronStatus: state.cronStatus,\n                cronJobs: state.cronJobs,\n                cronError: state.cronError,\n                agentFilesLoading: state.agentFilesLoading,\n                agentFilesError: state.agentFilesError,\n                agentFilesList: state.agentFilesList,\n                agentFileActive: state.agentFileActive,\n                agentFileContents: state.agentFileContents,\n                agentFileDrafts: state.agentFileDrafts,\n                agentFileSaving: state.agentFileSaving,\n                agentIdentityLoading: state.agentIdentityLoading,\n                agentIdentityError: state.agentIdentityError,\n                agentIdentityById: state.agentIdentityById,\n                agentSkillsLoading: state.agentSkillsLoading,\n                agentSkillsReport: state.agentSkillsReport,\n                agentSkillsError: state.agentSkillsError,\n                agentSkillsAgentId: state.agentSkillsAgentId,\n                skillsFilter: state.skillsFilter,\n                onRefresh: async () => {\n                  await loadAgents(state);\n                  const agentIds = state.agentsList?.agents?.map((entry) => entry.id) ?? [];\n                  if (agentIds.length > 0) {\n                    void loadAgentIdentities(state, agentIds);\n                  }\n                },\n                onSelectAgent: (agentId) => {\n                  if (state.agentsSelectedId === agentId) {\n                    return;\n                  }\n                  state.agentsSelectedId = agentId;\n                  state.agentFilesList = null;\n                  state.agentFilesError = null;\n                  state.agentFilesLoading = false;\n                  state.agentFileActive = null;\n                  state.agentFileContents = {};\n                  state.agentFileDrafts = {};\n                  state.agentSkillsReport = null;\n                  state.agentSkillsError = null;\n                  state.agentSkillsAgentId = null;\n                  void loadAgentIdentity(state, agentId);\n                  if (state.agentsPanel === \"files\") {\n                    void loadAgentFiles(state, agentId);\n                  }\n                  if (state.agentsPanel === \"skills\") {\n                    void loadAgentSkills(state, agentId);\n                  }\n                },\n                onSelectPanel: (panel) => {\n                  state.agentsPanel = panel;\n                  if (panel === \"files\" && resolvedAgentId) {\n                    if (state.agentFilesList?.agentId !== resolvedAgentId) {\n                      state.agentFilesList = null;\n                      state.agentFilesError = null;\n                      state.agentFileActive = null;\n                      state.agentFileContents = {};\n                      state.agentFileDrafts = {};\n                      void loadAgentFiles(state, resolvedAgentId);\n                    }\n                  }\n                  if (panel === \"skills\") {\n                    if (resolvedAgentId) {\n                      void loadAgentSkills(state, resolvedAgentId);\n                    }\n                  }\n                  if (panel === \"channels\") {\n                    void loadChannels(state, false);\n                  }\n                  if (panel === \"cron\") {\n                    void state.loadCron();\n                  }\n                },\n                onLoadFiles: (agentId) => loadAgentFiles(state, agentId),\n                onSelectFile: (name) => {\n                  state.agentFileActive = name;\n                  if (!resolvedAgentId) {\n                    return;\n                  }\n                  void loadAgentFileContent(state, resolvedAgentId, name);\n                },\n                onFileDraftChange: (name, content) => {\n                  state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\n                },\n                onFileReset: (name) => {\n                  const base = state.agentFileContents[name] ?? \"\";\n                  state.agentFileDrafts = { ...state.agentFileDrafts, [name]: base };\n                },\n                onFileSave: (name) => {\n                  if (!resolvedAgentId) {\n                    return;\n                  }\n                  const content =\n                    state.agentFileDrafts[name] ?? state.agentFileContents[name] ?? \"\";\n                  void saveAgentFile(state, resolvedAgentId, name, content);\n                },\n                onToolsProfileChange: (agentId, profile, clearAllow) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  const basePath = [\"agents\", \"list\", index, \"tools\"];\n                  if (profile) {\n                    updateConfigFormValue(state, [...basePath, \"profile\"], profile);\n                  } else {\n                    removeConfigFormValue(state, [...basePath, \"profile\"]);\n                  }\n                  if (clearAllow) {\n                    removeConfigFormValue(state, [...basePath, \"allow\"]);\n                  }\n                },\n                onToolsOverridesChange: (agentId, alsoAllow, deny) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  const basePath = [\"agents\", \"list\", index, \"tools\"];\n                  if (alsoAllow.length > 0) {\n                    updateConfigFormValue(state, [...basePath, \"alsoAllow\"], alsoAllow);\n                  } else {\n                    removeConfigFormValue(state, [...basePath, \"alsoAllow\"]);\n                  }\n                  if (deny.length > 0) {\n                    updateConfigFormValue(state, [...basePath, \"deny\"], deny);\n                  } else {\n                    removeConfigFormValue(state, [...basePath, \"deny\"]);\n                  }\n                },\n                onConfigReload: () => loadConfig(state),\n                onConfigSave: () => saveConfig(state),\n                onChannelsRefresh: () => loadChannels(state, false),\n                onCronRefresh: () => state.loadCron(),\n                onSkillsFilterChange: (next) => (state.skillsFilter = next),\n                onSkillsRefresh: () => {\n                  if (resolvedAgentId) {\n                    void loadAgentSkills(state, resolvedAgentId);\n                  }\n                },\n                onAgentSkillToggle: (agentId, skillName, enabled) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  const entry = list[index] as { skills?: unknown };\n                  const normalizedSkill = skillName.trim();\n                  if (!normalizedSkill) {\n                    return;\n                  }\n                  const allSkills =\n                    state.agentSkillsReport?.skills?.map((skill) => skill.name).filter(Boolean) ??\n                    [];\n                  const existing = Array.isArray(entry.skills)\n                    ? entry.skills.map((name) => String(name).trim()).filter(Boolean)\n                    : undefined;\n                  const base = existing ?? allSkills;\n                  const next = new Set(base);\n                  if (enabled) {\n                    next.add(normalizedSkill);\n                  } else {\n                    next.delete(normalizedSkill);\n                  }\n                  updateConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"], [...next]);\n                },\n                onAgentSkillsClear: (agentId) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  removeConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"]);\n                },\n                onAgentSkillsDisableAll: (agentId) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  updateConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"], []);\n                },\n                onModelChange: (agentId, modelId) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  const basePath = [\"agents\", \"list\", index, \"model\"];\n                  if (!modelId) {\n                    removeConfigFormValue(state, basePath);\n                    return;\n                  }\n                  const entry = list[index] as { model?: unknown };\n                  const existing = entry?.model;\n                  if (existing && typeof existing === \"object\" && !Array.isArray(existing)) {\n                    const fallbacks = (existing as { fallbacks?: unknown }).fallbacks;\n                    const next = {\n                      primary: modelId,\n                      ...(Array.isArray(fallbacks) ? { fallbacks } : {}),\n                    };\n                    updateConfigFormValue(state, basePath, next);\n                  } else {\n                    updateConfigFormValue(state, basePath, modelId);\n                  }\n                },\n                onModelFallbacksChange: (agentId, fallbacks) => {\n                  if (!configValue) {\n                    return;\n                  }\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\n                  if (!Array.isArray(list)) {\n                    return;\n                  }\n                  const index = list.findIndex(\n                    (entry) =>\n                      entry &&\n                      typeof entry === \"object\" &&\n                      \"id\" in entry &&\n                      (entry as { id?: string }).id === agentId,\n                  );\n                  if (index < 0) {\n                    return;\n                  }\n                  const basePath = [\"agents\", \"list\", index, \"model\"];\n                  const entry = list[index] as { model?: unknown };\n                  const normalized = fallbacks.map((name) => name.trim()).filter(Boolean);\n                  const existing = entry.model;\n                  const resolvePrimary = () => {\n                    if (typeof existing === \"string\") {\n                      return existing.trim() || null;\n                    }\n                    if (existing && typeof existing === \"object\" && !Array.isArray(existing)) {\n                      const primary = (existing as { primary?: unknown }).primary;\n                      if (typeof primary === \"string\") {\n                        const trimmed = primary.trim();\n                        return trimmed || null;\n                      }\n                    }\n                    return null;\n                  };\n                  const primary = resolvePrimary();\n                  if (normalized.length === 0) {\n                    if (primary) {\n                      updateConfigFormValue(state, basePath, primary);\n                    } else {\n                      removeConfigFormValue(state, basePath);\n                    }\n                    return;\n                  }\n                  const next = primary\n                    ? { primary, fallbacks: normalized }\n                    : { fallbacks: normalized };\n                  updateConfigFormValue(state, basePath, next);\n                },\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"skills\"\n            ? renderSkills({\n                loading: state.skillsLoading,\n                report: state.skillsReport,\n                error: state.skillsError,\n                filter: state.skillsFilter,\n                edits: state.skillEdits,\n                messages: state.skillMessages,\n                busyKey: state.skillsBusyKey,\n                onFilterChange: (next) => (state.skillsFilter = next),\n                onRefresh: () => loadSkills(state, { clearMessages: true }),\n                onToggle: (key, enabled) => updateSkillEnabled(state, key, enabled),\n                onEdit: (key, value) => updateSkillEdit(state, key, value),\n                onSaveKey: (key) => saveSkillApiKey(state, key),\n                onInstall: (skillKey, name, installId) =>\n                  installSkill(state, skillKey, name, installId),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"nodes\"\n            ? renderNodes({\n                loading: state.nodesLoading,\n                nodes: state.nodes,\n                devicesLoading: state.devicesLoading,\n                devicesError: state.devicesError,\n                devicesList: state.devicesList,\n                configForm:\n                  state.configForm ??\n                  (state.configSnapshot?.config as Record<string, unknown> | null),\n                configLoading: state.configLoading,\n                configSaving: state.configSaving,\n                configDirty: state.configFormDirty,\n                configFormMode: state.configFormMode,\n                execApprovalsLoading: state.execApprovalsLoading,\n                execApprovalsSaving: state.execApprovalsSaving,\n                execApprovalsDirty: state.execApprovalsDirty,\n                execApprovalsSnapshot: state.execApprovalsSnapshot,\n                execApprovalsForm: state.execApprovalsForm,\n                execApprovalsSelectedAgent: state.execApprovalsSelectedAgent,\n                execApprovalsTarget: state.execApprovalsTarget,\n                execApprovalsTargetNodeId: state.execApprovalsTargetNodeId,\n                onRefresh: () => loadNodes(state),\n                onDevicesRefresh: () => loadDevices(state),\n                onDeviceApprove: (requestId) => approveDevicePairing(state, requestId),\n                onDeviceReject: (requestId) => rejectDevicePairing(state, requestId),\n                onDeviceRotate: (deviceId, role, scopes) =>\n                  rotateDeviceToken(state, { deviceId, role, scopes }),\n                onDeviceRevoke: (deviceId, role) => revokeDeviceToken(state, { deviceId, role }),\n                onLoadConfig: () => loadConfig(state),\n                onLoadExecApprovals: () => {\n                  const target =\n                    state.execApprovalsTarget === \"node\" && state.execApprovalsTargetNodeId\n                      ? { kind: \"node\" as const, nodeId: state.execApprovalsTargetNodeId }\n                      : { kind: \"gateway\" as const };\n                  return loadExecApprovals(state, target);\n                },\n                onBindDefault: (nodeId) => {\n                  if (nodeId) {\n                    updateConfigFormValue(state, [\"tools\", \"exec\", \"node\"], nodeId);\n                  } else {\n                    removeConfigFormValue(state, [\"tools\", \"exec\", \"node\"]);\n                  }\n                },\n                onBindAgent: (agentIndex, nodeId) => {\n                  const basePath = [\"agents\", \"list\", agentIndex, \"tools\", \"exec\", \"node\"];\n                  if (nodeId) {\n                    updateConfigFormValue(state, basePath, nodeId);\n                  } else {\n                    removeConfigFormValue(state, basePath);\n                  }\n                },\n                onSaveBindings: () => saveConfig(state),\n                onExecApprovalsTargetChange: (kind, nodeId) => {\n                  state.execApprovalsTarget = kind;\n                  state.execApprovalsTargetNodeId = nodeId;\n                  state.execApprovalsSnapshot = null;\n                  state.execApprovalsForm = null;\n                  state.execApprovalsDirty = false;\n                  state.execApprovalsSelectedAgent = null;\n                },\n                onExecApprovalsSelectAgent: (agentId) => {\n                  state.execApprovalsSelectedAgent = agentId;\n                },\n                onExecApprovalsPatch: (path, value) =>\n                  updateExecApprovalsFormValue(state, path, value),\n                onExecApprovalsRemove: (path) => removeExecApprovalsFormValue(state, path),\n                onSaveExecApprovals: () => {\n                  const target =\n                    state.execApprovalsTarget === \"node\" && state.execApprovalsTargetNodeId\n                      ? { kind: \"node\" as const, nodeId: state.execApprovalsTargetNodeId }\n                      : { kind: \"gateway\" as const };\n                  return saveExecApprovals(state, target);\n                },\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"chat\"\n            ? renderChat({\n                sessionKey: state.sessionKey,\n                onSessionKeyChange: (next) => {\n                  state.sessionKey = next;\n                  state.chatMessage = \"\";\n                  state.chatAttachments = [];\n                  state.chatStream = null;\n                  state.chatStreamStartedAt = null;\n                  state.chatRunId = null;\n                  state.chatQueue = [];\n                  state.resetToolStream();\n                  state.resetChatScroll();\n                  state.applySettings({\n                    ...state.settings,\n                    sessionKey: next,\n                    lastActiveSessionKey: next,\n                  });\n                  void state.loadAssistantIdentity();\n                  void loadChatHistory(state);\n                  void refreshChatAvatar(state);\n                },\n                thinkingLevel: state.chatThinkingLevel,\n                showThinking,\n                loading: state.chatLoading,\n                sending: state.chatSending,\n                compactionStatus: state.compactionStatus,\n                assistantAvatarUrl: chatAvatarUrl,\n                messages: state.chatMessages,\n                toolMessages: state.chatToolMessages,\n                stream: state.chatStream,\n                streamStartedAt: state.chatStreamStartedAt,\n                draft: state.chatMessage,\n                queue: state.chatQueue,\n                connected: state.connected,\n                canSend: state.connected,\n                disabledReason: chatDisabledReason,\n                error: state.lastError,\n                sessions: state.sessionsResult,\n                focusMode: chatFocus,\n                onRefresh: () => {\n                  state.resetToolStream();\n                  return Promise.all([loadChatHistory(state), refreshChatAvatar(state)]);\n                },\n                onToggleFocusMode: () => {\n                  if (state.onboarding) {\n                    return;\n                  }\n                  state.applySettings({\n                    ...state.settings,\n                    chatFocusMode: !state.settings.chatFocusMode,\n                  });\n                },\n                onChatScroll: (event) => state.handleChatScroll(event),\n                onDraftChange: (next) => (state.chatMessage = next),\n                attachments: state.chatAttachments,\n                onAttachmentsChange: (next) => (state.chatAttachments = next),\n                onSend: () => state.handleSendChat(),\n                canAbort: Boolean(state.chatRunId),\n                onAbort: () => void state.handleAbortChat(),\n                onQueueRemove: (id) => state.removeQueuedMessage(id),\n                onNewSession: () => state.handleSendChat(\"/new\", { restoreDraft: true }),\n                showNewMessages: state.chatNewMessagesBelow,\n                onScrollToBottom: () => state.scrollToBottom(),\n                // Sidebar props for tool output viewing\n                sidebarOpen: state.sidebarOpen,\n                sidebarContent: state.sidebarContent,\n                sidebarError: state.sidebarError,\n                splitRatio: state.splitRatio,\n                onOpenSidebar: (content: string) => state.handleOpenSidebar(content),\n                onCloseSidebar: () => state.handleCloseSidebar(),\n                onSplitRatioChange: (ratio: number) => state.handleSplitRatioChange(ratio),\n                assistantName: state.assistantName,\n                assistantAvatar: state.assistantAvatar,\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"config\"\n            ? renderConfig({\n                raw: state.configRaw,\n                originalRaw: state.configRawOriginal,\n                valid: state.configValid,\n                issues: state.configIssues,\n                loading: state.configLoading,\n                saving: state.configSaving,\n                applying: state.configApplying,\n                updating: state.updateRunning,\n                connected: state.connected,\n                schema: state.configSchema,\n                schemaLoading: state.configSchemaLoading,\n                uiHints: state.configUiHints,\n                formMode: state.configFormMode,\n                formValue: state.configForm,\n                originalValue: state.configFormOriginal,\n                searchQuery: state.configSearchQuery,\n                activeSection: state.configActiveSection,\n                activeSubsection: state.configActiveSubsection,\n                onRawChange: (next) => {\n                  state.configRaw = next;\n                },\n                onFormModeChange: (mode) => (state.configFormMode = mode),\n                onFormPatch: (path, value) => updateConfigFormValue(state, path, value),\n                onSearchChange: (query) => (state.configSearchQuery = query),\n                onSectionChange: (section) => {\n                  state.configActiveSection = section;\n                  state.configActiveSubsection = null;\n                },\n                onSubsectionChange: (section) => (state.configActiveSubsection = section),\n                onReload: () => loadConfig(state),\n                onSave: () => saveConfig(state),\n                onApply: () => applyConfig(state),\n                onUpdate: () => runUpdate(state),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"debug\"\n            ? renderDebug({\n                loading: state.debugLoading,\n                status: state.debugStatus,\n                health: state.debugHealth,\n                models: state.debugModels,\n                heartbeat: state.debugHeartbeat,\n                eventLog: state.eventLog,\n                callMethod: state.debugCallMethod,\n                callParams: state.debugCallParams,\n                callResult: state.debugCallResult,\n                callError: state.debugCallError,\n                onCallMethodChange: (next) => (state.debugCallMethod = next),\n                onCallParamsChange: (next) => (state.debugCallParams = next),\n                onRefresh: () => loadDebug(state),\n                onCall: () => callDebugMethod(state),\n              })\n            : nothing\n        }\n\n        ${\n          state.tab === \"logs\"\n            ? renderLogs({\n                loading: state.logsLoading,\n                error: state.logsError,\n                file: state.logsFile,\n                entries: state.logsEntries,\n                filterText: state.logsFilterText,\n                levelFilters: state.logsLevelFilters,\n                autoFollow: state.logsAutoFollow,\n                truncated: state.logsTruncated,\n                onFilterTextChange: (next) => (state.logsFilterText = next),\n                onLevelToggle: (level, enabled) => {\n                  state.logsLevelFilters = { ...state.logsLevelFilters, [level]: enabled };\n                },\n                onToggleAutoFollow: (next) => (state.logsAutoFollow = next),\n                onRefresh: () => loadLogs(state, { reset: true }),\n                onExport: (lines, label) => state.exportLogs(lines, label),\n                onScroll: (event) => state.handleLogsScroll(event),\n              })\n            : nothing\n        }\n      </main>\n      ${renderExecApprovalPrompt(state)}\n      ${renderGatewayUrlConfirmation(state)}\n      ${\n        state.shortcutsHelpOpen\n          ? html`\n              <div\n                class=\"modal-overlay\"\n                @click=${() => {\n                  state.shortcutsHelpOpen = false;\n                  if (\n                    (state as unknown as { lastFocusedElement: HTMLElement | null })\n                      .lastFocusedElement\n                  ) {\n                    (\n                      (state as unknown as { lastFocusedElement: HTMLElement | null })\n                        .lastFocusedElement as HTMLElement\n                    ).focus();\n                    (\n                      state as unknown as { lastFocusedElement: HTMLElement | null }\n                    ).lastFocusedElement = null;\n                  }\n                }}\n                @keydown=${(e: KeyboardEvent) => {\n                  if (e.key === \"Escape\") {\n                    state.shortcutsHelpOpen = false;\n                    if (\n                      (state as unknown as { lastFocusedElement: HTMLElement | null })\n                        .lastFocusedElement\n                    ) {\n                      (\n                        (state as unknown as { lastFocusedElement: HTMLElement | null })\n                          .lastFocusedElement as HTMLElement\n                      ).focus();\n                      (\n                        state as unknown as { lastFocusedElement: HTMLElement | null }\n                      ).lastFocusedElement = null;\n                    }\n                  }\n                }}\n              >\n                <div\n                  class=\"modal\"\n                  role=\"dialog\"\n                  aria-modal=\"true\"\n                  aria-labelledby=\"shortcuts-title\"\n                  @click=${(e: Event) => e.stopPropagation()}\n                >\n                  <div class=\"modal-header\">\n                    <h2 id=\"shortcuts-title\">Keyboard Shortcuts</h2>\n                    <button\n                      class=\"modal-close\"\n                      @click=${() => {\n                        state.shortcutsHelpOpen = false;\n                        if (\n                          (state as unknown as { lastFocusedElement: HTMLElement | null })\n                            .lastFocusedElement\n                        ) {\n                          (\n                            (state as unknown as { lastFocusedElement: HTMLElement | null })\n                              .lastFocusedElement as HTMLElement\n                          ).focus();\n                          (\n                            state as unknown as { lastFocusedElement: HTMLElement | null }\n                          ).lastFocusedElement = null;\n                        }\n                      }}\n                      aria-label=\"Close\"\n                    >\n                      Ã—\n                    </button>\n                  </div>\n                  <div class=\"modal-content\">\n                    <div class=\"shortcuts-list\">\n                      <div class=\"shortcut-item\">\n                        <kbd>Alt</kbd> + <kbd>1</kbd> - <kbd>9</kbd>\n                        <span>Switch to tab by index</span>\n                      </div>\n                      <div class=\"shortcut-item\">\n                        <kbd>Ctrl</kbd> + <kbd>[</kbd> / <kbd>]</kbd>\n                        <span>Previous / Next tab</span>\n                      </div>\n                      <div class=\"shortcut-item\">\n                        <kbd>R</kbd>\n                        <span>Refresh current view</span>\n                      </div>\n                      <div class=\"shortcut-item\">\n                        <kbd>Esc</kbd>\n                        <span>Close sidebar / modals</span>\n                      </div>\n                      <div class=\"shortcut-item\">\n                        <kbd>Ctrl</kbd> + <kbd>/</kbd> or <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>F</kbd>\n                        <span>Focus search field</span>\n                      </div>\n                      <div class=\"shortcut-item\">\n                        <kbd>Shift</kbd> + <kbd>/</kbd>\n                        <span>Show this help</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            `\n          : nothing\n      }\n      ${\n        state.commandPaletteOpen\n          ? (() => {\n              const query = state.commandPaletteQuery.toLowerCase();\n              const allCommands = state.getCommandPaletteCommands();\n              const filtered = query\n                ? allCommands.filter(\n                    (cmd) =>\n                      cmd.keywords.some((kw) => kw.toLowerCase().includes(query)) ||\n                      cmd.label.toLowerCase().includes(query),\n                  )\n                : allCommands;\n              const selectedIndex = 0;\n\n              return html`\n                <div\n                  class=\"modal-overlay\"\n                  @click=${() => {\n                    state.commandPaletteOpen = false;\n                    state.commandPaletteQuery = \"\";\n                    if (\n                      (state as unknown as { lastFocusedElement: HTMLElement | null })\n                        .lastFocusedElement\n                    ) {\n                      (\n                        (state as unknown as { lastFocusedElement: HTMLElement | null })\n                          .lastFocusedElement as HTMLElement\n                      ).focus();\n                      (\n                        state as unknown as { lastFocusedElement: HTMLElement | null }\n                      ).lastFocusedElement = null;\n                    }\n                  }}\n                  @keydown=${(e: KeyboardEvent) => {\n                    if (e.key === \"Escape\") {\n                      state.commandPaletteOpen = false;\n                      state.commandPaletteQuery = \"\";\n                      if (\n                        (state as unknown as { lastFocusedElement: HTMLElement | null })\n                          .lastFocusedElement\n                      ) {\n                        (\n                          (state as unknown as { lastFocusedElement: HTMLElement | null })\n                            .lastFocusedElement as HTMLElement\n                        ).focus();\n                        (\n                          state as unknown as { lastFocusedElement: HTMLElement | null }\n                        ).lastFocusedElement = null;\n                      }\n                    }\n                  }}\n                >\n                  <div\n                    class=\"modal modal--command-palette\"\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                    aria-labelledby=\"palette-title\"\n                    @click=${(e: Event) => e.stopPropagation()}\n                    @keydown=${(e: KeyboardEvent) => {\n                      if (e.key === \"Enter\" && filtered.length > 0) {\n                        e.preventDefault();\n                        filtered[selectedIndex]?.action();\n                      }\n                    }}\n                  >\n                    <div class=\"modal-header\">\n                      <h2 id=\"palette-title\">Command Palette</h2>\n                      <button\n                        class=\"modal-close\"\n                        @click=${() => {\n                          state.commandPaletteOpen = false;\n                          state.commandPaletteQuery = \"\";\n                          if (\n                            (state as unknown as { lastFocusedElement: HTMLElement | null })\n                              .lastFocusedElement\n                          ) {\n                            (\n                              (state as unknown as { lastFocusedElement: HTMLElement | null })\n                                .lastFocusedElement as HTMLElement\n                            ).focus();\n                            (\n                              state as unknown as { lastFocusedElement: HTMLElement | null }\n                            ).lastFocusedElement = null;\n                          }\n                        }}\n                        aria-label=\"Close\"\n                      >\n                        Ã—\n                      </button>\n                    </div>\n                    <div class=\"modal-content\">\n                      <input\n                        type=\"text\"\n                        class=\"command-palette-input\"\n                        .value=${state.commandPaletteQuery}\n                        @input=${(e: Event) => {\n                          state.commandPaletteQuery = (e.target as HTMLInputElement).value;\n                        }}\n                        placeholder=\"Type to search commands...\"\n                        autofocus\n                        ${ref((el) => {\n                          if (el && state.commandPaletteOpen) {\n                            (el as HTMLInputElement).focus();\n                          }\n                        })}\n                      />\n                      <div class=\"command-palette-list\" role=\"listbox\">\n                        ${\n                          filtered.length === 0\n                            ? html`\n                                <div class=\"command-palette-empty\">No commands found</div>\n                              `\n                            : filtered.map(\n                                (cmd, idx) => html`\n                                  <button\n                                    class=\"command-palette-item ${idx === selectedIndex ? \"command-palette-item--selected\" : \"\"}\"\n                                    role=\"option\"\n                                    @click=${() => cmd.action()}\n                                  >\n                                    <span class=\"command-palette-item__label\">${cmd.label}</span>\n                                  </button>\n                                `,\n                              )\n                        }\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              `;\n            })()\n          : nothing\n      }\n    </div>\n  `;\n}\n","import { LitElement } from \"lit\";\nimport { customElement, state } from \"lit/decorators.js\";\nimport type { EventLogEntry } from \"./app-events\";\nimport type { AppViewState } from \"./app-view-state\";\nimport type { DevicePairingList } from \"./controllers/devices\";\nimport type { ExecApprovalRequest } from \"./controllers/exec-approval\";\nimport type { ExecApprovalsFile, ExecApprovalsSnapshot } from \"./controllers/exec-approvals\";\nimport type { SkillMessage } from \"./controllers/skills\";\nimport type { GatewayBrowserClient, GatewayHelloOk } from \"./gateway\";\nimport type { ResolvedTheme, ThemeMode } from \"./theme\";\nimport type {\n  AgentIdentityResult,\n  AgentsFilesListResult,\n  AgentsListResult,\n  ChannelsStatusSnapshot,\n  ConfigSnapshot,\n  ConfigUiHints,\n  CronJob,\n  CronRunLogEntry,\n  CronStatus,\n  HealthSnapshot,\n  LogEntry,\n  LogLevel,\n  NostrProfile,\n  PresenceEntry,\n  SessionsListResult,\n  SkillStatusReport,\n  StatusSummary,\n} from \"./types\";\nimport type { NostrProfileFormState } from \"./views/channels.nostr-profile-form\";\nimport {\n  handleChannelConfigReload as handleChannelConfigReloadInternal,\n  handleChannelConfigSave as handleChannelConfigSaveInternal,\n  handleNostrProfileCancel as handleNostrProfileCancelInternal,\n  handleNostrProfileEdit as handleNostrProfileEditInternal,\n  handleNostrProfileFieldChange as handleNostrProfileFieldChangeInternal,\n  handleNostrProfileImport as handleNostrProfileImportInternal,\n  handleNostrProfileSave as handleNostrProfileSaveInternal,\n  handleNostrProfileToggleAdvanced as handleNostrProfileToggleAdvancedInternal,\n  handleWhatsAppLogout as handleWhatsAppLogoutInternal,\n  handleWhatsAppStart as handleWhatsAppStartInternal,\n  handleWhatsAppWait as handleWhatsAppWaitInternal,\n} from \"./app-channels\";\nimport {\n  handleAbortChat as handleAbortChatInternal,\n  handleSendChat as handleSendChatInternal,\n  removeQueuedMessage as removeQueuedMessageInternal,\n} from \"./app-chat\";\nimport { DEFAULT_CRON_FORM, DEFAULT_LOG_LEVEL_FILTERS } from \"./app-defaults\";\nimport { connectGateway as connectGatewayInternal } from \"./app-gateway\";\nimport {\n  handleConnected,\n  handleDisconnected,\n  handleFirstUpdated,\n  handleUpdated,\n} from \"./app-lifecycle\";\nimport { renderApp } from \"./app-render\";\nimport {\n  exportLogs as exportLogsInternal,\n  handleChatScroll as handleChatScrollInternal,\n  handleLogsScroll as handleLogsScrollInternal,\n  resetChatScroll as resetChatScrollInternal,\n  scheduleChatScroll as scheduleChatScrollInternal,\n} from \"./app-scroll\";\nimport {\n  applySettings as applySettingsInternal,\n  loadCron as loadCronInternal,\n  loadOverview as loadOverviewInternal,\n  onPopState as onPopStateInternal,\n  setTab as setTabInternal,\n  setTheme as setThemeInternal,\n} from \"./app-settings\";\nimport {\n  resetToolStream as resetToolStreamInternal,\n  type ToolStreamEntry,\n} from \"./app-tool-stream\";\nimport { resolveInjectedAssistantIdentity } from \"./assistant-identity\";\nimport { loadAgents } from \"./controllers/agents\";\nimport { loadAssistantIdentity as loadAssistantIdentityInternal } from \"./controllers/assistant-identity\";\nimport { loadChannels } from \"./controllers/channels\";\nimport { loadConfig } from \"./controllers/config\";\nimport { loadLogs } from \"./controllers/logs\";\nimport { loadSessions } from \"./controllers/sessions\";\nimport { loadSkills } from \"./controllers/skills\";\nimport { TAB_GROUPS, titleForTab, type Tab } from \"./navigation\";\nimport { loadSettings, type UiSettings } from \"./storage\";\nimport { type ChatAttachment, type ChatQueueItem, type CronFormState } from \"./ui-types\";\n\ndeclare global {\n  interface Window {\n    __OPENCLAW_CONTROL_UI_BASE_PATH__?: string;\n  }\n}\n\nconst injectedAssistantIdentity = resolveInjectedAssistantIdentity();\n\nfunction resolveOnboardingMode(): boolean {\n  if (!window.location.search) {\n    return false;\n  }\n  const params = new URLSearchParams(window.location.search);\n  const raw = params.get(\"onboarding\");\n  if (!raw) {\n    return false;\n  }\n  const normalized = raw.trim().toLowerCase();\n  return normalized === \"1\" || normalized === \"true\" || normalized === \"yes\" || normalized === \"on\";\n}\n\n@customElement(\"openclaw-app\")\nexport class OpenClawApp extends LitElement {\n  @state() settings: UiSettings = loadSettings();\n  @state() password = \"\";\n  @state() tab: Tab = \"chat\";\n  @state() onboarding = resolveOnboardingMode();\n  @state() connected = false;\n  @state() connectionState: \"connected\" | \"reconnecting\" | \"disconnected\" = \"disconnected\";\n  @state() theme: ThemeMode = this.settings.theme ?? \"system\";\n  @state() themeResolved: ResolvedTheme = \"dark\";\n  @state() hello: GatewayHelloOk | null = null;\n  @state() lastError: string | null = null;\n  @state() eventLog: EventLogEntry[] = [];\n  @state() toasts: Array<{\n    id: string;\n    type: \"success\" | \"error\" | \"info\" | \"loading\";\n    message: string;\n    createdAt: number;\n  }> = [];\n  private lastErrorToastId: string | null = null;\n  private errorToastDebounceTimer: number | null = null;\n  private toastTimers = new Map<string, number>();\n  private eventLogBuffer: EventLogEntry[] = [];\n  private toolStreamSyncTimer: number | null = null;\n  private sidebarCloseTimer: number | null = null;\n\n  @state() assistantName = injectedAssistantIdentity.name;\n  @state() assistantAvatar = injectedAssistantIdentity.avatar;\n  @state() assistantAgentId = injectedAssistantIdentity.agentId ?? null;\n\n  @state() sessionKey = this.settings.sessionKey;\n  @state() chatLoading = false;\n  @state() chatSending = false;\n  @state() chatMessage = \"\";\n  @state() chatMessages: unknown[] = [];\n  @state() chatToolMessages: unknown[] = [];\n  @state() chatStream: string | null = null;\n  @state() chatStreamStartedAt: number | null = null;\n  @state() chatRunId: string | null = null;\n  @state() compactionStatus: import(\"./app-tool-stream\").CompactionStatus | null = null;\n  @state() chatAvatarUrl: string | null = null;\n  @state() chatThinkingLevel: string | null = null;\n  @state() chatQueue: ChatQueueItem[] = [];\n  @state() chatAttachments: ChatAttachment[] = [];\n  // Sidebar state for tool output viewing\n  @state() sidebarOpen = false;\n  @state() sidebarContent: string | null = null;\n  @state() sidebarError: string | null = null;\n  @state() splitRatio = this.settings.splitRatio;\n\n  @state() nodesLoading = false;\n  @state() nodes: Array<Record<string, unknown>> = [];\n  @state() devicesLoading = false;\n  @state() devicesError: string | null = null;\n  @state() devicesList: DevicePairingList | null = null;\n  @state() execApprovalsLoading = false;\n  @state() execApprovalsSaving = false;\n  @state() execApprovalsDirty = false;\n  @state() execApprovalsSnapshot: ExecApprovalsSnapshot | null = null;\n  @state() execApprovalsForm: ExecApprovalsFile | null = null;\n  @state() execApprovalsSelectedAgent: string | null = null;\n  @state() execApprovalsTarget: \"gateway\" | \"node\" = \"gateway\";\n  @state() execApprovalsTargetNodeId: string | null = null;\n  @state() execApprovalQueue: ExecApprovalRequest[] = [];\n  @state() execApprovalBusy = false;\n  @state() execApprovalError: string | null = null;\n  @state() pendingGatewayUrl: string | null = null;\n\n  @state() configLoading = false;\n  @state() configRaw = \"{\\n}\\n\";\n  @state() configRawOriginal = \"\";\n  @state() configValid: boolean | null = null;\n  @state() configIssues: unknown[] = [];\n  @state() configSaving = false;\n  @state() configApplying = false;\n  @state() updateRunning = false;\n  @state() applySessionKey = this.settings.lastActiveSessionKey;\n  @state() configSnapshot: ConfigSnapshot | null = null;\n  @state() configSchema: unknown = null;\n  @state() configSchemaVersion: string | null = null;\n  @state() configSchemaLoading = false;\n  @state() configUiHints: ConfigUiHints = {};\n  @state() configForm: Record<string, unknown> | null = null;\n  @state() configFormOriginal: Record<string, unknown> | null = null;\n  @state() configFormDirty = false;\n  @state() configFormMode: \"form\" | \"raw\" = \"form\";\n  @state() configSearchQuery = \"\";\n  @state() configActiveSection: string | null = null;\n  @state() configActiveSubsection: string | null = null;\n\n  @state() channelsLoading = false;\n  @state() channelsSnapshot: ChannelsStatusSnapshot | null = null;\n  @state() channelsError: string | null = null;\n  @state() channelsLastSuccess: number | null = null;\n  @state() whatsappLoginMessage: string | null = null;\n  @state() whatsappLoginQrDataUrl: string | null = null;\n  @state() whatsappLoginConnected: boolean | null = null;\n  @state() whatsappBusy = false;\n  @state() nostrProfileFormState: NostrProfileFormState | null = null;\n  @state() nostrProfileAccountId: string | null = null;\n\n  @state() presenceLoading = false;\n  @state() presenceEntries: PresenceEntry[] = [];\n  @state() presenceError: string | null = null;\n  @state() presenceStatus: string | null = null;\n\n  @state() agentsLoading = false;\n  @state() agentsList: AgentsListResult | null = null;\n  @state() agentsError: string | null = null;\n  @state() agentsSelectedId: string | null = null;\n  @state() agentsPanel: \"overview\" | \"files\" | \"tools\" | \"skills\" | \"channels\" | \"cron\" =\n    \"overview\";\n  @state() agentFilesLoading = false;\n  @state() agentFilesError: string | null = null;\n  @state() agentFilesList: AgentsFilesListResult | null = null;\n  @state() agentFileContents: Record<string, string> = {};\n  @state() agentFileDrafts: Record<string, string> = {};\n  @state() agentFileActive: string | null = null;\n  @state() agentFileSaving = false;\n  @state() agentIdentityLoading = false;\n  @state() agentIdentityError: string | null = null;\n  @state() agentIdentityById: Record<string, AgentIdentityResult> = {};\n  @state() agentSkillsLoading = false;\n  @state() agentSkillsError: string | null = null;\n  @state() agentSkillsReport: SkillStatusReport | null = null;\n  @state() agentSkillsAgentId: string | null = null;\n\n  @state() sessionsLoading = false;\n  @state() sessionsResult: SessionsListResult | null = null;\n  @state() sessionsError: string | null = null;\n  @state() sessionsFilterActive = \"\";\n  @state() sessionsFilterLimit = \"120\";\n  @state() sessionsFilterText = \"\";\n  @state() sessionsIncludeGlobal = true;\n  @state() sessionsIncludeUnknown = false;\n\n  @state() cronLoading = false;\n  @state() cronJobs: CronJob[] = [];\n  @state() cronStatus: CronStatus | null = null;\n  @state() cronError: string | null = null;\n  @state() cronForm: CronFormState = { ...DEFAULT_CRON_FORM };\n  @state() cronRunsJobId: string | null = null;\n  @state() cronRuns: CronRunLogEntry[] = [];\n  @state() cronBusy = false;\n\n  @state() skillsLoading = false;\n  @state() skillsReport: SkillStatusReport | null = null;\n  @state() skillsError: string | null = null;\n  @state() skillsFilter = \"\";\n  @state() skillEdits: Record<string, string> = {};\n  @state() skillsBusyKey: string | null = null;\n  @state() skillMessages: Record<string, SkillMessage> = {};\n\n  @state() debugLoading = false;\n  @state() debugStatus: StatusSummary | null = null;\n  @state() debugHealth: HealthSnapshot | null = null;\n  @state() debugModels: unknown[] = [];\n  @state() debugHeartbeat: unknown = null;\n  @state() debugCallMethod = \"\";\n  @state() debugCallParams = \"{}\";\n  @state() debugCallResult: string | null = null;\n  @state() debugCallError: string | null = null;\n\n  @state() logsLoading = false;\n  @state() logsError: string | null = null;\n  @state() logsFile: string | null = null;\n  @state() logsEntries: LogEntry[] = [];\n  @state() logsFilterText = \"\";\n  @state() logsLevelFilters: Record<LogLevel, boolean> = {\n    ...DEFAULT_LOG_LEVEL_FILTERS,\n  };\n  @state() logsAutoFollow = true;\n  @state() logsTruncated = false;\n  @state() logsCursor: number | null = null;\n  @state() logsLastFetchAt: number | null = null;\n  @state() logsLimit = 500;\n  @state() logsMaxBytes = 250_000;\n  @state() logsAtBottom = true;\n\n  client: GatewayBrowserClient | null = null;\n  private chatScrollFrame: number | null = null;\n  private chatScrollTimeout: number | null = null;\n  private chatHasAutoScrolled = false;\n  private chatUserNearBottom = true;\n  @state() chatNewMessagesBelow = false;\n  private nodesPollInterval: number | null = null;\n  private logsPollInterval: number | null = null;\n  private debugPollInterval: number | null = null;\n  private logsScrollFrame: number | null = null;\n  private toolStreamById = new Map<string, ToolStreamEntry>();\n  private toolStreamOrder: string[] = [];\n  refreshSessionsAfterChat = new Set<string>();\n  basePath = \"\";\n  private popStateHandler = () =>\n    onPopStateInternal(this as unknown as Parameters<typeof onPopStateInternal>[0]);\n  private themeMedia: MediaQueryList | null = null;\n  private themeMediaHandler: ((event: MediaQueryListEvent) => void) | null = null;\n  private topbarObserver: ResizeObserver | null = null;\n  private keyboardHandler: ((e: KeyboardEvent) => void) | null = null;\n  private lastFocusedElement: HTMLElement | null = null;\n  @state() shortcutsHelpOpen = false;\n  @state() commandPaletteOpen = false;\n  @state() commandPaletteQuery = \"\";\n\n  createRenderRoot() {\n    return this;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    handleConnected(this as unknown as Parameters<typeof handleConnected>[0]);\n    this.setupKeyboardShortcuts();\n  }\n\n  protected firstUpdated() {\n    handleFirstUpdated(this as unknown as Parameters<typeof handleFirstUpdated>[0]);\n  }\n\n  disconnectedCallback() {\n    this.teardownKeyboardShortcuts();\n    handleDisconnected(this as unknown as Parameters<typeof handleDisconnected>[0]);\n    super.disconnectedCallback();\n  }\n\n  protected updated(changed: Map<PropertyKey, unknown>) {\n    handleUpdated(this as unknown as Parameters<typeof handleUpdated>[0], changed);\n\n    // Show toast when lastError changes (debounced)\n    if (changed.has(\"lastError\")) {\n      const newError = this.lastError;\n      if (newError && newError !== this.lastErrorToastId) {\n        if (this.errorToastDebounceTimer !== null) {\n          window.clearTimeout(this.errorToastDebounceTimer);\n        }\n        this.errorToastDebounceTimer = window.setTimeout(() => {\n          this.lastErrorToastId = newError;\n          this.showToast(\"error\", newError);\n          this.errorToastDebounceTimer = null;\n        }, 300);\n      } else if (!newError) {\n        this.lastErrorToastId = null;\n        if (this.errorToastDebounceTimer !== null) {\n          window.clearTimeout(this.errorToastDebounceTimer);\n          this.errorToastDebounceTimer = null;\n        }\n      }\n    }\n  }\n\n  connect() {\n    connectGatewayInternal(this as unknown as Parameters<typeof connectGatewayInternal>[0]);\n  }\n\n  handleChatScroll(event: Event) {\n    handleChatScrollInternal(\n      this as unknown as Parameters<typeof handleChatScrollInternal>[0],\n      event,\n    );\n  }\n\n  handleLogsScroll(event: Event) {\n    handleLogsScrollInternal(\n      this as unknown as Parameters<typeof handleLogsScrollInternal>[0],\n      event,\n    );\n  }\n\n  exportLogs(lines: string[], label: string) {\n    exportLogsInternal(lines, label);\n  }\n\n  resetToolStream() {\n    resetToolStreamInternal(this as unknown as Parameters<typeof resetToolStreamInternal>[0]);\n  }\n\n  resetChatScroll() {\n    resetChatScrollInternal(this as unknown as Parameters<typeof resetChatScrollInternal>[0]);\n  }\n\n  scrollToBottom() {\n    resetChatScrollInternal(this as unknown as Parameters<typeof resetChatScrollInternal>[0]);\n    scheduleChatScrollInternal(\n      this as unknown as Parameters<typeof scheduleChatScrollInternal>[0],\n      true,\n    );\n  }\n\n  async loadAssistantIdentity() {\n    await loadAssistantIdentityInternal(this);\n  }\n\n  applySettings(next: UiSettings) {\n    applySettingsInternal(this as unknown as Parameters<typeof applySettingsInternal>[0], next);\n  }\n\n  setTab(next: Tab) {\n    setTabInternal(this as unknown as Parameters<typeof setTabInternal>[0], next);\n  }\n\n  setTheme(next: ThemeMode, context?: Parameters<typeof setThemeInternal>[2]) {\n    setThemeInternal(this as unknown as Parameters<typeof setThemeInternal>[0], next, context);\n  }\n\n  async loadOverview() {\n    await loadOverviewInternal(this as unknown as Parameters<typeof loadOverviewInternal>[0]);\n  }\n\n  async loadCron() {\n    await loadCronInternal(this as unknown as Parameters<typeof loadCronInternal>[0]);\n  }\n\n  async handleAbortChat() {\n    await handleAbortChatInternal(this as unknown as Parameters<typeof handleAbortChatInternal>[0]);\n  }\n\n  removeQueuedMessage(id: string) {\n    removeQueuedMessageInternal(\n      this as unknown as Parameters<typeof removeQueuedMessageInternal>[0],\n      id,\n    );\n  }\n\n  async handleSendChat(\n    messageOverride?: string,\n    opts?: Parameters<typeof handleSendChatInternal>[2],\n  ) {\n    await handleSendChatInternal(\n      this as unknown as Parameters<typeof handleSendChatInternal>[0],\n      messageOverride,\n      opts,\n    );\n  }\n\n  async handleWhatsAppStart(force: boolean) {\n    await handleWhatsAppStartInternal(this, force);\n  }\n\n  async handleWhatsAppWait() {\n    await handleWhatsAppWaitInternal(this);\n  }\n\n  async handleWhatsAppLogout() {\n    await handleWhatsAppLogoutInternal(this);\n  }\n\n  async handleChannelConfigSave() {\n    await handleChannelConfigSaveInternal(this);\n  }\n\n  async handleChannelConfigReload() {\n    await handleChannelConfigReloadInternal(this);\n  }\n\n  handleNostrProfileEdit(accountId: string, profile: NostrProfile | null) {\n    handleNostrProfileEditInternal(this, accountId, profile);\n  }\n\n  handleNostrProfileCancel() {\n    handleNostrProfileCancelInternal(this);\n  }\n\n  handleNostrProfileFieldChange(field: keyof NostrProfile, value: string) {\n    handleNostrProfileFieldChangeInternal(this, field, value);\n  }\n\n  async handleNostrProfileSave() {\n    await handleNostrProfileSaveInternal(this);\n  }\n\n  async handleNostrProfileImport() {\n    await handleNostrProfileImportInternal(this);\n  }\n\n  handleNostrProfileToggleAdvanced() {\n    handleNostrProfileToggleAdvancedInternal(this);\n  }\n\n  async handleExecApprovalDecision(decision: \"allow-once\" | \"allow-always\" | \"deny\") {\n    const active = this.execApprovalQueue[0];\n    if (!active || !this.client || this.execApprovalBusy) {\n      return;\n    }\n    this.execApprovalBusy = true;\n    this.execApprovalError = null;\n    try {\n      await this.client.request(\"exec.approval.resolve\", {\n        id: active.id,\n        decision,\n      });\n      this.execApprovalQueue = this.execApprovalQueue.filter((entry) => entry.id !== active.id);\n    } catch (err) {\n      this.execApprovalError = `Exec approval failed: ${String(err)}`;\n    } finally {\n      this.execApprovalBusy = false;\n    }\n  }\n\n  handleGatewayUrlConfirm() {\n    const nextGatewayUrl = this.pendingGatewayUrl;\n    if (!nextGatewayUrl) {\n      return;\n    }\n    this.pendingGatewayUrl = null;\n    applySettingsInternal(this as unknown as Parameters<typeof applySettingsInternal>[0], {\n      ...this.settings,\n      gatewayUrl: nextGatewayUrl,\n    });\n    this.connect();\n  }\n\n  handleGatewayUrlCancel() {\n    this.pendingGatewayUrl = null;\n  }\n\n  // Sidebar handlers for tool output viewing\n  handleOpenSidebar(content: string) {\n    if (this.sidebarCloseTimer != null) {\n      window.clearTimeout(this.sidebarCloseTimer);\n      this.sidebarCloseTimer = null;\n    }\n    this.sidebarContent = content;\n    this.sidebarError = null;\n    this.sidebarOpen = true;\n  }\n\n  handleCloseSidebar() {\n    this.sidebarOpen = false;\n    // Clear content after transition\n    if (this.sidebarCloseTimer != null) {\n      window.clearTimeout(this.sidebarCloseTimer);\n    }\n    this.sidebarCloseTimer = window.setTimeout(() => {\n      if (this.sidebarOpen) {\n        return;\n      }\n      this.sidebarContent = null;\n      this.sidebarError = null;\n      this.sidebarCloseTimer = null;\n    }, 200);\n  }\n\n  handleSplitRatioChange(ratio: number) {\n    const newRatio = Math.max(0.4, Math.min(0.7, ratio));\n    this.splitRatio = newRatio;\n    this.applySettings({ ...this.settings, splitRatio: newRatio });\n  }\n\n  showToast(type: \"success\" | \"error\" | \"info\" | \"loading\", message: string) {\n    const id = generateUUID();\n    const createdAt = Date.now();\n    this.toasts = [...this.toasts.slice(-2), { id, type, message, createdAt }]; // Max 3 visible\n\n    // Auto-dismiss timers\n    if (type === \"success\") {\n      const timer = window.setTimeout(() => this.dismissToast(id), 5000);\n      this.toastTimers.set(id, timer);\n    } else if (type === \"error\") {\n      const timer = window.setTimeout(() => this.dismissToast(id), 8000);\n      this.toastTimers.set(id, timer);\n    }\n    // loading and info are indefinite (no auto-dismiss)\n  }\n\n  dismissToast(id: string) {\n    const timer = this.toastTimers.get(id);\n    if (timer !== undefined) {\n      window.clearTimeout(timer);\n      this.toastTimers.delete(id);\n    }\n    this.toasts = this.toasts.filter((t) => t.id !== id);\n  }\n\n  private setupKeyboardShortcuts() {\n    this.keyboardHandler = (e: KeyboardEvent) => {\n      // Ignore if focus is in text input/textarea/contenteditable\n      const target = e.target as HTMLElement;\n      if (target.tagName === \"INPUT\" || target.tagName === \"TEXTAREA\" || target.isContentEditable) {\n        return;\n      }\n\n      // Alt+1..9: Switch to tab by index\n      if (e.altKey && !e.ctrlKey && !e.shiftKey && !e.metaKey) {\n        const num = parseInt(e.key, 10);\n        if (num >= 1 && num <= 9) {\n          e.preventDefault();\n          const allTabs: Tab[] = [];\n          for (const group of TAB_GROUPS) {\n            allTabs.push(...group.tabs);\n          }\n          const tabIndex = num - 1;\n          if (tabIndex < allTabs.length) {\n            this.setTab(allTabs[tabIndex]);\n          }\n          return;\n        }\n      }\n\n      // Ctrl+[/Ctrl+]: Previous/next tab\n      if (e.ctrlKey && !e.altKey && !e.shiftKey && !e.metaKey) {\n        if (e.key === \"[\" || e.key === \"]\") {\n          e.preventDefault();\n          const allTabs: Tab[] = [];\n          for (const group of TAB_GROUPS) {\n            allTabs.push(...group.tabs);\n          }\n          const currentIndex = allTabs.indexOf(this.tab);\n          if (currentIndex === -1) {\n            return;\n          }\n          const direction = e.key === \"[\" ? -1 : 1;\n          const nextIndex = (currentIndex + direction + allTabs.length) % allTabs.length;\n          this.setTab(allTabs[nextIndex]);\n          return;\n        }\n      }\n\n      // r: Refresh current view\n      if (e.key === \"r\" && !e.ctrlKey && !e.altKey && !e.shiftKey && !e.metaKey) {\n        e.preventDefault();\n        if (this.tab === \"overview\") {\n          void this.loadOverview();\n        } else if (this.tab === \"channels\") {\n          void loadChannels(this as unknown as Parameters<typeof loadChannels>[0], false);\n        } else if (this.tab === \"sessions\") {\n          void loadSessions(this as unknown as Parameters<typeof loadSessions>[0]);\n        } else if (this.tab === \"logs\") {\n          void loadLogs(this as unknown as Parameters<typeof loadLogs>[0]);\n        } else if (this.tab === \"skills\") {\n          void loadSkills(this as unknown as Parameters<typeof loadSkills>[0]);\n        } else if (this.tab === \"agents\") {\n          void loadAgents(this as unknown as Parameters<typeof loadAgents>[0]);\n        } else if (this.tab === \"config\") {\n          void loadConfig(this as unknown as Parameters<typeof loadConfig>[0]);\n        }\n        return;\n      }\n\n      // Cmd/Ctrl+Shift+K: Open command palette\n      if ((e.ctrlKey || e.metaKey) && e.shiftKey && !e.altKey && e.key === \"K\") {\n        e.preventDefault();\n        this.commandPaletteOpen = true;\n        this.commandPaletteQuery = \"\";\n        // Focus will be handled in render\n        return;\n      }\n\n      // Esc: Close sidebar/modals/help/palette\n      if (e.key === \"Escape\" && !e.ctrlKey && !e.altKey && !e.shiftKey && !e.metaKey) {\n        if (this.commandPaletteOpen) {\n          e.preventDefault();\n          this.commandPaletteOpen = false;\n          this.commandPaletteQuery = \"\";\n          if (this.lastFocusedElement) {\n            this.lastFocusedElement.focus();\n            this.lastFocusedElement = null;\n          }\n          return;\n        }\n        if (this.shortcutsHelpOpen) {\n          e.preventDefault();\n          this.shortcutsHelpOpen = false;\n          if (this.lastFocusedElement) {\n            this.lastFocusedElement.focus();\n            this.lastFocusedElement = null;\n          }\n          return;\n        }\n        if (this.sidebarOpen) {\n          e.preventDefault();\n          this.handleCloseSidebar();\n          return;\n        }\n        return;\n      }\n\n      // Ctrl+/ or Ctrl+Shift+F: Focus search field\n      if (\n        (e.ctrlKey && !e.altKey && !e.metaKey && e.key === \"/\") ||\n        (e.ctrlKey && e.shiftKey && !e.altKey && !e.metaKey && e.key === \"F\")\n      ) {\n        e.preventDefault();\n        const searchInput = document.querySelector<HTMLInputElement>(\n          'input[type=\"search\"], input[placeholder*=\"Search\"], input[placeholder*=\"Filter\"]',\n        );\n        if (searchInput) {\n          searchInput.focus();\n          searchInput.select();\n        }\n        return;\n      }\n\n      // Shift+/: Show shortcuts help\n      if (e.shiftKey && !e.ctrlKey && !e.altKey && !e.metaKey && e.key === \"/\") {\n        e.preventDefault();\n        if (!this.shortcutsHelpOpen) {\n          this.lastFocusedElement = document.activeElement as HTMLElement;\n        }\n        this.shortcutsHelpOpen = !this.shortcutsHelpOpen;\n        return;\n      }\n    };\n    document.addEventListener(\"keydown\", this.keyboardHandler);\n  }\n\n  private teardownKeyboardShortcuts() {\n    if (this.keyboardHandler) {\n      document.removeEventListener(\"keydown\", this.keyboardHandler);\n      this.keyboardHandler = null;\n    }\n  }\n\n  getCommandPaletteCommands(): Array<{\n    id: string;\n    label: string;\n    keywords: string[];\n    action: () => void;\n  }> {\n    const allTabs: Tab[] = [];\n    for (const group of TAB_GROUPS) {\n      allTabs.push(...group.tabs);\n    }\n\n    const commands: Array<{ id: string; label: string; keywords: string[]; action: () => void }> =\n      [];\n\n    // Tab navigation\n    for (const tab of allTabs) {\n      commands.push({\n        id: `tab-${tab}`,\n        label: `Go to ${titleForTab(tab)}`,\n        keywords: [tab, titleForTab(tab).toLowerCase()],\n        action: () => {\n          this.setTab(tab);\n          this.commandPaletteOpen = false;\n        },\n      });\n    }\n\n    // Refresh current view\n    commands.push({\n      id: \"refresh\",\n      label: \"Refresh current view\",\n      keywords: [\"refresh\", \"reload\"],\n      action: () => {\n        if (this.tab === \"overview\") {\n          void this.loadOverview();\n        } else if (this.tab === \"channels\") {\n          void loadChannels(this as unknown as Parameters<typeof loadChannels>[0], false);\n        } else if (this.tab === \"sessions\") {\n          void loadSessions(this as unknown as Parameters<typeof loadSessions>[0]);\n        } else if (this.tab === \"logs\") {\n          void loadLogs(this as unknown as Parameters<typeof loadLogs>[0]);\n        } else if (this.tab === \"skills\") {\n          void loadSkills(this as unknown as Parameters<typeof loadSkills>[0]);\n        } else if (this.tab === \"agents\") {\n          void loadAgents(this as unknown as Parameters<typeof loadAgents>[0]);\n        } else if (this.tab === \"config\") {\n          void loadConfig(this as unknown as Parameters<typeof loadConfig>[0]);\n        }\n        this.commandPaletteOpen = false;\n      },\n    });\n\n    // Toggle theme\n    commands.push({\n      id: \"toggle-theme\",\n      label: `Switch to ${this.themeResolved === \"dark\" ? \"light\" : \"dark\"} theme`,\n      keywords: [\"theme\", \"dark\", \"light\", \"toggle\"],\n      action: () => {\n        this.setTheme(this.themeResolved === \"dark\" ? \"light\" : \"dark\");\n        this.commandPaletteOpen = false;\n      },\n    });\n\n    // Toggle focus mode\n    commands.push({\n      id: \"toggle-focus\",\n      label: `${this.settings.chatFocusMode ? \"Disable\" : \"Enable\"} focus mode`,\n      keywords: [\"focus\", \"mode\"],\n      action: () => {\n        this.applySettings({\n          ...this.settings,\n          chatFocusMode: !this.settings.chatFocusMode,\n        });\n        this.commandPaletteOpen = false;\n      },\n    });\n\n    // New session (if in chat)\n    if (this.tab === \"chat\") {\n      commands.push({\n        id: \"new-session\",\n        label: \"New chat session\",\n        keywords: [\"new\", \"session\", \"chat\"],\n        action: () => {\n          this.sessionKey = `session-${Date.now()}`;\n          this.chatMessage = \"\";\n          this.resetToolStream();\n          this.applySettings({\n            ...this.settings,\n            sessionKey: this.sessionKey,\n            lastActiveSessionKey: this.sessionKey,\n          });\n          void this.loadAssistantIdentity();\n          this.commandPaletteOpen = false;\n        },\n      });\n    }\n\n    return commands;\n  }\n\n  render() {\n    return renderApp(this as unknown as AppViewState);\n  }\n}\n"],"names":["loadChannels","state","probe","res","err","startWhatsAppLogin","force","waitWhatsAppLogin","logoutWhatsApp","cloneConfigObject","value","serializeConfigForm","form","setPathValue","obj","path","current","i","key","nextKey","record","lastKey","removePathValue","loadConfig","applyConfigSnapshot","loadConfigSchema","applyConfigSchema","snapshot","rawFromSnapshot","saveConfig","raw","baseHash","applyConfig","runUpdate","updateConfigFormValue","base","removeConfigFormValue","isFormDirty","values","original","renderNostrProfileForm","params","callbacks","accountId","isDirty","renderField","field","label","opts","type","placeholder","maxLength","help","error","inputId","html","e","target","nothing","renderPicturePreview","picture","img","createNostrProfileFormState","profile","handleWhatsAppStart","host","handleWhatsAppWait","handleWhatsAppLogout","handleChannelConfigSave","handleChannelConfigReload","parseValidationErrors","details","errors","entry","rawField","rest","message","resolveNostrAccountId","buildNostrProfileUrl","suffix","handleNostrProfileEdit","handleNostrProfileCancel","handleNostrProfileFieldChange","handleNostrProfileToggleAdvanced","handleNostrProfileSave","response","data","errorMessage","handleNostrProfileImport","merged","nextValues","showAdvanced","parseAgentSessionKey","sessionKey","parts","agentId","NEAR_BOTTOM_THRESHOLD","scheduleChatScroll","pickScrollTarget","container","overflowY","distanceFromBottom","effectiveForce","retryDelay","latest","latestDistanceFromBottom","scheduleLogsScroll","handleChatScroll","event","handleLogsScroll","resetChatScroll","exportLogs","lines","blob","url","anchor","stamp","observeTopbar","topbar","update","height","loadDebug","status","health","models","heartbeat","modelPayload","callDebugMethod","LOG_BUFFER_LIMIT","LEVELS","parseMaybeJsonString","trimmed","parsed","normalizeLevel","lowered","parseLogLine","line","meta","time","level","contextCandidate","contextObj","subsystem","loadLogs","payload","entries","shouldReset","loadNodes","startNodesPolling","stopNodesPolling","startLogsPolling","stopLogsPolling","startDebugPolling","stopDebugPolling","loadAgentIdentity","loadAgentIdentities","agentIds","missing","id","loadAgentSkills","loadAgents","selected","known","QUICK_TAG_RE","FINAL_TAG_RE","THINKING_TAG_RE","findCodeRegions","text","regions","fencedRe","match","start","inlineRe","end","r","a","b","isInsideCode","pos","applyTrim","mode","stripReasoningTagsFromText","options","cleaned","finalMatches","preCodeRegions","m","codeRegions","result","lastIndex","inThinking","idx","isClose","formatMs","ms","formatAgo","diff","sec","min","hr","formatDurationMs","formatList","v","clampText","max","truncateText","toNumber","fallback","stripThinkingTags","loadCronStatus","loadCronJobs","buildCronSchedule","amount","unit","expr","buildCronPayload","timeoutSeconds","addCronJob","schedule","job","toggleCronJob","enabled","runCronJob","loadCronRuns","removeCronJob","jobId","STORAGE_KEY","normalizeRole","role","normalizeScopes","scopes","out","scope","readStore","writeStore","store","loadDeviceAuthToken","storeDeviceAuthToken","next","existing","clearDeviceAuthToken","ed25519_CURVE","P","N","Gx","Gy","_a","_d","h","L","L2","captureTrace","args","isBig","n","isStr","s","isBytes","abytes","length","title","bytes","len","needsLen","prefix","ofLen","got","u8n","u8fr","buf","padh","pad","bytesToHex","C","_ch","ch","hexToBytes","hex","hl","al","array","ai","hi","n1","n2","cr","subtle","concatBytes","arrs","sum","randomBytes","big","assertRange","msg","M","modN","invert","num","md","x","u","q","callHash","name","fn","hashes","apoint","p","Point","B256","X","Y","Z","T","zip215","d","normed","lastByte","y","bytesToNumLE","y2","isValid","uvRatio","isXOdd","isLastByteOdd","X2","Y2","Z2","Z4","aX2","left","right","XY","ZT","other","X1","Y1","Z1","X1Z2","X2Z1","Y1Z2","Y2Z1","I","A","B","D","x1y1","E","G","F","H","X3","Y3","T3","Z3","T1","T2","safe","wNAF","f","scalar","iz","numTo32bLE","pow2","power","pow_2_252_3","b2","b4","b5","b10","b20","b40","b80","b160","b240","b250","RM1","v3","v7","pow","vx2","root1","root2","useRoot1","useRoot2","noRoot","modL_LE","hash","sha512a","sha512s","hash2extK","hashed","head","point","pointBytes","getExtendedPublicKeyAsync","secretKey","getExtendedPublicKey","getPublicKeyAsync","hashFinishA","_sign","rBytes","R","S","signAsync","randomSecretKey","seed","utils","W","scalarBits","pwindows","pwindowSize","precompute","points","w","Gpows","ctneg","cnd","comp","pow_2_w","maxNum","mask","shiftBy","wbits","off","offF","offP","isEven","isNeg","base64UrlEncode","binary","byte","base64UrlDecode","input","normalized","padded","fingerprintPublicKey","publicKey","generateIdentity","privateKey","loadOrCreateDeviceIdentity","derivedId","updated","identity","stored","signDevicePayload","privateKeyBase64Url","sig","loadDevices","approveDevicePairing","requestId","rejectDevicePairing","rotateDeviceToken","revokeDeviceToken","resolveExecApprovalsRpc","nodeId","resolveExecApprovalsSaveRpc","loadExecApprovals","rpc","applyExecApprovalsSnapshot","saveExecApprovals","file","updateExecApprovalsFormValue","removeExecApprovalsFormValue","loadPresence","loadSessions","overrides","includeGlobal","includeUnknown","activeMinutes","limit","patchSession","patch","deleteSession","setSkillMessage","getErrorMessage","loadSkills","updateSkillEdit","skillKey","updateSkillEnabled","saveSkillApiKey","apiKey","installSkill","installId","successMsg","TAB_GROUPS","TAB_PATHS","PATH_TO_TAB","tab","normalizeBasePath","basePath","normalizePath","pathForTab","tabFromPath","pathname","inferBasePathFromPathname","segments","candidate","iconForTab","titleForTab","subtitleForTab","KEY","loadSettings","defaults","saveSettings","getSystemTheme","resolveTheme","clamp01","hasReducedMotionPreference","cleanupThemeTransition","root","startThemeTransition","nextTheme","applyTheme","context","currentTheme","documentReference","document_","prefersReducedMotion","xPercent","yPercent","rect","transition","applySettings","applyResolvedTheme","setLastActiveSessionKey","applySettingsFromUrl","tokenRaw","passwordRaw","sessionRaw","gatewayUrlRaw","shouldCleanUrl","token","password","session","gatewayUrl","setTab","refreshActiveTab","syncUrlWithTab","setTheme","loadOverview","loadChannelsTab","loadCron","refreshChat","inferBasePath","configured","syncThemeWithSettings","resolved","attachThemeListener","detachThemeListener","syncTabWithLocation","replace","setTabFromRoute","onPopState","targetPath","currentPath","syncUrlWithSessionKey","TOOL_STREAM_LIMIT","TOOL_STREAM_THROTTLE_MS","TOOL_OUTPUT_CHAR_LIMIT","extractToolOutputText","content","item","part","formatToolOutput","contentText","truncated","buildToolStreamMessage","trimToolStream","overflow","removed","syncToolStreamMessages","flushToolStreamSync","scheduleToolStreamSync","resetToolStream","COMPACTION_TOAST_DURATION_MS","handleCompactionEvent","phase","handleAgentEvent","toolCallId","output","now","ENVELOPE_PREFIX","ENVELOPE_CHANNELS","textCache","thinkingCache","looksLikeEnvelopeHeader","header","stripEnvelope","extractText","joined","extractTextCached","extractThinking","rawText","extractRawText","extracted","extractThinkingCached","formatReasoningMarkdown","warnedWeakCrypto","uuidFromBytes","weakRandomBytes","warnWeakCryptoOnce","generateUUID","cryptoLike","loadChatHistory","dataUrlToBase64","dataUrl","sendChatMessage","attachments","hasAttachments","contentBlocks","att","runId","apiAttachments","abortChatRun","handleChatEvent","CHAT_SESSIONS_ACTIVE_MINUTES","isChatBusy","isChatStopCommand","isChatResetCommand","handleAbortChat","enqueueChatMessage","refreshSessions","sendChatMessageNow","ok","flushChatQueue","removeQueuedMessage","handleSendChat","messageOverride","previousDraft","attachmentsToSend","refreshChatAvatar","flushChatQueueForEvent","resolveAgentIdForSession","buildAvatarMetaUrl","encoded","avatarUrl","DEFAULT_LOG_LEVEL_FILTERS","DEFAULT_CRON_FORM","MAX_ASSISTANT_NAME","MAX_ASSISTANT_AVATAR","DEFAULT_ASSISTANT_NAME","coerceIdentityValue","normalizeAssistantIdentity","avatar","resolveInjectedAssistantIdentity","loadAssistantIdentity","isRecord","parseExecApprovalRequested","request","command","createdAtMs","expiresAtMs","parseExecApprovalResolved","pruneExecApprovalQueue","queue","addExecApproval","removeExecApproval","buildDeviceAuthPayload","version","GATEWAY_CLIENT_IDS","GATEWAY_CLIENT_NAMES","GATEWAY_CLIENT_MODES","CONNECT_FAILED_CLOSE_CODE","GatewayBrowserClient","ev","reason","delay","isSecureContext","deviceIdentity","canFallbackToShared","authToken","storedToken","auth","device","signedAtMs","nonce","signature","hello","frame","evt","seq","pending","method","resolve","reject","normalizeSessionKeyForDefaults","mainSessionKey","mainKey","defaultAgentId","applySessionDefaults","resolvedSessionKey","resolvedSettingsSessionKey","resolvedLastActiveSessionKey","nextSessionKey","nextSettings","shouldUpdateSettings","connectGateway","applySnapshot","code","connectionState","errorMsg","handleGatewayEvent","expected","received","handleGatewayEventUnsafe","handleConnected","handleFirstUpdated","handleDisconnected","handleUpdated","changed","forcedByTab","forcedByLoad","o","c","t","icons","renderTab","href","isActive","renderChatControls","resolveMainSessionKey","sessionOptions","resolveSessionOptions","disableThinkingToggle","disableFocusToggle","showThinking","focusActive","refreshIcon","focusIcon","repeat","sessions","row","resolveSessionDisplayName","displayName","seen","resolvedMain","resolvedCurrent","THEME_ORDER","renderThemeToggle","index","renderMonitorIcon","renderSunIcon","renderMoonIcon","mergeFileEntry","list","nextFiles","loadAgentFiles","loadAgentFileContent","saveAgentFile","TOOL_NAME_ALIASES","TOOL_GROUPS","TOOL_PROFILES","normalizeToolName","normalizeToolList","expandToolGroups","expanded","group","resolveToolProfilePolicy","formatPresenceSummary","ip","formatPresenceAge","ts","formatNextRun","formatSessionTokens","total","ctx","formatEventPayload","formatCronState","last","formatCronSchedule","formatCronPayload","TOOL_SECTIONS","PROFILE_OPTIONS","normalizeAgentLabel","agent","isLikelyEmoji","hasNonAscii","resolveAgentEmoji","agentIdentity","identityEmoji","agentEmoji","identityAvatar","agentBadgeText","defaultId","formatBytes","units","size","unitIndex","resolveAgentConfig","config","cfg","buildAgentContext","configForm","agentFilesList","workspace","modelLabel","resolveModelLabel","identityName","skillFilter","skillCount","model","primary","fallbackCount","normalizeModelValue","resolveModelPrimary","resolveModelFallbacks","fallbacks","parseFallbackList","resolveConfiguredModels","modelId","modelRaw","alias","buildModelOptions","hasCurrent","option","compilePattern","pattern","escaped","compilePatterns","patterns","matchesAny","isAllowedByPolicy","policy","deny","allow","matchesList","renderAgents","props","agents","selectedId","selectedAgent","badge","emoji","renderAgentHeader","renderAgentTabs","panel","renderAgentOverview","renderAgentFiles","renderAgentTools","renderAgentSkills","renderAgentChannels","renderAgentCron","subtitle","active","onSelect","agentIdentityLoading","agentIdentityError","configLoading","configSaving","configDirty","onConfigReload","onConfigSave","onModelChange","onModelFallbacksChange","defaultModel","modelPrimary","defaultPrimary","effectivePrimary","modelFallbacks","fallbackText","identityStatus","isDefault","renderAgentContextCard","resolveChannelLabel","resolveChannelEntries","ids","ordered","CHANNEL_EXTRA_FIELDS","resolveChannelConfigValue","channelId","fromChannels","formatChannelExtraValue","resolveChannelExtras","summarizeChannelAccounts","accounts","connected","account","probeOk","lastSuccessLabel","summary","extras","extra","jobs","files","activeEntry","baseContent","draft","renderAgentFileRow","agentTools","globalTools","profileSource","hasAgentAllow","hasGlobalAllow","editable","alsoAllow","basePolicy","toolIds","section","tool","resolveAllowed","toolId","baseAllowed","extraAllowed","denied","enabledCount","updateTool","nextEnabled","nextAllow","nextDeny","updateAll","allowed","SKILL_SOURCE_GROUPS","groupSkills","skills","groups","def","skill","allowlist","allowSet","usingAllowlist","reportReady","rawSkills","filter","filtered","totalCount","renderAgentSkillGroup","collapsedByDefault","renderAgentSkillRow","reasons","schemaType","schema","defaultValue","pathKey","segment","hintForPath","hints","direct","hintKey","hint","hintSegments","humanize","isSensitivePath","META_KEYS","isAnySchema","jsonValue","renderNode","unsupported","disabled","onPatch","showLabel","nonNull","extractLiteral","literals","allLiterals","resolvedValue","lit","renderSelect","primitiveTypes","variant","normalizedTypes","hasString","hasNumber","renderTextInput","opt","renderObject","renderArray","displayValue","renderNumberInput","inputType","isSensitive","numValue","currentIndex","unset","val","sorted","orderA","orderB","reserved","additional","allowExtra","propKey","node","renderMapField","itemsSchema","arr","reservedKeys","anySchema","entryValue","valuePath","sectionIcons","SECTION_META","getSectionIcon","matchesSearch","query","schemaMatches","propSchema","items","unions","renderConfigForm","properties","searchQuery","activeSection","activeSubsection","filteredEntries","subsectionContext","sectionSchema","sectionKey","subsectionKey","description","sectionValue","scopedValue","normalizeEnum","nullable","enumValues","analyzeConfigSchema","normalizeSchemaNode","pathLabel","union","normalizeUnion","enumNullable","normalizedProps","remaining","unique","resolveSchemaNode","resolveChannelValue","EXTRA_CHANNEL_FIELDS","formatExtraValue","renderExtraChannelFields","renderChannelConfigForm","analysis","configValue","renderChannelConfigSection","renderDiscordCard","discord","accountCountLabel","renderGoogleChatCard","googleChat","renderIMessageCard","imessage","truncatePubkey","pubkey","renderNostrCard","nostr","nostrAccounts","profileFormState","profileFormCallbacks","onEditProfile","primaryAccount","summaryConfigured","summaryRunning","summaryPublicKey","summaryLastStartAt","summaryLastError","hasMultipleAccounts","showingForm","renderAccountCard","renderProfileSection","about","nip05","hasAnyProfileData","formatDuration","channelEnabled","channels","channelStatus","running","accountActive","getChannelAccountCount","channelAccounts","renderChannelAccountCount","count","renderSignalCard","signal","renderSlackCard","slack","renderTelegramCard","telegram","telegramAccounts","botUsername","renderWhatsAppCard","whatsapp","renderChannels","orderedChannels","resolveChannelOrder","channel","renderChannel","showForm","renderGenericChannelCard","lastError","renderGenericAccount","resolveChannelMetaMap","RECENT_ACTIVITY_THRESHOLD_MS","hasRecentActivity","deriveRunningStatus","deriveConnectedStatus","runningStatus","connectedStatus","marked","allowedTags","allowedAttrs","hooksInstalled","MARKDOWN_CHAR_LIMIT","MARKDOWN_PARSE_LIMIT","MARKDOWN_CACHE_LIMIT","MARKDOWN_CACHE_MAX_CHARS","markdownCache","getCachedMarkdown","cached","setCachedMarkdown","oldest","installHooks","DOMPurify","toSanitizedMarkdownHtml","markdown","escapeHtml","sanitized","rendered","COPIED_FOR_MS","ERROR_FOR_MS","COPY_LABEL","COPIED_LABEL","ERROR_LABEL","copyTextToClipboard","setButtonLabel","button","createCopyButton","idleLabel","btn","copied","renderCopyAsMarkdownButton","COPY_ICON_SVG","attachCopyButtonsToCodeBlocks","pre","copiedTimeout","normalizeMessage","hasToolId","contentRaw","contentItems","hasToolContent","hasToolName","timestamp","normalizeRoleForGrouping","lower","isToolResultMessage","TOOL_DISPLAY_CONFIG","rawConfig","FALLBACK","TOOL_MAP","defaultTitle","normalizeVerb","coerceDisplayValue","firstLine","preview","lookupValueByPath","resolveDetailFromKeys","keys","display","resolveReadDetail","offset","resolveWriteDetail","resolveActionSpec","spec","action","resolveToolDisplay","icon","actionRaw","actionSpec","verb","detail","detailKeys","shortenHomeInString","formatToolDetail","TOOL_INLINE_THRESHOLD","PREVIEW_MAX_LINES","PREVIEW_MAX_CHARS","formatToolOutputForSidebar","getTruncatedPreview","allLines","extractToolCards","normalizeContent","cards","kind","coerceArgs","extractToolText","card","renderToolCardSidebar","onOpenSidebar","hasText","canClick","handleClick","info","isShort","showCollapsed","showInline","isEmpty","extractImages","images","block","source","mediaType","imageUrl","renderReadingIndicatorGroup","assistant","renderAvatar","renderStreamingGroup","startedAt","renderGroupedMessage","renderMessageGroup","normalizedRole","assistantName","who","roleClass","assistantAvatar","initial","className","isAvatarUrl","renderMessageImages","isToolResult","toolCards","hasToolCards","hasImages","extractedText","extractedThinking","markdownBase","reasoningMarkdown","canCopyMarkdown","bubbleClasses","ref","el","unsafeHTML","renderMarkdownSidebar","ResizableDivider","LitElement","containerWidth","deltaRatio","newRatio","css","__decorateClass","property","customElement","adjustTextareaHeight","renderCompactionIndicator","generateAttachmentId","handlePaste","imageItems","reader","newAttachment","renderAttachmentPreview","renderChat","canCompose","isBusy","canAbort","reasoningLevel","showReasoning","assistantIdentity","composePlaceholder","splitRatio","sidebarOpen","thread","buildChatItems","CHAT_HISTORY_RENDER_LIMIT","groupMessages","currentGroup","history","tools","historyStart","messageKey","messageId","sidebarIcons","SECTIONS","ALL_SUBSECTION","resolveSectionMeta","resolveSubsections","uiHints","subKey","order","computeDiff","changes","compare","orig","curr","origObj","currObj","allKeys","truncateValue","maxLen","str","renderConfig","validity","formUnsafe","schemaProps","availableSections","knownKeys","extraSections","k","allSections","activeSectionSchema","activeSectionMeta","subsections","allowSubnav","isAllSubsection","effectiveSubsection","hasRawChanges","hasChanges","canSaveForm","canSave","canApply","canUpdate","change","buildChannelOptions","renderCron","channelOptions","renderScheduleFields","renderJob","renderRun","itemClass","renderDebug","securitySummary","critical","warn","securityTone","securityLabel","formatRemaining","totalSeconds","minutes","renderMetaRow","renderExecApprovalPrompt","remainingMs","queueCount","renderGatewayUrlConfirmation","pendingGatewayUrl","renderInstances","renderEntry","lastInput","roles","scopesLabel","formatTime","date","matchesFilter","needle","renderLogs","levelFiltered","exportLabel","renderNodes","bindingState","resolveBindingsState","approvalsState","resolveExecApprovalsState","renderExecApprovals","renderBindings","renderDevices","paired","req","renderPendingDevice","renderPairedDevice","age","repair","tokens","renderTokenRow","deviceId","when","EXEC_APPROVALS_DEFAULT_SCOPE","SECURITY_OPTIONS","ASK_OPTIONS","nodes","resolveExecNodes","defaultBinding","resolveAgentBindings","ready","normalizeSecurity","normalizeAsk","resolveExecApprovalsDefaults","resolveConfigAgents","agentsNode","resolveExecApprovalsAgents","configAgents","approvalsAgents","aLabel","bLabel","resolveExecApprovalsScope","targetNodes","resolveExecApprovalsNodes","targetNodeId","selectedScope","supportsBinding","renderAgentBinding","targetReady","renderExecApprovalsTarget","renderExecApprovalsTabs","renderExecApprovalsPolicy","renderExecApprovalsAllowlist","hasNodes","nodeValue","first","isDefaults","agentSecurity","agentAsk","agentAskFallback","securityValue","askValue","askFallbackValue","autoOverride","autoEffective","autoIsDefault","allowlistPath","renderAllowlistEntry","lastUsed","lastCommand","lastPath","bindingValue","cmd","fallbackAgent","exec","execEntry","binding","caps","commands","renderOverview","uptime","tick","authHint","hasToken","hasPassword","insecureContextHint","THINK_LEVELS","BINARY_THINK_LEVELS","VERBOSE_LEVELS","REASONING_LEVELS","normalizeProviderId","provider","isBinaryThinkingProvider","resolveThinkLevelOptions","resolveThinkLevelDisplay","isBinary","resolveThinkLevelPatchValue","renderSessions","rows","filterText","renderRow","onDelete","rawThinking","isBinaryThinking","thinking","thinkLevels","verbose","reasoning","canLink","chatUrl","renderSkills","renderSkill","busy","canInstall","AVATAR_DATA_RE","AVATAR_HTTP_RE","resolveAssistantAvatarUrl","renderApp","presenceCount","sessionsCount","cronNext","chatDisabledReason","isChat","chatFocus","assistantAvatarUrl","chatAvatarUrl","resolvedAgentId","toast","isGroupCollapsed","hasActiveTab","clearAllow","skillName","normalizedSkill","allSkills","agentIndex","ratio","allCommands","kw","selectedIndex","injectedAssistantIdentity","resolveOnboardingMode","OpenClawApp","onPopStateInternal","newError","connectGatewayInternal","handleChatScrollInternal","handleLogsScrollInternal","exportLogsInternal","resetToolStreamInternal","resetChatScrollInternal","scheduleChatScrollInternal","loadAssistantIdentityInternal","applySettingsInternal","setTabInternal","setThemeInternal","loadOverviewInternal","loadCronInternal","handleAbortChatInternal","removeQueuedMessageInternal","handleSendChatInternal","handleWhatsAppStartInternal","handleWhatsAppWaitInternal","handleWhatsAppLogoutInternal","handleChannelConfigSaveInternal","handleChannelConfigReloadInternal","handleNostrProfileEditInternal","handleNostrProfileCancelInternal","handleNostrProfileFieldChangeInternal","handleNostrProfileSaveInternal","handleNostrProfileImportInternal","handleNostrProfileToggleAdvancedInternal","decision","nextGatewayUrl","createdAt","timer","allTabs","tabIndex","direction","nextIndex","searchInput"],"mappings":"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","x_google_ignoreList":[18,44,45,67]}